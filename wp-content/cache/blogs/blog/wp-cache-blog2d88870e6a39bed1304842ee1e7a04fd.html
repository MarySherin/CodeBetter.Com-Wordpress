<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>CodeBetter.Com | Stuff you need to Code Better!</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/xmlrpc.php" />
	                <link rel="stylesheet" href="/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='CodeBetter.Com' href='http://codebetter.com/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<meta name="_awb_version" content="2.0.3" /><link rel="stylesheet" href="/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.6" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="/wp-content/uploads/spacker-cache/3e52f3b292da95601a0d3fbd9775ac0e.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content">
			<div id="main" class="grid_8">
			<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://feeds.feedburner.com/CodeBetter"  rel="nofollow"><img src="http://www2.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://feeds.feedburner.com/CodeBetter" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div>			
	<div id="nav-above" class="navigation">
		<div class="nav-previous"><a href="?page=0" >&laquo; Previous Page</a></div>
		<div class="nav-next"><a href="?page=2" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-above -->


				
			<div id="post-820" class="post-820 post type-post status-publish format-standard hentry category-fubumvc">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/11/building-a-simple-fubumvc-convention/" title="Permalink to Building a Simple FubuMVC Convention" rel="bookmark">Building a Simple FubuMVC Convention</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/11/building-a-simple-fubumvc-convention/" title="9:38 am" rel="bookmark"><span class="entry-date">January 11, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>I will fix the *&amp;^%*ing code formatting later.</p>
<p>In my last missive I gave a high level explanation of FubuMVC’s <a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvcs-configuration-strategy/">configuration strategy</a>.  Before going deep into the details, let’s look at a simple example that demonstrates both the runtime and configuration architecture of FubuMVC.  I’m going to push this into FubuMVC.Core afterwards.</p>
<p>A friend of mine recently worked on a project where they were building several Json endpoints with a REST inspired architecture.  Most of their endpoints took in a message, did something, then simply returned an Http status code to denote success or failure.</p>
<p>Let’s say that you are building that same system the “FubuMVC way,” meaning we want FubuMVC to take care of the consistent actions like deserializing json and writing the status code to the http response.  Using the idea of “one model in, one model out,” all of my actions would take in the input message and just return an System.Net.HttpStatusCode object like this one:</p>
<pre><span style="color: green">// JsonMessage is just a marker interface
// FubuMVC doesn't yet support "conneg" -- but should
// We take pull requests!
</span><span style="color: blue">public class </span><span style="color: #2b91af">InputMessage </span>: <span style="color: #2b91af">JsonMessage </span>{}

<span style="color: blue">public class </span><span style="color: #2b91af">RestfulService
</span>{
    <span style="color: blue">public </span><span style="color: #2b91af">HttpStatusCode </span>Action1(<span style="color: #2b91af">InputMessage </span>message)
    {
        <span style="color: green">// perform the action
        </span><span style="color: blue">return </span><span style="color: #2b91af">HttpStatusCode</span>.OK;
    }
}</pre>
<p>When I unit test that service method above I can simply assert that the status code returned matches what I expected for the input message.  No FubuMVC internals to get in the way.</p>
<p>As of now, FubuMVC doesn’t know how to handle actions that return just an HttpStatusCode.  We’ll need to build out two pieces, a runtime behavior that writes the status code and a convention that puts this runtime behavior in the chain after the right actions.</p>
<p>The runtime is pretty simple, it’s just this little class here that implements the <a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/">IActionBehavior interface</a>:</p>
<pre><span style="font-family: Consolas"><span style="color: #000000"><span>    </span></span><span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">class</span><span style="color: #000000"> </span><span style="color: #2b91af">RenderStatusCodeBehavior</span><span style="color: #000000"> : </span><span style="color: #2b91af">IActionBehavior</span>
</span></span><span><span style="font-family: Consolas"><span style="color: #000000">    {
        </span><span style="color: #0000ff">private</span><span style="color: #000000"> </span><span style="color: #0000ff">readonly</span><span style="color: #000000"> </span><span style="color: #2b91af">IFubuRequest</span></span><span style="font-family: Consolas"><span style="color: #000000"> _request;
        </span><span style="color: #0000ff">private</span><span style="color: #000000"> </span><span style="color: #0000ff">readonly</span><span style="color: #000000"> </span><span style="color: #2b91af">IOutputWriter</span></span><span style="font-family: Consolas"><span style="color: #000000"> _writer;

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> RenderStatusCodeBehavior(</span><span style="color: #2b91af">IFubuRequest</span><span style="color: #000000"> request, </span></span></span><span style="color: #444444;font-family: Georgia, 'Bitstream Charter', serif;line-height: 22px"><span style="font-family: Consolas"><span style="color: #2b91af">IOutputWriter</span></span><span style="font-family: Consolas"><span style="color: #000000"> writer)</span></span></span>
<span><span style="font-family: Consolas"><span style="color: #000000"><span style="color: #000000">        {
            _request = request;
            _writer = writer;
        }

        </span></span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span></span><span style="font-family: Consolas"><span style="color: #000000"> Invoke()
        {
            </span><span style="color: #008000">// There is a T Get&lt;T&gt;() method on IFubuRequest, but in</span>
<span style="color: #000000">            </span><span style="color: #008000">// my infinite wisdom I made it so that it only works </span>
<span style="color: #000000">            </span><span style="color: #008000">// for reference types</span>
<span style="color: #000000">            </span><span style="color: #0000ff">var</span><span style="color: #000000"> status = (</span><span style="color: #2b91af">HttpStatusCode</span><span style="color: #000000">)_request</span></span></span><span><span style="font-family: Consolas"><span style="color: #000000">.Get(</span><span style="color: #0000ff">typeof</span><span style="color: #000000"> (</span><span style="color: #2b91af">HttpStatusCode</span></span></span><span style="font-family: Consolas"><span><span style="color: #000000">));</span></span></span>
<span style="font-family: Consolas"><span style="color: #000000"><span style="color: #000000;font-family: Consolas">            _writer.WriteResponseCode(status);
        }

        </span></span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span><span style="color: #000000"> InvokePartial()
        {
            Invoke();
        }
    }</span></span></pre>
<p>Now that the runtime works we just need to add some conventions to the FubuRegistry for the application like this:</p>
<pre><span style="font-family: Consolas"><span style="color: #000000"><span>    </span></span><span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">class</span><span style="color: #000000"> </span><span style="color: #2b91af">RestfulServicesRegistry</span><span style="color: #000000"> : </span><span style="color: #2b91af">FubuRegistry</span>
</span></span><span><span style="font-family: Consolas"><span style="color: #000000">    {
        </span><span style="color: #0000ff">public</span></span><span style="font-family: Consolas"><span style="color: #000000"> RestfulServicesRegistry()
        {
          </span><span style="color: #008000">// Need to tell FubuMVC which classes are actions</span>
<span style="color: #000000">          Actions.IncludeTypes(x =&gt; </span></span></span><span style="color: #444444;font-family: Georgia, 'Bitstream Charter', serif;line-height: 22px"><span style="font-family: Consolas"><span style="color: #000000">x.IsInNamespace(</span><span style="color: #a31515">"RestfulStatusCodeServices"</span></span><span style="font-family: Consolas"><span style="color: #000000">));</span></span></span>
<span><span style="font-family: Consolas"><span style="color: #000000"><span style="color: #000000">          </span></span><span style="color: #008000">// Tell FubuMVC to toss the RenderStatusCodeBehavior on</span>
<span style="color: #008000">          // the back of any behavior chain where the action returns</span>
<span style="color: #008000">          // an HttpStatusCode</span>
<span style="color: #000000">          Output.ToBehavior&lt;</span><span style="color: #2b91af">RenderStatusCodeBehavior</span></span><span style="font-family: Consolas"><span style="color: #000000">&gt;()
              .WhenTheOutputModelIs&lt;</span><span style="color: #2b91af">HttpStatusCode</span></span></span><span style="font-family: Consolas"><span><span style="color: #000000">&gt;();</span></span></span>
<span style="font-family: Consolas"><span><span style="color: #000000">          Routes
              .ConstrainToHttpMethod(x =&gt; x.OutputType()</span></span></span><span style="color: #444444;font-family: Georgia, 'Bitstream Charter', serif;line-height: 22px"><span style="color: #000000"> == </span><span style="color: #0000ff">typeof</span><span style="color: #000000">(</span><span style="color: #2b91af">HttpStatusCode</span><span style="color: #000000">), </span><span style="color: #a31515">"POST"</span><span style="color: #000000">)</span></span>
<span style="font-family: Consolas"><span><span style="color: #000000"><span style="color: #000000">              .IgnoreControllerNamespaceEntirely();
        }
    }</span></span></span></span></pre>
<p>&nbsp;</p>
<p>That wasn’t horrible now was it?  This most certainly is not everyday FubuMVC usage, but when you do need to tailor the way FubuMVC works for your project, you can.</p>
<p>P.S. This is going into FubuMVC’s default conventions, so you don’t need to build this yourself or even copy the code.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/fubumvc/" title="View all posts in FubuMVC" rel="category">FubuMVC</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/11/building-a-simple-fubumvc-convention/#respond" title="Comment on Building a Simple FubuMVC Convention"><span class="dsq-postid" rel="820 http://codebetter.com/jeremymiller/2011/01/11/building-a-simple-fubumvc-convention/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-820 -->

		
						
			<div id="post-814" class="post-814 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvcs-configuration-strategy/" title="Permalink to FubuMVC&rsquo;s Configuration Strategy" rel="bookmark">FubuMVC&rsquo;s Configuration Strategy</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvcs-configuration-strategy/" title="6:03 pm" rel="bookmark"><span class="entry-date">January 10, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>To continue my blogging blast on FubuMVC, it’s time to talk about how fubu is configured.  For long time FubuMVC followers, there was a flurry of commits just before Christmas this year to support the new packaging model that greatly changed how you bootstrap a FubuMVC application.  I’ll blog about packaging soon, but for right now, let’s catch up on basic bootstrapping.</p>
<p>In contrast to the other .Net web frameworks, FubuMVC has by far and away the simplest runtime model.  The real world being imperfect, we achieved that runtime simplicity by relying on the configuration subsystem to determine how the runtime objects would be assembled at application startup time, then to “bake” that object assembly into the underlying IoC container in your application.  <em>That</em> code was non-trivial to write.</p>
<h2>In the beginning…</h2>
<p>At the tail end of 2009 I had a window of opportunity at work to basically reboot FubuMVC from scratch (about the time we moved to GitHub[LINK]).  At Dovetail we had already tried a couple iterations of what I now call “proto-fubu” plus the initial versions of FubuMVC that all used something similar to what’s now the “behaviors” runtime model.  From that experience we had a pretty good idea of how the runtime model was going to look, but we had struggled with the configuration story.</p>
<p>I had originally instituted a fluent interface to explicitly configure the behavior chains (this request url is handled by this controller action and this view or json), but the fluent interface quickly achieved <a href="http://odetocode.com/blogs/scott/archive/2009/03/16/aluminum-wiring-in-your-software.aspx">aluminum wiring</a> status.  We knew with the FubuMVC reboot that we wanted to move towards favoring “<a href="http://msdn.microsoft.com/en-us/magazine/dd419655.aspx">convention over configuration</a>.”</p>
<p>I started with this vision for FubuMVC configuration and conventions:</p>
<ul>
<li>FubuMVC would be able to mostly discover controller actions by scanning one or more assemblies.</li>
<li>Route url patterns could be determined by a convention</li>
<li>Views would be “attached” to controller actions by a convention</li>
<li>FubuMVC would be able to figure out for itself which actions were strictly json services, html snippets, or just returned a string value</li>
<li>We could happily supplement or override the conventions with explicit configuration.</li>
<li><strong>Conventions would not be hard coded</strong>.  Users (us) would be able to create their own conventions.</li>
<li>One way or another we’d just use an IoC container to do the object assembly, meaning that the whole nested behavior model would need to be translated into the IoC container of your choice.</li>
<li>Conventions are magic.  Magic is confusing.  We knew right off the bat that we would need <a href="http://codebetter.com/jeremymiller/2010/01/04/fubumvc-diagnostics-sneak-peek/">diagnostics baked into the framework</a> to unravel the convention magic.</li>
</ul>
<h2>FubuMVC Configuration at 10,000 Feet</h2>
<p>Roughly speaking, the configuration infrastructure is broken up into a few different areas of responsibility:</p>
<ul>
<li>A low level configuration object graph (BehaviorGraph) that models all the routes, behaviors, and additional services that FubuMVC needs internally.  Think “this url is handled by calling this method on this class, then rendered with this WebForms view.”</li>
<li>A Domain Specific Language (FubuRegistry) that builds the configuration object graph by using the conventions, policies, and explicit configuration expressed by the DSL.</li>
<li>A container facility (IContainerFacility) that takes the entire configuration object graph and <strong>adds</strong> the appropriate configuration to the application’s underlying IoC container.</li>
<li>Bootstrapping classes (FubuApplication) that govern the entire startup process.  Let’s just say that the internals of bootstrapping a FubuMVC application are non-trivial – and much more so after the packaging work.  I’ve attempted to make the application bootstrapping as declarative as possible to prevent user mistakes.</li>
</ul>
<p>FubuMVC incorporates a lot of the architectural lessons that we learned from our involvement with both StructureMap and Fluent NHibernate.  The most important lesson is that the configuration should be modeled with a passive data structure, and that data structure should be completely decoupled from the mechanism used to capture configuration.  Moreover, the configuration model should be easy to traverse, query, and write.</p>
<p>This architectural strategy has some powerful benefits:</p>
<ol>
<li>It enables the framework to mix and match multiple forms of configuration.</li>
<li>It makes it possible to create all new conventions.  In this architecture,</li>
<li>Conventions can be used to build the first pass of the configuration model, then explicit configuration directives can be applied to the model afterward to override the conventions.</li>
<li>The passive configuration model can be queried by diagnostic reports</li>
</ol>
<h2>Bootstrapping a Simple Application</h2>
<p>Please note that I’m glossing over the new packaging functionality in this post for the sake of length and managing complexity.  FubuApplication also “knows” how to invoke the packaging pipeline in the correct order.</p>
<p>Inside the FubuMVC codebase is a simple “Hello World” project that I’m using for this example.</p>
<p>The first thing to do is to create a single top level FubuRegistry for the HelloWorld project like <a href="https://gist.github.com/raw/773750/ce0add31fdb366773fb0423821d38ea8ad585d9c/HelloWroldFubuRegistry.cs">this code</a>.</p>
<p>FubuRegistry is a big topic by itself for another day, but for right now just glance at the class above.  Among other things, HelloWorldFubuRegistry is declaring which classes expose actions, how to derive a Route for the controller actions in the BehaviorGraph, and the policies FubuMVC should use to connect WebForms views to controller actions.</p>
<p>Now that we have a FubuRegistry (and we’ve very logically chosen to use StructureMap as our IoC container), we would open the Global.asax file of the Hello World app and write code like this:</p>
<pre>FubuApplication
    .For&lt;HelloWorldFubuRegistry&gt;()
    .StructureMap(() =&gt; new Container())
    .Bootstrap(RouteTable.Routes);</pre>
<p>&nbsp;</p>
<p>FubuApplication “knows” how to do all the bootstrapping activities in the right order, but we have to first tell FubuApplication what the main FubuRegistry is and how to build an IContainerFacility.  Please note that we register the container facility in the “StructureMap()” method with a Func (the StructureMap() method actually wraps the Func&lt;IContainer&gt; inside another Func that would return a StructureMapContainerFacility object.  Deferred execution FTW!).  This has to be done with deferred execution to ensure that your IoC container setup can take advantage of the assemblies discovered dynamically through package loading.</p>
<p>Now that we’ve told FubuApplication about our HelloWorldFubuRegistry and that we’re going to use StructureMap for our container facility, we can call the Bootstrap() method to start up our application.  In order, Bootstrap():</p>
<ol>
<li>A bunch of package discovery and loading we’ll talk about later…</li>
<li>Builds an IContainerFacility with the Func&lt;IContainerFacility&gt; we supplied to FubuApplication</li>
<li>Calls the BuildGraph() method on the HelloWorldFubuRegistry object we supplied to FubuApplication to build a BehaviorGraph of all the actions, views, and route information for our application.  HelloWorldFubuRegistry itself is using the conventions we specified to scan the main assembly of HelloWorld in order to build the BehaviorGraph.</li>
<li>FubuApplication reads BehaviorGraph and registers FubuMVC specific services with the IContainerFacility</li>
<li>FubuApplication iterates through each “BehaviorChain” in BehaviorGraph and adds uses the IContainerFacility to translate the configuration objects into StructureMap’s internal configuration.  If appropriate, FubuApplication also creates and registers an ASP.Net Route object for the behavior chain with a FubuRouteHandler pointing back to the correct behaviors (some BehaviorChain’s represent “partial requests” and would not have a url).</li>
<li>Some more packaging activation stuff we’ll get into later…</li>
</ol>
<h2>FubuMVC and IoC Freedom</h2>
<p>I’ve chosen to use StructureMap for the Hello World application.  FubuMVC was purposely built to make the IoC container swappable.  StructureMap is the only option in the official core right now, but at least one other team is using Ninject with FubuMVC.  The StructureMap() method above is an extension method from the FubuMVC.StructureMap assembly.  Despite reports to the contrary, FubuMVC is not tightly coupled to StructureMap.</p>
<p><strong>Summary</strong></p>
<p>I think that the configuration subsystem in FubuMVC is what sets it apart from other .Net tools in terms of its capabilities, but I know some of the rest of you are from Missouri and you’ll have to be shown with some examples<img class="wlEmoticon wlEmoticon-winkingsmile" style="border-style: none" src="http://codebetter.com/jeremymiller/files/2011/01/wlEmoticon-winkingsmile1.png" alt="Winking smile" /></p>
<h2>But wait, there’s more…</h2>
<p>This blogging out FubuMVC before CodeMash thing isn’t happening fast enough because it’s just too big a topic.  I need to continue the discussion about FubuMVC configuration with:</p>
<ul>
<li>An introduction to the BehaviorGraph</li>
<li>How FubuMVC allows you to swap out IoC containers</li>
<li>How FubuRegistry works</li>
<li>Writing your own conventions</li>
<li>Packaging!  After the support for conventions, I think this is our killer feature.</li>
</ul>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvcs-configuration-strategy/#respond" title="Comment on FubuMVC&rsquo;s Configuration Strategy"><span class="dsq-postid" rel="814 http://codebetter.com/jeremymiller/2011/01/10/fubumvcs-configuration-strategy/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-814 -->

		
						
			<div id="post-812" class="post-812 post type-post status-publish format-standard hentry category-fubumvc">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvc-routing-and-the-front-controller-pattern/" title="Permalink to FubuMVC, Routing, and the Front Controller Pattern" rel="bookmark">FubuMVC, Routing, and the Front Controller Pattern</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvc-routing-and-the-front-controller-pattern/" title="8:07 am" rel="bookmark"><span class="entry-date">January 10, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>Authors’s note:&nbsp; I’ll be switching to using GistHub for code samples shortly, but bear with me just for now please.</p>
<p>In <a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/">my last massive post</a> I talked a little bit about how FubuMVC’s behavior model works.&nbsp; In the interest of length I cut this section about how a FubuMVC application goes from receiving a request for a Url address to the correct behaviors to invoke.&nbsp; Again, this isn’t something you would deal with while working with FubuMVC, but this is just meant to explain what’s going on under the covers.</p>
<p>For those of you non-Fowlbots who aren’t familiar with the term “<a href="http://martinfowler.com/eaaCatalog/frontController.html">Front Controller</a>,” it just means that there’s a component that interrogates an http request, then decides what other class or component should handle the request and hands off the request.&nbsp; Think of the Front Controller as a traffic cop.&nbsp; </p>
<p>For FubuMVC we utilize the Routing module built into .Net* as part of our Front Controller strategy.&nbsp; The connection between receiving a url request and invoking the proper chain of nested behaviors looks like this:</p>
<p><a href="http://codebetter.com/jeremymiller/files/2011/01/diagram_thumb.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="diagram_thumb" src="http://codebetter.com/jeremymiller/files/2011/01/diagram_thumb_thumb.png" width="598" height="202"></a></p>
<p>I’ll cover configuration at a later time, but for now let me just say that FubuMVC registers a unique Route object for every possible url endpoint in the entire application.&nbsp; FubuMVC attaches a FubuRouteHandler object to each Route object.&nbsp; The FubuRouteHandler is more or less just an adapter between the selected Route and the correct behavior chain.&nbsp; Each FubuRouteHandler is created with a reference to the IBehaviorFactory for the application and the unique “behaviorId” of the top level behavior that handles the Route in question.</p>
<pre style="line-height: normal;background-color: transparent;font-family:"><font face="Consolas"><font color="#000000"><font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </font></font><font><span style="line-height: normal"><font color="#0000ff">public</font></span><font color="#000000"> FubuRouteHandler(</font><span style="line-height: normal"><font color="#2b91af">IBehaviorFactory</font></span><font color="#000000"> factory, </font><span style="line-height: normal"><font color="#2b91af">Guid</font></span><font color="#000000"> behaviorId)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _factory = factory;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _behaviorId = behaviorId;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</font></font></font></pre>
<p>&nbsp;</p>
<p>IBehaviorFactory is a lightweight abstraction over your IoC container of choice and “behaviorId” is unsurprisingly just the name of the IActionBehavior instance within your IoC container.&nbsp; </p>
<p>Walking down the sequence diagram above, once a route is selected by routing:</p>
<ol>
<li>The selected Route calls into its FubuRouteHandler and asks it for an IHttpHandler
<li>FubuRouteHandler uses the HttpContext of the request to set up an AggregateDictionary object used as the lowest level abstraction to request data in the rest of the FubuMVC pipeline.
<li>The FubuRouteHandler calls into the IBehaviorFactory with the behaviorId and the AggregateDictory to retrieve the outermost IActionBehavior
<li>The IBehaviorFactory invokes the IoC container to build the outermost behavior with all its dependencies including all inner behaviors.&nbsp; The AggregateDictionary is passed into the IoC container as an explicit argument.
<li>The FubuHttpHandler just has to invoke the outermost behavior and get out of the way.</li>
</ol>
<p>&nbsp;</p>
<h2>Why didn’t we write our own routing engine?</h2>
<p>Once in a while I do get challenged about why we use Routing as is instead of writing our own.&nbsp; I even had one person claim that the necessary Xml configuration to run Routing was intolerable.&nbsp; So here it is, we use Routing because it’s part of the BCL now, well tested, and it works quite well.&nbsp; I even took a peek at it under Reflector one day to see if we could use it for something later outside of IIS and lo and behold, it’s relatively de-coupled from ASP.Net internals.&nbsp; And now you know, I don’t have to reinvent every possible wheel (plus I’m allergic to regex’s).</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/fubumvc/" title="View all posts in FubuMVC" rel="category">FubuMVC</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/10/fubumvc-routing-and-the-front-controller-pattern/#respond" title="Comment on FubuMVC, Routing, and the Front Controller Pattern"><span class="dsq-postid" rel="812 http://codebetter.com/jeremymiller/2011/01/10/fubumvc-routing-and-the-front-controller-pattern/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-812 -->

		
						
			<div id="post-807" class="post-807 post type-post status-publish format-standard hentry category-di category-fubumvc category-ioc category-structuremap">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/" title="Permalink to FubuMVC&rsquo;s Internal Runtime, the Russian Doll Model, and how it compares to ASP.Net MVC and OpenRasta" rel="bookmark">FubuMVC&rsquo;s Internal Runtime, the Russian Doll Model, and how it compares to ASP.Net MVC and OpenRasta</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/" title="9:28 pm" rel="bookmark"><span class="entry-date">January 9, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>I’m blogging out some preliminary FubuMVC documentation in preparation for a workshop later this week.  As a logical place to start, I’d like to dive into the internals of how FubuMVC handles an Http request.  Along the way I’ll try to explain how our design philosophy and goals led us to the current shape of FubuMVC.  <strong>A typical user of FubuMVC wouldn’t come into contact with any of these details in daily usage</strong>, but I think it’s still good to know what’s going on under the hood.  I’m also going to contrast the internal design of FubuMVC to ASP.Net MVC and a tiny bit to OpenRasta.  For as long as this post is, I’ve left out a lot of important details, so look for more content soon-ish to follow up on tangents.</p>
<h2>Request Responsibilities</h2>
<p>First, let’s stop and think about some of the typical stuff that needs to happen to handle an Http request.  Granted, this varies quite a bit, but the typical Http request in <strong>our</strong> application is doing something like these steps:</p>
<ol>
<li>Start up a new nested StructureMap container and an NHibernate session (if necessary)</li>
<li>Apply any authorization rules and potentially reject the request with a 403 response</li>
<li>Model binding.  Take the request data and transform the raw Http request into something more palatable like a simple DTO / ViewModel object that represents a request for either a view or the invocation of a service.  In fubu parlance I call this the input model.</li>
<li>Pass the input model object into the correct action method and get the resulting output model</li>
<li>Take the output model object and either use it to render the correct view or simply write the output model to the output stream as Json.</li>
<li>Clean up and dispose the NHibernate session and the nested StructureMap container for the request (this will be important later)</li>
</ol>
<h2></h2>
<h2>Contrasting FubuMVC and ASP.Net MVC</h2>
<p>The key technical differentiator between FubuMVC and ASP.Net MVC or MonoRail is our usage of composition instead of inheritance as a way to configure and extend the request pipeline.  ASP.Net MVC and some other .Net web frameworks rely on subclassing and extending a Controller base class to directly coordinate the steps I outlined in the section above.</p>
<p>The controller methods (actions) in ASP.Net MVC force you to return an object that implements the IActionResult interface telling the controller what to do next (render this view, spit out json, issue a redirect, etc.).  I liked this model at first because it’s simple to understand and use, but I think you lose a lot of flexibility, reuse, and modularity.  The IActionResult model introduces a tight coupling in the pipeline between controller actions and outputs.</p>
<p>FubuMVC grew out of our frustrations with using the inheritance based model of ASP.Net MVC and what we felt was unnecessary repetition from the IActionResult usage.  We postulated that we would be more successful if the responsibilities in that list could be spread out into a series of cohesive little objects that were almost completely decoupled from each other.  We eventually settled on the name “behavior” to describe these little classes.</p>
<h2>Behaviors and the Russian Doll Model</h2>
<p>Behaviors in FubuMVC are modeled by this key abstraction in the FubuMVC runtime:</p>
<p><span style="color: blue">public</span> <span style="color: blue">interface</span> <span style="color: #2b91af">IActionBehavior</span><br />
{<br />
<span style="color: blue">void</span> Invoke();<br />
<span style="color: blue">void</span> InvokePartial();<br />
}</p>
<p>You might notice that the IActionBehavior’s methods don’t take in any arguments for request state (i.e., no RequestContext/ControllerContext).  FubuMVC depends on an IoC container to put the right dependencies including request state / response abstractions into the behavior objects through good old fashioned constructor injection.</p>
<p>A single Http request would potentially be handled by a combination of behaviors, each fulfilling a single responsibility.  A simplified view of a FubuMVC request looks like this:</p>
<p><a href="http://codebetter.com/jeremymiller/files/2011/01/diagram-1.png"><img style="margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;padding-top: 0px;border-width: 0px" src="http://codebetter.com/jeremymiller/files/2011/01/diagram-1_thumb.png" border="0" alt="diagram (1)" width="593" height="237" /></a></p>
<p>To circle back to the section on “request responsibilities” and map that to behaviors, a typical request in my team’s system might be handled by:</p>
<ol>
<li>A “<a href="https://github.com/DarthFubuMVC/fubumvc/blob/master/src/FubuFastPack/StructureMap/TransactionalStructureMapContainerFacility.cs">TransactionContainerBehavior</a>” that starts the nested container and the NHibernate session for the request.  This behavior also handles the session and nested container cleanup after the other behaviors run.  See the following paragraph on the “Russian Doll Model” for a full explanation.</li>
<li>The “AuthorizationBehavior” runs any and all authorization rules relevant to this request</li>
<li>An “ActionCall” behavior that “knows” how to invoke the proper action by first exercising the model binding services in fubu to turn the raw Http input into something usable by the action.  The ActionCall then executes the proper action and stores any output where other behaviors could get to it.</li>
<li>An “output handler” behavior of some sort that can find the output of the action and render a view or serialize the output to json or just write a status code to the Http response.</li>
</ol>
<p>One of the key features of the behaviors model is what some folks have taken to calling the “Russian Doll Model” (think about the <a href="http://en.wikipedia.org/wiki/Matryoshka_doll">traditional nesting dolls like these</a>).  In practice, behaviors are nested inside other behaviors as shown by this base class we use for most of the out of the box behaviors in FubuMVC:</p>
<pre><span style="font-family: Consolas"><span style="color: #000000"><span>    </span></span><span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">abstract</span><span style="color: #000000"> </span><span style="color: #0000ff">class</span><span style="color: #000000"> </span><span style="color: #2b91af">BasicBehavior</span><span style="color: #000000"> : </span><span style="color: #2b91af">IActionBehavior</span>
</span></span><span><span style="font-family: Consolas"><span style="color: #000000">    {
        </span><span style="color: #0000ff">private</span><span style="color: #000000"> </span><span style="color: #0000ff">readonly</span><span style="color: #000000"> </span><span style="color: #2b91af">Action</span></span><span style="font-family: Consolas"><span style="color: #000000"> _partialInvoke;

        </span><span style="color: #0000ff">protected</span><span style="color: #000000"> BasicBehavior(</span><span style="color: #2b91af">PartialBehavior</span></span><span style="font-family: Consolas"><span style="color: #000000"> partialBehavior)
        {
            _partialInvoke = partialBehavior == </span><span style="color: #2b91af">PartialBehavior</span></span><span style="font-family: Consolas"><span style="color: #000000">.Executes
                ? (</span><span style="color: #2b91af">Action</span></span><span style="font-family: Consolas"><span style="color: #000000">) (Invoke)
                : () =&gt; { </span><span style="color: #0000ff">if</span><span style="color: #000000"> (InsideBehavior != </span><span style="color: #0000ff">null</span></span><span style="font-family: Consolas"><span style="color: #000000">) InsideBehavior.InvokePartial(); };
        }

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #2b91af">IActionBehavior</span><span style="color: #000000"> InsideBehavior { </span><span style="color: #0000ff">get</span><span style="color: #000000">; </span><span style="color: #0000ff">set</span></span><span style="font-family: Consolas"><span style="color: #000000">; }

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span></span><span style="font-family: Consolas"><span style="color: #000000"> Invoke()
        {
            </span><span style="color: #0000ff">if</span><span style="color: #000000"> (performInvoke() == </span><span style="color: #2b91af">DoNext</span><span style="color: #000000">.Continue &amp;&amp; InsideBehavior != </span><span style="color: #0000ff">null</span></span><span style="font-family: Consolas"><span style="color: #000000">)
            {
                InsideBehavior.Invoke();
            }

            afterInsideBehavior();
        }

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span></span><span style="font-family: Consolas"><span style="color: #000000"> InvokePartial()
        {
            _partialInvoke();
        }

        </span><span style="color: #0000ff">protected</span><span style="color: #000000"> </span><span style="color: #0000ff">virtual</span><span style="color: #000000"> </span><span style="color: #2b91af">DoNext</span></span><span style="font-family: Consolas"><span style="color: #000000"> performInvoke()
        {
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> </span><span style="color: #2b91af">DoNext</span></span></span><span style="font-family: Consolas"><span><span style="color: #000000">.Continue;
        }

        </span><span style="color: #0000ff">protected</span><span style="color: #000000"> </span><span style="color: #0000ff">virtual</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span><span style="color: #000000"> afterInsideBehavior()
        {
        }
    }</span></span></span></pre>
<p>&nbsp;</p>
<p>Classes that inherit from the BasicBehavior superclass can implement template methods to perform work before the inner behavior, decide whether or not to execute the inner behavior, and run some code after the inner behavior runs.  If you forgo the superclass above and write a behavior directly to the IActionBehavior interface you gain the ability to use <em>try/catch</em> or <em>using</em> blocks around the invocation of the inner behavior like this example:</p>
<pre><span style="font-family: Consolas"><span style="color: #000000"><span>    </span></span><span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">class</span><span style="color: #000000"> </span><span style="color: #2b91af">StopwatchBehavior</span><span style="color: #000000"> : </span><span style="color: #2b91af">IActionBehavior</span>
</span></span><span><span style="font-family: Consolas"><span style="color: #000000">    {
        </span><span style="color: #0000ff">private</span><span style="color: #000000"> </span><span style="color: #0000ff">readonly</span><span style="color: #000000"> </span><span style="color: #2b91af">Action</span><span style="color: #000000">&lt;</span><span style="color: #0000ff">double</span></span><span style="font-family: Consolas"><span style="color: #000000">&gt; _record;

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> StopwatchBehavior(</span><span style="color: #2b91af">Action</span><span style="color: #000000">&lt;</span><span style="color: #0000ff">double</span></span><span style="font-family: Consolas"><span style="color: #000000">&gt; record)
        {
            _record = record;
        }

        </span><span style="color: #008000">// The underlying IoC container would inject the "inner"</span>
<span style="color: #000000">        </span><span style="color: #008000">// behavior via this property</span>
<span style="color: #000000">        </span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #2b91af">IActionBehavior</span><span style="color: #000000"> InnerBehavior { </span><span style="color: #0000ff">get</span><span style="color: #000000">; </span><span style="color: #0000ff">set</span></span><span style="font-family: Consolas"><span style="color: #000000">; }

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span></span><span style="font-family: Consolas"><span style="color: #000000"> Invoke()
        {
            </span><span style="color: #0000ff">var</span><span style="color: #000000"> stopwatch = </span><span style="color: #0000ff">new</span><span style="color: #000000"> </span><span style="color: #2b91af">Stopwatch</span></span><span style="font-family: Consolas"><span style="color: #000000">();
            stopwatch.Start();
            </span><span style="color: #0000ff">try</span>
</span><span style="font-family: Consolas"><span style="color: #000000">            {
                InnerBehavior.Invoke();
            }
            </span><span style="color: #0000ff">finally</span>
</span></span><span style="font-family: Consolas"><span><span style="color: #000000">            {
                stopwatch.Stop();
                _record(stopwatch.ElapsedMilliseconds);
            }
        }

        </span><span style="color: #0000ff">public</span><span style="color: #000000"> </span><span style="color: #0000ff">void</span><span style="color: #000000"> InvokePartial()
        {
            Invoke();
        }
    }</span></span></span></pre>
<p>My favorite usage of this nesting capability is how easy it makes it to clean up resources like containers or NHibernate sessions opened up during a request.</p>
<h2>Other differences between ASP.Net MVC and FubuMVC’s “Behaviors”</h2>
<ol>
<li>FubuMVC has no concept of a “Controller, ” only actions that at this point must conform to the “<a href="http://codebetter.com/jeremymiller/2008/10/23/our-opinions-on-the-asp-net-mvc-introducing-the-thunderdome-principle/">one model in, one model out</a>” design principle.  Action classes can happily be POCO classes with zero coupling to any FubuMVC namespace.</li>
<li>You can chain multiple actions in the same request.  We’ve taken advantage of this ability to greatly simplify our “crud” actions by reusing actions across routes.  Other teams are using chained actions to generalize validation.</li>
<li>There’s technically no reason why a request has to include an action at all.  “Controllerless” actions were trivial in FubuMVC to implement and save you from wasting your time on controller actions that just return their input model.</li>
<li>The IActionFilter from ASP.Net MVC is just a behavior in FubuMVC.  The FubuMVC behaviors model is much simpler than ASP.Net’s architecture but we think the simplification leads to more capabilities rather than less.  I definitely think the nested behavior model in FubuMVC makes “before and after” functionality much easier and cleaner to implement than the IActionFilter abstraction in ASP.Net MVC.  Hat tip to Chad Myers[LINK] for that idea.  Hey, it’s all about behaviors these days…</li>
<li>FubuMVC uses an IoC container to assemble all the behaviors for a single request at one time and all their dependencies.  You might note that the IActionBehavior interface above doesn’t use any kind of “*****Context” objects to pass state around because all the Http abstractions and the model state is pushed into behaviors or services through dependency injection.  This is a full topic in its own right, but I’m very convinced that using an IoC container inside FubuMVC has greatly simplified the internals compared to the same functionality in the ASP.Net MVC codebase.</li>
</ol>
<h2>FubuMVC v. OpenRasta</h2>
<p>I do think FubuMVC is superficially similar to <a href="https://github.com/openrasta/openrasta-stable">OpenRasta</a> in terms of architecture, especially in regards to composition over inheritance.  However, I think the runtimes and approaches are different enough to justify the separate efforts.</p>
<p>I think you could say that OpenRasta’s IPipelineContributor is analogous to FubuMVC’s IActionBehavior, but they diverge after that.  Whereas FubuMVC relies on that “Russian Doll Model” at configuration time to pre-order the behaviors for each request, OpenRasta uses the IPipeline / PipelineRunner class as a “Coordinator” for the various IPipelineContributor’s (see <a href="http://msdn.microsoft.com/en-us/magazine/cc721605.aspx">this MSDN article</a> for an explanation of Coordinator).  To contrast them, I’d say that FubuMVC solves the composable pipeline problem with a complex configuration model and a simple runtime model where I’d say that OpenRasta has a more complex runtime model but a simpler configuration model.  Again, just <strong>my</strong> thoughts on the two tools.</p>
<p>Maybe what I should say is that if you share the general ALT.NET aesthetic, I think you’d like either OpenRasta or FubuMVC much better than ASP.Net MVC.  If you’re a serious student of software design, I’d highly recommend doing your own compare and contrast study of all three tools and how they solve the same problems in different ways.</p>
<p>The configuration approach is also very different, but I have click “publish” on this blog post at some point<img class="wlEmoticon wlEmoticon-winkingsmile" style="border-style: none" src="http://codebetter.com/jeremymiller/files/2011/01/wlEmoticon-winkingsmile.png" alt="Winking smile" /></p>
<h2>So, why did we do it this way?</h2>
<p>One of the key design philosophies of FubuMVC from day one has been to strongly <a href="http://www.artima.com/lejava/articles/designprinciples4.html">favor composition over inheritance</a> in regards to the internal code structure and how we expose extension points to users.  Of course “composition” is just the means.  The real design <strong>goals</strong> of FubuMVC were to</p>
<ol>
<li>Decouple application code from the framework as much as possible.  I really don’t want framework junk like “ActionResult’s” or attribute noise to intrude into my application code.  Composition with little cohesive objects has been a powerful way to remove the framework goop so prevalent in inheritance based frameworks.</li>
<li>Enable convention over configuration in a meaningful way.  A lot of the conventions in FubuMVC work by looking at a chain of behaviors and using some criteria to determine what other behaviors should be chained to the original behaviors (like attaching “view” behaviors to action behaviors based on a naming convention).  Being able to move around little behavior objects like Lego pieces enables convention based approaches in FubuMVC.&nbsp;</li>
<li>Eliminate as much repetitive code as possible.  Why should I have to tell the dang framework what view to render if it could figure it out from a convention?</li>
<li>Maximize our ability to extend and/or control the way server requests are handled.  Think about the simple need to intercept the output from an action before it’s rendered.  That’s simple with our behaviors model, but the equivalent solution in ASP.Net MVC requires some non-obvious hoop jumping.</li>
</ol>
<p>Some of you (and seemingly all of Microsoft’s DevDiv group) might disagree with me, but my very strong feeling is that extensibility and reuse through composition is more powerful than inheritance.  I think composition based code is easier to understand and debug because the boundaries and dependencies between sections of code are clearer than the equivalent code using inheritance with lots of template methods.</p>
<h2>What I need to talk about next….</h2>
<p>I think by now I’ve reminded all of you long term readers that my blog is no place for folks with short attention spans.  Some related topics I’ll cover later are:</p>
<ul>
<li>Someday I’d like to share some of Dovetail’s experiences with customer extensions and how the behavior model allows us to be “Open/Closed” with the customer extensions</li>
<li>How FubuMVC uses Routing as a Front Controller</li>
<li>How FubuMVC abstracts Http (I’m thinking ahead a little bit to possibly supporting OWIN if that ever feels like more than an academic exercise).</li>
<li>How FubuMVC uses an IoC Container</li>
<li>FubuMVC’s Configuration Model – you probably noticed that I didn’t remotely explain how behaviors are configured in FubuMVC</li>
<li>How FubuMVC Model Binding Works</li>
</ul>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/di/" title="View all posts in DI" rel="category">DI</a>, <a href="http://codebetter.com/jeremymiller/category/fubumvc/" title="View all posts in FubuMVC" rel="category">FubuMVC</a>, <a href="http://codebetter.com/jeremymiller/category/ioc/" title="View all posts in IOC" rel="category">IOC</a>, <a href="http://codebetter.com/jeremymiller/category/structuremap/" title="View all posts in StructureMap" rel="category">StructureMap</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/#respond" title="Comment on FubuMVC&rsquo;s Internal Runtime, the Russian Doll Model, and how it compares to ASP.Net MVC and OpenRasta"><span class="dsq-postid" rel="807 http://codebetter.com/jeremymiller/2011/01/09/fubumvcs-internal-runtime-the-russian-doll-model-and-how-it-compares-to-asp-net-mvc-and-openrasta/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-807 -->

		
						
			<div id="post-802" class="post-802 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/09/an-idle-thought-about-selecting-a-development-platform/" title="Permalink to An Idle Thought about Selecting a Development Platform" rel="bookmark">An Idle Thought about Selecting a Development Platform</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/09/an-idle-thought-about-selecting-a-development-platform/" title="10:49 am" rel="bookmark"><span class="entry-date">January 9, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>I’m working hard all weekend (minus my son’s very late birthday party and the Chiefs playoff game today) getting ready for my <a href="http://codebetter.com/jeremymiller/2010/12/15/fubumvc-at-codemash-2011/">FubuMVC workshop</a> at CodeMash.  A pretty important part of that workshop is to start by explaining / justifying why FubuMVC should even exist in the first place when there are so many other options.</p>
<p>When we started at Dovetail back in 2008 we immediately had to choose which platform and basic framework to start with.  We could have chosen Ruby on Rails or Merb (this was before the merger), but we chose to stay on .Net partially due to non-technical reasons (there were other internal factors at play that I can’t discuss here).</p>
<p>We were assuming (and still offer) an “on premises” deployment model.  Our management had plenty of market research and experience with customers that led them to believe that a .Net solution would be much better received by our potential customers than a non-mainstream platform like Ruby or Python (and I’d have simply quit if they’d said Java).  Fast forward to today and a hosted solution (SaaS or otherwise) is a much more popular option for customers.</p>
<p>If we were making the platform choice today based on the assumption of a hosted solution, our primary concern would be team productivity with whatever technology we chose and the cloud deployment options for that platform because potential customer’s IT preferences are no longer an issue.</p>
<p>I don’t think there’s enough justifiable reason or even advantage in us ditching FubuMVC and .Net for Ruby on Rails <strong>now</strong>, but if I was at the beginning of things instead of almost 3 years in, I’d probably opt for Ruby / Rails and foregone the time investment that I’ve personally put into FubuMVC development.</p>
<p>I’m not really into making <a href="http://blogs.tedneward.com/2011/01/01/Tech+Predictions+2011+Edition.aspx">industry prognostications like a Ted Neward</a>, but if I were Microsoft, I’d be very, very concerned because the SaaS model and cloud computing will erode some of the “no one ever got fired for using Microsoft” advantage that they’ve previously enjoyed.  In a world with less pressure to use standard technology, the best technologies will have a much bigger advantage than they do today.</p>
<p>&nbsp;</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/09/an-idle-thought-about-selecting-a-development-platform/#respond" title="Comment on An Idle Thought about Selecting a Development Platform"><span class="dsq-postid" rel="802 http://codebetter.com/jeremymiller/2011/01/09/an-idle-thought-about-selecting-a-development-platform/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-802 -->

		
			
	<div id="nav-below" class="navigation">
		<div class="nav-previous"><a href="?page=0" >&laquo; Previous Page</a></div>
		<div class="nav-next"><a href="?page=2" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-below -->
			</div><!-- #main -->
			<div id="sidebar" class="grid_4">
						<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="authors" class="widget-container widget_authors"><h3 class="widget-title">CodeBetter.Com Editors</h3>
<!-- Authors -->
<ul>
<li><a href="http://codebetter.com/drusellers/">Dru Sellers</a></li><li><a href="http://codebetter.com/howarddierking/">Howard Dierking</a></li><li><a href="http://codebetter.com/jeremymiller/">Jeremy D. Miller</a></li><li><a href="http://codebetter.com/benhall/">Ben Hall</a></li><li><a href="http://codebetter.com/iancooper/">Ian Cooper</a></li><li><a href="http://codebetter.com/jameskovacs/">James Kovacs</a></li><li><a href="http://codebetter.com/petervanooijen/">Peter van Ooijen</a></li><li><a href="http://codebetter.com/davidhayden/">David Hayden</a></li><li><a href="http://codebetter.com/sebastienlambla/">Sebastien Lambla</a></li><li><a href="http://codebetter.com/glennblock/">Glenn Block</a></li><li><a href="http://codebetter.com/patricksmacchia/">Patrick Smacchia</a></li><li><a href="http://codebetter.com/matthewpodwysocki/">Matthew Podwysocki</a></li><li><a href="http://codebetter.com/kylebaley/">Kyle Baley</a></li><li><a href="http://codebetter.com/gregyoung/">Greg Young</a></li></ul>
<!-- /Authors -->

</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
					<li id="blogs" class="widget-container widget_blogs"><h3 class="widget-title">Latest Posts</h3>
<!-- blogs -->
<ul>
<li><a href="http://codebetter.com/drusellers/2011/01/17/masstransit-next-steps-for-dru/">MassTransit: Next Steps (for dru)</a> <br/> by <a href="http://codebetter.com/drusellers/">Dru Sellers</a></li><li><a href="http://codebetter.com/howarddierking/2011/01/03/automating-pivot-trade-card-creation/">Automating Pivot Trade Card Creation</a> <br/> by <a href="http://codebetter.com/howarddierking/">Howard Dierking</a></li><li><a href="http://codebetter.com/jeremymiller/2011/01/16/a-train-of-thought-wrapping-up-codemash-2011/">A Train of Thought &ndash; Wrapping up CodeMash 2011</a> <br/> by <a href="http://codebetter.com/jeremymiller/">Jeremy D. Miller</a></li><li><a href="http://codebetter.com/iancooper/2011/01/16/alt-next/">Alt.Next</a> <br/> by <a href="http://codebetter.com/iancooper/">Ian Cooper</a></li><li><a href="http://codebetter.com/jameskovacs/2010/12/15/techdays-calgary-2010-wrap-up-convention-over-configuration/">TechDays Calgary 2010 Wrap-up: Convention-over-Configuration</a> <br/> by <a href="http://codebetter.com/jameskovacs/">James Kovacs</a></li><li><a href="http://codebetter.com/petervanooijen/2010/12/28/seasons-gifts-from-the-monotouch-iphone-treasure-chest-background-gps-tasks-and-uicontrol/">Seasons gifts from the MonoTouch (iPhone) treasure chest. Background (GPS) tasks and UIControl</a> <br/> by <a href="http://codebetter.com/petervanooijen/">Peter van Ooijen</a></li><li><a href="http://codebetter.com/davidhayden/2010/11/22/jquery-mobile-alpha-2-bug-with-links/">jQuery Mobile Alpha 2 Bug with Links</a> <br/> by <a href="http://codebetter.com/davidhayden/">David Hayden</a></li><li><a href="http://codebetter.com/sebastienlambla/2011/01/06/coming-up-next-in-openwrap/">Coming up next in OpenWrap&hellip;</a> <br/> by <a href="http://codebetter.com/sebastienlambla/">Sebastien Lambla</a></li><li><a href="http://codebetter.com/glennblock/2010/12/13/wcf-web-apis-roundup-volume-1/">WCF Web APIs Roundup - Volume 1</a> <br/> by <a href="http://codebetter.com/glennblock/">Glenn Block</a></li><li><a href="http://codebetter.com/patricksmacchia/2010/12/14/google-continuous-integration/">Google Continuous Integration Process</a> <br/> by <a href="http://codebetter.com/patricksmacchia/">Patrick Smacchia</a></li></ul>
<!-- /blogs -->

</li>				</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #content -->
	
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.584 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-18 11:04:40 -->
