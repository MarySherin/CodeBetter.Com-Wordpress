<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>CodeBetter.Com | Stuff you need to Code Better!</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='CodeBetter.Com' href='http://codebetter.com/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/3e52f3b292da95601a0d3fbd9775ac0e.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content">
			<div id="main" class="grid_8">
			<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://feeds.feedburner.com/CodeBetter"  rel="nofollow"><img src="http://www2.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://feeds.feedburner.com/CodeBetter" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div>			
	<div id="nav-above" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-above -->


				
			<div id="post-833" class="post-833 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/" title="Permalink to Announcing the new ATX Code Lunch" rel="bookmark">Announcing the new ATX Code Lunch</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/" title="7:17 pm" rel="bookmark"><span class="entry-date">January 28, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>Unfortunately, the original AgileATX has died an untimely death.  Between Dovetail, Headspring, and Drilling Info, we&#8217;re attempting to reboot what had been my favorite developer group &#8212; but make it a bit more focused without losing the social aspect that we enjoyed for so many years.  Chad&#8217;s got <a href="http://www.lostechies.com/blogs/chad_myers/archive/2011/01/28/announcing-atx-code-lunch.aspx">all the details right here</a>, with the first announced lunch on Thursday, February 3rd at the Mighty Fine off Mopac in the Arbor Walk.</p>
<p>Do note that nobody has said anything about a specific platform or methodology.  All types of developers or testers (or PM&#8217;s if you wanna come too) are invited &#8212; especially people working with cool technologies that I&#8217;ve never been exposed to;)</p>
<p>I think at the moment the idea is to center it up North, but that&#8217;s open for discussion.</p>
<p>We&#8217;re just getting started, so the format isn&#8217;t remotely set.  I know I&#8217;d also like to see us do a monthly(?) show and tell type get together to look at real project work and swap ideas. Other people are recommending days when we do lightning talks.  If you have an opinion, come express it and make it a group that you&#8217;d look forward to going to.</p>
<p>I hope to see you there.  Austinites, please tweet or repost this.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/#respond" title="Comment on Announcing the new ATX Code Lunch"><span class="dsq-postid" rel="833 http://codebetter.com/jeremymiller/?p=833">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-833 -->

		
						
			<div id="post-72" class="post-72 post type-post status-publish format-standard hentry category-msdn-magazine category-pivot">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/" title="Permalink to Collection Hosting Using Windows Azure" rel="bookmark">Collection Hosting Using Windows Azure</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/" title="1:00 am" rel="bookmark"><span class="entry-date">January 28, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>As I’ve mentioned in a couple earlier posts, Pivot is driven using Deep Zoom image pyramids.  This means that for a collection of trade card images, multiple additional image combinations are generated for different zoom levels.  The net result here is a LOT of generated images.  For example, in the case of the MSDN Magazine Pivot collection, there are roughly 2400 article trade cards.  Generating the deep zoom collection from this set of input images yields roughly 100,000 images with a total collection size of just under 500 MB.</p>
<p>As you can see, there are a ton of images generated, and a reasonable number of bytes that need to be stored, cached, etc.  For the MSDN Magazine collection, hosting the collection in our data center architecture wasn’t really a viable option for several reasons – the most notable one being that there’s not a really great story for managing large collections of images that change on a frequency or schedule that is different than the monthly platform release schedule.  Fortunately, Azure blob storage provides a really simple solution for dealing with this problem, as well as a few others.  Here’s how I setup Azure hosting for the MSDN Magazine Pivot collection.</p>
<h1>CDN Caching</h1>
<p>One of the nice things about hosting the collection in Azure blob storage is that enabling CDN edge caching as simple as one button click (see the upper left corner in the image below).  For more information about CDN, check out <a href="http://en.wikipedia.org/wiki/Content_delivery_network">http://en.wikipedia.org/wiki/Content_delivery_network</a></p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/azure-portal-storage.png"><img style="margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;padding-top: 0px;border-width: 0px" src="http://codebetter.com/howarddierking/files/2011/01/azure-portal-storage_thumb.png" border="0" alt="azure-portal-storage" width="355" height="250" /></a></p>
<h1>Silverlight Client Access Policy</h1>
<p>I knew pretty early on that I wanted to host my cxml and Deep Zoom image pyramids in Azure blob storage.  However, my initial plan was to store the Silverlight xap file on our own Web platform and simply pull in the data.  As all of you Silverlight aficionados already know, while this is totally doable, you need to ensure that you have a <a href="http://msdn.microsoft.com/en-us/library/cc645032.aspx">client access policy XML file</a> at the URL root of whatever resource you’re trying to access.  For Azure blob storage, you’ll want to put this file in a special <a href="http://msdn.microsoft.com/en-us/library/ee395424.aspx">$root container</a>.  Doing this will apply the policies you declare to all containers in that blob storage account.</p>
<p>Like I said, my original plan was to host the collection in Azure and xap containing the Pivot viewer on our servers.  However, as I progressed in developing the solution, I realized something different.  There were no restrictions preventing me from hosting the xap itself in blob storage along with the collection data, and that by doing this, I would get 2 additional benefits:</p>
<ol>
<li>I no longer had a need for a clientaccesspolicy.xml file, since the xap and the data were now in the same domain.</li>
<li>By simplifying things with #1, I could now make the entire magazine Pivot experience available to anybody that wanted to embed it in his or her own site – for example, check out <a href="http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/archive/2010/08/19/pivotviewer-collections-and-the-silverlight-control.aspx">this point on Mike Taulty’s blog</a>.  Because everything needed for the Pivot experience is now sitting up in blob storage, the only code needed for anybody who wants to include the experience in his/her site is just the Silverlight object creation code.</li>
</ol>
<pre class="brush: xml; title: ;" title="">
&lt;object data=&quot;data:application/x-silverlight-2,&quot; height=&quot;100%&quot; type=&quot;application/x-silverlight-2&quot; width=&quot;100%&quot;&gt;
   &lt;param name=&quot;source&quot; value=&quot;http://az7446.vo.msecnd.net/msdn-magazine/Magazines.PivotViewer.xap&quot;&gt;
   &lt;param name=&quot;onError&quot; value=&quot;onSilverlightError&quot;&gt;
   &lt;param name=&quot;background&quot; value=&quot;white&quot;&gt;
   &lt;param name=&quot;minRuntimeVersion&quot; value=&quot;4.0.50401.0&quot;&gt;
   &lt;param name=&quot;autoUpgrade&quot; value=&quot;true&quot;&gt;
   &lt;param name=&quot;enableHtmlAccess&quot; value=&quot;true&quot;&gt;
   &lt;param name=&quot;initParams&quot; value=&quot;collection=http://az7446.vo.msecnd.net/msdn-magazine/msdnmagazine.cxml, defaultViewState=%24facet0%24=Issue%20Date&amp;amp;%24view%24=2&quot;&gt;
   &lt;a href=&quot;http://go.microsoft.com/fwlink/?LinkID=149156&amp;amp;v=4.0.50401.0&quot; style=&quot;text-decoration:none;&quot; &gt;
      &lt;img alt=&quot;Get Microsoft Silverlight&quot; src=&quot;http://go.microsoft.com/fwlink/?LinkId=161376&quot; style=&quot;border-style:none&quot;&gt;
   &lt;/a&gt;
&lt;/object&gt;
</pre>
<h1>Uploading</h1>
<p>As I’m sure you can imagine, uploading 100,000 files to Azure can take a bit of time – and fortunately, from a brief bit of looking around, it seems as though there are more commercial tools to enable a performant upload experience.  At the time that I was working on the magazine collection, there was unfortunately not a ton of tools that could do what I needed – and so I wrote my own tool.  The requirements (and the resulting program) are pretty simple: recursively process a directory and all its contained files and upload all the files.  Additionally, because I’ve got a rockin’ machine with plenty of processor cores to go around, I made sure to take advantage of some of the opportunities for parallelism provided by the <a href="http://blogs.msdn.com/b/pfxteam/">parallel extensions</a> in .NET 4.  I was completely new to the Azure client libs but was fortunate enough to <a href="http://blog.smarx.com/posts/pivot-odata-and-windows-azure-visual-netflix-browsing">get help from Steve Marx</a> (the guy on the Azure team who did the Netflix collection) – so many thanks to Steve!</p>
<p>At any rate, the code to do the upload looks like this:</p>
<pre class="brush: csharp; title: ;" title="">
private static void Main(string[] args) {
    if (args.Length &lt; 3) {
        Console.WriteLine(&quot;Pivot.BlobStorageUpload.exe CollectionPath AccountName AccountKey&quot;);
        return;
    }

    var pivotCollectionFldr = args[0];
    var accountName = args[1];
    var key = args[2];

    const string magazineContainer = &quot;msdn-magazine&quot;;

    var storageAccount = CloudStorageAccount.Parse(string.Format(&quot;DefaultEndpointsProtocol=http;AccountName={0};AccountKey={1}&quot;,accountName, key));
    var client = storageAccount.CreateCloudBlobClient();

    var container = client.GetContainerReference(magazineContainer);

    UploadDirectoryRecursive(pivotCollectionFldr, container);

    Console.WriteLine(&quot;\nFinished!  Press any key to continue...&quot;);
    Console.ReadLine();
}

private static void UploadDirectoryRecursive(string pivotCollectionFolder, CloudBlobContainer container) {
    string cxmlPath = null;

    // use 16 threads to upload
    Parallel.ForEach(EnumerateDirectoryRecursive(pivotCollectionFolder),
                        new ParallelOptions {MaxDegreeOfParallelism = 16},
                        filePath =&gt; {
                            if (Path.GetExtension(filePath) == &quot;.cxml&quot;)    // save #####.cxml for last
                                cxmlPath = filePath;
                            else {
                                var blobAddressUri = Path.GetFullPath(filePath).Substring(pivotCollectionFolder.Length + 1);
                                var blob = container.GetBlobReference(blobAddressUri);
                                UploadFile(filePath, blob);   // upload each file, using the relative path as a blob name
                            }
                        });

    // finish up with the cxml itself
    if (cxmlPath != null)
        UploadFile(cxmlPath, container.GetBlobReference(Path.GetFullPath(cxmlPath).Substring(pivotCollectionFolder.Length + 1)));
}

private static IEnumerable&lt;string&gt; EnumerateDirectoryRecursive(string root) {
    foreach (var file in Directory.GetFiles(root))
        yield return file;
    foreach (var subdir in Directory.GetDirectories(root))
        foreach (var file in EnumerateDirectoryRecursive(subdir))
            yield return file;
}

private static void UploadFile(string filePath, CloudBlob blob) {
    var extension = Path.GetExtension(filePath).ToLower();
    blob.Properties.CacheControl = extension == &quot;.cxml&quot; ? &quot;max-age=1800&quot; : &quot;max-age=7200&quot;;

    switch (extension) {
        case &quot;.xml&quot;:
        case &quot;.cxml&quot;:
        case &quot;.dzi&quot;:
        case &quot;.dzc&quot;:
            blob.Properties.ContentType = &quot;application/xml&quot;;
            break;
        case &quot;.jpg&quot;:
            blob.Properties.ContentType = &quot;image/jpeg&quot;;
            break;
        case &quot;.ico&quot;:
            blob.Properties.ContentType = &quot;image/x-icon&quot;;
            break;
    }
    blob.UploadFile(filePath);
    Console.Write(&quot;*&quot;);
}
</pre>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/msdn-magazine/" title="View all posts in MSDN Magazine" rel="category">MSDN Magazine</a>, <a href="http://codebetter.com/howarddierking/category/pivot/" title="View all posts in Pivot" rel="category">Pivot</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/#respond" title="Comment on Collection Hosting Using Windows Azure"><span class="dsq-postid" rel="72 http://codebetter.com/howarddierking/?p=72">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-72 -->

		
						
			<div id="post-85" class="post-85 post type-post status-publish format-standard hentry category-msdn-magazine category-pivot">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/" title="Permalink to Creating the MSDN Magazine Pivot Client" rel="bookmark">Creating the MSDN Magazine Pivot Client</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/" title="11:34 pm" rel="bookmark"><span class="entry-date">January 27, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>When non-developers approach Pivot, they tend to be dismayed by 2 primary things:</p>
<ul>
<li>it’s not something that you can just plug into your data source and have it work
<li>it’s not some discrete thing that you can just slap onto a Web page and have it work</li>
</ul>
<p>We’ve talked about the data aspects of building the MSDN Magazine collection in <a href="http://codebetter.com/howarddierking/2010/10/28/generating-the-collection-data/">previous</a> <a href="http://codebetter.com/howarddierking/2010/09/20/data-and-design-the-chicken-and-egg-problem/">posts</a>.&nbsp; What I want to review in this post is the actual client work required to make the show the collection.&nbsp; There are actually 2 parts to the client work: the Silverlight project which extends the Silverlight Pivot viewer control, and the JavaScript which creates the Silverlight object and listens to events on it.</p>
<h1>Creating the Silverlight XAP</h1>
<p>When you download the <a href="http://www.silverlight.net/learn/pivotviewer/">Pivot SDK</a>, you’ll get the Pivot viewer control – just a standard Silverlight control.&nbsp; Most of the work, then is just packaging that control into a xap file by wrapping it into a Silverlight project and putting it on the mainpage.xaml file (or whatever you’ve declared as your applications RootVisual object).&nbsp; From there, you basically just write code to control the behavior of the control (e.g. what cxml to load, how to handle errors, catching events).&nbsp; As you can see, there’s really not all that much to it:</p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/pivot-viewer-sl-solution.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="pivot-viewer-sl-solution" src="http://codebetter.com/howarddierking/files/2011/01/pivot-viewer-sl-solution_thumb.png" width="274" height="190"></a></p>
<p>That said, there are a couple interesting extensions that I did to enable some capabilities on the control.&nbsp; Specifically, I derived my own control from PivotViewer so that I could hook a protected method and execute conditional logic for the action buttons on a trade card.&nbsp; I also made the Silverlight object scriptable and added a bunch of events so that could better instrument the Pivot experience with our BI system.</p>
<h2>Inheriting from PivotViewer</h2>
<p>As you may have noticed in the MSDN Magazine collection, a trade card can have up to 2 possible action buttons: one button to go read the article and another one to go and get associated sample code.&nbsp; </p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/action-buttons.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="action-buttons" src="http://codebetter.com/howarddierking/files/2011/01/action-buttons_thumb.png" width="413" height="115"></a></p>
<p>However, not every article has sample code, and as such, I need to be able to execute some conditional logic to determine whether or not to display the action button.&nbsp; You would hope/expect that the PivotViewer control would expose a method or event which you could hook per collection item that would enable you to specify the custom actions for that item – and you would be right – kind of.&nbsp; The PivotViewer does expose this in the form of a method override.&nbsp; The problem is that it’s a protected method.&nbsp; As a result, I created a custom class deriving from PivotViewer so that I could override the appropriate method and basically expose that method’s functionality to consumers of my custom PivotViewer.</p>
<p><pre class="brush: csharp; title: ;" title="">public class CustomPivotViewer : System.Windows.Pivot.PivotViewer
{
    public Func&lt;string, List&lt;CustomAction&gt;&gt; GetCustomActionsForItemCallback { get; set; }

    protected override List&lt;CustomAction&gt; GetCustomActionsForItem(string itemId) {
        List&lt;CustomAction&gt; customActions = null;

        if (GetCustomActionsForItemCallback != null)
            customActions = GetCustomActionsForItemCallback(itemId);

        return customActions;
    }
}
</pre>
<p>Back in my MainPage.xaml.cs code behind file, then (where I manipulate the instance of my custom PivotViewer object), I then have the following:</p>
<p><pre class="brush: csharp; title: ;" title="">private List&lt;CustomAction&gt; GetCustomActionsForItem(string itemId) {
    var customActions = new List&lt;CustomAction&gt;();

    var item = MagazinePivotViewer.GetItem(itemId);
    if (item.Facets[FACET_KEY_HAS_CODE].First() == FACET_VALUE_HAS_CODE)
        customActions.Add(_getCodeAction);

    if (!string.IsNullOrEmpty(item.Href))
        customActions.Add(_readArticleAction);

    return customActions;
}
</pre>
<p>As the PivotViewer control brings each item’s trade card into focus, it calls the GetCustomActionsForItem method, which my custom class overrides and then delegates to my code behind class using a callback.&nbsp; In my code behind class, that callback function runs the necessary conditional logic and returns a list containing the appropriate actions.&nbsp; The action instances themselves are&nbsp; created during xap initialization and are held in static fields for improving performance.</p>
<h2>Making it Scriptable</h2>
<p>The other major way that I’ve extended the default Pivot viewer functionality is to make my xap scriptable to my HTML page, and forward events coming from the viewer control out to the page.&nbsp; I did this for the MSDN Magazine collection specifically so that I could wire the control up to our business intelligence service (we use Omniture).&nbsp; In case you’ve never had to deal with one of these systems (Omniture, WebTrends, etc.), they don’t just sit on the back end and parse the Web server’s log files.&nbsp; Rather, they rely on an additional HTTP call from the client to the service’s servers.&nbsp; This level of indirection enables the site owners to provide additional detail which can then be used to slice and dice blunt stats such as page views when performing analysis.&nbsp; For the Pivot viewer, I wanted to feed into the analytics system was not just how many people were using the Pivot experience, but *how* they were using it (e.g. are there specific facet categories that are used more than others, do people drill-through or re-pivot using the info pane, etc.).&nbsp; This insight can then be used to drive things like the order in which I show facet categories (or whether I can get rid of categories) and what features I add going forward.</p>
<p>Making the Silverlight object scriptable was pretty straightforward.&nbsp; The first thing to do is register my xap’s mainpage object as a scriptable object using a static method on the HtmlPage class:</p>
<p><pre class="brush: csharp; title: ;" title="">
HtmlPage.RegisterScriptableObject(&quot;PivotViewer&quot;, this);
</pre>
<p>Next, it was just a matter of creating all of the events that I wanted to expose as scriptable.&nbsp; The only requirement that goes beyond the normal pattern for exposing events in .NET is to ensure that the event declaration is decorated with the <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptablememberattribute(v=vs.95).aspx">ScriptableMemberAttribute</a>:</p>
<p><pre class="brush: csharp; title: ;" title="">
[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ArticleButtonClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ArticleLinkClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; CodeButtonClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; FiltersChanged;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; SortChanged;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ViewChanged;

protected virtual void OnArticleButtonClicked(string articleUrl) {
    if (ArticleButtonClicked != null)
        ArticleButtonClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl });
}

protected virtual void OnArticleLinkClicked(string articleUrl) {
    if (ArticleLinkClicked != null)
        ArticleLinkClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl });
}

protected virtual void OnCodeButtonClicked(string articleUrl, string codeUrl) {
    if (CodeButtonClicked != null)
        CodeButtonClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl, CodeHref = codeUrl });
}

protected virtual void OnFiltersChanged(string filterString) {
    if (FiltersChanged != null)
        FiltersChanged(this, new PivotViewerStateEventArgs { FilterCategories = filterString });
}

protected virtual void OnSortChanged(string sortFacet) {
    if (SortChanged != null)
        SortChanged(this, new PivotViewerStateEventArgs { SortFacet = sortFacet });
}

protected virtual void OnViewChanged(string view) {
    if (ViewChanged != null)
        ViewChanged(this, new PivotViewerStateEventArgs { View = view });
}
</pre>
<p>Because the events pass a custom EventArguments type, we need to also ensure that this custom type is decorated with <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptabletypeattribute(v=vs.95).aspx">ScriptableTypeAttribute</a> and its members are decorated with <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptablememberattribute(v=vs.95).aspx">ScriptableMemberAttribute</a>:</p>
<p><pre class="brush: csharp; title: ;" title="">
[ScriptableType]
public class PivotViewerStateEventArgs : EventArgs
{
    [ScriptableMember]
    public string ArticleHref { get; set; }

    [ScriptableMember]
    public string CodeHref { get; set; }

    [ScriptableMember]
    public string FilterCategories { get; set; }

    [ScriptableMember]
    public string SortFacet { get; set; }

    [ScriptableMember]
    public string State { get; set; }

    [ScriptableMember]
    public string View { get; set; }
}
</pre>
<p>Firing the event is consistent with everything you already know from .NET programming – nothing more to see here.</p>
<h1>Consuming the Silverlight</h1>
<p>Because the xap completely encapsulates the Pivot viewer control, the configuration of all inputs is performed by default in the code behind the mainpage.xaml file.&nbsp; In my case, I wanted to have some of these configuration options available through the creation script or markup.&nbsp; To enable this, I enabled several different inputs (including the location of the cxml and the default view state) to be passed in through the Silverlight object’s <a href="http://msdn.microsoft.com/en-us/library/system.windows.startupeventargs.initparams(v=vs.95).aspx">InitParams</a> collection.&nbsp; This is a comma separated list that the application host automatically parses and makes available as a dictionary – through the Application.Current.Host.InitParams object.&nbsp; If you’re creating the Silverlight object using the object tag, you can specify all the configuration options using a param element.&nbsp; In my case, I wrapped the client functionality in a Javascript object, and am therefore creating it using the following:</p>
<p><pre class="brush: jscript; title: ;" title="">
PivotViewer.prototype.renderIn = function (container) {
    var self = this;
    Silverlight.createObject(
                this.xapPath,
                container[0],
                &quot;magazinePivotViewer_SL&quot;,
                {
                    type: &quot;application/x-silverlight-2&quot;,
                    width: &quot;100%&quot;,
                    height: &quot;100%&quot;,
                    background: &quot;white&quot;,
                    version: &quot;4.0.50401.0&quot;,
                    enableHtmlAccess: 'true',
                    autoUpgrade: 'true'
                },
                {
                    onError: this.onSilverlightError,
                    onLoad: function (sender, e) {
                        self.onLoad(sender, e);
                    }
                },
                &quot;collection=&quot; + this.collectionPath + &quot;,defaultViewState=&quot; + this.defaultViewState,
                this);
}
</pre>
<p>If you take a look at the third line from the bottom, you can see where the init parameters is built up from some fields (which were set during the object initializer). Another function of the initializer is that it allows you to pass in JavaScript functions to handle the various state change events that I previously exposed in my mainpage.xaml code behind.</p>
<p><pre class="brush: jscript; title: ;" title="">
var PivotViewer = function (xapPath,
        collectionPath,
        defaultViewState,
        onArticleLinkClicked,
        onArticleButtonClicked,
        onCodeButtonClicked,
        onSortChanged,
        onViewChanged,
        onFiltersChanged) {
    this.xapPath = xapPath;
    this.collectionPath = collectionPath;
    this.defaultViewState = defaultViewState;

    this.onArticleLinkClicked = onArticleLinkClicked;
    this.onArticleButtonClicked = onArticleButtonClicked;
    this.onCodeButtonClicked = onCodeButtonClicked;
    this.onSortChanged = onSortChanged;
    this.onViewChanged = onViewChanged;
    this.onFiltersChanged = onFiltersChanged;

};
</pre>
<p>In order to wire these client side functions up to the scriptable events in my Silverlight code, I&#8217;m hooking the load event in the Silverlight initialization code, and then setting the input JavaScript functions to the Silverlight event members.</p>
<p><pre class="brush: jscript; title: ;" title="">
PivotViewer.prototype.onLoad = function (sender, e) {
  sender.Content.PivotViewer.ArticleLinkClicked = this.onArticleLinkClicked;
  sender.Content.PivotViewer.ArticleButtonClicked = this.onArticleButtonClicked;
  sender.Content.PivotViewer.CodeButtonClicked = this.onCodeButtonClicked;
  sender.Content.PivotViewer.FiltersChanged = this.onFiltersChanged;
  sender.Content.PivotViewer.ViewChanged = this.onViewChanged;
  sender.Content.PivotViewer.SortChanged = this.onSortChanged;
}
</pre>
<p>This then gives me the ability to react in my HTML page to the state change events that are happening in the Pivot viewer Silverlight control. For example, in order to create a state change &#8220;console&#8221;, I would initialize my Pivot collection using the following JQuery:</p>
<p><pre class="brush: jscript; title: ;" title="">
$(document).ready(function () {
    var sl = new PivotViewer(&quot;ClientBin/Magazines.PivotViewer.xap&quot;,
        &quot;http://az7446.vo.msecnd.net/msdn-magazine/msdnmagazine.cxml&quot;,
        &quot;%24facet0%24=Issue%20Date&amp;%24view%24=2&quot;,
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;articleLinkClicked: &quot; + e.ArticleHref + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;articleButtonClicked: &quot; + e.ArticleHref + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;codeButtonClicked: [article - &quot; + e.ArticleHref + &quot;] [code - &quot; + e.CodeHref + &quot;]&quot; + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;sortChanged: &quot; + e.SortFacet + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;onViewChanged: &quot; + e.View + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;OnFiltersChanged: &quot; + e.FilterCategories + &quot;&lt;br/&gt;&quot;); })
            .renderIn($('div#silverlightControlHost'));
});
</pre>
<p>As I've mentioned before, my plan is to make all of the source code available to you through bitbucket (I need to do a little refactoring to get rid of some hard coded authentication strings and then I'll post the location). However, I hope this gives you a good idea of what was involved in creating the Pivot UX parts of the <a href="http://msdn.microsoft.com/magazine">MSDN Magazine pivot collection</a>.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/msdn-magazine/" title="View all posts in MSDN Magazine" rel="category">MSDN Magazine</a>, <a href="http://codebetter.com/howarddierking/category/pivot/" title="View all posts in Pivot" rel="category">Pivot</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/#respond" title="Comment on Creating the MSDN Magazine Pivot Client"><span class="dsq-postid" rel="85 http://codebetter.com/howarddierking/?p=85">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-85 -->

		
						
			<div id="post-92" class="post-92 post type-post status-publish format-standard hentry category-net category-nhibernate">
			<h2 class="entry-title"><a href="http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/" title="Permalink to Date/Time Support in NHibernate" rel="bookmark">Date/Time Support in NHibernate</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/" title="9:00 am" rel="bookmark"><span class="entry-date">2011/01/26</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jameskovacs" title="View all posts by James Kovacs">James Kovacs</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>[Code for this article is available on GitHub <a href="https://github.com/JamesKovacs/NH3Features/tree/02-DateTimeSupport">here</a>.]</p>
<p>In this post, we’ll examine the ways that NHibernate supports the DateTime-related data types, including some new features introduced in NHibernate 2 and 3. Here is a quick summary for the impatient.</p>
<table border="1" cellspacing="0" cellpadding="2">
<tbody>
<tr>
<td><strong>DbType</strong></td>
<td><strong>.NET</strong></td>
<td><strong>SQL Type</strong></td>
</tr>
<tr>
<td>DateTime</td>
<td>System.DateTime</td>
<td>datetime</td>
</tr>
<tr>
<td>LocalDateTime</td>
<td>System.DateTime</td>
<td>datetime</td>
</tr>
<tr>
<td>UtcDateTime</td>
<td>System.DateTime</td>
<td>datetime</td>
</tr>
<tr>
<td>DateTimeOffset</td>
<td>System.DateTimeOffset</td>
<td>datetimeoffset</td>
</tr>
<tr>
<td>DateTime2</td>
<td>System.DateTime</td>
<td>datetime2</td>
</tr>
<tr>
<td>Date</td>
<td>System.DateTime</td>
<td>date</td>
</tr>
<tr>
<td>Time</td>
<td>System.DateTime</td>
<td>time</td>
</tr>
<tr>
<td>TimeAsTimeSpan</td>
<td>System.TimeSpan</td>
<td>time</td>
</tr>
<tr>
<td>TimeSpan</td>
<td>System.TimeSpan</td>
<td>bigint (int64)</td>
</tr>
</tbody>
</table>
<h3>Local/UTC</h3>
<p>Let’s take a look at a few DateTime-related problems that developers have run into in the past…</p>
<pre class="brush: csharp;">public class DateTimeEntity {
    public DateTimeEntity() {
        CreationTime = DateTime.Now;
    }

    public virtual Guid Id { get; private set; }
    public virtual DateTime CreationTime { get; set; }
}</pre>
<p>Note that CreationTime is initialized using DateTime.Now. The corresponding mapping file would be:</p>
<pre class="brush: xml;">

&lt;hibernate-mapping xmlns="urn:nhibernate-mapping-2.2"

                   namespace="Nh3Hacking"

                   assembly="Nh3Hacking"&gt;
  &lt;class name="DateTimeEntity"&gt;
    &lt;id name="Id"&gt;
      &lt;generator class="guid.comb" /&gt;
    &lt;/id&gt;
    &lt;property name="CreationTime"/&gt;
  &lt;/class&gt;
&lt;/hibernate-mapping&gt;
</pre>
<p>If we create an instance of our DateTimeEntity and reload it, we get:</p>
<pre>Original entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTime: 2011-01-24 5:29:36 PM (Local)
Reloaded entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTime: 2011-01-24 5:29:36 PM (Unspecified)</pre>
<p>Note that I am outputting both CreationTime.ToString() and CreationTime.Kind. DateTime.Kind returns a DateTimeKind (surprising, huh?), which indicates whether this DateTime represents Local time or UTC time. We initialized the value with DateTime.Now, which is the local time. (If we wanted UTC time, we would use DateTime.UtcNow.) When the object is reloaded, the DateTimeKind is Unspecified. This is because the database does not store whether the DateTime value is Local or UTC. NHibernate has no way of knowing which one it is, hence Unspecified.</p>
<p>NHibernate 3 includes two new DbTypes that allow us to resolve this ambiguity. In our mapping file, we can write:</p>
<pre class="brush: xml;">&lt;property name="CreationTimeAsLocalDateTime" type="LocalDateTime"/&gt;
&lt;property name="CreationTimeAsUtcDateTime" type="UtcDateTime"/&gt;</pre>
<p>We are explicitly telling NHibernate whether the database stores Local or UTC times.</p>
<pre>Original entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTimeAsDateTime: 2011-01-24 5:29:36 PM (Local)
        CreationTimeAsLocalDateTime: 2011-01-24 5:29:36 PM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 12:29:36 AM (Utc)
Reloaded entity:
Id: 09bead07-5a05-4459-a108-9e7501204918
        CreationTimeAsDateTime: 2011-01-24 5:29:36 PM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-24 5:29:36 PM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 12:29:36 AM (Utc)</pre>
<p>This is strictly metadata and it is up to the developer to ensure that the proper DateTime is present in the property/field. For instance, if I initialize the entity as follows:</p>
<pre class="brush: csharp;">public DateTimeEntity() {
    CreationTimeAsDateTime = DateTime.Now;
    CreationTimeAsLocalDateTime = DateTime.UtcNow;
    CreationTimeAsUtcDateTime = DateTime.Now;
}</pre>
<p>Note that the LocalDateTime property contains a UTC DateTime and the UTC property contains a Local DateTime. The results are:</p>
<pre>Original entity:
Id: 4579d245-46f3-4c3f-893b-9e750124a90b
        CreationTimeAsDateTime: 2011-01-24 5:45:32 PM (Local)
        CreationTimeAsLocalDateTime: 2011-01-25 12:45:32 AM (Utc)
        CreationTimeAsUtcDateTime: 2011-01-24 5:45:32 PM (Local)
Reloaded entity:
Id: 4579d245-46f3-4c3f-893b-9e750124a90b
        CreationTimeAsDateTime: 2011-01-24 5:45:32 PM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-25 12:45:32 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-24 5:45:32 PM (Utc)</pre>
<p>Notice that NHibernate did not perform any conversions or throw an exception when saving/loading a DateTime value with the wrong DateTimeKind. (It could be argued that NHibernate should throw an exception when asked to save a Local DateTime and the property is mapped as a UtcDateTime.) It is up to the developer to ensure that the proper kind of DateTime is in the appropriate field/property.</p>
<h3>System.DateTimeOffset</h3>
<p>One problem that LocalDateTime and UtcDateTime does not solve is the offset problem. If you have a DateTime and its Kind is Local, all you know is that it is a Local DateTime. You do not know if that Local DateTime is Mountain (MST), Eastern (EST), Pacific (PST), etc. You do not know whether it has been corrected for daylight savings time. All you know is that it is a Local DateTime. You have to assume that the local time is based on the time zone of the current computer. Although this is often a reasonable assumption, it’s not always. (Consider for example that you’re collecting log files from a distributed system and servers reside in multiple time zones.) The problem is that System.DateTime class does not contain a place to record the timezone offset. Microsoft solved this problem starting in .NET 3.5 by introducing the System.DateTimeOffset class. It looks a lot like System.DateTime, but does include the timezone offset rather than the DateTimeKind. So we can just use System.DateTimeOffset in our applications rather than System.DateTime.</p>
<p>Except… Date/time types in SQL databases do not have anywhere to store the timezone offset. The notable exception is SQL Server 2008, which introduced the datetimeoffset type. NHibernate 2 introduced support for System.DateTimeOffset, but only for SQL Server 2008 onwards. (If you’re using SQL Server 2005 or earlier or another database server, you’ll have to implement your own IUserType to store System.DateTimeOffset in two separate columns – one for the DateTime and the other for the timezone offset.) The additional code in DateTimeEntity.cs looks like this:</p>
<pre class="brush: csharp;">public virtual DateTimeOffset CreationTimeAsDateTimeOffset { get; set; }</pre>
<p>The mapping file just needs the new property added:</p>
<pre class="brush: xml;">&lt;property name="CreationTimeAsDateTimeOffset"/&gt;</pre>
<p>Note that I don’t need to specify the type in the mapping as NHibernate can infer it from the property type in DateTimeEntity. The resulting output is:</p>
<pre>Original entity:
Id: 95aa6c15-86f5-4398-aa9e-9e7600ae4580
        CreationTimeAsDateTime: 2011-01-25 10:34:30 AM (Local)
        CreationTimeAsLocalDateTime: 2011-01-25 10:34:30 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 5:34:30 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 10:34:30 AM -07:00
Reloaded entity:
Id: 95aa6c15-86f5-4398-aa9e-9e7600ae4580
        CreationTimeAsDateTime: 2011-01-25 10:34:30 AM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-25 10:34:30 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 5:34:30 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 10:34:30 AM -07:00</pre>
<h3>Support for DateTime2, Date, and Time</h3>
<p>Let’s look at some C# and the corresponding mapping file for these types:</p>
<pre class="brush: csharp;">public virtual DateTime CreationTimeAsDateTime2 { get; set; }
public virtual DateTime CreationTimeAsDate { get; set; }
public virtual DateTime CreationTimeAsTime { get; set; }
public virtual TimeSpan CreationTimeAsTimeAsTimeSpan { get; set; }
public virtual TimeSpan CreationTimeAsTimeSpan { get; set; }</pre>
<p>Modifications to the hbm.xml:</p>
<pre class="brush: xml;">&lt;property name="CreationTimeAsDateTime2" type="DateTime2"/&gt;
&lt;property name="CreationTimeAsDate" type="Date"/&gt;
&lt;property name="CreationTimeAsTime" type="Time"/&gt;
&lt;property name="CreationTimeAsTimeAsTimeSpan" type="TimeAsTimeSpan"/&gt;
&lt;property name="CreationTimeAsTimeSpan"/&gt;</pre>
<p>We’ll examine each of these in turn…</p>
<p>DbType.DateTime2 is a higher precision, wider range version of DbType.DateTime. DbType.DateTime maps to the datetime (or smalldatetime) SQL type, which has a range of 1753-01-01 to 9999-12-31. DbType.DateTime2 maps to the datetime2 SQL type, which has a range of 0001-01-01 to 9999-12-31. (Precision can be as high as 1/10 of a microsecond with a datetime2(7).) One of the niceties of DateTime2 is that an uninitialized DateTime struct (which has a value of 0001-01-01 12:00:00 AM (Unspecified)) does not cause a SqlTypeException with a SqlDateTime underflow.</p>
<p>DbType.Date does just what it advertises. It represents a Date without a Time component. It is stored in the database as only a date. .NET does not have a Date type and NHibernate represents it via a DateTime with the time portion set to 12:00:00 AM. I personally prefer to define my own Date class, which has no time component, and create an IUserType to handle the mapping. My custom Date class can handle the time truncation and provide a more natural programing model for my domain, but that’s a post for another day.</p>
<p>Time-related DbTypes stores just the time, but no date. In .NET, there is no Time class and so NHibernate uses a DateTime with the date component set to 1753-01-01, the minimum value for a SQL datetime or a System.TimeSpan – depending on the DbType that we choose. DbType.Time stores a System.DateTime in a time SQL type. DbType.TimeAsTimeSpan stores a System.TimeSpan as a time SQL type. DbType.TimeSpan stores a Syste.TimeSpan as a 64-bit integer (bigint) SQL type. As I mentioned for DbType.Date, I am more inclined to write my own Time class and custom IUserType to achieve a better programming model than relying on the .NET constructs of System.DateTime and System.TimeSpan. (I typically use System.DateTime or System.TimeSpan as a field in my custom Date or Time class for storing the data, but provide my own API for consistently working with the data.)</p>
<p><strong>WARNING</strong>: Not all databases support all date/time SQL types. So before choosing .NET and SQL types for your entities, make sure that they’re available in all databases that you plan to support.</p>
<p>Now we’ll take a look at these date/time types in action:</p>
<pre>Original entity:
Id: 6b2fb9ff-8036-4c17-b9ef-9e7600bf37e3
        CreationTimeAsDateTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsLocalDateTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 6:36:12 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 11:36:12 AM -07:00
        CreationTimeAsDateTime2: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsDate: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsTimeAsTimeSpan: 11:36:12.2688265
        CreationTimeAsTimeSpan: 11:36:12.2688265
Reloaded entity:
Id: 6b2fb9ff-8036-4c17-b9ef-9e7600bf37e3
        CreationTimeAsDateTime: 2011-01-25 11:36:12 AM (Unspecified)
        CreationTimeAsLocalDateTime: 2011-01-25 11:36:12 AM (Local)
        CreationTimeAsUtcDateTime: 2011-01-25 6:36:12 PM (Utc)
        CreationTimeAsDateTimeOffset: 2011-01-25 11:36:12 AM -07:00
        CreationTimeAsDateTime2: 2011-01-25 11:36:12 AM (Unspecified)
        CreationTimeAsDate: 2011-01-25 12:00:00 AM (Unspecified)
        CreationTimeAsTime: 1753-01-01 11:36:12 AM (Unspecified)
        CreationTimeAsTimeAsTimeSpan: 11:36:12.2700000
        CreationTimeAsTimeSpan: 11:36:12.2688265</pre>
<h3>Summary</h3>
<p>As you have seen, NHibernate has a wide variety of options for mapping date/time-related types to and from the database. The right choice is highly dependent on your application and database server. I hope that this post has given you a few more tricks up your sleeve for effectively mapping date/time-related types using NHibernate.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jameskovacs/category/net/" title="View all posts in .NET" rel="category">.NET</a>, <a href="http://codebetter.com/jameskovacs/category/nhibernate/" title="View all posts in NHibernate" rel="category">NHibernate</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/#respond" title="Comment on Date/Time Support in NHibernate"><span class="dsq-postid" rel="92 http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-92 -->

		
						
			<div id="post-827" class="post-827 post type-post status-publish format-standard hentry category-structuremap tag-structuremap">
			<h2 class="entry-title"><a href="http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/" title="Permalink to If you are using StructureMap with MVC3, please read this:" rel="bookmark">If you are using StructureMap with MVC3, please read this:</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/" title="9:49 pm" rel="bookmark"><span class="entry-date">January 23, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/jeremymiller" title="View all posts by Jeremy Miller">Jeremy Miller</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>Ok, a couple people are stumbling into some problems with using StructureMap with ASP.Net MVC3&#8242;s new IoC integration.  Steve Smith has a blog post <a href="http://stevesmithblog.com/blog/how-do-i-use-structuremap-with-asp-net-mvc-3/">here</a> that shows a correctly working version of using StructureMap as MVC3&#8242;s  IDependencyResolver.</p>
<p>The specific problem is in the IDependencyResolver.GetService(type) method.  MVC3 makes a different set of assumptions about IoC functionality than we did with StructureMap&#8217;s TryGetInstance(type) method.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/jeremymiller/category/structuremap/" title="View all posts in StructureMap" rel="category">StructureMap</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="tag-links"><span class="entry-utility-prep entry-utility-prep-tag-links">Tagged <a href="http://codebetter.com/jeremymiller/tag/structuremap/" title="View all posts in StructureMap" rel="tag">StructureMap</a></span></span>
				<span class="meta-sep"> | </span>
								<span class="comments-link"><a href="http://codebetter.com/jeremymiller/2011/01/23/if-you-are-using-structuremap-with-mvc3-please-read-this/#respond" title="Comment on If you are using StructureMap with MVC3, please read this:"><span class="dsq-postid" rel="827 http://codebetter.com/jeremymiller/?p=827">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-827 -->

		
			
	<div id="nav-below" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-below -->
			</div><!-- #main -->
			<div id="sidebar" class="grid_4">
						<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="authors" class="widget-container widget_authors"><h3 class="widget-title">CodeBetter.Com Editors</h3>
<!-- Authors -->
<ul>
<li><a href="http://codebetter.com/jeremymiller/">Jeremy D. Miller</a></li><li><a href="http://codebetter.com/howarddierking/">Howard Dierking</a></li><li><a href="http://codebetter.com/petervanooijen/">Peter van Ooijen</a></li><li><a href="http://codebetter.com/jameskovacs/">James Kovacs</a></li><li><a href="http://codebetter.com/drusellers/">Dru Sellers</a></li><li><a href="http://codebetter.com/benhall/">Ben Hall</a></li><li><a href="http://codebetter.com/iancooper/">Ian Cooper</a></li><li><a href="http://codebetter.com/davidhayden/">David Hayden</a></li><li><a href="http://codebetter.com/sebastienlambla/">Sebastien Lambla</a></li><li><a href="http://codebetter.com/glennblock/">Glenn Block</a></li><li><a href="http://codebetter.com/patricksmacchia/">Patrick Smacchia</a></li><li><a href="http://codebetter.com/matthewpodwysocki/">Matthew Podwysocki</a></li><li><a href="http://codebetter.com/kylebaley/">Kyle Baley</a></li><li><a href="http://codebetter.com/gregyoung/">Greg Young</a></li></ul>
<!-- /Authors -->

</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
					<li id="blogs" class="widget-container widget_blogs"><h3 class="widget-title">Latest Posts</h3>
<!-- blogs -->
<ul>
<li><a href="http://codebetter.com/jeremymiller/2011/01/28/announcing-the-new-atx-code-lunch/">Announcing the new ATX Code Lunch</a> <br/> by <a href="http://codebetter.com/jeremymiller/">Jeremy D. Miller</a></li><li><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/">Creating the MSDN Magazine Pivot Client</a> <br/> by <a href="http://codebetter.com/howarddierking/">Howard Dierking</a></li><li><a href="http://codebetter.com/petervanooijen/2010/12/28/seasons-gifts-from-the-monotouch-iphone-treasure-chest-background-gps-tasks-and-uicontrol/">Seasons gifts from the MonoTouch (iPhone) treasure chest. Background (GPS) tasks and UIControl</a> <br/> by <a href="http://codebetter.com/petervanooijen/">Peter van Ooijen</a></li><li><a href="http://codebetter.com/jameskovacs/2011/01/26/datetime-support-in-nhibernate/">Date/Time Support in NHibernate</a> <br/> by <a href="http://codebetter.com/jameskovacs/">James Kovacs</a></li><li><a href="http://codebetter.com/drusellers/2011/01/22/rss-feed/">RSS Feed</a> <br/> by <a href="http://codebetter.com/drusellers/">Dru Sellers</a></li><li><a href="http://codebetter.com/iancooper/2011/01/16/alt-next/">Alt.Next</a> <br/> by <a href="http://codebetter.com/iancooper/">Ian Cooper</a></li><li><a href="http://codebetter.com/sebastienlambla/2011/01/06/coming-up-next-in-openwrap/">Coming up next in OpenWrap&hellip;</a> <br/> by <a href="http://codebetter.com/sebastienlambla/">Sebastien Lambla</a></li><li><a href="http://codebetter.com/glennblock/2010/12/13/wcf-web-apis-roundup-volume-1/">WCF Web APIs Roundup - Volume 1</a> <br/> by <a href="http://codebetter.com/glennblock/">Glenn Block</a></li><li><a href="http://codebetter.com/patricksmacchia/2010/12/14/google-continuous-integration/">Google Continuous Integration Process</a> <br/> by <a href="http://codebetter.com/patricksmacchia/">Patrick Smacchia</a></li></ul>
<!-- /blogs -->

</li>				</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #content -->
	
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.351 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-29 16:23:48 -->
