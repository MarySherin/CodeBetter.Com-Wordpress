<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>A recent conversation about MSpec practices | Aaron Jensen</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/aaronjensen/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/aaronjensen/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Aaron Jensen' href='http://codebetter.com/aaronjensen/' />
<link rel='start' title='The Eleutian Guys join the CodeBetter Guys' href='http://codebetter.com/aaronjensen/2008/03/19/the-eleutian-guys-join-the-codebetter-guys/' />
<link rel='prev' title='Check out Virtual ALT.NET' href='http://codebetter.com/aaronjensen/2009/06/30/check-out-virtual-alt-net/' />
<link rel='next' title='Advanced Selenium RC logging with MSpec' href='http://codebetter.com/aaronjensen/2009/10/20/advanced-selenium-logging-with-mspec/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/aaronjensen/2009/10/05/a-recent-conversation-about-mspec-practices/' />
<link rel='shortlink' href='http://codebetter.com/aaronjensen/?p=29' />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/aaronjensen/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-29" class="post-29 post type-post status-publish format-standard hentry category-mspec">
					<h1 class="entry-title">A recent conversation about MSpec practices</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/aaronjensen/author/aaronjensen/" title="View all posts by Aaron Jensen">Aaron Jensen</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/aaronjensen/2009/10/05/a-recent-conversation-about-mspec-practices/" title="9:12 pm" rel="bookmark"><span class="entry-date">October 5, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/aaronjensen/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/aaronjensen/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>Recently I&#8217;ve heard about more and more people checking out MSpec. A few days ago I got an email from a friend. He said he was having trouble with base class explosion while creating specs. Here is a snippet from his code:</p>
<pre>public abstract class with_null_program
{
  protected static Program program;
}

public abstract class with_program_and_empty_args : with_null_program
{
  Establish context = () =&gt; program = new Program(new string[]{});
}

public abstract class with_list_command
{

}

[Subject(&quot;Program&quot;)]
public class when_creating : with_program_and_empty_args
{
  private Because of = () =&gt; program = new Program(new string[] {});

  It should_output_to_the_console =()=&gt;
   program.Out.ShouldEqual(Console.Out);
}

[Subject(&quot;Program&quot;)]
public class when_running_with_no_arguments : with_null_program
{
  private static StringBuilder outputBuilder;

  private Because of = () =&gt;
  {
    outputBuilder = new StringBuilder();
    program = new Program(new string[] {}) {Out = new StringWriter(outputBuilder)};
    program.Run();
  };

  It should_print_usage =()=&gt; outputBuilder.ToString().ShouldContain(&quot;USAGE&quot;);
}

[Subject(&quot;Program&quot;)]
public class when_running_without_database_args : with_list_command
{

}</pre>
<p>And here&#8217;s my response:</p>
<blockquote>
<p>Hey man, Glad to see you playing with MSpec. Definitely curious to get your feedback on the experience.</p>
<p>So there&#8217;s a few things I noticed about the specs. For one, you&#8217;re using the with_ pattern. I know I or Scott or someone started this&#8230; but I don&#8217;t like it now. I much more prefer to just have a base class that contains any utility/meaningless cruft my specs have. You also seem to have taken this to a bit of an extreme. Would you make a regular base class just to create a single instance variable and set it to null in the constructor? Probably not. Same stuff applies here. There&#8217;s no value in creating base classes unless they provide value. There&#8217;s no naming or understanding benefit. As a matter of fact, they *hinder* understanding more than anything. This is why I try to only put utter crap in base classes, and when it&#8217;s important crap, I put it in a method and name it something descriptive and call it in the context. If I were to rewrite these specs I *may* have a single base class called ProgramSpecs. It would probably just have the static program field, but be a place holder in case i needed any utility methods. Naming specs with the with_foo_bar implies that that name is important, which it isn&#8217;t. It&#8217;s not included in the report for a reason. Your context description should be fully encapsulated by the name of the context class.</p>
<p>Another thing I&#8217;m seeing&#8230; and I&#8217;m not sure if this is just circumstantial, but do you know that you can have more than one context in a class hierarchy? In other words, something like outputBuilder = new StringBuilder() would go in the subclasses establish context. They&#8217;re run in order from basiest to subbiest. The Because is *only* a way to highlight a line and say &quot;this is the catalyst that makes the observations possible&#8230; everything else up to this point is also important, but this is the real meat&quot;. Because is actually *part* of the context. The Context is the arrange and the act (if there is an act). Here&#8217;s an example of multiple context clauses (though i have no idea why i didn&#8217;t use because here, heh): <a href="http://github.com/aaronjensen/compete/blob/master/Source/Compete.Specs/Model/Game/AggregateResultSpecs.cs">http://github.com/aaronjensen/compete/blob/master/Source/Compete.Specs/Model/Game/AggregateResultSpecs.cs</a></p>
<p>As an aside, I feel the Program class is a bit awkward. Personally, it&#8217;d make more sense if the StringBuilder was a constructor parameter and the args were parameters to the run method. That&#8217;s just my style though&#8211;i&#8217;m not saying it&#8217;s better. It would definitely make testing this less awkward. Actually, look at your context. &quot;when running with no arguments&quot;. Your code isn&#8217;t doing what you said it would do, at least not in the simplest fashion. I think I&#8217;ll change my position to &quot;strongly prefer&quot; the arguments to be passed to the Run method <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  More often than not, when you&#8217;re feeling pain while testing it&#8217;s because your API can be improved.</p>
<p>You may, if you haven&#8217;t already, want to take a look at the mspec console runner specs: <a href="http://github.com/machine/machine.specifications/blob/master/Source/Machine.Specifications.ConsoleRunner.Specs/ProgramSpecs.cs">http://github.com/machine/machine.specifications/blob/master/Source/Machine.Specifications.ConsoleRunner.Specs/ProgramSpecs.cs</a></p>
<p>They&#8217;re quite similar to the domain you were writing specs for and may help. Yes, I used with_runner there, they&#8217;re old <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley' /> </p>
<p>Hope that helps a bit, let me know if you have any other questions or anything.</p>
<p>Thanks, Aaron</p>
</blockquote>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/aaronjensen/category/mspec/" title="View all posts in mspec" rel="category tag">mspec</a>. Bookmark the <a href="http://codebetter.com/aaronjensen/2009/10/05/a-recent-conversation-about-mspec-practices/" title="Permalink to A recent conversation about MSpec practices" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/aaronjensen/2009/10/05/a-recent-conversation-about-mspec-practices/feed/" title="Comments RSS to A recent conversation about MSpec practices" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-29 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/aaronjensen/2009/06/30/check-out-virtual-alt-net/" rel="prev"><span class="meta-nav">&larr;</span> Check out Virtual ALT.NET</a></div>
					<div class="nav-next"><a href="http://codebetter.com/aaronjensen/2009/10/20/advanced-selenium-logging-with-mspec/" rel="next">Advanced Selenium RC logging with MSpec <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-162">
					<div id="dsq-comment-header-162" class="dsq-comment-header">
						<cite id="dsq-cite-162">
								<span id="dsq-author-user-162">Paco</span>
							</cite>
					</div>
					<div id="dsq-comment-body-162" class="dsq-comment-body">
						<div id="dsq-comment-message-162" class="dsq-comment-message"><p>Why don&#8217;t you declare the Subject attribute on the with_runner class in your example? Because it&#8217;s not a feature of MSpec of course. I would like to have subjects and sub-subjects with inheritance from baseclasses that appear in the report output. </p>
<p>[Subject(&#8220;base subject&#8221;) public class Baseclass { }</p>
<p>[Subject(&#8220;sub subject&#8221;)public class When_something : Baseclass { }</p>
<p>Report:</p>
<p>Base subject specs:<br />
- sub subject specs:<br />
 + When something<br />
   * should_do_this<br />
   * should_do_that<br />
 + When something else<br />
   * should_do_that</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-163">
					<div id="dsq-comment-header-163" class="dsq-comment-header">
						<cite id="dsq-cite-163">
	http://codebetter.com/members/ScottBellware/default.aspx							<span id="dsq-author-user-163">ScottBellware</span>
							</cite>
					</div>
					<div id="dsq-comment-body-163" class="dsq-comment-body">
						<div id="dsq-comment-message-163" class="dsq-comment-message"><p>The &#8220;with_&#8221; stuff is just a naming style.  It&#8217;s aesthetic.  It&#8217;s not the impetus for creating base context classes.  As Aaron said, base context classes are there to remove noise.  In C#, noise is inevitable &#8211; it&#8217;s just a noisy programming language, filled with compiler instructions and ceremony.  When I create a base context, I may name it using the &#8220;with_&#8221; convention, or some other convention, but the drive to create a base context has nothing to do with trying to create English language constructs using C#&#8217;s syntax for class extension.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-164">
					<div id="dsq-comment-header-164" class="dsq-comment-header">
						<cite id="dsq-cite-164">
								<span id="dsq-author-user-164">BJ Dweck</span>
							</cite>
					</div>
					<div id="dsq-comment-body-164" class="dsq-comment-body">
						<div id="dsq-comment-message-164" class="dsq-comment-message"><p>I&#8217;ve been using mSpec for only a few weeks now and struggled with this point a little, until I read the following advise from Alexander Groß:</p>
<p>&#8220;&#8230;I mainly use &#8220;With&#8221; base classes as a container and perform only general initialization there, like setting up mocked dependencies. However, strive to not stub behavior in the &#8220;Withs&#8221;.&#8221;</p>
<p><a href="http://stackoverflow.com/questions/1184297/bdd-and-mspec-am-i-approaching-this-right" rel="nofollow">http://stackoverflow.com/questions/1184297/bdd-and-mspec-am-i-approaching-this-right</a> </p>
<p>Now my base classes play the role of a container and look like this:</p>
<p>    public class With_controller_container<br />
    {<br />
        protected static ISeasonsService _seasonsService;<br />
        protected static IPrintService _printService;<br />
        protected static IDesignService _designService;<br />
        protected static IProductCategoryService _productCategoryService;</p>
<p>        protected static PrintController _printController;<br />
        protected static AjaxController _ajaxController;<br />
        protected static DesignController _designController;<br />
        protected static AdminController _adminController;</p>
<p>        Establish context = () =><br />
        {<br />
            _seasonsService = MockRepository.GenerateStub<iseasonsservice>();<br />
            _printService = MockRepository.GenerateStub<iprintservice>();<br />
            _designService = MockRepository.GenerateStub<idesignservice>();<br />
            _productCategoryService = MockRepository.GenerateStub<iproductcategoryservice>();</p>
<p>            _printController = new PrintController(_printService);<br />
            _ajaxController = new AjaxController(_printService, _seasonsService);<br />
            _designController = new DesignController(_designService);<br />
            _adminController = new AdminController(_productCategoryService, _seasonsService);<br />
        };<br />
    }</p>
<p>and things are really working out well so far&#8230;</iproductcategoryservice></idesignservice></iprintservice></iseasonsservice></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-165">
					<div id="dsq-comment-header-165" class="dsq-comment-header">
						<cite id="dsq-cite-165">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-165">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-165" class="dsq-comment-body">
						<div id="dsq-comment-message-165" class="dsq-comment-message"><p>Paco,</p>
<p>I don&#8217;t see any positives with this approach other than saving typing. The negatives are numerous though, it makes scanning more difficult, you have to skip around the file in order to understand a test. It also can (and likely would) lead people to being lazy about their subjects and not thinking about them thoroughly. Most would just set their subject once on the base class and not think about it again.</p>
<p>Scott,</p>
<p>Yes, I agree. Some were starting to use or assume that the with_ classes were part of the context and therefore should be in the report or were allowed to be necessary for understanding. This is what I want to discourage. I, of course, have no qualms with this naming convention if used responsibly.</p>
<p>BJ,</p>
<p>Totally agree. Alex is a smart guy <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
					</div>
				</li>
					<li id="dsq-comment-166">
					<div id="dsq-comment-header-166" class="dsq-comment-header">
						<cite id="dsq-cite-166">
	http://www.corebvba.be							<span id="dsq-author-user-166">Tom Janssens</span>
							</cite>
					</div>
					<div id="dsq-comment-body-166" class="dsq-comment-body">
						<div id="dsq-comment-message-166" class="dsq-comment-message"><p>Hey Aaron,</p>
<p>Based on your version I am currently implementing a new BDD framework, but with an even cleaner layout then yours.</p>
<p>Please let me know what you think about it, since your framework has been my initial inspiration :<br />
<a href="http://www.corebvba.be/blog/post/A-new-BDD-framework-in-Net-NetSpec.aspx" rel="nofollow">http://www.corebvba.be/blog/post/A-new-BDD-framework-in-Net-NetSpec.aspx</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-167">
					<div id="dsq-comment-header-167" class="dsq-comment-header">
						<cite id="dsq-cite-167">
								<span id="dsq-author-user-167">ryzam</span>
							</cite>
					</div>
					<div id="dsq-comment-body-167" class="dsq-comment-body">
						<div id="dsq-comment-message-167" class="dsq-comment-message"><p>How can i write establish context to the reporting?</p>
<p>I like to do somthing like this</p>
<p>Establish given_customer_status_is_non_active = () =><br />
  &#8230;</p>
<p>Establish and_given_balance_is_equal_to_1000 = () =><br />
 &#8230;</p>
<p>I try to write establish context to reporting, but not sure how</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-168">
					<div id="dsq-comment-header-168" class="dsq-comment-header">
						<cite id="dsq-cite-168">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-168">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-168" class="dsq-comment-body">
						<div id="dsq-comment-message-168" class="dsq-comment-message"><p>Hi Ryzam,</p>
<p>You actually don&#8217;t. That&#8217;s not how the framework works. &#8220;Establish context&#8221; is just a marker. The actual text description of the context is the class name. MSpec is not Cucumber or any other GWT framework, it&#8217;s a Context/Specification framework. As such, you have one context. Some C/S frameworks support nested contexts, but MSpec does not at this time. You&#8217;ll need to say everything you need to say in the class name. Hope this helps.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-169">
					<div id="dsq-comment-header-169" class="dsq-comment-header">
						<cite id="dsq-cite-169">
								<span id="dsq-author-user-169">Martin</span>
							</cite>
					</div>
					<div id="dsq-comment-body-169" class="dsq-comment-body">
						<div id="dsq-comment-message-169" class="dsq-comment-message"><p>How does MSpec (or BDD itself) adapt to low level requirements, such as testing business classes methods in isolation, verifying a DB connection is closed, etc.?</p>
<p>You may want to look at this article which talks about this and made me think about it:<br />
<a href="http://thedotnetters.blogspot.com/2010/01/introducing-mspec.html" rel="nofollow">http://thedotnetters.blogspot.com/2010/01/introducing-mspec.html</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-170">
					<div id="dsq-comment-header-170" class="dsq-comment-header">
						<cite id="dsq-cite-170">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-170">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-170" class="dsq-comment-body">
						<div id="dsq-comment-message-170" class="dsq-comment-message"><p>Hi Martin,</p>
<p>Just because they&#8217;re low level requirement doesn&#8217;t mean they cannot be expressed in English. Context/Spec certainly isn&#8217;t a one-size-fits-all testing paradigm, but it fits pretty well for most things. </p>
<p>With lower level things you speak in lower level terms. You want to be sure to consider your audience: <a href="http://codebetter.com/blogs/aaron.jensen/archive/2008/10/19/bdd-consider-your-audience.aspx" rel="nofollow">http://codebetter.com/blogs/aaron.jensen/archive/2008/10/19/bdd-consider-your-audience.aspx</a></p>
<p>In this case your audience would be other programmers. Being able to express in plain, terse English what your code is doing is valuable both in terms of initially writing/designing it and later attempting to understand something that already exists.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-171">
					<div id="dsq-comment-header-171" class="dsq-comment-header">
						<cite id="dsq-cite-171">
								<span id="dsq-author-user-171">Martin</span>
							</cite>
					</div>
					<div id="dsq-comment-body-171" class="dsq-comment-body">
						<div id="dsq-comment-message-171" class="dsq-comment-message"><p>Ok, I see what you mean Aaron and thanks for the quick reply.</p>
<p>Another question I have:</p>
<p>When you plan your tests (or specs) at a higher-level (ie: when you plan to test the user stories, the business requirements) should it be at the controller level (in an MVC arch), at the service layer, both? </p>
<p>Definitely, it doesn&#8217;t seem the right thing to test the stories at the data access layer for example since you sometimes don&#8217;t talk in terms of &#8220;business&#8221; at that point. What do you think?</p>
<p>If you DO test at data access layer, you will definitely also have to test those stories at the service and/or controller layer too, to ensure that the specification is fulfilled across all the layers of your app, and you might end with duplicate specs.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-172">
					<div id="dsq-comment-header-172" class="dsq-comment-header">
						<cite id="dsq-cite-172">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-172">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-172" class="dsq-comment-body">
						<div id="dsq-comment-message-172" class="dsq-comment-message"><p>Duplication isn&#8217;t something you should strive to avoid. I tend to test my data access against the db itself then stub it out when testing the actual functionality. </p>
<p>I also tend to not test Controllers as much since mine are so simple. I don&#8217;t necessarily recommend that, I just haven&#8217;t gotten much value in it.</p>
<p>We also write a lot of code that has very clear testing boundaries&#8230; pieces that receive messages and as a result send messages (or fire domain events). Really easy to know where to test these&#8211;you just test everything and stub out the db if you have one.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-173">
					<div id="dsq-comment-header-173" class="dsq-comment-header">
						<cite id="dsq-cite-173">
								<span id="dsq-author-user-173">Luke</span>
							</cite>
					</div>
					<div id="dsq-comment-body-173" class="dsq-comment-body">
						<div id="dsq-comment-message-173" class="dsq-comment-message"><p>I think you mentioned Cucumber in some previous answer. I wasn&#8217;t able to use it, but have seen some screencast about Cuke4Nuke (which is the framework ported to .NET I believe) with Watin.</p>
<p><a href="http://tinyurl.com/yfkt3yc" rel="nofollow">http://tinyurl.com/yfkt3yc</a></p>
<p>What do you think about it? What do you think about the regular expression way of expressing different scenarios? I am not so sure how well it works in bigger, real-life cases.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-174">
					<div id="dsq-comment-header-174" class="dsq-comment-header">
						<cite id="dsq-cite-174">
								<span id="dsq-author-user-174">Kevin</span>
							</cite>
					</div>
					<div id="dsq-comment-body-174" class="dsq-comment-body">
						<div id="dsq-comment-message-174" class="dsq-comment-message"><p>I want to verify that certain specs are executed in a specific order (for instance, I want to make sure that a validation is run first and that the repository is accessed after that.. or whatever)</p>
<p>Can Mspec ensure that?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-175">
					<div id="dsq-comment-header-175" class="dsq-comment-header">
						<cite id="dsq-cite-175">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-175">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-175" class="dsq-comment-body">
						<div id="dsq-comment-message-175" class="dsq-comment-message"><p>Kevin, correct me if I&#8217;m wrong, but it doesn&#8217;t sound like you want to verify that *specs* are run in a certain order, but rather that your system under test does things in a certain order. Is that correct? </p>
<p>If so, this is an annoying problem to solve with any testing framework and it could be an indication that you&#8217;re testing the wrong thing. Why is it that you want X to happen before Y? The example you gave seems contrived. Is that your real example? If so, why do you want to test this? Isn&#8217;t there something more meaningful you can test? </p>
<p>Essentially, you&#8217;re attempting to test the encapsulated portions of your system under test when really you should be testing the *behavior* that is observable externally.</p>
<p>Any way, if you really want to do this, you&#8217;d just use custom fakes or something along those lines. The testing framework has nothing to do with this problem&#8230; unless i&#8217;m misunderstanding your question&#8230; it&#8217;s late.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-176">
					<div id="dsq-comment-header-176" class="dsq-comment-header">
						<cite id="dsq-cite-176">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-176">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-176" class="dsq-comment-body">
						<div id="dsq-comment-message-176" class="dsq-comment-message"><p>Luke,</p>
<p>I&#8217;m not a fan of cucumber. I think the regular expression based scenario expression leads to short stopping the analysis. It is also easily abused. </p>
<p>Example:</p>
<p>Given username &#8220;bob&#8221;<br />
and password &#8220;foo&#8221;<br />
when logging in<br />
then it should fail</p>
<p>Given username &#8220;sam&#8221;<br />
and password &#8220;foo&#8221;<br />
when logging in<br />
then it should pass</p>
<p>So great, I can reuse my code to set up my parameters and call some methods. But uh oh, what happens when someone reads these? Why should the first fail? Is the password wrong? Does the username not exist? Should we rewrite it to setup the user? </p>
<p>Given user named &#8220;bob&#8221; with password &#8220;asdf&#8221;<br />
when logging in with username &#8220;bob&#8221; and password &#8220;foo&#8221;<br />
then it should fail</p>
<p>Sure, we could do that, but now we&#8217;re getting pretty verbose. </p>
<p>Compare that to the context specification alternative&#8230;</p>
<p>When logging in with a user that exists with an incorrect password, it should fail</p>
<p>or even</p>
<p>When logging in with an incorrect password, it should fail</p>
<p>I&#8217;ve done just a little bit more analysis and figured out what the scenario is actually trying to say. I&#8217;ve used English to describe it rather than allowing the reader to try and infer what I&#8217;m actually trying to test. I&#8217;ve potentially discovered terms in my ubiquitous language that I may not have had I stuck to plug and play scenario bits.</p>
<p>Cucumber and friends are quite popular at the moment though, so don&#8217;t necessarily take my word for it. Feel free to experiment and draw your own conclusions.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-177">
					<div id="dsq-comment-header-177" class="dsq-comment-header">
						<cite id="dsq-cite-177">
								<span id="dsq-author-user-177">Kevin</span>
							</cite>
					</div>
					<div id="dsq-comment-body-177" class="dsq-comment-body">
						<div id="dsq-comment-message-177" class="dsq-comment-message"><p>&#8220;Kevin, correct me if I&#8217;m wrong, but it doesn&#8217;t sound like you want to verify that *specs* are run in a certain order, but rather that your system under test does things in a certain order. Is that correct?&#8221;</p>
<p>Yes, that&#8217;s correct. I said it the wrong way. I want to make sure that methods of my underlying system are executed in a certain order, and not the specs themselves.<br />
The brief example I posted is just the first thing that came to my mind, so it may be misleading.</p>
<p>A simplistic but (hopefully) better example would be:</p>
<p>Say I am testing the OrderService.InsertOrder() method which in turn uses a mocked &#8220;OrderDAO&#8221;.  And I want to ensure that before calling the OrderDAO.InsertOrder(), the service invokes the OrderDAO.GetOrder() to verify that the order doesn&#8217;t exist in the DB already.<br />
So I want to set my expectations in a way that the OrderDAO.Get() is executed BEFORE the OrderDAO.Insert() and not the other way round.</p>
<p>Is it more clear now? Am I missing the point here?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-178">
					<div id="dsq-comment-header-178" class="dsq-comment-header">
						<cite id="dsq-cite-178">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-178">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-178" class="dsq-comment-body">
						<div id="dsq-comment-message-178" class="dsq-comment-message"><p>This doesn&#8217;t strike me as the best way to test this. Take a step back and look at it on a higher level. The *ordering* is irrelevant. The observable behavior is relevant.</p>
<p>In your example, I&#8217;m assuming you&#8217;re wanting to spec something like this: </p>
<p>When an order is placed, it should be recorded</p>
<p>Also</p>
<p>When an order is placed for a second time, it should not be recorded</p>
<p>The way to test this is to simple and does not require you to assert on code ordering. In the first spec, you would stub the GetOrder method to return null. You would then assert that the InsertOrder method was invoked with an order matching the order you care about.</p>
<p>In the second spec, you would stub the GetOrder method to return an order. You would then assert that the InsertOrder method was *not* called.</p>
<p>No mention of ordering here. The ordering is implicit. You define your ins and observe/assert on your outs. </p>
<p>It is rare that you actually need to assert on ordering, more often than not I&#8217;d say if you take a step back you can find an alternate solution that is more elegant.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-179">
					<div id="dsq-comment-header-179" class="dsq-comment-header">
						<cite id="dsq-cite-179">
								<span id="dsq-author-user-179">Luke</span>
							</cite>
					</div>
					<div id="dsq-comment-body-179" class="dsq-comment-body">
						<div id="dsq-comment-message-179" class="dsq-comment-message"><p>Why don&#8217;t you like the with_ pattern anymore? <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_sad.gif' alt=':(' class='wp-smiley' /><br />
Although it is something small, and it doesn&#8217;t make a big difference if we don&#8217;t use it, I think it looks nice to have the spec&#8217;s &#8220;header&#8221; (class name and parent class) in English form, and helps to understand what is it that you&#8217;re actually testing.</p>
<p>public class when_doing_something : with_some_context<br />
{<br />
&#8230;<br />
}</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-180">
					<div id="dsq-comment-header-180" class="dsq-comment-header">
						<cite id="dsq-cite-180">
	http://codebetter.com/members/aaronjensen/default.aspx							<span id="dsq-author-user-180">aaronjensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-180" class="dsq-comment-body">
						<div id="dsq-comment-message-180" class="dsq-comment-message"><p>Luke,</p>
<p>The original post is explicitly about why I don&#8217;t like the with_ pattern. Your context should convey what you are actually testing. The fact that you named your with class in the example &#8220;with_some_context&#8221; implies that the with_ pattern itself has prevented some from understanding that the context is actually the name of the class. Not its base class. The context is the &#8220;Given&#8221; and the &#8220;When&#8221; if you want to compare it to GWT.</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/aaronjensen/2009/10/05/a-recent-conversation-about-mspec-practices/ ';
	var disqus_identifier = '29 /blogs/aaron.jensen/archive/2009/10/05/a-recent-conversation-about-mspec-practices.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'aaronjensen';
	var disqus_title = "A recent conversation about MSpec practices";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=29');
		});
					};
	var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/aaronjensen\/2009\/10\/05\/a-recent-conversation-about-mspec-practices\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.678 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 13:29:31 -->
<!-- super cache -->