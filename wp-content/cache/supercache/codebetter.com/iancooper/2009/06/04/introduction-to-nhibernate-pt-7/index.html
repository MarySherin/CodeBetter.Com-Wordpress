<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Introduction to NHibernate, pt. 7 | Ian Cooper</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/iancooper/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/iancooper/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Ian Cooper' href='http://codebetter.com/iancooper/' />
<link rel='start' title='Hello World' href='http://codebetter.com/iancooper/2007/11/17/hello-world-2/' />
<link rel='prev' title='AltNetConf UK London August 2009' href='http://codebetter.com/iancooper/2009/05/15/altnetconf-uk-london-august-2009/' />
<link rel='next' title='Should you learn frameworks or principles' href='http://codebetter.com/iancooper/2009/06/11/should-you-learn-frameworks-or-principles/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/iancooper/2009/06/04/introduction-to-nhibernate-pt-7/' />
<link rel='shortlink' href='http://codebetter.com/iancooper/?p=64' />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/codebetteriancooper/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-64" class="post-64 post type-post status-publish format-standard hentry category-net category-castle category-ddd category-nhibernate">
					<h1 class="entry-title">Introduction to NHibernate, pt. 7</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">Ian Cooper</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/iancooper/2009/06/04/introduction-to-nhibernate-pt-7/" title="3:56 am" rel="bookmark"><span class="entry-date">June 4, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/iancooper/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/iancooper/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>In earlier parts of this series we looked at <a href="/blogs/ian_cooper/archive/2008/12/12/introduction-to-nhibernate-part-2.aspx">mapping via XML mapping files</a>. I wanted to look at some alternatives to the angle bracket tax. First up is the Castle project&#8217;s Active Record. Next time we will look at Fluent NHibernate.</p>
<h2>Active Record Support for Attribute Based Mapping</h2>
<p>While mapping via an xml file allows access to the full range of options that NHibernate gives us, it can be slow, because it forces us to context switch between C# and XML. Both NHibernate and Castle have attribute mapping options. NNHibernate.Mapping.Attributes is an add-in for NHibernate contributed by Pierre Henri Kuat&eacute;. Active Record is part of the Castle project, originally intended to support the Active Record pattern favored by Ruby On Rails.</p>
<p>We&#8217;ll just discuss how to use Active Record&#8217;s Attribute Support here. Essentially ActiveRecord contains attributes that are the equivalent of elements from the mapping file. For example to map the Customer class we mark it up as follows.</p>
<h3>Adding the required references<br /></h3>
<p>We need to reference a number of assemblies to get ActiveRecord support:<br />Castle.ActiveRecord.dll<br />Castle.Core.dll<br />Castle.Components.Validator.dll<br />Castle.DynamicProxy.dll<br />NHibernate.dll</p>
<p>We also need to change our configuration file to configure ActiveRecord instead of NHibernate (ActiveRecord configures NHibernate from this information). We an configure either by a stand-alone xml file or through the app.config. For simplicity we configure through the app.config file here. </p>
<p>We need to add a config section handler for the active record section of our configuration file:</p>
<p>&nbsp;&nbsp;&nbsp; &lt;configSections&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;section name=&#8221;activerecord&#8221; type=&#8221;Castle.ActiveRecord.Framework.Config.ActiveRecordSectionHandler, Castle.ActiveRecord&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/configSections&gt;</p>
<p>The configuration mainly tells NHibernate how to access the Db. There are two key attributes of the &lt;activerecord&gt; element. We need to set the IsWeb attribute to true if we are an asp.net web application. We need to set the IsDebug attribute to true, if we want to see the generated mapping files (see below).</p>
<p>Note that when working with NHibernate 2.0+ the sample code given on the Castle site for Active Record uses incorrect key values that are prefixed with NHibernate. You need to change these to omit the &#8220;hibernate.&#8221; from the name. If you forget to do this you will get messages about invalid key from log4net. This is because the hibernate.* keys are no longer in the schema.</p>
<p>&lt;?xml version=&#8221;1.0&#8243; encoding=&#8221;utf-8&#8243; ?&gt;<br />&lt;configuration&gt;<br />&nbsp; &lt;configSections&gt;<br />&nbsp;&nbsp;&nbsp; &lt;section name=&#8221;activerecord&#8221; type=&#8221;Castle.ActiveRecord.Framework.Config.ActiveRecordSectionHandler, Castle.ActiveRecord&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;section name=&#8221;log4net&#8221; type=&#8221;log4net.Config.Log4NetConfigurationSectionHandler, log4net&#8221; /&gt;<br />&nbsp; &lt;/configSections&gt;</p>
<p>&nbsp; &lt;activerecord isWeb=&#8221;false&#8221; isDebug=&#8221;true&#8221;&gt;<br />&nbsp;&nbsp;&nbsp; &lt;config&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key=&#8221;connection.driver_class&#8221;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value=&#8221;NHibernate.Driver.SqlClientDriver&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key=&#8221;dialect&#8221;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value=&#8221;NHibernate.Dialect.MsSql2000Dialect&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key=&#8221;connection.provider&#8221;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value=&#8221;NHibernate.Connection.DriverConnectionProvider&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;add<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; key=&#8221;connection.connection_string&#8221;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value=&#8221;Data Source=.;Initial Catalog=nhibernate;Integrated Security=SSPI&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/config&gt;<br />&nbsp; &lt;/activerecord&gt;<br />&nbsp; <br />&nbsp; &lt;log4net&gt;<br />&nbsp;&nbsp;&nbsp; &lt;appender name=&#8221;ConsoleAppender&#8221; type=&#8221;log4net.Appender.ConsoleAppender, log4net&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;layout type=&#8221;log4net.Layout.PatternLayout, log4net&#8221;&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;param name=&#8221;ConversionPattern&#8221; value=&#8221;%m&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/layout&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/appender&gt;<br />&nbsp;&nbsp;&nbsp; &lt;root&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;priority value=&#8221;DEBUG&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;appender-ref ref=&#8221;ConsoleAppender&#8221; /&gt;<br />&nbsp;&nbsp;&nbsp; &lt;/root&gt;<br />&nbsp; &lt;/log4net&gt;<br />&nbsp; <br />&lt;/configuration&gt;</p>
<h3>Using attributes to peform our mapping</h3>
<p>We mark the entity with an [ActiveRecord] attribute to indicate that we want NHibernate to persist it. We can add the table name if it does not match the entity name [ActiveRecord("MyTableName")]. We can indicate that we want the entity to be loaded, by adding the Lazy attribute as in [ActiveRecord(Lazy=true)].</p>
<p>We can declare that our class inherits from ActiveRecordBase if we want Active Record pattern semantics, i.e. the entity knows how to retrieve and persist itself. We want true seperation of concerns, so we do not intend to mix CRUD mechanics with our entity. For this reason we do not derive our class from ActiveRecordBase.</p>
<p>We mark up the identity of our entity using the [PrimaryKey] attribute. The default primary key type is native, so we do not need to mark this up, but if we have a different strategy then we have to explicitly indicate that. For example to use a GUID we would use: PrimaryKey(PrimaryKeyType.UuidHex, Params=&#8221;format=D,seperator=-&#8221;)]</p>
<p>We can mark up a property using the [Property] attribute. In addition, we can use [Field] if we want to map a private member of the class. If we need to map to a column with a different name to the property then we can pass it as a parameter to the attribute [Property("MyColumnName")]. If we have a large object then we can set the column type &#8211; see the the Active Record documentation.</p>
<p>We use a [HasMany] attribute to represent a one-to-many relationship, attributing the collection on the parent class i.e. [HasMany(typeof(Post), Table="Posts", ColumnKey="blogid")]. We use the RelationType enumerated value to specify the type of the relationship i.e. RelationshipType.Set. We also set the Inverse parameter as part of the HasMany attribute if this is a bi-directional relationship to avoid generating the insert and update statement, and creating an insert only. We can indicate if this relationship should be lazy-loaded using the Lazy parameter on the HasMany attribute. As with XML mapping we can also set the action NHibernate should take when we update or delete the parent using the Cascade option. In addition, we can set the index if we use one of the ordered types for our relationship or the sort order.<br />We use a [BelongsTo] attribute on the reverse side of the relationship to indicate a Many-To-One relationship. We need to pass the name of the foreign key column as a parameter to the attribute. Again there are options that reflect those available from the xml mapping file.</p>
<p>ActiveRecord also provides support for more advanced scenarios that are outside the scope of this article (it is meant to be an introduction and most of this is documented elsewhere):</p>
<p>HasAndBelongsToMany<br />OneToOne<br />Any and HasManyToAny</p>
<p>ActiveRecord also supports inheritance, supporting both the table Table-per-class hierarchy and Table-per-subclass strategies. </p>
<p>Mapping the Table-per-class hierachy strategy is straightforward, just set the parameters on the superclass ActiveRecord attribute to indicate the discriminator column to use i.e. [ActiveRecord("companies", DiscriminatorColumn="type", DiscriminatorType="String", DiscriminatorValue="company")] and then indicate the value for each of the sub-classes i.e. [ActiveRecord(DiscriminatorValue="firm")].<br />Mapping the Table-per-subclass strategy requires us to use the JoinedBase attribute on the superclass ActiveRecord attribute i.e. [ActiveRecord("entity"), JoinedBase] and then use the [JoinedKey] attribute on the shared key value of the sub-classes.</p>
<p>ActiveRecord also provides support for fine grained object models. We declare the [Nested] attribute on the property declaration in the containing entity, and then only mark up the component class with [Property] attributes i.e. not with [ActiveRecord] or [PrimaryKey] attributes.</p>
<h3>Configuring Active Record</h3>
<p>Before using ActiveRecord we must invoke the method Initialize on ActiveRecordStarter to configure NHibernate for us.There are a range of options to use when configuring, depending on where your configuration information is found. Because we added our configuration to the app.config file we can use the ActiveRecordSectionHandler to retrieve our configuration information.<br />ActiveRecordStarter also provides the functionality to generate our schema from our code.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log4net.Config.XmlConfigurator.Configure();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IConfigurationSource config = ActiveRecordSectionHandler.Instance;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveRecordStarter.Initialize(typeof(Company).Assembly, config);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveRecordStarter.CreateSchema();</p>
<h2>Switching from attributes to mapping files</h2>
<p>Active Record generates XML mapping files at run-time from your attributes, so this is using the same mechanism as the XML configuration, the complexity is just hidden from you. If you want to see the mapping then you can set the Debug value to true on the active record configuration (see above). This will tell NHibernate to keep the files around when your application ends, instead of deleting them. <br />This allows you to pursue a strategy of beginning development by using attributes, and then switching to .hbm.xml files later to fully utilize all options and keep your domain model clean of mapping information.</p>
<h2>Active Record support for Session Management</h2>
<p>Active Record removes the need to initialize a session factory explicitly, instead we use the ActiveRecordStarter.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IConfigurationSource config = ActiveRecordSectionHandler.Instance;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveRecordStarter.Initialize(typeof(Company).Assembly, config);</p>
<p>For a web based application best practice is that we initialize within the Application_Start method of the global HttpApplication object.</p>
<p>Active Record operations try to get a session from the current thread, but create one if it is not extant, perform the operation and then release the session. So by default Active Record is session per operation. Active Record also gives us the ability to use a SessionScope to keep the session alive for the scope of our business transaction. Best practice is always to use a SessionScope.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (new SessionScope())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const string COMPANY_NAME = &#8220;CompanyOfWolves&#8221;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InsertNewCompany(COMPANY_NAME);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int companyId = FindInsertedCompany(COMPANY_NAME);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>For a web application the usual pattern is to create a <a href="http://www.castleproject.org/activerecord/documentation/trunk/usersguide/web.html.">SessionScope with request affinity</a></p>
<p>&nbsp;</p>
<h2>Active Record and Repositories</h2>
<p>The problem with the Active Record pattern, where the entity exposes CRUD methods is that it does not enforce a clean separation of concerns. (We have not shown this but to get Active Record working this way we need our entities to derive from ActiveRecordBase). Knowledge about persistence is coupled with knowledge about domain responsibilities. This increases complexity and thus makes maintenance harder. So good design strives for persistence ignorance within its domain model. The repository lives within the domain model and represents a collection of entities from an aggregate root.</p>
<p>We call the repository from our domain level service to persist the object graph.</p>
<p>&nbsp;</p>
<h3>Support for Repository within Active Record</h3>
<p>Active Record provides ActiveRecordMediator to allow you to use ActiveRecord to implement a repository.</p>
<p>&nbsp;&nbsp; public class CompanyRepository<br />&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; protected ActiveRecordMediator&lt;Company&gt; mediator;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public void Add(Company item)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveRecordMediator&lt;Company&gt;.Save(item);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public virtual this[ int id]<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; get { return ActiveRecordMediator&lt;Company&gt;.FindByPrimaryKey(id); }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Company[] Find(IActiveRecordQuery query)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return (Company[])ActiveRecordMediator&lt;Company&gt;.ExecuteQuery(query);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public Company[] Items()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ActiveRecordMediator&lt;Company&gt;.FindAll();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public virtual int Count()<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return ActiveRecordMediator&lt;Company&gt;.Count();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp; }</p>
<p>A quick example of using this repository (domain services etc. elided to remove complexity) would be:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp; public static void Main(string[] args)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; log4net.Config.XmlConfigurator.Configure();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IConfigurationSource config = ActiveRecordSectionHandler.Instance;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveRecordStarter.Initialize(typeof(Company).Assembly, config);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ActiveRecordStarter.CreateSchema();</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //Comment out the session scope to see lazy load lack of scope issues<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; using (new SessionScope())<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; const string COMPANY_NAME = &#8220;CompanyOfWolves&#8221;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; InsertNewCompany(COMPANY_NAME);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; int companyId = FindInsertedCompany(COMPANY_NAME);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static int FindInsertedCompany(string companyName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IActiveRecordQuery query = new SimpleQuery&lt;Company&gt;(&#8220;from Company org where Name = ?&#8221;, companyName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CompanyRepository companyRepository = new CompanyRepository();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Company[] companies = companyRepository.Find(query);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Company company = companies[0];<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.Out.WriteLine(company.Name);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (Customer customer in company.Customers)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.Out.WriteLine();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.Out.Write(&#8220;First Name: &#8220;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.Out.WriteLine(customer.Name.FirstName);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.Out.Write(&#8220;Surname: &#8220;);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Console.Out.WriteLine(customer.Name.Surname);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return company.Id;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private static void InsertNewCompany(string companyName)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Company company = new Company();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; company.Name = companyName;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Customer customer = new Customer();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.Name.FirstName = &#8220;Neil&#8221;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.Name.Surname = &#8220;Jordan&#8221;;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.DateOfBirth = new DateTime(1950, 2, 25);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; customer.Company = company;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; company.Customers.Add(customer);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CompanyRepository companyRepository = new CompanyRepository();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; companyRepository.Add(company); </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</p>
											</div><!-- .entry-content -->

					<div id="entry-author-info">
						<div id="author-avatar">
							<img alt='' src='http://1.gravatar.com/avatar/b033a6c1af4ee8d7a734f3684225ea8a?s=60&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D60&amp;r=R' class='avatar avatar-60 photo' height='60' width='60' />						</div><!-- #author-avatar 	-->
						<div id="author-description">
							<h2>About Ian Cooper</h2>
							Ian Cooper has over 18 years of experience delivering Microsoft platform solutions in government, healthcare, and finance. During that time he has worked for the DTi, Reuters, Sungard, Misys and Beazley delivering everything from bespoke enterpise solutions to 'shrink-wrapped' products to thousands of customers. Ian is a passionate exponent of the benefits of OO and Agile. He is test-infected and contagious. When he is not writing C# code he is also the and founder of the London .NET user group. http://www.dnug.org.uk							<div id="author-link">
								<a href="http://codebetter.com/iancooper/author/iancooper/" title="View all posts by Ian Cooper">View all posts by Ian Cooper &rarr;</a>
							</div><!-- #author-link	-->
						</div><!-- #author-description	-->
					</div><!-- .entry-author-info -->

					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/iancooper/category/net/" title="View all posts in .Net" rel="category tag">.Net</a>, <a href="http://codebetter.com/iancooper/category/castle/" title="View all posts in Castle" rel="category tag">Castle</a>, <a href="http://codebetter.com/iancooper/category/ddd/" title="View all posts in DDD" rel="category tag">DDD</a>, <a href="http://codebetter.com/iancooper/category/nhibernate/" title="View all posts in NHibernate" rel="category tag">NHibernate</a>. Bookmark the <a href="http://codebetter.com/iancooper/2009/06/04/introduction-to-nhibernate-pt-7/" title="Permalink to Introduction to NHibernate, pt. 7" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/iancooper/2009/06/04/introduction-to-nhibernate-pt-7/feed/" title="Comments RSS to Introduction to NHibernate, pt. 7" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-64 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/iancooper/2009/05/15/altnetconf-uk-london-august-2009/" rel="prev"><span class="meta-nav">&larr;</span> AltNetConf UK London August 2009</a></div>
					<div class="nav-next"><a href="http://codebetter.com/iancooper/2009/06/11/should-you-learn-frameworks-or-principles/" rel="next">Should you learn frameworks or principles <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-623">
					<div id="dsq-comment-header-623" class="dsq-comment-header">
						<cite id="dsq-cite-623">
								<span id="dsq-author-user-623">Charl</span>
							</cite>
					</div>
					<div id="dsq-comment-body-623" class="dsq-comment-body">
						<div id="dsq-comment-message-623" class="dsq-comment-message"><p>Very nice post. Thanks very much.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-624">
					<div id="dsq-comment-header-624" class="dsq-comment-header">
						<cite id="dsq-cite-624">
	http://geekswithblogs.net/chrisfalter							<span id="dsq-author-user-624">Chris Falter</span>
							</cite>
					</div>
					<div id="dsq-comment-body-624" class="dsq-comment-body">
						<div id="dsq-comment-message-624" class="dsq-comment-message"><p>Nice post, Ian!  Some questions:</p>
<p>1. Where does one get the Castle ActiveRecord stuff?  I&#8217;d like to look at (and possibly use) it.</p>
<p>2.  Why does the CompanyRepository class have a protected member ActiveRecordMediator<company> mediator that it does not use? </p>
<p>3.  For that matter, why couldn&#8217;t you create a generic repository class that facilitates the creation of repositories with a single line of code?</p>
<p>public abstract class Repository<t>: ActiveRecordMediator</t><t><br />
{<br />
public void Add(T item)<br />
        {<br />
            ActiveRecordMediator</t><t>.Save(item);<br />
        }<br />
public T[] Find(IActiveRecordQuery query)<br />
        {<br />
            return (T[])ActiveRecordMediator</t><t>.ExecuteQuery(query);<br />
        }<br />
// etc.<br />
}</p>
<p>Since I don&#8217;t have the source code in front of me (see question #1), I&#8217;m not sure it this would work.  And we&#8217;d probably have to clarify the semantics of instantiation (see question #2).  But if this is possible, then creating a repository would take a single line of code:</p>
<p>public class CompanyRepository: Repository<company> {}</p>
<p>Although maybe it would need to override a constructor&#8230;  What do you think?</company></t></company></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-625">
					<div id="dsq-comment-header-625" class="dsq-comment-header">
						<cite id="dsq-cite-625">
	http://jack-fx.com							<span id="dsq-author-user-625">jack</span>
							</cite>
					</div>
					<div id="dsq-comment-body-625" class="dsq-comment-body">
						<div id="dsq-comment-message-625" class="dsq-comment-message"><p>NHibernate, very powerful. but i prefer subsonic, a light weight O/R Mapping</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-626">
					<div id="dsq-comment-header-626" class="dsq-comment-header">
						<cite id="dsq-cite-626">
	http://www.californiasanjose.info							<span id="dsq-author-user-626">San Jose Business Directory</span>
							</cite>
					</div>
					<div id="dsq-comment-body-626" class="dsq-comment-body">
						<div id="dsq-comment-message-626" class="dsq-comment-message"><p>I can see that you are an expert at your field! I am launching a website soon, and your information will be very useful for me. Thanks for all your help and wishing you all the success in your business.  Please come visit my site  <a href="http://www.californiasanjose.info">Local Business Directory Of San Jose U.S.A.</a> when you got time.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-627">
					<div id="dsq-comment-header-627" class="dsq-comment-header">
						<cite id="dsq-cite-627">
	http://www.michigandetroit.net							<span id="dsq-author-user-627">Detroit Business Directory</span>
							</cite>
					</div>
					<div id="dsq-comment-body-627" class="dsq-comment-body">
						<div id="dsq-comment-message-627" class="dsq-comment-message"><p>You got a really useful blog I have been here reading for about an hour. I am a newbee and your success is very much an inspiration for me. Please come visit my site  <a href=“http://www.businesseschicago.com”>Local Business Directory Of Detroit U.S.A.</a> when you got time.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-628">
					<div id="dsq-comment-header-628" class="dsq-comment-header">
						<cite id="dsq-cite-628">
	http://www.Businesssantaana.com							<span id="dsq-author-user-628">Santa Ana Business Directory</span>
							</cite>
					</div>
					<div id="dsq-comment-body-628" class="dsq-comment-body">
						<div id="dsq-comment-message-628" class="dsq-comment-message"><p>You may have not intended to do so, but I think you have managed to express the state of mind that a lot of people are in. The sense of wanting to help, but not knowing how or where, is something a lot of us are going through. Please come visit my site  <a href="http://www.Businesssantaana.com">Santa Ana Yellow Page Business Directory  when you got time.</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-629">
					<div id="dsq-comment-header-629" class="dsq-comment-header">
						<cite id="dsq-cite-629">
	http://www.anaheimcaguide.com							<span id="dsq-author-user-629">Anaheim Business Directory</span>
							</cite>
					</div>
					<div id="dsq-comment-body-629" class="dsq-comment-body">
						<div id="dsq-comment-message-629" class="dsq-comment-message"><p>I am not really sure if best practices have emerged around things like that, but I am sure that your great job is clearly identifed. I was wondering if you offer any subscription to your RSS feeds as I would be very interested and can’t find any link to subscribe here. Please come visit my site  <a href="http://www.anaheimcaguide.com">Anaheim Yellow Page Business Directory  when you got time.</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-630">
					<div id="dsq-comment-header-630" class="dsq-comment-header">
						<cite id="dsq-cite-630">
	http://www.resalestorelist.com							<span id="dsq-author-user-630">discount stores</span>
							</cite>
					</div>
					<div id="dsq-comment-body-630" class="dsq-comment-body">
						<div id="dsq-comment-message-630" class="dsq-comment-message"><p>I usually don’t leave comments!!! Trust me! But I liked your blog…especially this post! Would you mind terribly if I put up a backlink from my site to your site? Please come visit my site  <a href="http://www.resalestorelist.com">discount store</a> when you got time</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-631">
					<div id="dsq-comment-header-631" class="dsq-comment-header">
						<cite id="dsq-cite-631">
	http://www.resalestorelist.com							<span id="dsq-author-user-631">discount stores</span>
							</cite>
					</div>
					<div id="dsq-comment-body-631" class="dsq-comment-body">
						<div id="dsq-comment-message-631" class="dsq-comment-message"><p>I usually don’t leave comments!!! Trust me! But I liked your blog…especially this post! Would you mind terribly if I put up a backlink from my site to your site? Please come visit my site  <a href="http://www.resalestorelist.com">discount store</a> when you got time</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-632">
					<div id="dsq-comment-header-632" class="dsq-comment-header">
						<cite id="dsq-cite-632">
	http://www.resalestorelist.com							<span id="dsq-author-user-632">discount stores</span>
							</cite>
					</div>
					<div id="dsq-comment-body-632" class="dsq-comment-body">
						<div id="dsq-comment-message-632" class="dsq-comment-message"><p>I usually don’t leave comments!!! Trust me! But I liked your blog…especially this post! Would you mind terribly if I put up a backlink from my site to your site? Please come visit my site  <a href="http://www.resalestorelist.com">discount store</a>discount store</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-633">
					<div id="dsq-comment-header-633" class="dsq-comment-header">
						<cite id="dsq-cite-633">
	http://www.serviceroadside.com							<span id="dsq-author-user-633">towing</span>
							</cite>
					</div>
					<div id="dsq-comment-body-633" class="dsq-comment-body">
						<div id="dsq-comment-message-633" class="dsq-comment-message"><p>I enjoyed reading your work! GREAT post! I looked around for this… but I found you!  Anyway, would you mind if I threw up a backlink from my site? Please come visit my site  <a href="http://www.serviceroadside.com">paving</a> and give me any valuable feedbacks.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-634">
					<div id="dsq-comment-header-634" class="dsq-comment-header">
						<cite id="dsq-cite-634">
	http://www.roofingcontractorbuilder.com							<span id="dsq-author-user-634">roofing contractors</span>
							</cite>
					</div>
					<div id="dsq-comment-body-634" class="dsq-comment-body">
						<div id="dsq-comment-message-634" class="dsq-comment-message"><p>I enjoyed reading your work! GREAT post! I looked around for this… but I found you!  Anyway, would you mind if I threw up a backlink from my site? Please come visit my site  <a href="http://www.roofingcontractorbuilder.com">roofing supply</a> and give me any valuable feedbacks.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-635">
					<div id="dsq-comment-header-635" class="dsq-comment-header">
						<cite id="dsq-cite-635">
								<span id="dsq-author-user-635">recycling containers</span>
							</cite>
					</div>
					<div id="dsq-comment-body-635" class="dsq-comment-body">
						<div id="dsq-comment-message-635" class="dsq-comment-message"><p>You share valuable information and excellent design you got here! I would like to thank you for sharing your thoughts and time into the stuff you post!! Thumbs up.  Feel free to check out my site  <a href="http://www.recyclingproduct.com">glass recycling</a> when you got time.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-636">
					<div id="dsq-comment-header-636" class="dsq-comment-header">
						<cite id="dsq-cite-636">
								<span id="dsq-author-user-636">civil engineers</span>
							</cite>
					</div>
					<div id="dsq-comment-body-636" class="dsq-comment-body">
						<div id="dsq-comment-message-636" class="dsq-comment-message"><p>I was thinking of looking up some of them newspaper websites, but am glad I came here instead. Although glad is not quite the right word… let me just say I needed this after the incessant chatter in the media, and am grateful to you for articulating something many of us are feeling &#8211; even from distant shores.  Feel free to check out my site <a href="http://www.engineeringstructural.com">structural engineers</a> when you got time.</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/iancooper/2009/06/04/introduction-to-nhibernate-pt-7/ ';
	var disqus_identifier = '64 /blogs/ian_cooper/archive/2009/06/04/introduction-to-nhibernate-pt-7.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'codebetteriancooper';
	var disqus_title = "Introduction to NHibernate, pt. 7";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=64');
		});
					};
	var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/iancooper\/2009\/06\/04\/introduction-to-nhibernate-pt-7\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.298 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 13:04:21 -->
<!-- super cache -->