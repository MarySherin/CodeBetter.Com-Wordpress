<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Command pattern architecture, or “How to do it a little at a time” | Kyle Baley</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/kylebaley/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/kylebaley/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Kyle Baley' href='http://codebetter.com/kylebaley/' />
<link rel='start' title='The CodeBetter Hillbilly, or &quot;How to build a better banjo&quot;' href='http://codebetter.com/kylebaley/2007/12/13/the-codebetter-hillbilly-or-quot-how-to-build-a-better-banjo-quot/' />
<link rel='prev' title='Release management, or “How to de-version your app”' href='http://codebetter.com/kylebaley/2010/10/04/release-management-or-how-to-de-version-your-app/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/kylebaley/2010/10/21/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time/' />
<link rel='shortlink' href='http://codebetter.com/kylebaley/?p=190' />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/kylebaleycb/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-190" class="post-190 post type-post status-publish format-standard hentry category-asp-net-mvc category-gwt">
					<h1 class="entry-title">Command pattern architecture, or “How to do it a little at a time”</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/kylebaley/author/kylebaley/" title="View all posts by Kyle Baley">Kyle Baley</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/kylebaley/2010/10/21/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time/" title="3:14 am" rel="bookmark"><span class="entry-date">October 21, 2010</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/kylebaley/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/kylebaley/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>In the comments of <a href="http://codebetter.com/blogs/kyle.baley/archive/2010/09/06/relationships-in-bigtable-or-how-to-put-extra-effort-into-being-lazy.aspx">a recent post</a>, some people pointed out some questionable practices:</p>
<ul>
<li>Modifying the data access when I should be modifying the business model </li>
<li>Using a NoSQL data store when a relational one would be more appropriate for slicing and dicing data </li>
<li>Changing the business model to accommodate the UI </li>
</ul>
<p>Will ignore the second point for now. I’ve <a href="http://codebetter.com/blogs/kyle.baley/archive/2010/02/19/bigtable-concerns-or-how-to-put-your-trust-in-the-cloud.aspx">covered part of the concern</a> already anyway.</p>
<p>For the other two, it’s worth explaining the architecture that I think Google Web Toolkit encourages.</p>
<p>Both points mention “business model” and I’ve probably called it that on occasion as well. I’ve never liked using the term because I don’t think I’ve worked on a project that’s done any form of DDD except use repositories. My domain is usually anemic because there isn’t a lot of business logic in a CRUD app. Unless you count the many forms of GetFullName I’ve written on a customer object.</p>
<p>But now I’m in an app that has real business logic. “Find next available appointment”, for example. Or better yet, “find optimal appointment time” for the ominous “smart scheduling” feature. Seems like a good candidate for a rich domain model. Except that our “domain” is still all DTOs. </p>
<p>I’m fine with this because it works for our architecture. In a more traditional .NET web app, I would probably define a proper domain model with behaviours and such. On the front end, I’d diligently translate between it and screen-specific DTOs or JSON objects or what-have-you.</p>
<p>We’re using GWT. It’s *all* JSON. And it’s not even JSON we control. (We could control it but we choose not to and use the built-in GWT RPC translation.) Every single action is an AJAX call launched from a button, or a link, or a drag and drop. Nothing is screen-specific because presenting a single screen is too big a concept. Instead, we replace individual pieces of it as necessary and make individual requests for the corresponding data for those pieces.</p>
<p>So we’ve adopted an architecture based around what I have been calling (possibly erroneously, so you may want to look it up) the command pattern. This sounds like a grand architectural decision from a big software mucky-much but really, this architecture is nigh impossible to avoid with GWT applications. The implementation is courtesy of <a href="http://code.google.com/p/gwt-platform/">gwt-platform</a>, which also handles our MVP structure as well. </p>
<p>Here is a 998-word picture of the process:</p>
<p>&#160;</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/kyle.baley/image_5F00_506C8EE9.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/kyle/baley/image_thumb_16111908.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787601&amp;Signature=EPrjH3dMtq77L56mcKWIsFebqFw%3d" width="690" height="242" /></a> </p>
<p>&#160;</p>
<p>Notice there are no domain objects anywhere. That’s because it’s my diagram and I’ve specifically doctored it so that there are no domain objects.</p>
<p>I jest, slightly. There are no domain objects because they aren’t interesting. All the real magic happens in the “Process command” step. This is where we examine the data we’ve been given, do some stuff like save to a data store or calculate a person’s likelihood of arrest before the age of 18 or some other piece of logic befitting our “domain”.</p>
<p>The “data we’ve been given” is the command, which is a fancy word for a specialized DTO. For example, if we want to search for a suitable liquor store, we create a FindClient command and populate the SearchText proper—…whoops, this is Java. I mean we call the setSearchText method. The server matches, through dependency injection, the FindLiquorStore command with the FindLiquorStoreHandler and executes it.</p>
<p>After doing whatever magic needs to be done, we create a result, which is another specialized DTO. It has a getResults method which returns a list of LiquorStore “domain” objects.</p>
<p>With this architecture, the domain objects are little more than property bags. All the real work is done in handlers. To summarize the objects used in our “find liquor store” example:</p>
<table border="0" cellspacing="0" cellpadding="2" width="774">
<tbody>
<tr>
<td valign="top" width="200">FindLiquorStore</td>
<td valign="top" width="572">Command object. Class name helps determine which handler to run. Property accessors store relevant data needed to execute the command</td>
</tr>
<tr>
<td valign="top" width="200">FindLiquorStoreHandler</td>
<td valign="top" width="572">Handler that examines the data within the command and does whatever needs to be done with it. Also creates a result object and returns it.</td>
</tr>
<tr>
<td valign="top" width="200">FindLiquorStoreResult</td>
<td valign="top" width="572">Contains any data that the caller might be interested in after processing the command; in this case, a list of LiquorStore objects</td>
</tr>
<tr>
<td valign="top" width="200">LiquorStore</td>
<td valign="top" width="572">An “domain” object in the sense that it is called something that a business person might recognize</td>
</tr>
</tbody>
</table>
<p>Seems a lot of infrastructure but it’s not so far removed from MVC applications where a controller action takes parameters from a query string (or form), process it, then sends a model back to the view. The difference is we don’t do it at the page level with a model that contains a bunch of lookup data as well as the one piece of info we care about (notwithstanding <a href="http://mikehadlow.blogspot.com/2010/10/populating-drop-down-lists-in-aspnet.html">some interesting work in this area</a>).</p>
<p>This is more in line with the types of apps I’m building more often even using MVC. That is, the page loads with very little actual information on it and each section takes care of its own data. One section might load the client data, another the alcohol consumption stats for the staff, and another the customer satisfaction charts. Each of these would entail a separate AJAX call to a controller action that would likely return a JsonResult (or even more likely, a custom Json result so that I can avoid the serialization issues inherent with the native MVC JsonResult object).</p>
<p>This probably doesn’t necessarily obviate the need for a full-fledged domain model complete with all the behaviours and other keywords that I have no business pretending I know anything about. You can translate between DTOs and domain objects very easily these days. But given that the sole access to the application is through commands, I’m more inclined to leave everything as DTOs and have the handlers contain all our business logic.</p>
<p>Kyle the Commandeered</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/kylebaley/category/asp-net-mvc/" title="View all posts in ASP.NET MVC" rel="category tag">ASP.NET MVC</a>, <a href="http://codebetter.com/kylebaley/category/gwt/" title="View all posts in GWT" rel="category tag">GWT</a>. Bookmark the <a href="http://codebetter.com/kylebaley/2010/10/21/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time/" title="Permalink to Command pattern architecture, or “How to do it a little at a time”" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/kylebaley/2010/10/21/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time/feed/" title="Comments RSS to Command pattern architecture, or “How to do it a little at a time”" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-190 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/kylebaley/2010/10/04/release-management-or-how-to-de-version-your-app/" rel="prev"><span class="meta-nav">&larr;</span> Release management, or “How to de-version your app”</a></div>
					<div class="nav-next"></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-1070">
					<div id="dsq-comment-header-1070" class="dsq-comment-header">
						<cite id="dsq-cite-1070">
	http://www.geekswithblogs.net/optikal							<span id="dsq-author-user-1070">Dylan Smith</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1070" class="dsq-comment-body">
						<div id="dsq-comment-message-1070" class="dsq-comment-message"><p>Sounds like the Transaction Script pattern to me: <a href="http://takacsot.freeblog.hu/Files/martinfowler/transactionScript.html" rel="nofollow">http://takacsot.freeblog.hu/Files/martinfowler/transactionScript.html</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1071">
					<div id="dsq-comment-header-1071" class="dsq-comment-header">
						<cite id="dsq-cite-1071">
								<span id="dsq-author-user-1071">Dan Jensen</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1071" class="dsq-comment-body">
						<div id="dsq-comment-message-1071" class="dsq-comment-message"><p>My company has recently come to an architecture very similar to this for commands, but we couldn&#8217;t see how to use it for queries because the return types are always different.  How do you handle this?  We&#8217;re using c#, so maybe this is a difference that the GWT allows you?  I&#8217;m not familiar with it.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1072">
					<div id="dsq-comment-header-1072" class="dsq-comment-header">
						<cite id="dsq-cite-1072">
	http://codebetter.com/members/kylebaley/default.aspx							<span id="dsq-author-user-1072">Kyle Baley</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1072" class="dsq-comment-body">
						<div id="dsq-comment-message-1072" class="dsq-comment-message"><p>@Dan</p>
<p>This is handled by gwt and gwt-platform. When we launch the command, we indicate what type of Result we are expecting back. For example:</p>
<p>dispatcher.execute( new GetWineList( ), new ActionCallback<getwinelistresult>( ) {<br />
   @Override public void onSuccess( GetWineListResult ) { &#8230; }<br />
   @Override public void onFailure( Throwable cause ) { &#8230; }<br />
} );</getwinelistresult></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1073">
					<div id="dsq-comment-header-1073" class="dsq-comment-header">
						<cite id="dsq-cite-1073">
								<span id="dsq-author-user-1073">hassan rogers</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1073" class="dsq-comment-body">
						<div id="dsq-comment-message-1073" class="dsq-comment-message"><p>I have a large cluster of computers that were given to me by my last employer, I&#8217;m a software engineer that loves new projects, I have a total of 25 servers that are about 2 years old, i would love to start a non-profit, or link the servers up for some type of project, also im running ubuntu, im tired of windows,,,,looking for any help or new ideas,,,</p>
<p><a href="mailto:hassanrogers@tmo.blackberry.net">hassanrogers@tmo.blackberry.net</a></p>
<p><a href="mailto:alimsabree@gmail.com">alimsabree@gmail.com</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1078">
					<div id="dsq-comment-header-1078" class="dsq-comment-header">
						<cite id="dsq-cite-1078">
								<span id="dsq-author-user-1078">Demetrius Middleton</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1078" class="dsq-comment-body">
						<div id="dsq-comment-message-1078" class="dsq-comment-message"><p>The thing is, while commands as you describe are &#8220;close&#8221; to how we think about things I think the community / you / I / and others that are trying to find a better way are still missing something when we create solutions as you describe.  When we do something in the real world we do perform a command, and something (a handler) compares what we want to do to our environment and the laws of that environment and either we are able to actually perform what we want to do or we get an error or are prevented because something else in this context does not allow the operation we intend to perform.  So, our command object is now the context.  Good!  Then if the operation is allowed, the business logic in the operation is executed (ie. Person.BrushTeeth or do something else).  Now this is where I think thing I am starting to disagree with the community.  Not only do we Person.BrushTeeth, we try to lump all of the other things that *should* occur if we Person.BrushTeeth in either the Service.BrushTeeth(Person) method or the Person.BrushTeeth method or we issue a Context.PersonBrushedTeeth command that is then handled by the handler for Person.BrushTeeth and stuff all of the logic surround what should happen to other objects in that same operation.  The problem is, we are directly determining what else should happen to other objects  and our context within that handler or service method.  This is not the real world!  </p>
<p>This ties all the other things that should happen and pre-determines what should happen.  But, if we have a rich domain model or an anemic one with the ability to do many different things depending on whether something else occured, then if Person.BrushedTeeth Event and if AnotherPerson.IsWaitingForPersonOneToBrushTeethSoTheyCanLeaveTogether and if AnotherPerson.IsWaitingToUseTheBathroom then we then go and create one gigantic method that executes that logic.  I am starting to feel that this is wrong. </p>
<p>What I feel we need to start doing, is have Person.BrushTeeth or Context.HandleCommand(PersonBrushTeeth) fire an Event when Person.GoesToBrushesTeeth and Person.FinishesBrushingTeeth and all other objects and our contest that are listening for that event then go and have the handlers that respond to those events go and do something.  So now, Instead of:<br />
LiquorStore:  FindLiquorStore -&gt; FindLiquorStoreHandler -&gt; FindLiquorStoreResult</p>
<p>I think we should have:</p>
<p>Person, LiquorStore, Context:<br />
Person.FindLiquorStoreCommand -&gt; Person.FindLiquorStoreHandler.FireLiquorStoreFoundEvent -&gt; Person.LiquorStoreFoundHandler.DecideToEnterLiquorStore -&gt; Person.RaiseEnterdLiquorStoreEvent AND Context.AlertOtherListenersThatPersonFoundLiquorStoreEvent and Context.AlertOtherListenersThatPersonEnteredLiquorStoreEvent</p>
<p>Then all other entities within that context (where context could be the entity framework&#8217;s dbcontext, or a session in HHib, or the service layer which is basically a context); all other enties listening for any events that they care about handle those events and do what they do and / or fire other events &#8230; and the cycle continues.  </p>
<p>This allows REAL Behavior.  The problem is, it is a divergence from the normal way of thinking where we think in sequences but the sequence we think of is not always what should or actually will happen.  Things don&#8217;t happen in sequence in the real world.  The things that we think should happen or that we observe happening do indeed, generally, happen in a sequence.  But in the real world were entities really do have rich behavior in each context, other things happen that we do not observe, can&#8217;t plan, and we can&#8217;t evaluate within our context.  They happen within a different context, or commandhandler, on there own.  </p>
<p>When we go to the bathroom, and if another person is waiting for me to finish so I can give him a ride, in our context (commandhandler for finishing using the bathroom) in the real world we dont call OtherPerson.TellThatI&#8217;mReadyToLeave, we might let them know we are finished then say lets leave.  Instead, we do something like Me.Context.RaiseIFinishedUsingBathroomEvent and Me.Context.RaiseImReadyToLeave(WithPerson2) Event.  And then:<br />
Person2.HandlePerson1ReadyToLeaveEvent<br />
Person2.RaisePerson1LetsGoEvent<br />
Person1.HandleLetsGo(Person1)<br />
&#8230;<br />
&#8230;<br />
Person1.StartLeavingCommand and Person2.StartLeavingCommand<br />
&#8230;<br />
and so on and so forth.  </p>
<p>Your &#8220;FindLiquorStoreResult&#8221;, IMHO, should not be an actual result.  As a result of &#8220;FindLiquorStoreHandler&#8221;, a result is not directly determined.  What should happen is other events happen or are raised from that handler and responded to by the person and anything else that is listening in our context.  That way, we dont directly determine what the responses / actions of the other entities are, we do what we really do and raise another event from our handler and allow other entities to respond to those events on their own.  So we dont have &#8220;FindLiquorStoreResult&#8221;.  We have RaiseLiquorStoreFoundEvent and EnterLiquorStoreCommand and PersonEnteredLiquorStoreEvent within our context (service for some or dbcontext for entity framework people) any entity or our context that is listening for those Events has their own handler where they execute their own business logic as a result of those events.  And if they want they can raise whatever events they wish.<br />
The benefit of this is we go from a procedural / transaction script model, to very rich behavior where any number of other entities that have registered to listen for that command within our context / service / dbcontext do whatever they want to do or may already be programmed to do on their own.</p>
<p>To me, that&#8217;s how the real world works.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1079">
					<div id="dsq-comment-header-1079" class="dsq-comment-header">
						<cite id="dsq-cite-1079">
								<span id="dsq-author-user-1079">Demetrius Middleton</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1079" class="dsq-comment-body">
						<div id="dsq-comment-message-1079" class="dsq-comment-message"><p>That was really long.  But in short, in the real world IMHO, in the Person1.LeaveBathroom method,  we don&#8217;t directly call Person2.Leave(WithMe) method.</p>
<p>It&#8217;s more like:<br />
Person1.ImReadyToExitBathroomEvent<br />
Person1.ReadyToExitBathroomHandler<br />
          -Person1.ExitBathroomCommand<br />
          -Person1.RaiseBathroomExitedCommand<br />
                           &#8211; Person1.FindPerson2Command<br />
                            &#8211; if no FoundPerson2Event is received but Person2.Handled(ISawPerson1.RaiseBathroomExitedCommand)</p>
<p>then Person2.RaiseTellPerson1LetsLeave or if Context.Person2IsOutsideAndISeeHIm<br />
and then Person2.Leave(GoToPerson1Outside) and so on and so forth.  </p>
<p>Does this make sense to anyone?  Am I complicating things too much or am I way off (if so why).  I&#8217;m still learning but this is what actually makes sense to me.  Commands &#8211; CommandHandlers &#8211; Other entities and / or our context listening for any events that can occur within that particular context.  Other entities raising events that each entity or context can listen for.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1080">
					<div id="dsq-comment-header-1080" class="dsq-comment-header">
						<cite id="dsq-cite-1080">
								<span id="dsq-author-user-1080">Demetrius Middleton</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1080" class="dsq-comment-body">
						<div id="dsq-comment-message-1080" class="dsq-comment-message"><p>I will say though, my way of thinking makes testing harder.  As if you want to truly test what happens if one entity performs an action you either need to, have a service layer or some other place where you can directly force certain things to happen in sequence, or your test themselves become &#8220;harder&#8221; because you have to acurately set the appropriate listeners / events for each individual test you perform under each context. </p>
<p>However, I feel there is a better way.  When testing, you really don&#8217;t need to test all the consequences of what you perform (or the consequences of raising an event).  Within a test, you really don&#8217;t care what else is listening and responding to your event.  You just care about raising the appropriate events from the correct handlers.  If you also have tested the other handlers within that domain, and have tested that the correct entities are listening for the correct events, then you have effectively tested whether or not the correct &#8220;sequence&#8221; of events have occurred.  That way, you don&#8217;t tie your tests to the full behavior of all the other entities and their responsibilites.  You are adhering to the SRP and only doing your action and raising the appropriate events.  </p>
<p>If the correct sequence of responses to your events don&#8217;t occur in production, then your other entities need listeners added / tested so that they respond to the originating event appropriately.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-1082">
					<div id="dsq-comment-header-1082" class="dsq-comment-header">
						<cite id="dsq-cite-1082">
	http://kyle.baley.org							<span id="dsq-author-user-1082">Kyle Baley</span>
							</cite>
					</div>
					<div id="dsq-comment-body-1082" class="dsq-comment-body">
						<div id="dsq-comment-message-1082" class="dsq-comment-message"><p>Demetrius,</p>
<p>I think what you describe is closer to what people like Udi Dahan and Greg Young have been espousing for some time. I can&#8217;t comment intelligently on the idea but I attended Udi&#8217;s course and believe it has some significant advantages in the right circumstances. For my part, although this doesn&#8217;t go as far as you suggest, it *is* how GWT encourages devs to write code. It&#8217;s not without it&#8217;s tradeoffs but all in all, it&#8217;s a very clean way to code.</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/kylebaley/2010/10/21/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time/ ';
	var disqus_identifier = '190 /blogs/kyle.baley/archive/2010/10/20/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'kylebaleycb';
	var disqus_title = "Command pattern architecture, or “How to do it a little at a time”";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=190');
		});
					};
	var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/kylebaley\/2010\/10\/21\/command-pattern-architecture-or-how-to-do-it-a-little-at-a-time\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.271 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 09:07:06 -->
<!-- super cache -->