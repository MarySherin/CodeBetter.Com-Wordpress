<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Matthew Podwysocki | CodeBetter.Com &#8211; Stuff you need to Code Better!</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Matthew Podwysocki' href='http://codebetter.com/matthewpodwysocki/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/3e52f3b292da95601a0d3fbd9775ac0e.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content">
			<div id="main" class="grid_8">
			<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div>			
	<div id="nav-above" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-above -->


				
			<div id="post-242" class="post-242 post type-post status-publish format-standard hentry category-javascript category-node category-reactive-framework category-ssjs">
			<h2 class="entry-title"><a href="http://codebetter.com/matthewpodwysocki/2010/09/08/getting-started-with-node-js-on-windows/" title="Permalink to Getting Started with Node.js on Windows" rel="bookmark">Getting Started with Node.js on Windows</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/matthewpodwysocki/2010/09/08/getting-started-with-node-js-on-windows/" title="12:32 am" rel="bookmark"><span class="entry-date">September 8, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p><strong>UPDATE: New packages and further items</strong></p>
<p>What a difference a year makes.&#160; Last year at the first conference solely dedicated to JavaScript, <a href="http://jsconf.us/2009">JSConf 2009</a>, there was a big focus on the uses of JavaScript on the client side.&#160; This year, there was a marked change with server-side JavaScript taking up about half the sessions at <a href="http://jsconf.us/2010">JSConf 2010</a> this past April.&#160; The rise of server-side JavaScript has been in large part to two platforms, <a href="http://narwhaljs.org/">Narwahl</a> and <a href="http://nodejs.org/">node.js</a>.&#160; Node in particular has garnered a bit of attention lately, especially with the <a href="http://nodeknockout.com/">node knockout</a> which happened very recently.&#160; The winners in the node knockout competition alone should give you some clue as to its potential.</p>
<p>Why Node?&#160; Simply put, the purpose of node.js is “To provide a purely evented, non-blocking infrastructure to script highly concurrent programs.”&#160; This stands in contrast to many other concurrency models where threads and synchronization blocks are used, which can cause any number of issues.&#160; Because of its lock free nature, and a bigger freedom from deadlocks, it allows for a more approachable way to concurrency.&#160; The node.js site itself has a great amount of resources <a href="http://nodejs.org/#about">here</a> to get started.</p>
<p>In this series, I’m going to focus a little bit on getting started on node.js and how you can mix the <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Reactive Extensions for JavaScript</a> into your node solutions.</p>
<h2>Getting Started</h2>
<p>One downside has been in the past for me, being a developer who uses Windows frequently (given that I’m employed by Microsoft), has been the lack of native support for Windows.&#160; Fortunately, with the release of node.js version 0.2, there is now support for Windows, albeit through <a href="http://cygwin.com/">Cygwin</a>.&#160; Following the instructions <a href="http://boxysystems.com/index.php/step-by-step-instructions-to-install-nodejs-on-windows/">here</a>, I was able to get it to install on any number of machines, from XP, to Windows 7 to Windows Server 2008 R2.&#160;&#160;&#160; </p>
<p>When installing Cygwin, I chose the following packages:</p>
<ul>
<li>Dev (install all works just fine for all of them if space is not an issue, and I’d recommend that)</li>
<ul>
<li>gcc g++ C++ compiler</li>
<li>gcc mingw-g++</li>
<li>gcc4-4++ G++ subpackage</li>
<li>git</li>
<li>make</li>
<li>openssl</li>
<li>pkg-config</li>
<li>zlib-devel</li>
</ul>
<li>Python – install</li>
<li>Web</li>
<ul>
<li>wget</li>
</ul>
</ul>
<p>Once that installs, before you’ll be able to successfully build anything, you should do a rebaseall by doing the following steps:</p>
<ol>
<li>Close any instances of Cygwin</li>
<li>Launch a command prompt</li>
<li>Execute ash.exe (commonly found in C:\Cygwin\bin)</li>
<li>Execute ./rebaseall –v</li>
</ol>
<p>You should see results similar to the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">/</span><span style="color: #000000">usr</span><span style="color: #000000">/</span><span style="color: #000000">lib</span><span style="color: #000000">/</span><span style="color: #000000">abc</span><span style="color: #000000">.</span><span style="color: #000000">dll new base </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #000000">1234</span><span style="color: #000000">,</span><span style="color: #000000"> new size </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #000000">1234</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now it’s time for us to pull down a fresh copy of node.js.&#160; You can either do it from wget and unpack it as the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">$</span><span style="color: #000000"> wget http:</span><span style="color: #000000">//</span><span style="color: #000000">nodejs</span><span style="color: #000000">.</span><span style="color: #000000">org</span><span style="color: #000000">/</span><span style="color: #000000">dist</span><span style="color: #000000">/</span><span style="color: #000000">node-v0</span><span style="color: #000000">.</span><span style="color: #000000">2.0</span><span style="color: #000000">.</span><span style="color: #000000">tar</span><span style="color: #000000">.</span><span style="color: #000000">gz
</span><span style="color: #000000">$</span><span style="color: #000000"> tar xvf node-v0</span><span style="color: #000000">.</span><span style="color: #000000">2.0</span><span style="color: #000000">.</span><span style="color: #000000">tar</span><span style="color: #000000">.</span><span style="color: #000000">gz</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Or using Git, we can pull that down by the following command, if you installed Git of course like I told you to:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">$</span><span style="color: #000000"> git clone http:</span><span style="color: #000000">//</span><span style="color: #000000">github</span><span style="color: #000000">.</span><span style="color: #000000">com</span><span style="color: #000000">/</span><span style="color: #000000">ry</span><span style="color: #000000">/</span><span style="color: #000000">node</span><span style="color: #000000">.</span><span style="color: #000000">git
</span><span style="color: #000000">$</span><span style="color: #000000"> </span><span style="color: #0000FF">cd</span><span style="color: #000000"> node
</span><span style="color: #000000">$</span><span style="color: #000000"> git fetch --all
</span><span style="color: #000000">$</span><span style="color: #000000"> git tag
</span><span style="color: #000000">$</span><span style="color: #000000"> git checkout v0</span><span style="color: #000000">.</span><span style="color: #000000">2.0</span><span style="color: #000000">
</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>If you’re using a proxy server, like I was in several installs, you can get around that by setting the http_proxy environment variable:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">$</span><span style="color: #000000"> export http_proxy</span><span style="color: #000000">=</span><span style="color: #000000">http:</span><span style="color: #000000">//</span><span style="color: #000000">someproxy:</span><span style="color: #000000">1234</span><span style="color: #000000">/</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Then you can start to configure and build such as the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">$</span><span style="color: #000000"> </span><span style="color: #0000FF">cd</span><span style="color: #000000"> node
</span><span style="color: #000000">$</span><span style="color: #000000"> </span><span style="color: #000000">./</span><span style="color: #000000">configure
</span><span style="color: #000000">$</span><span style="color: #000000"> make
</span><span style="color: #000000">$</span><span style="color: #000000"> make install</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Let this chug for a little bit and it should build just fine.&#160; You can check for success by displaying the version of node such as:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">$</span><span style="color: #000000"> node --version
v0</span><span style="color: #000000">.</span><span style="color: #000000">2.0</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Another thing to notice is that we need to configure the DNS.&#160; Although Cygwin itself relies upon the Windows DNS for its queries, node.js uses the c-ares library that relies on <code>/etc/resolv.conf</code> file.&#160; Edit this file (if found, else create it) and add the entries to the Google public DNS entries:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">nameserver </span><span style="color: #000000">8.8</span><span style="color: #000000">.</span><span style="color: #000000">8.8</span><span style="color: #000000">
nameserver </span><span style="color: #000000">8.8</span><span style="color: #000000">.</span><span style="color: #000000">4.4</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, it’s time to set up our first file, called example.js and put it in the root of your node install, just for simplicity sake at this point.&#160; We’ll create the typical web server example where we write our header and a body containing Hello World from Cygwin.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> http </span><span style="color: #000000">=</span><span style="color: #000000"> require(</span><span style="color: #000000">'</span><span style="color: #000000">http</span><span style="color: #000000">'</span><span style="color: #000000">);

http.createServer(</span><span style="color: #0000FF">function</span><span style="color: #000000"> (request, response) {
  response.writeHead(</span><span style="color: #000000">200</span><span style="color: #000000">, {</span><span style="color: #000000">'</span><span style="color: #000000">Content-Type</span><span style="color: #000000">'</span><span style="color: #000000">: </span><span style="color: #000000">'</span><span style="color: #000000">text/html</span><span style="color: #000000">'</span><span style="color: #000000">});
  response.end(</span><span style="color: #000000">'</span><span style="color: #000000">&lt;b&gt;Hello World from Cygwin&lt;/b&gt;</span><span style="color: #000000">'</span><span style="color: #000000">);
}).listen(</span><span style="color: #000000">8124</span><span style="color: #000000">);

console.log(</span><span style="color: #000000">'</span><span style="color: #000000">Server running at http://127.0.0.1:8124/</span><span style="color: #000000">'</span><span style="color: #000000">);</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And then we can start the server by the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">$</span><span style="color: #000000"> node example</span><span style="color: #000000">.</span><span style="color: #000000">js
Server running at http:</span><span style="color: #000000">//</span><span style="color: #000000">127.0</span><span style="color: #000000">.</span><span style="color: #000000">0.1</span><span style="color: #000000">:</span><span style="color: #000000">8124</span><span style="color: #000000">/</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And now we can see the fruits of our labor by going to the address in our browser:</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_4F161733.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_639B66B1.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=cmpDumJ%2bGePb4bbE1JWjtfbb9Hw%3d" width="306" height="160" /></a> </p>
<p>And there you have it, ready to roll with node.js on Windows (via Cygwin).</p>
<h2>Conclusion</h2>
<p>Here we’ve just scratched the surface of what we can do with node, now that it can be accessible to the many Windows developers out there.&#160; Node, with its engaging community, is giving developers options for creating interesting scalable applications using JavaScript (yes, JavaScript).&#160; In this series, I hope to dive a little bit into it as well as how the <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Reactive Extensions for JavaScript</a> can play a part.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/matthewpodwysocki/category/javascript/" title="View all posts in JavaScript" rel="category">JavaScript</a>, <a href="http://codebetter.com/matthewpodwysocki/category/node/" title="View all posts in node" rel="category">node</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category">Reactive Framework</a>, <a href="http://codebetter.com/matthewpodwysocki/category/ssjs/" title="View all posts in ssjs" rel="category">ssjs</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/matthewpodwysocki/2010/09/08/getting-started-with-node-js-on-windows/#respond" title="Comment on Getting Started with Node.js on Windows"><span class="dsq-postid" rel="242 /blogs/matthew.podwysocki/archive/2010/09/07/getting-started-with-node-js-on-windows.aspx">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-242 -->

		
						
			<div id="post-240" class="post-240 post type-post status-publish format-standard hentry category-c category-event-based-porgramming category-reactive-framework">
			<h2 class="entry-title"><a href="http://codebetter.com/matthewpodwysocki/2010/09/01/reactive-extensions-for-net-event-based-async-operations/" title="Permalink to Reactive Extensions for .NET – Event-based Async Operations" rel="bookmark">Reactive Extensions for .NET – Event-based Async Operations</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/matthewpodwysocki/2010/09/01/reactive-extensions-for-net-event-based-async-operations/" title="12:25 am" rel="bookmark"><span class="entry-date">September 1, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>With the many posts that I’ve done on the Reactive Extensions for both JavaScript and .NET, I’ve covered a wide variety of the basics as well as some of the deeper stuff.&#160; This time, I’d like to get back to the basics that I do when I give a talk on Rx in person, and this time explaining some of the problems we face today with reactive programming in general, asynchronous and event-based.</p>
<h2>Why Do We Need It?</h2>
<p>Let’s go into an example of using the <a href="http://msdn.microsoft.com/en-us/library/e7a34yad.aspx">event-based asynchronous programming methods</a> that became a bit more prevalent when .NET 2.0 came around, especially with the introduction of WCF in the .NET 3.0 timeframe.&#160; This was an alternative to the other methods of asynchronous programming which included the Begin/End Pattern and using WaitHandles.&#160; One distinct advantage it did have was for the ability to report progress, report incremental results or state changes that the others could not provide.&#160; But with it, comes many downsides as well which we’ll go into and where the Reactive Extensions can help.&#160; </p>
<p>Typically, we’d have some form of asynchronous method which has no return value and takes in any number of parameters, and a given user token which would allow us to correlate our token with what comes in the user state to make sure we’re looking at the right result.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">void</span><span style="color: #000000"> DoSomethingAsync(</span><span style="color: #0000FF">object</span><span style="color: #000000"> token)
{
    </span><span style="color: #008000">//</span><span style="color: #008000"> Kick off something async</span><span style="color: #008000">
</span><span style="color: #000000">}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And we’d also have some form of EventArgs which would encompass our result and exception should one occur and optionally a cancelled flag should we need to do so and be notified that it happened.&#160; Then we’d also have our EventHandler which is then called when our asynchronous method is complete.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">class</span><span style="color: #000000"> DoSomethingCompletedEventArgs : EventArgs
{
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">string</span><span style="color: #000000"> Result { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">bool</span><span style="color: #000000"> Cancelled { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> Exception Error { </span><span style="color: #0000FF">get</span><span style="color: #000000">; </span><span style="color: #0000FF">set</span><span style="color: #000000">; }
}

</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">event</span><span style="color: #000000"> EventHandler</span><span style="color: #000000">&lt;</span><span style="color: #000000">DoSomethingCompletedEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">
    DoSomethingCompleted;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To give you an idea of some of the problems we face with this pattern, let’s go over an example using the System.Net.WebClient class and downloading a string asynchronously via the DownloadStringAsync method.&#160; Let’s enumerate some of the challenges in the code below.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">var uri </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Uri(</span><span style="color: #800000">"</span><span style="color: #800000">http://search.twitter.com/search.json?q=4sq.com</span><span style="color: #800000">"</span><span style="color: #000000">);
var client </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> WebClient();

client.DownloadStringCompleted </span><span style="color: #000000">+=</span><span style="color: #000000"> (sender, args)
{
    </span><span style="color: #008000">//</span><span style="color: #008000"> TODO: Get the only one we want?
    </span><span style="color: #008000">//</span><span style="color: #008000"> TODO: Check for cancel?
    </span><span style="color: #008000">//</span><span style="color: #008000"> TODO: Check for exception?
    </span><span style="color: #008000">//</span><span style="color: #008000"> TODO: Check for result?

    </span><span style="color: #008000">//</span><span style="color: #008000"> TODO: What about more composition?</span><span style="color: #008000">
</span><span style="color: #000000">};

client.DownloadStringAsync(uri);

</span><span style="color: #008000">//</span><span style="color: #008000"> TODO: How to unsubscribe</span><span style="color: #008000">
</span><span style="color: #000000">client.DownloadStringCompleted </span><span style="color: #000000">-=</span><span style="color: #000000"> </span><span style="color: #000000">???</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The first challenge is how to make sure we get the value we want.&#160; After all, if multiple calls are made to this WebClient instance, we’ll need to correlate the user state with our token.&#160; Next, we need to check for cancellation and do something when that happens.&#160; After checking for cancellation, we might also want to check for exceptions and handle them appropriately as well.&#160; And finally we get our result, now what do we do with it?&#160; Better yet, now that I have the result, how can I compose it with another asynchronous call?&#160; Finally, when using lambdas for subscribing to events, I can’t unsubscribe our inline lambda, so that could cause an issue as well.&#160; Making some of those changes to handle our cases properly, we end up with code that looks like the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">var uri </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Uri(</span><span style="color: #800000">"</span><span style="color: #800000">http://search.twitter.com/search.json?q=4sq.com</span><span style="color: #800000">"</span><span style="color: #000000">);
var client </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> WebClient();
var token </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #0000FF">object</span><span style="color: #000000">();

DownloadStringCompletedEventHandler h </span><span style="color: #000000">=</span><span style="color: #000000"> (sender, args)
{
    </span><span style="color: #008000">//</span><span style="color: #008000"> Check if it's ours</span><span style="color: #008000">
</span><span style="color: #000000">    </span><span style="color: #0000FF">if</span><span style="color: #000000"> (token </span><span style="color: #000000">!=</span><span style="color: #000000"> args.UserState) </span><span style="color: #0000FF">return</span><span style="color: #000000">;

    </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.Cancelled)
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Do something to say we stopped</span><span style="color: #008000">
</span><span style="color: #000000">    }
    </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.Error </span><span style="color: #000000">!=</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">)
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Do something with that error</span><span style="color: #008000">
</span><span style="color: #000000">    }
    </span><span style="color: #0000FF">else</span><span style="color: #000000">
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Well, now what?</span><span style="color: #008000">
</span><span style="color: #000000">    }
};

client.DownloadStringCompleted </span><span style="color: #000000">+=</span><span style="color: #000000"> h;
client.DownloadStringAsync(uri, token);

</span><span style="color: #008000">//</span><span style="color: #008000"> When we're ready to clean up</span><span style="color: #008000">
</span><span style="color: #000000">client.DownloadStringCompleted </span><span style="color: #000000">-=</span><span style="color: #000000"> h;</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>We solved a good majority of the problems with a lot of boilerplate.&#160; But within all this boilerplate, we’re losing sight of our core goal here, which is to get our result and do something with it, especially when that next call happens to be to another asynchronous call.&#160; For example, what if we want to download a string from somewhere, transform it into JSON, modify the results and then upload somewhere else?&#160; Our code might look like the following should we use the Reactive Extensions for .NET to solve it.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">var client </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> WebClient();
var searchUri </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Uri(</span><span style="color: #800000">"</span><span style="color: #800000">http://search.twitter.com/search.json?q=4sq.com</span><span style="color: #800000">"</span><span style="color: #000000">);
var uploadUri </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Uri(</span><span style="color: #800000">"</span><span style="color: #800000">http://localhost:8080/uploads</span><span style="color: #800000">"</span><span style="color: #000000">);

IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">Unit</span><span style="color: #000000">&gt;</span><span style="color: #000000"> query </span><span style="color: #000000">=</span><span style="color: #000000">
    from result </span><span style="color: #0000FF">in</span><span style="color: #000000"> client.DownloadStringAsObservable(searchUri, </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #0000FF">object</span><span style="color: #000000">())
    let transformed </span><span style="color: #000000">=</span><span style="color: #000000"> TransformResult(result)
    from upload </span><span style="color: #0000FF">in</span><span style="color: #000000"> client.UploadStringAsObservable(
        uploadUri,
        </span><span style="color: #800000">"</span><span style="color: #800000">POST</span><span style="color: #800000">"</span><span style="color: #000000">,
        transformed,
        </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #0000FF">object</span><span style="color: #000000">())
    select upload;

var subscription </span><span style="color: #000000">=</span><span style="color: #000000"> query.Subscribe(
    x </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> {}, </span><span style="color: #008000">//</span><span style="color: #008000"> Nothing to do</span><span style="color: #008000">
</span><span style="color: #000000">    exn </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Do something with the exception</span><span style="color: #008000">
</span><span style="color: #000000">    },
    () </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Indicate we're finished</span><span style="color: #008000">
</span><span style="color: #000000">    });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>What we’re able to do is take operations that would have required quite a bit of code in terms of boilerplate, and allow for composition through LINQ via the Reactive Extensions for .NET.&#160; But, how do we get there?&#160; </p>
<h2>How Do We Get There?</h2>
<p>What we need to do at this point is to transform our asynchronous call from above and turn it into an IObservable&lt;T&gt; instance.&#160; Using the FromEvent which we’ve covered earlier, won’t cut it because ultimately, we want to combine the asynchronous call with the event handler which is invoked upon completion, which FromEvent cannot provider.&#160; Instead, we want to focus our effort into the Observable.Create and Observable.CreateWithDisposable methods to help us.&#160; This allows us to create IObservable&lt;T&gt; instances from the subscribe implementation.&#160; We can either choose the CreateWithDisposable method which gives us an IObserver&lt;T&gt; instance and we return a concrete IDisposable instance, or we call Create in which are given the same IObserver&lt;T&gt; instance, but we return an Action instead of the IDisposable instance.&#160; Let’s look at those signatures below:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">TSource</span><span style="color: #000000">&gt;</span><span style="color: #000000"> CreateWithDisposable</span><span style="color: #000000">&lt;</span><span style="color: #000000">TSource</span><span style="color: #000000">&gt;</span><span style="color: #000000">(
    Func</span><span style="color: #000000">&lt;</span><span style="color: #000000">IObserver</span><span style="color: #000000">&lt;</span><span style="color: #000000">TSource</span><span style="color: #000000">&gt;</span><span style="color: #000000">, IDisposable</span><span style="color: #000000">&gt;</span><span style="color: #000000"> subscribe
)

</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">TSource</span><span style="color: #000000">&gt;</span><span style="color: #000000"> Create</span><span style="color: #000000">&lt;</span><span style="color: #000000">TSource</span><span style="color: #000000">&gt;</span><span style="color: #000000">(
    Func</span><span style="color: #000000">&lt;</span><span style="color: #000000">IObserver</span><span style="color: #000000">&lt;</span><span style="color: #000000">TSource</span><span style="color: #000000">&gt;</span><span style="color: #000000">, Action</span><span style="color: #000000">&gt;</span><span style="color: #000000"> subscribe
)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Using the Observable.Create method, let’s create a method called DownloadStringAsObservable extension method to handle the asynchronous request.&#160; Inside the Observable.Create, we’ll create our DownloadStringCompletedEventHandler where we can check for our user token, handle cancellation by calling observer.OnCompleted, handle exceptions via observer.OnError and finally handle our result by calling observer.OnNext and observer.OnCompleted to indicate we are finished.&#160; We then take this handler and listen to the DownloadStringCompleted event.&#160; We want to be able to catch any errors in our DownloadStringAsync should it throw an exception, so we put that in a try/catch block and send the Exception to observer.OnError.&#160; Finally, Being the good citizens we are, we want to clean up after ourselves by removing our handler from the DownloadStringCompleted event when we dispose of our subscription.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #0000FF">string</span><span style="color: #000000">&gt;</span><span style="color: #000000"> DownloadStringAsObservable(
    </span><span style="color: #0000FF">this</span><span style="color: #000000"> WebClient client,
    Uri address,
    </span><span style="color: #0000FF">object</span><span style="color: #000000"> userToken)
{
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> Observable.Create</span><span style="color: #000000">&lt;</span><span style="color: #0000FF">string</span><span style="color: #000000">&gt;</span><span style="color: #000000">(observer </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
    {
        DownloadStringCompletedEventHandler handler </span><span style="color: #000000">=</span><span style="color: #000000"> (sender, args) </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
        {
            </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.UserState </span><span style="color: #000000">!=</span><span style="color: #000000"> userToken) </span><span style="color: #0000FF">return</span><span style="color: #000000">;

            </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.Cancelled)
                observer.OnCompleted();
            </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #0000FF">if</span><span style="color: #000000">(args.Error </span><span style="color: #000000">!=</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">)
                observer.OnError(args.Error);
            </span><span style="color: #0000FF">else</span><span style="color: #000000">
            {
                observer.OnNext(args.Result);
                observer.OnCompleted();
            }
        };

        client.DownloadStringCompleted </span><span style="color: #000000">+=</span><span style="color: #000000"> handler;

        </span><span style="color: #0000FF">try</span><span style="color: #000000">
        {
            client.DownloadStringAsync(address, token);
        }
        </span><span style="color: #0000FF">catch</span><span style="color: #000000"> (Exception ex)
        {
            observer.OnError(ex);
        }

        </span><span style="color: #0000FF">return</span><span style="color: #000000"> () </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> client.DownloadStringCompleted </span><span style="color: #000000">-=</span><span style="color: #000000"> handler;
    });
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The sample logic applies to uploading a string as well by wrapping the UploadStringAsync method as we do below.</p>
</p>
</p>
</p>
</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">Unit</span><span style="color: #000000">&gt;</span><span style="color: #000000"> UploadStringAsObservable(
    </span><span style="color: #0000FF">this</span><span style="color: #000000"> WebClient client,
    Uri address,
    </span><span style="color: #0000FF">string</span><span style="color: #000000"> method,
    </span><span style="color: #0000FF">string</span><span style="color: #000000"> data,
    </span><span style="color: #0000FF">object</span><span style="color: #000000"> userToken)
{
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> Observable.Create</span><span style="color: #000000">&lt;</span><span style="color: #000000">Unit</span><span style="color: #000000">&gt;</span><span style="color: #000000">(observer </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
    {
        UploadStringCompletedEventHandler handler </span><span style="color: #000000">=</span><span style="color: #000000"> (sender, args) </span><span style="color: #000000">=&gt;</span><span style="color: #000000">
        {
            </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.UserState </span><span style="color: #000000">!=</span><span style="color: #000000"> userToken) </span><span style="color: #0000FF">return</span><span style="color: #000000">;

            </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.Cancelled)
                observer.OnCompleted();
            </span><span style="color: #0000FF">else</span><span style="color: #000000"> </span><span style="color: #0000FF">if</span><span style="color: #000000"> (args.Error </span><span style="color: #000000">!=</span><span style="color: #000000"> </span><span style="color: #0000FF">null</span><span style="color: #000000">)
                observer.OnError(args.Error);
            </span><span style="color: #0000FF">else</span><span style="color: #000000">
            {
                observer.OnNext(</span><span style="color: #0000FF">new</span><span style="color: #000000"> Unit());
                observer.OnCompleted();
            }
        };

        client.UploadStringCompleted </span><span style="color: #000000">+=</span><span style="color: #000000"> handler;

        </span><span style="color: #0000FF">try</span><span style="color: #000000">
        {
            client.UploadStringAsync(address, data, method, token);
        }
        </span><span style="color: #0000FF">catch</span><span style="color: #000000">(Exception ex)
        {
            observer.OnError(ex);
        }

        </span><span style="color: #0000FF">return</span><span style="color: #000000"> () </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> client.UploadStringCompleted </span><span style="color: #000000">-=</span><span style="color: #000000"> handler;
    });
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>By using these tokens as we do above, we could easily wrap the DownloadProgressChanged event as well filtering for our token as well.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">static</span><span style="color: #000000"> IObservable</span><span style="color: #000000">&lt;</span><span style="color: #000000">DownloadProgressChangedEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">
    DownloadProgressChangedAsObservable(
        </span><span style="color: #0000FF">this</span><span style="color: #000000"> WebClient client,
        </span><span style="color: #0000FF">object</span><span style="color: #000000"> userToken)
{
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> Observable.FromEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">DownloadProgressChangedEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">(
            client,
            </span><span style="color: #800000">"</span><span style="color: #800000">DownloadProgressChanged</span><span style="color: #800000">"</span><span style="color: #000000">)
        .Where(x </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> x.EventArgs.UserState </span><span style="color: #000000">==</span><span style="color: #000000"> userToken)
        .Select(x </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> x.EventArgs)
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>What we have done here is taken a less than optimal event-based asynchronous programming model and moved it to use Reactive Extensions for .NET so that we can take care of uniform cancellation checking, error handling and allow for composition.</p>
<h2>Conclusion</h2>
<p>Asynchronous programming is something that’s creeping up more and more to .NET developers, especially with Silverlight, Windows Phone and so forth.&#160; Unfortunately, dealing with asynchronous programming has been and continues to be hard.&#160; By using the Reactive Extensions for .NET, we have ways to build bridges from the old asynchronous programming models, to a more composable form where we can uniformly handle exceptions, cancellation and so forth.</p>
<p>So with that, <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">download it</a>, and <a href="http://social.msdn.microsoft.com/Forums/en-US/rx/threads">give the team feedback!</a></p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/matthewpodwysocki/category/c/" title="View all posts in C#" rel="category">C#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/event-based-porgramming/" title="View all posts in Event-based Porgramming" rel="category">Event-based Porgramming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category">Reactive Framework</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/matthewpodwysocki/2010/09/01/reactive-extensions-for-net-event-based-async-operations/#respond" title="Comment on Reactive Extensions for .NET – Event-based Async Operations"><span class="dsq-postid" rel="240 /blogs/matthew.podwysocki/archive/2010/08/31/reactive-extensions-for-net-event-based-async-operations.aspx">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-240 -->

		
						
			<div id="post-239" class="post-239 post type-post status-publish format-standard hentry category-event-based-porgramming category-javascript category-jsconf category-reactive-framework">
			<h2 class="entry-title"><a href="http://codebetter.com/matthewpodwysocki/2010/08/25/introduction-to-the-reactive-extensions-for-javascript-buffering/" title="Permalink to Introduction to the Reactive Extensions for JavaScript – Buffering" rel="bookmark">Introduction to the Reactive Extensions for JavaScript – Buffering</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/matthewpodwysocki/2010/08/25/introduction-to-the-reactive-extensions-for-javascript-buffering/" title="10:55 pm" rel="bookmark"><span class="entry-date">August 25, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>We’ve come a long way in the series on the <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Reactive Extensions for JavaScript</a>.&#160; After spending some time with Ruby and with extension points in other libraries, let’s step back to some of the basic operators again.&#160; This time, let’s talk about how we can buffer our input, which is to say we can put our observable values into a buffer based upon either time or by count.&#160; This means that instead of flooding our system with calls to OnNext, we instead fill up a buffer based upon the given criteria of time or count, and then call OnNext with that value.&#160; Let’s look deeper into how we can use this in today’s post.</p>
<p>Before we get started, let’s get caught up to where we are today:</p>
<ul>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/02/16/introduction-to-the-reactive-extensions-to-javascript.aspx">Introduction</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/02/23/introduction-to-the-reactive-extensions-for-javascript-creating-observables.aspx">Creating Observables</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/02/27/introduction-to-the-reactive-extensions-for-javascript-creating-observers.aspx">Creating Observers</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/05/introduction-to-the-reactive-extensions-for-javascript-jquery-integration.aspx">jQuery Integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/11/introduction-to-the-reactive-extensions-for-javascript-composing-callbacks.aspx">Composing Callbacks</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/12/introduction-to-the-reactive-extensions-for-javascript-from-blocking-to-async.aspx">From Blocking to Async</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/15/introduction-to-the-reactive-extensions-for-javascript-wikipedia-lookup.aspx">Wikipedia Lookup</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/16/introduction-to-the-reactive-extensions-for-javascript-composing-deeper.aspx">Composing Deeper</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/17/the-reactive-extensions-for-javascript-released.aspx">Bing Maps and Twitter Mashup</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/19/introduction-to-the-reactive-extensions-for-javascript-drag-and-drop.aspx">Drag and Drop</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/21/introduction-to-the-reactive-extensions-for-javascript-jquery-live-event-integration.aspx">jQuery Live Event integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/02/introduction-to-the-reactive-extensions-for-javascript-extending-jquery-ajax.aspx">jQuery AJAX integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/09/introduction-to-the-reactive-extensions-for-javascript-a-separation-of-concerns.aspx">A Separation of Concerns</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/14/introduction-to-the-reactive-extensions-for-javascript-aggregation-part-1.aspx">Aggregates – Part 1</a> and <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/14/introduction-to-the-reactive-extensions-for-javascript-aggregation-part-2.aspx">Part 2</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/19/introduction-to-the-reactive-extensions-for-javascript-new-release-and-joins.aspx">Join Operators</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/23/introduction-to-the-reactive-extensions-for-javascript-going-parallel-with-forkjoin.aspx">Going “Parallel” with ForkJoin</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/04/introduction-to-the-reactive-extensions-for-javascript-refactoring-a-game.aspx">Refactoring a Game</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/10/introduction-to-the-reactive-extensions-for-javascript-async-method-chaining.aspx">Async Method Chaining</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/12/introduction-to-the-reactive-extensions-for-javascript-custom-schedulers.aspx">Custom Schedulers</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/17/introduction-to-the-reactive-extensions-for-javascript-the-final-countdown-timer.aspx">Countdown Timers</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/28/introduction-to-the-reactive-extensions-for-javascript-wrapping-the-dojo-api.aspx">Wrapping the Dojo Toolkit</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/06/04/introduction-to-the-reactive-extensions-for-javascript-mootools-integration.aspx">MooTools Integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/06/16/introduction-to-the-reactive-extensions-for-javascript-conditionals.aspx">Conditional Operators</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/06/24/introduction-to-the-reactive-extensions-for-javascript-looping-operators.aspx">Looping Operators</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/07/20/introduction-to-the-reactive-extensions-for-javascript-error-handling-part-i.aspx">Error Handling Part 1</a> and <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/08/02/introduction-to-the-reactive-extensions-for-javascript-error-handling-part-ii.aspx">Part 2</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript.aspx">Rx and Dojo Deferred</a></li>
</ul>
<p>&#160;</p>
<h2>Buffering Output</h2>
<p>In a traditional pull-based model of synchronous programming, you could have scenarios where yielding the next value could be a potentially expensive blocking operations.&#160; Contrasting it to the reactive push based model, we could get flooded with requests as our systems are eagerly sending us data as fast as it can.&#160; Potentially this can be a problem which could overload our system.&#160; To compensate for this, we have with the Reactive Extensions (for both .NET and JavaScript), a notion of buffering, which is to say based upon some criteria, we can buffer the results and return them as an array.&#160; We have the choice of either buffering by count threshold, or by a given time span.&#160; Once the criteria has been exceeded (or we reach the end), we have the values yielded to us at once in array form.&#160; Let’s first look at the buffering by count.</p>
<h2>…With Count?</h2>
<p>The first buffering mechanism we have with the Reactive Extensions is by count.&#160; To make use of this functionality, we can call the BufferWithCount method which takes a count, and optionally a number to indicate how many you want values to skip in between buffers being yielded.&#160; This method then returns to us an array of values inside an observable sequence.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #008000">//</span><span style="color: #008000"> count: the size of the buffer</span><span style="color: #008000">
//</span><span style="color: #008000"> skip (Optional): how many values to skip</span><span style="color: #008000">
//</span><span style="color: #008000"> returns: Observable&lt;Array&lt;T&gt;&gt;</span><span style="color: #008000">
</span><span style="color: #000000">
Rx.Observable.prototype.BufferWithCount </span><span style="color: #000000">=</span><span style="color: #000000">  </span><span style="color: #0000FF">function</span><span style="color: #000000">(
    count,
    skip);</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Let’s look at this in action.&#160; We’ll take an array with ten numbers and buffer them every two values, so in all we should have yielded to us five arrays.&#160; We’ll iterate through our buffer and indicate its value and position in the buffer.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Rx.Observable.FromArray([</span><span style="color: #000000">1</span><span style="color: #000000">, </span><span style="color: #000000">2</span><span style="color: #000000">, </span><span style="color: #000000">3</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">, </span><span style="color: #000000">5</span><span style="color: #000000">, </span><span style="color: #000000">6</span><span style="color: #000000">, </span><span style="color: #000000">7</span><span style="color: #000000">, </span><span style="color: #000000">8</span><span style="color: #000000">, </span><span style="color: #000000">9</span><span style="color: #000000">, </span><span style="color: #000000">10</span><span style="color: #000000">])
    .BufferWithCount(</span><span style="color: #000000">2</span><span style="color: #000000">)
    .Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (next) {
            $.each(next, </span><span style="color: #0000FF">function</span><span style="color: #000000"> (index, value) {
                $(</span><span style="color: #000000">"</span><span style="color: #000000">&lt;p/&gt;</span><span style="color: #000000">"</span><span style="color: #000000">).html(</span><span style="color: #000000">"</span><span style="color: #000000">Buffered: </span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> index </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #000000">"</span><span style="color: #000000">-</span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> value)
                    .appendTo(results);
            });
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Below is the result of the BufferWithCount specifying only the count and not the skip count.&#160; I have highlighted how many arrays you will get.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">1</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">2</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> one</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">3</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">4</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> two</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">5</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">6</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> three</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">7</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">8</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> four</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">9</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">10</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> five</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Next, we’ll try specifying the skip count, which is to say how many elements we should skip.&#160; For example, if I have a buffer set at two and then I specify four as the skip value, then it will yield 1 and 2 and then skip 3 and 4 before then yielding to us 5 and 6.&#160; Let’s show how that code might look:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Rx.Observable.FromArray([</span><span style="color: #000000">1</span><span style="color: #000000">, </span><span style="color: #000000">2</span><span style="color: #000000">, </span><span style="color: #000000">3</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">, </span><span style="color: #000000">5</span><span style="color: #000000">, </span><span style="color: #000000">6</span><span style="color: #000000">, </span><span style="color: #000000">7</span><span style="color: #000000">, </span><span style="color: #000000">8</span><span style="color: #000000">, </span><span style="color: #000000">9</span><span style="color: #000000">, </span><span style="color: #000000">10</span><span style="color: #000000">])
    .BufferWithCount(</span><span style="color: #000000">2</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">)
    .Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (next) {
            $.each(next, </span><span style="color: #0000FF">function</span><span style="color: #000000"> (index, value) {
                $(</span><span style="color: #000000">"</span><span style="color: #000000">&lt;p/&gt;</span><span style="color: #000000">"</span><span style="color: #000000">).html(</span><span style="color: #000000">"</span><span style="color: #000000">Buffered: </span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> index </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #000000">"</span><span style="color: #000000">-</span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> value)
                    .appendTo(results);
            });
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And now we can sure enough see our results where we yield only three arrays this time due to us skipping 3, 4, 7 and 8.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">1</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">2</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> one</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">5</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">6</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> two</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">9</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">10</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> three</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>But this of course isn’t the only mechanism we have in our arsenal.&#160; Let’s now talk about buffering with time.</p>
<h2>…With Time?</h2>
<p>In addition to buffering with count, we have a notion of buffering with time, which we can achieve with the BufferWithTime method.&#160; This method takes in a timespan in milliseconds, an optional time shift, which acts like the skip from BufferWithCount, and an optional Rx Scheduler.&#160; This then returns to us, as before, an Observable of an array.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #008000">//</span><span style="color: #008000"> timeSpan: time span in milliseconds to buffer</span><span style="color: #008000">
//</span><span style="color: #008000"> timeShift (Optional): time to skip listening in milliseconds</span><span style="color: #008000">
//</span><span style="color: #008000"> scheduler (Optional): a custom scheduler</span><span style="color: #008000">
//</span><span style="color: #008000"> returns: Observable&lt;Array&lt;T&gt;&gt;</span><span style="color: #008000">
</span><span style="color: #000000">
Rx.Observable.prototype.BufferWithTime </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000">(
    timeSpan,
    timeShift,
    scheduler);</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To show this in action, we’ll hop back to some of our knowledge gained in our <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/12/introduction-to-the-reactive-extensions-for-javascript-custom-schedulers.aspx">custom schedulers post</a>.&#160; We’ll create our custom DelayedScheduler based upon a given delay time.&#160; This will help take an existing array and then space it out over time.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> delayedScheduler </span><span style="color: #000000">=</span><span style="color: #000000"> Rx.DelayedScheduler </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> (delay) {

    </span><span style="color: #0000FF">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.Scheduler(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (action) {
            </span><span style="color: #0000FF">var</span><span style="color: #000000"> id </span><span style="color: #000000">=</span><span style="color: #000000"> window.setTimeout(action, delay);
            </span><span style="color: #0000FF">return</span><span style="color: #000000"> Rx.Disposable.Create(</span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
                window.clearTimeout(id);
            });
        },
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (action, dueTime) {
            </span><span style="color: #0000FF">var</span><span style="color: #000000"> id </span><span style="color: #000000">=</span><span style="color: #000000"> window.setTimeout(action, dueTime);
            </span><span style="color: #0000FF">return</span><span style="color: #000000"> Rx.Disposable.Create(</span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
                window.clearTimeout(id);
            });
        },
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
            </span><span style="color: #0000FF">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Date().getTime();
        });
};</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>With the scheduler now in place, we can take our array and delay each item by 100 milliseconds by calling the FromArray with our scheduler.&#160; We can then buffer it with a given timeout of 300 milliseconds and then subscribe much as we have before.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Rx.Observable.FromArray(
        [</span><span style="color: #000000">1</span><span style="color: #000000">, </span><span style="color: #000000">2</span><span style="color: #000000">, </span><span style="color: #000000">3</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">, </span><span style="color: #000000">5</span><span style="color: #000000">, </span><span style="color: #000000">6</span><span style="color: #000000">, </span><span style="color: #000000">7</span><span style="color: #000000">, </span><span style="color: #000000">8</span><span style="color: #000000">, </span><span style="color: #000000">9</span><span style="color: #000000">, </span><span style="color: #000000">10</span><span style="color: #000000">],
        </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.DelayedScheduler(</span><span style="color: #000000">100</span><span style="color: #000000">))
    .BufferWithTime(</span><span style="color: #000000">300</span><span style="color: #000000">)
    .Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (next) {
            $.each(next, </span><span style="color: #0000FF">function</span><span style="color: #000000"> (index, value) {
                $(</span><span style="color: #000000">"</span><span style="color: #000000">&lt;p/&gt;</span><span style="color: #000000">"</span><span style="color: #000000">).html(</span><span style="color: #000000">"</span><span style="color: #000000">Buffered: </span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> index </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #000000">"</span><span style="color: #000000">-</span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> value)
                    .appendTo(results);
            });
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This will yield to us some interesting results in that we have four arrays yielded to us, some with three elements and some with only two due to the timing.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">1</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">2</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> one</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">3</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">4</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">2</span><span style="color: #000000">-</span><span style="color: #000000">5</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> two</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">6</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">7</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">2</span><span style="color: #000000">-</span><span style="color: #000000">8</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> three</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">9</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">10</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> four</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, let’s try with a time shift specified.&#160; In this example, we’ll set our timeout once again as 300 milliseconds and our shift of 100 milliseconds, which should then allow us to skip the numbers 3 and 7 based upon our timing.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Rx.Observable.FromArray(
        [</span><span style="color: #000000">1</span><span style="color: #000000">, </span><span style="color: #000000">2</span><span style="color: #000000">, </span><span style="color: #000000">3</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">, </span><span style="color: #000000">5</span><span style="color: #000000">, </span><span style="color: #000000">6</span><span style="color: #000000">, </span><span style="color: #000000">7</span><span style="color: #000000">, </span><span style="color: #000000">8</span><span style="color: #000000">, </span><span style="color: #000000">9</span><span style="color: #000000">, </span><span style="color: #000000">10</span><span style="color: #000000">],
        </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.DelayedScheduler(</span><span style="color: #000000">100</span><span style="color: #000000">))
    .BufferWithTime(</span><span style="color: #000000">300</span><span style="color: #000000">, </span><span style="color: #000000">400</span><span style="color: #000000">)
    .Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (next) {
            $.each(next, </span><span style="color: #0000FF">function</span><span style="color: #000000"> (index, value) {
                $(</span><span style="color: #000000">"</span><span style="color: #000000">&lt;p/&gt;</span><span style="color: #000000">"</span><span style="color: #000000">).html(</span><span style="color: #000000">"</span><span style="color: #000000">Buffered: </span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> index </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #000000">"</span><span style="color: #000000">-</span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> value)
                    .appendTo(results);
            });
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And sure enough that turns out to be the case as we have three arrays yielded to us, missing both the 3 and 7.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">1</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">2</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> one</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">4</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">5</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">2</span><span style="color: #000000">-</span><span style="color: #000000">6</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> two</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">8</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">9</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">2</span><span style="color: #000000">-</span><span style="color: #000000">10</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> three</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now we shouldn’t be limited to an either or at this point, why not have the best of both worlds?</p>
<h2>…With Both?</h2>
<p>As we’ve already covered both buffering with count and time, let’s cover how we can get the best of both worlds and when either the timeout or the buffer size has been hit, then yield us the values in the buffer.&#160; We can do that through the use of the BufferWithTimeOurCount which we specify the time in milliseconds, a count, and an optional Rx Scheduler.&#160; This then yields to us our Observable of an array.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #008000">//</span><span style="color: #008000"> timeSpan: time used to determine buffer size</span><span style="color: #008000">
//</span><span style="color: #008000"> count: count used to determine buffer size</span><span style="color: #008000">
//</span><span style="color: #008000"> scheduler (Optional): optional scheduler</span><span style="color: #008000">
//</span><span style="color: #008000"> returns: Observable&lt;Array&lt;T&gt;&gt;</span><span style="color: #008000">
</span><span style="color: #000000">
Rx.Observable.prototype.BufferWithTimeOrCount </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000">(
    timeSpan,
    count,
    scheduler);
</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To show this in action, I’m going to need another custom scheduler, but this time completely random as to allow me to show off both behaviors.&#160; We’ll take much of the above code from our DelayedScheduler and instead create a random number up to the delay parameter.&#160; Then, every time a new value is to be yielded, then we delay that value by the given random number.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> randomScheduler </span><span style="color: #000000">=</span><span style="color: #000000"> Rx.RandomScheduler </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> (delay) {

    </span><span style="color: #0000FF">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.Scheduler(
    </span><span style="color: #0000FF">function</span><span style="color: #000000"> (action) {
        </span><span style="color: #0000FF">var</span><span style="color: #000000"> randomnumber </span><span style="color: #000000">=</span><span style="color: #000000"> Math.random() </span><span style="color: #000000">*</span><span style="color: #000000"> (delay </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #000000">1</span><span style="color: #000000">) </span><span style="color: #000000">&lt;&lt;</span><span style="color: #000000"> </span><span style="color: #000000">0</span><span style="color: #000000">;
        </span><span style="color: #0000FF">var</span><span style="color: #000000"> id </span><span style="color: #000000">=</span><span style="color: #000000"> window.setTimeout(action, randomnumber);
        </span><span style="color: #0000FF">return</span><span style="color: #000000"> Rx.Disposable.Create(</span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
            window.clearTimeout(id);
        });
    },
    </span><span style="color: #0000FF">function</span><span style="color: #000000"> (action, dueTime) {
        </span><span style="color: #0000FF">var</span><span style="color: #000000"> id </span><span style="color: #000000">=</span><span style="color: #000000"> window.setTimeout(action, dueTime);
        </span><span style="color: #0000FF">return</span><span style="color: #000000"> Rx.Disposable.Create(</span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
            window.clearTimeout(id);
        });
    },
    </span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
        </span><span style="color: #0000FF">return</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Date().getTime();
    });
};</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Let’s show this off by taking our standard array that we’ve used so far and use our customer RandomScheduler of a maximum of 100 milliseconds.&#160; We’ll then buffer it by either a timeout of 200 milliseconds or 4 items and then subscribe like normally.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Rx.Observable.FromArray(
        [</span><span style="color: #000000">1</span><span style="color: #000000">, </span><span style="color: #000000">2</span><span style="color: #000000">, </span><span style="color: #000000">3</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">, </span><span style="color: #000000">5</span><span style="color: #000000">, </span><span style="color: #000000">6</span><span style="color: #000000">, </span><span style="color: #000000">7</span><span style="color: #000000">, </span><span style="color: #000000">8</span><span style="color: #000000">, </span><span style="color: #000000">9</span><span style="color: #000000">, </span><span style="color: #000000">10</span><span style="color: #000000">],
        </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.RandomScheduler(</span><span style="color: #000000">100</span><span style="color: #000000">))
    .BufferWithTimeOrCount(</span><span style="color: #000000">200</span><span style="color: #000000">, </span><span style="color: #000000">4</span><span style="color: #000000">)
    .Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (next) {
            $.each(next, </span><span style="color: #0000FF">function</span><span style="color: #000000"> (index, value) {
                $(</span><span style="color: #000000">"</span><span style="color: #000000">&lt;p/&gt;</span><span style="color: #000000">"</span><span style="color: #000000">).html(</span><span style="color: #000000">"</span><span style="color: #000000">Buffered: </span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> index </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #000000">"</span><span style="color: #000000">-</span><span style="color: #000000">"</span><span style="color: #000000"> </span><span style="color: #000000">+</span><span style="color: #000000"> value)
                    .appendTo(results);
            });
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>We’ll see in our results that we’ll hit the timeout quite a few more times than we hit with the count, but it shows that we do indeed hit both the timeout and count buffers.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">1</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">2</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> timeout</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">3</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">4</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> timeout</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">2</span><span style="color: #000000">-</span><span style="color: #000000">5</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">3</span><span style="color: #000000">-</span><span style="color: #000000">6</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> count</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">7</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">8</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> timeout</span><span style="color: #008000">
</span><span style="color: #000000">Buffered: </span><span style="color: #000000">0</span><span style="color: #000000">-</span><span style="color: #000000">9</span><span style="color: #000000">
Buffered: </span><span style="color: #000000">1</span><span style="color: #000000">-</span><span style="color: #000000">10</span><span style="color: #000000"> </span><span style="color: #008000">//</span><span style="color: #008000"> timeout</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And there you have it, a simple walkthrough of using buffers with the Reactive Extensions for JavaScript (and if you squint real hard, .NET as well).</p>
<h2>Conclusion</h2>
<p>Dealing with asynchronous programming has been in the forefront of many minds in the JavaScript community.&#160; At <a href="http://jsconf.us/2010">JSConf</a>, there were several examples of frameworks trying to get around the idea of callbacks and instead lean more towards composition.&#160; By utilizing the Reactive Extensions for JavaScript, we’re able to compose together asynchronous and event-based operations together and transform the results in interesting ways. </p>
<p>In the reactive programming world, we could easily have situations where we have systems pushing values at us faster than we would like.&#160; To compensate for this, we have a notion of buffering in the Reactive Extensions which allow for us to specify either count buffers, timeout buffers, or heck, even both.&#160; This gives us some much needed flexibility on how we process the data that is coming at us.</p>
<p>So with that, <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">download it</a>, and <a href="http://social.msdn.microsoft.com/Forums/en-US/rx/threads">give the team feedback!</a></p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/matthewpodwysocki/category/event-based-porgramming/" title="View all posts in Event-based Porgramming" rel="category">Event-based Porgramming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/javascript/" title="View all posts in JavaScript" rel="category">JavaScript</a>, <a href="http://codebetter.com/matthewpodwysocki/category/jsconf/" title="View all posts in JSConf" rel="category">JSConf</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category">Reactive Framework</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/matthewpodwysocki/2010/08/25/introduction-to-the-reactive-extensions-for-javascript-buffering/#respond" title="Comment on Introduction to the Reactive Extensions for JavaScript – Buffering"><span class="dsq-postid" rel="239 /blogs/matthew.podwysocki/archive/2010/08/25/introduction-to-the-reactive-extensions-for-javascript-buffering.aspx">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-239 -->

		
						
			<div id="post-237" class="post-237 post type-post status-publish format-standard hentry category-javascript category-jsconf category-reactive-framework">
			<h2 class="entry-title"><a href="http://codebetter.com/matthewpodwysocki/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript/" title="Permalink to Dojo Deferred and the Reactive Extensions for JavaScript" rel="bookmark">Dojo Deferred and the Reactive Extensions for JavaScript</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/matthewpodwysocki/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript/" title="10:38 pm" rel="bookmark"><span class="entry-date">August 12, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>We’ve covered quite a bit in this series including how well the <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Reactive Extensions for JavaScript</a> plays with other libraries and what integration points we have.&#160; Our main thrust in providing this is that we don’t want to replace your library of choice, whether it be <a href="http://jquery.com">jQuery</a>, <a href="http://www.dojotoolkit.org/">Dojo</a>, <a href="http://mootools.net/">MooTools</a>, YUI in addition to the server components of <a href="http://nodejs.org/">node.js</a>.&#160; Instead, we want to build bridges from them when you encounter the pains of asynchronous and event-based composition which frequently crop up in JavaScript applications both on the web and even on the server.&#160; Case in point, let’s go over our latest integration with the <a href="http://www.dojotoolkit.org/">Dojo Toolkit’s</a> promises via the <a href="http://docs.dojocampus.org/dojo/Deferred">dojo.Deferred module</a>.</p>
<p>Before we get started, let’s get caught up to where we are today:</p>
<ul>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/02/16/introduction-to-the-reactive-extensions-to-javascript.aspx">Introduction</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/02/23/introduction-to-the-reactive-extensions-for-javascript-creating-observables.aspx">Creating Observables</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/02/27/introduction-to-the-reactive-extensions-for-javascript-creating-observers.aspx">Creating Observers</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/05/introduction-to-the-reactive-extensions-for-javascript-jquery-integration.aspx">jQuery Integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/11/introduction-to-the-reactive-extensions-for-javascript-composing-callbacks.aspx">Composing Callbacks</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/12/introduction-to-the-reactive-extensions-for-javascript-from-blocking-to-async.aspx">From Blocking to Async</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/15/introduction-to-the-reactive-extensions-for-javascript-wikipedia-lookup.aspx">Wikipedia Lookup</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/16/introduction-to-the-reactive-extensions-for-javascript-composing-deeper.aspx">Composing Deeper</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/17/the-reactive-extensions-for-javascript-released.aspx">Bing Maps and Twitter Mashup</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/19/introduction-to-the-reactive-extensions-for-javascript-drag-and-drop.aspx">Drag and Drop</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/03/21/introduction-to-the-reactive-extensions-for-javascript-jquery-live-event-integration.aspx">jQuery Live Event integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/02/introduction-to-the-reactive-extensions-for-javascript-extending-jquery-ajax.aspx">jQuery AJAX integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/09/introduction-to-the-reactive-extensions-for-javascript-a-separation-of-concerns.aspx">A Separation of Concerns</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/14/introduction-to-the-reactive-extensions-for-javascript-aggregation-part-1.aspx">Aggregates – Part 1</a> and <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/14/introduction-to-the-reactive-extensions-for-javascript-aggregation-part-2.aspx">Part 2</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/19/introduction-to-the-reactive-extensions-for-javascript-new-release-and-joins.aspx">Join Operators</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/04/23/introduction-to-the-reactive-extensions-for-javascript-going-parallel-with-forkjoin.aspx">Going “Parallel” with ForkJoin</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/04/introduction-to-the-reactive-extensions-for-javascript-refactoring-a-game.aspx">Refactoring a Game</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/10/introduction-to-the-reactive-extensions-for-javascript-async-method-chaining.aspx">Async Method Chaining</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/12/introduction-to-the-reactive-extensions-for-javascript-custom-schedulers.aspx">Custom Schedulers</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/17/introduction-to-the-reactive-extensions-for-javascript-the-final-countdown-timer.aspx">Countdown Timers</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/05/28/introduction-to-the-reactive-extensions-for-javascript-wrapping-the-dojo-api.aspx">Wrapping the Dojo Toolkit</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/06/04/introduction-to-the-reactive-extensions-for-javascript-mootools-integration.aspx">MooTools Integration</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/06/16/introduction-to-the-reactive-extensions-for-javascript-conditionals.aspx">Conditional Operators</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/06/24/introduction-to-the-reactive-extensions-for-javascript-looping-operators.aspx">Looping Operators</a></li>
<li><a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/07/20/introduction-to-the-reactive-extensions-for-javascript-error-handling-part-i.aspx">Error Handling Part 1</a> and <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/08/02/introduction-to-the-reactive-extensions-for-javascript-error-handling-part-ii.aspx">Part 2</a></li>
</ul>
<p>&#160;</p>
<h2>Dojo Deferred</h2>
<p>The Dojo dojo.Deferred module is a central piece of the Dojo Toolkit which serves as the basis for such things as AJAX calls like xhrGet among others.&#160; At its core, it serves as a promises API which acts as a proxy for value which has not yet been calculated, and through this API, we have a clear separation of concerns which allows us to abstract the asynchronous behavior via callbacks into the promise itself, instead of the method signature.&#160; The same could be said of the Reactive Extensions for JavaScript as well.&#160; </p>
<p>Although dojo.Deferred has been around for a while, the newest release of the Dojo Toolkit has added another method to handle both the success and failure cases of a given computation, such as the following code.&#160; Imagine we had an asynchronous function which returns to us a dojo.Deferred object, which does nothing more than delay by a second and return the value.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">function</span><span style="color: #000000"> someDeferredFunction() {
    </span><span style="color: #0000FF">var</span><span style="color: #000000"> deferred </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> dojo.Deferred();
    setTimeout(
        </span><span style="color: #0000FF">function</span><span style="color: #000000">() {
            deferred.callback(</span><span style="color: #000000">42</span><span style="color: #000000">);
        }, </span><span style="color: #000000">1000</span><span style="color: #000000">);
    </span><span style="color: #0000FF">return</span><span style="color: #000000"> deferred;
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Then we can subscribe to both its success and failure cases by using the then function.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> deferred1 </span><span style="color: #000000">=</span><span style="color: #000000"> someDeferredFunction();
deferred1.then(
    </span><span style="color: #008000">//</span><span style="color: #008000"> Success</span><span style="color: #008000">
</span><span style="color: #000000">    </span><span style="color: #0000FF">function</span><span style="color: #000000">(value) {
        alert(value);
    },
    </span><span style="color: #008000">//</span><span style="color: #008000"> Failure</span><span style="color: #008000">
</span><span style="color: #000000">    </span><span style="color: #0000FF">function</span><span style="color: #000000">(error) {
        alert(error);
    });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>We can see a bit of overlap between the ideas here and the heart of the Reactive Extensions for JavaScript.&#160; The difference between the two is that this API treats asynchronous calls as one shot resumable methods whereas RxJS treats these as observable sequences.&#160; So, how could we take advantage of this API and build a bridge between the two libraries?</p>
<h2>From Deferred to Observable</h2>
<p>The first order of business is to see how we can take a given dojo.Deferred and turn it into an Observable sequence yielding a single value.&#160;&#160; Using the Reactive Extensions for JavaScript with the Dojo support added via the “rx.dojo.js” script, we can seamless leap between the two by calling the asObservable prototype method we added.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> deferred2 </span><span style="color: #000000">=</span><span style="color: #000000"> someDeferredFunction();
deferred2.asObservable()
    .Select(</span><span style="color: #0000FF">function</span><span style="color: #000000">(value) { </span><span style="color: #0000FF">return</span><span style="color: #000000"> value </span><span style="color: #000000">*</span><span style="color: #000000"> value; })
    .Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000">(value) {
            alert(value);
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In this example, we took the someDeferredFunction from above and then called the asObservable method, then we’re free to do such things as projections via Select in which we square the returned value and then subscribe to the result via Subscribe.&#160; To show you how we did it, let’s walk through the code below.&#160; First, we create an AsyncSubject which represents and asynchronous operation which accepts only one value and then caches it for all future observations.&#160; Then we can call the then function and in the success case, we call OnNext with the result and OnCompleted to indicate we are finished, and in the failure case, we send the error on via OnError.&#160; FInally we return the subject, thus completing our bridge.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">dojo.Deferred.prototype.asObservable </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
    </span><span style="color: #0000FF">var</span><span style="color: #000000"> subject </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.AsyncSubject();

    </span><span style="color: #0000FF">this</span><span style="color: #000000">.then(
        </span><span style="color: #008000">//</span><span style="color: #008000"> Success</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (value) {
            subject.OnNext(value);
            subject.OnCompleted();
        },
        </span><span style="color: #008000">//</span><span style="color: #008000"> Failure</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (error) {
            subject.OnError(error);
        });

    </span><span style="color: #0000FF">return</span><span style="color: #000000"> subject;
};</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>But, what about the other way around?&#160; Can we go from an Observable sequence to a dojo.Deferred? </p>
<h2>From Observable to Deferred</h2>
<p>Because we feel like building bridges, we want to give the ability for traffic to go both ways.&#160; For example, we could have a given AsyncSubject that we want to use with our existing Dojo functionality.&#160; Imagine we had an Observable sequence that waits for a second and then yields the value via an AsyncSubject.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">function</span><span style="color: #000000"> someAsyncSubjectFunction() {
    </span><span style="color: #0000FF">var</span><span style="color: #000000"> subject </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> Rx.AsyncSubject();

    setTimeout(
        </span><span style="color: #0000FF">function</span><span style="color: #000000">() {
            subject.OnNext(</span><span style="color: #000000">42</span><span style="color: #000000">);
            subject.OnCompleted();
        },
        </span><span style="color: #000000">1000</span><span style="color: #000000">);

    </span><span style="color: #0000FF">return</span><span style="color: #000000"> subject;
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, we might have some processing logic written in Dojo, so we want you to take full advantage of that.&#160; Via the AsDeferred method provided to us through the “rx.dojo.js” script, we build that bridge between the two libraries.&#160; After calling AsDeferred, we can then use it as a regular dojo.Deferred object.&#160; So, now we can call then passing in the two continuations for the success and failure cases.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">var</span><span style="color: #000000"> subject </span><span style="color: #000000">=</span><span style="color: #000000"> someAsyncSubjectFunction();
subject
    .AsDeferred()
    .then(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (value) {
            alert(value);
        },
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (error) {
            alert(error);
        });</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, how did we make this happen?&#160; We’ll need to extend the AsyncSubject with our AsDeferred method.&#160; Inside, we’ll create a new dojo.Deferred which will handle the values from our AsyncSubject.&#160; Next, we’ll subscribe to our subject via the Subscribe method, calling the callback method with our result on success, and errback on the failure.&#160; Finally, we return the deferred which completes our bridge.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Rx.AsyncSubject.prototype.AsDeferred </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">function</span><span style="color: #000000"> () {
   </span><span style="color: #0000FF">var</span><span style="color: #000000"> deferred </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">new</span><span style="color: #000000"> dojo.Deferred();

    </span><span style="color: #0000FF">this</span><span style="color: #000000">.Subscribe(
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (value) {
            deferred.callback(value);
        },
        </span><span style="color: #0000FF">function</span><span style="color: #000000"> (error) {
            deferred.errback(error);
        });

    </span><span style="color: #0000FF">return</span><span style="color: #000000"> deferred;
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And there you have it, our bridge between the Dojo Toolkit and the Reactive Extensions for JavaScript, which allows you to have the best of both worlds. </p>
<h2>Conclusion</h2>
<p>Dealing with asynchronous programming has been in the forefront of many minds in the JavaScript community.&#160; At <a href="http://jsconf.us/2010">JSConf</a>, there were several examples of frameworks trying to get around the idea of callbacks and instead lean more towards composition.&#160; By utilizing the Reactive Extensions for JavaScript, we’re able to compose together asynchronous and event-based operations together and transform the results in interesting ways. </p>
<p>The Reactive Extensions isn’t meant to be the only solution in your toolkit, but instead you can continue to use the JavaScript library of your choice, and when you run into callback hell and composition issues, that’s where RxJS shines.&#160; To that end, we’ve provided a lot of bridges between various libraries such as the following, and more to come:</p>
<ul>
<li><a href="http://jquery.com">jQuery</a></li>
<li><a href="http://dojotoolkit.org/">Dojo Toolkit</a></li>
<li><a href="http://mootools.net/">MooTools</a></li>
<li><a href="http://prototypejs.org/">Prototype</a></li>
<li><a href="http://developer.yahoo.com/yui/3/">YUI3</a></li>
<li><a href="http://www.sencha.com/">ExtJS</a></li>
<li><a href="http://raphaeljs.com/">Raphael</a></li>
<li>Bing Maps</li>
<li>Bing Translator</li>
<li>Google Maps</li>
<li>Google Translate</li>
<li><a href="http://nodejs.org/">Node.js</a></li>
<li>and so on…</li>
</ul>
<p>So with that, <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">download it</a>, and <a href="http://social.msdn.microsoft.com/Forums/en-US/rx/threads">give the team feedback!</a></p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/matthewpodwysocki/category/javascript/" title="View all posts in JavaScript" rel="category">JavaScript</a>, <a href="http://codebetter.com/matthewpodwysocki/category/jsconf/" title="View all posts in JSConf" rel="category">JSConf</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category">Reactive Framework</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/matthewpodwysocki/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript/#respond" title="Comment on Dojo Deferred and the Reactive Extensions for JavaScript"><span class="dsq-postid" rel="237 /blogs/matthew.podwysocki/archive/2010/08/12/dojo-deferred-and-the-reactive-extensions-for-javascript.aspx">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-237 -->

		
						
			<div id="post-236" class="post-236 post type-post status-publish format-standard hentry category-event-based-porgramming category-reactive-framework category-ruby">
			<h2 class="entry-title"><a href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/" title="Permalink to IronRuby and the Reactive Extensions Together Again – Taming User Input" rel="bookmark">IronRuby and the Reactive Extensions Together Again – Taming User Input</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/" title="5:51 pm" rel="bookmark"><span class="entry-date">August 9, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>In the <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2010/08/06/ironruby-and-the-reactive-extensions-together-again-events.aspx">previous post</a>, I talked about how <a href="http://ironruby.codeplex.com/">IronRuby 1.1</a> now supports extension methods, and that it not only supports LINQ to objects, but with relative ease it also supports the <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">Reactive Extensions for .NET</a>.&#160; We covered a little example of taking a Ruby Enumerable and turn it into an .NET Observable instance and then projecting and filtering the data.&#160; In this post, we’ll go a little bit further by showing how you can also use events as well and how we can tame user input.</p>
<h2>What Does the Future Hold?</h2>
<p>Before we continue this series, I thought I’d address the elephant in the room in terms of what the future holds for IronRuby.&#160; <a href="http://twitter.com/jschementi">Jimmy Schementi</a>, the former PM of the IronRuby project laid out what has been going on <a href="http://blog.jimmy.schementi.com/2010/08/start-spreading-news-future-of-jimmy.html">in his blog</a> and the <a href="http://rubyforge.org/pipermail/ironruby-core/2010-August/007310.html">IronRuby core mailing list</a> (which if you want to see it stick around, <a href="http://rubyforge.org/mailman/listinfo/ironruby-core">join the community</a>).&#160; Keep in mind that at the time of this writing, no decision has been made one way or the other as to its future.&#160; My hope is that the community does indeed stand up and either continue on IronRuby, or a bridge effort such as RubyCLR as they are both valuable things to have.</p>
<p>Either way, this blog series, however many posts it may be, will continue as I think it might have some value to some folks out there.&#160; So with that, onto today’s subject.</p>
<h2>Taming User Input</h2>
<p>In this post, I’m going to take an example we had from the Reactive Extensions for .NET Hands on Labs and apply it to a version using IronRuby and WPF.&#160; The idea behind this example is that calls to such things as HTTP calls such as Web Services, REST and so forth can be expensive.&#160; Imagine if you were a really fast typer at over 100 words per minute, and then having each new character cause a new request to be sent.&#160; Chances are you’d overload the system, and not only that, but also have a chance of the results coming back in out of order.&#160; So, how do we fix that?&#160; By using the Reactive Extensions for .NET together with IronRuby, we can make this scenario work quite nicely.</p>
<h2>Removing the Boilerplate</h2>
<p>Getting started, we’ll need to get some boilerplate out of the way including referencing the proper assemblies for a .NET 4 solution.&#160; In order for us to do so, let’s move the assembly includes to a separate file.&#160; Since we’re going to be using WPF and the Reactive Extensions, we’ll create two separate files, rxnet.rb and wpf.rb.&#160; The rxnet.rb contains all specific assemblies related to the Reactive Extensions such as the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.CoreEx</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Interactive</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Reactive</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And our wpf.rb contains the following assemblies:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">WindowsBase</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">PresentationCore</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">PresentationFramework</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Xaml</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.CoreEx</span><span style="color: #800000">'</span><span style="color: #000000">
load_assembly </span><span style="color: #800000">'</span><span style="color: #800000">System.Reactive</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now we can make this available any number of ways, either through a quick gem, or just copying these files directly to the lib folder for IronRuby.&#160; Once we’ve decided on a given path, then we could reference all we need by the following for this post:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">require </span><span style="color: #800000">'</span><span style="color: #800000">System.Core</span><span style="color: #800000">'</span><span style="color: #000000">
require </span><span style="color: #800000">'</span><span style="color: #800000">wpf</span><span style="color: #800000">'</span><span style="color: #000000">
require </span><span style="color: #800000">'</span><span style="color: #800000">rxnet</span><span style="color: #800000">'</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now that our boilerplate is out of the way, let’s get on to the solution.</p>
<h2>Starting the Solution</h2>
<p>Once we have finished that, we are free to include the namespaces and the extension method namespaces which include both System and System::Linq namespaces.&#160; The IObservable extensions for the standard operators reside in System::Linq, and the overloads for the IObservable&lt;T&gt;.subscribe reside in the System namespace.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">include System
include System::Linq
include System::Windows
include System::Windows::Controls

using_clr_extensions System
using_clr_extensions System::Linq</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now, let’s create a standard WPF Window class with a StackPanel which contains two elements, our TextBox for entering data and a ListBox for showing the results.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">class</span><span style="color: #000000"> RubyWindow </span><span style="color: #000000">&lt;</span><span style="color: #000000"> Window

    </span><span style="color: #0000FF">def</span><span style="color: #000000"> initialize
        </span><span style="color: #0000FF">self</span><span style="color: #000000">.Title </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800000">'</span><span style="color: #800000">Hello Ruby!</span><span style="color: #800000">'</span><span style="color: #000000">

        stackpanel </span><span style="color: #000000">=</span><span style="color: #000000"> StackPanel.new
        @textbox </span><span style="color: #000000">=</span><span style="color: #000000"> TextBox.new
        @listbox </span><span style="color: #000000">=</span><span style="color: #000000"> ListBox.new
        stackpanel.children.add(@textbox)
        stackpanel.children.add(@listbox)
        </span><span style="color: #0000FF">self</span><span style="color: #000000">.content </span><span style="color: #000000">=</span><span style="color: #000000"> stackpanel

        initialize_handlers
    </span><span style="color: #0000FF">end</span><span style="color: #000000">

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Once we’ve done this, now let’s get to the interesting part.&#160; After setting the content of our Window to the StackPanel, let’s hook up the to the TextChanged event of our TextBox by calling Observable.from_event generic method (FromEvent) with the arguments of TextChangedEventArgs.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">)

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This is all fine and interesting, but the TextChangedEventArgs doesn’t actually give us the text of our TextBox, so, let’s fix that to call select, passing in our IEvent&lt;TextChangedEventArgs&gt; argument and then retrieving the text property from the sender, which in this case was the TextBox.&#160; In order for us to call generic methods using IronRuby, we need to make use of the following pattern in which we specify the method we want to call, of what type and then we can invoke it via the call method.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">some_object.
    method(:some_method).
    of(SomeType).
    call(some_args)</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>To see this in action, we’ll apply the same pattern to call the from_event method of type TextChangedEventArgs, and then we invoke via call with our @textbox and the ‘TextChanged’ event.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>One distinct advantage we have here while using a dynamic language such as Ruby, we’re able to get the text from the sender without having to cast.&#160; For example, using C#, we’d have to do the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #000000">var textChanged </span><span style="color: #000000">=</span><span style="color: #000000">
    Observable.FromEvent</span><span style="color: #000000">&lt;</span><span style="color: #000000">TextChangedEventArgs</span><span style="color: #000000">&gt;</span><span style="color: #000000">(textbox, </span><span style="color: #800000">&quot;</span><span style="color: #800000">TextChanged</span><span style="color: #800000">&quot;</span><span style="color: #000000">)
        .Select(ev </span><span style="color: #000000">=&gt;</span><span style="color: #000000"> ((TextBox)sender).Text);</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>We can subscribe to the resulting observable and then have the items added to the ListBox.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This is great, but as you may notice, all of our input is immediately put into the below ListBox.&#160; This may or may not be a problem, but imagine we’re calling an external service, then ultimately it’d be a huge issue to have hundreds of calls going out at once because we’re fast typers.&#160; Let’s fix that by using the throttle method (Throttle) which allows us to specify a timeout time before the event is fired.&#160; If there are no other events that happen in the specified timeframe, then we get the result, else we keep waiting until that timeout.&#160; So, let’s now throttle our input.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        throttle(TimeSpan.from_milliseconds(</span><span style="color: #000000">500</span><span style="color: #000000">))
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Now we can run it and watch the results, and it should just work, right?&#160; Not so much…</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_4BA767D0.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_347BED52.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=NJk%2fDT2xLyfdYZOJS6pE9CvVQwo%3d" width="434" height="217" /></a> </p>
<p>The problem is that once we start throttling our input, we’re launching a new thread to make this happen.&#160; This newly spawned thread cannot access the object to modify the items.&#160; Instead, we have to think about Schedulers, which I’ll cover all of them in a later post, but sufficed to say, we have some options.&#160; The easiest of which is the observe_on_dispatcher method (ObserveOnDispatcher) which allows us to observe this sequence on the control’s dispatcher.&#160; Let’s change the code to fix this issue:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        throttle(TimeSpan.from_milliseconds(</span><span style="color: #000000">500</span><span style="color: #000000">)).
        observe_on_dispatcher.
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And now we can start typing, and sure enough our text is throttled, including copying the sentence and pasting it.</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_28E63013.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_68B01698.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=5Uf25Oqdy3GJyeLUT7xyDq6avEo%3d" width="304" height="223" /></a> </p>
<p>But you’ll notice that we now have a duplicate because of the copy/paste operation.&#160; What we really want is to have distinct values only in our ListBox.&#160; To make that happen, we’ll need to use the distinct_until_changed method (DistinctUntilChanged) which then eliminates those duplicates.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">def</span><span style="color: #000000"> initialize_handlers

    @textbox_changed </span><span style="color: #000000">=</span><span style="color: #000000"> Observable.
        method(:from_event).
        of(TextChangedEventArgs).
        call(@textbox, </span><span style="color: #800000">'</span><span style="color: #800000">TextChanged</span><span style="color: #800000">'</span><span style="color: #000000">).
        select(lambda { </span><span style="color: #000000">|</span><span style="color: #000000">event</span><span style="color: #000000">|</span><span style="color: #000000"> event.sender.text })        

    @textbox_changed.
        throttle(TimeSpan.from_milliseconds(</span><span style="color: #000000">500</span><span style="color: #000000">)).
        observe_on_dispatcher.
        distinct_until_changed.
        subscribe(lambda {</span><span style="color: #000000">|</span><span style="color: #000000">text</span><span style="color: #000000">|</span><span style="color: #000000"> @listbox.items.add(text))

</span><span style="color: #0000FF">end</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And we can run the same experiment and sure enough our result is throttled and we receive no duplicates from item to item.</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/matthew.podwysocki/image_5F00_364C4319.png"><img style="border-bottom: 0px;border-left: 0px;border-top: 0px;border-right: 0px" border="0" alt="image" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/matthew/podwysocki/image_thumb_24037C57.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1919787603&amp;Signature=3byXSTecMIO%2b226DWqQuCrX8IWw%3d" width="285" height="234" /></a></p>
<p>And there you have it, a simple case of taming user input, all with the use of IronRuby and the Reactive Extensions for .NET. </p>
<h2>Conclusion</h2>
</p>
</p>
</p>
</p>
</p>
<p>With the Reactive Extensions for .NET, we have a nice cross-language support for building a bridge to asynchronous and event-based programming.&#160; Coming with the latest release of IronRuby, we now have the ability, and a rather nice one at that, to consume extension methods that are predefined in other languages, which opens a whole new set of opportunities for interoperability.&#160; In the coming posts, I’ll take a look at what else I can do in this space to see that we can fact help solve some of the hardest problems around asynchronous and event-based programming.</p>
<p>As for the future of IronRuby, best to get involved and help where you can if you want to see it be a success!</p>
<p>So with that, <a href="http://msdn.microsoft.com/en-us/devlabs/ee794896.aspx">download it</a>, and <a href="http://social.msdn.microsoft.com/Forums/en-US/rx/threads">give the team feedback!</a></p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/matthewpodwysocki/category/event-based-porgramming/" title="View all posts in Event-based Porgramming" rel="category">Event-based Porgramming</a>, <a href="http://codebetter.com/matthewpodwysocki/category/reactive-framework/" title="View all posts in Reactive Framework" rel="category">Reactive Framework</a>, <a href="http://codebetter.com/matthewpodwysocki/category/ruby/" title="View all posts in Ruby" rel="category">Ruby</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/matthewpodwysocki/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input/#respond" title="Comment on IronRuby and the Reactive Extensions Together Again – Taming User Input"><span class="dsq-postid" rel="236 /blogs/matthew.podwysocki/archive/2010/08/09/ironruby-and-the-reactive-extensions-together-again-taming-user-input.aspx">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-236 -->

		
			
	<div id="nav-below" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-below -->
			</div><!-- #main -->
			<div id="sidebar" class="grid_4">
						<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #content -->
	
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.452 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 12:56:53 -->
<!-- super cache -->