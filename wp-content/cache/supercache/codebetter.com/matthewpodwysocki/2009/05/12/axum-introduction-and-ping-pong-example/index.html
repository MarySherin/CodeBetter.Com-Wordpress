<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Axum – Introduction and Ping Pong Example | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/matthewpodwysocki/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/matthewpodwysocki/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/matthewpodwysocki/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Matthew Podwysocki' href='http://codebetter.com/matthewpodwysocki/' />
<link rel='start' title='let Matt = CodeBetter + 1' href='http://codebetter.com/matthewpodwysocki/2008/04/24/let-matt-codebetter-1/' />
<link rel='prev' title='Axum Hits CTP' href='http://codebetter.com/matthewpodwysocki/2009/05/08/axum-hits-ctp/' />
<link rel='next' title='Axum – Ping Pong with Dataflow Networks' href='http://codebetter.com/matthewpodwysocki/2009/05/15/axum-ping-pong-with-dataflow-networks/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/matthewpodwysocki/2009/05/12/axum-introduction-and-ping-pong-example/' />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=140' />
<link rel="stylesheet" href="http://codebetter.com/matthewpodwysocki/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/matthewpodwysocki/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/matthewpodwysocki/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-140" class="post-140 post type-post status-publish format-standard hentry category-axum category-concurrency">
					<h1 class="entry-title">Axum – Introduction and Ping Pong Example</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2009/05/12/axum-introduction-and-ping-pong-example/" title="5:33 am" rel="bookmark"><span class="entry-date">May 12, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/matthewpodwysocki/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>As it was <a href="http://blogs.msdn.com/maestroteam/archive/2009/05/07/the-first-axum-bits-are-now-available.aspx">announced last week</a>, <a href="http://msdn.microsoft.com/en-us/devlabs/dd795202.aspx">Axum, a .NET Domain Specific Language</a> around safe, scalable parallel programming through the actor model and message passing was released to the world as a CTP.&#160; It was noted, that although this is an initial release, that this is still an incubation project which may or may not lead to a final product.&#160; This post will serve as a kind of introduction to the language and some basic concepts.</p>
<h2>Just A Brief Introduction</h2>
<p>Before we get started, I wanted to make sure that we had a basic introduction to the language.&#160; The question often comes up, why another .NET language?&#160; Many people feel that with such others as C#, VB.NET, now F#, IronPython and IronRuby, that maybe we have enough languages already to solve most of our programming needs.&#160; But there remains one important, yet untackled problem around making coordinated parallelization easy.&#160; Sure, we have such things as the Parallel Extensions for .NET being baked into .NET 4.0, which gives us the Task Parallel Library, Parallel LINQ and so on, but none of these really address the intricate nature of coordinated parallelization.</p>
<p>Typically, when we’re developing these parallel applications, we could partition the data as usual and then scatter them out as parallel tasks.&#160; Some jobs were meant for solutions such as this, but others might require a bit more coordination.&#160; The Axum language, built upon the <a href="http://msdn.microsoft.com/en-us/library/bb648752.aspx">Microsoft Concurrency and Coordination Runtime</a> from the Microsoft Robotics Studio, allows for a pretty natural language around such concepts as messaging, side effect free programming, but just as well, free yourself of many concurrency related bugs.&#160; Because isolation is built-in as a default, one of the major sources of concurrency related bugs is taken away.&#160; Just as well, when we design our applications with messaging in mind, we are building a scalable solution where concurrency isn’t an afterthought.</p>
<p>So, the final word is, why a language?&#160; Built-in isolation, easy to understand syntax around messaging, easy asynchronous programming model and many other benefits we get by stepping outside of the C# bounds.&#160; The real question then becomes, so what?&#160; What can we do with it?</p>
<h2>The Erlang Way</h2>
<p>When learning language concepts, I find it easier to spend some time in the language which most strongly implements that concept.&#160; This way, I learn the concepts best when they are first-class citizens in the space.&#160; For learning functional programming, I don’t think it’s as wise to spend your time hacking on C# as to instead learn on a more functional language such as Haskell.&#160; Often when people ask how best to learn FP concepts, often Haskell comes into the equation and has obviously improved my F# code as well as some of my C# as well.&#160; The same applies to a language with actor model concurrency as a built-in concept, where I can learn from my time spent in Erlang as a good precursor to what I can do in Axum.</p>
<p>One of the really elementary things to do in Erlang is a simple <a href="http://erlang.org/doc/getting_started/conc_prog.html">ping-pong example</a>.&#160; In this simple example, we create two processes, a pinger and a ponger, and send messages between them a number of times.&#160; Such code might look like the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">-module</span><span style="color: #000000">(tut15).

</span><span style="color: #0000FF">-export</span><span style="color: #000000">([start</span><span style="color: #000000">/</span><span style="color: #800080">0</span><span style="color: #000000">, ping</span><span style="color: #000000">/</span><span style="color: #800080">2</span><span style="color: #000000">, pong</span><span style="color: #000000">/</span><span style="color: #800080">0</span><span style="color: #000000">]).

ping(</span><span style="color: #800080">0</span><span style="color: #000000">, Pong_PID) </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
    Pong_PID </span><span style="color: #000000">!</span><span style="color: #000000"> finished,
    io:format(</span><span style="color: #800000">"</span><span style="color: #800000">ping finished~n</span><span style="color: #800000">"</span><span style="color: #000000">, []);

ping(N, Pong_PID) </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
    Pong_PID </span><span style="color: #000000">!</span><span style="color: #000000"> {ping, self()},
    </span><span style="color: #0000FF">receive</span><span style="color: #000000">
        pong </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
            io:format(</span><span style="color: #800000">"</span><span style="color: #800000">Ping received pong~n</span><span style="color: #800000">"</span><span style="color: #000000">, [])
    </span><span style="color: #0000FF">end</span><span style="color: #000000">,
    ping(N </span><span style="color: #000000">-</span><span style="color: #000000"> </span><span style="color: #800080">1</span><span style="color: #000000">, Pong_PID).

pong() </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
    </span><span style="color: #0000FF">receive</span><span style="color: #000000">
        finished </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
            io:format(</span><span style="color: #800000">"</span><span style="color: #800000">Pong finished~n</span><span style="color: #800000">"</span><span style="color: #000000">, []);
        {ping, Ping_PID} </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
            io:format(</span><span style="color: #800000">"</span><span style="color: #800000">Pong received ping~n</span><span style="color: #800000">"</span><span style="color: #000000">, []),
            Ping_PID </span><span style="color: #000000">!</span><span style="color: #000000"> pong,
            pong()
    </span><span style="color: #0000FF">end</span><span style="color: #000000">.

start() </span><span style="color: #000000">-&gt;</span><span style="color: #000000">
    Pong_PID </span><span style="color: #000000">=</span><span style="color: #000000"> spawn(tut15, pong, []),
    spawn(tut15, ping, [</span><span style="color: #800080">3</span><span style="color: #000000">, Pong_PID]).</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>From this example, we have two functions, a ping and a pong.&#160; Our ping has an arity with two arguments, the iteration number and the Process ID (PID) of the pong.&#160; If we are at zero iterations left, then we sent the finished message back to the pong’s PID, else we send a ping to the pong, then receive our pong message and then recurse to decrement the iteration number.&#160; Pretty simple, elegant and straight forward example.&#160; Running this example, we might get the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Erlang R13B (erts</span><span style="color: #000000">-</span><span style="color: #800080">5.7</span><span style="color: #000000">.</span><span style="color: #800080">1</span><span style="color: #000000">) [smp:</span><span style="color: #800080">2</span><span style="color: #000000">:</span><span style="color: #800080">2</span><span style="color: #000000">] [rq:</span><span style="color: #800080">2</span><span style="color: #000000">] [async</span><span style="color: #000000">-</span><span style="color: #000000">threads:</span><span style="color: #800080">0</span><span style="color: #000000">]

Eshell V5.</span><span style="color: #800080">7.1</span><span style="color: #000000">  (abort with </span><span style="color: #000000">^</span><span style="color: #000000">G)
</span><span style="color: #800080">1</span><span style="color: #000000">&gt;</span><span style="color: #000000"> c(tut15).
{ok,tut15}
</span><span style="color: #800080">2</span><span style="color: #000000">&gt;</span><span style="color: #000000"> tut15:start().
Pong received ping
</span><span style="color: #000000">&lt;</span><span style="color: #800080">0.40</span><span style="color: #000000">.</span><span style="color: #800080">0</span><span style="color: #000000">&gt;</span><span style="color: #000000">
Ping received pong
Pong received ping
Ping received pong
Pong received ping
Ping received pong
ping finished
Pong finished</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The &lt;0.40.0&gt; value you see above is the return value from the start() function which is nothing more than the PID of the ping process.&#160; Now that we’ve seen this in action in Erlang, how could we do the same in Axum?</p>
<h2>The Axum Solution</h2>
<p>We have a couple of options when implementing this ping-pong example in Axum.&#160; First, we have approach using channels, and another using an ordered interaction point.&#160; Let’s walk through each of these solutions as a possible implementation.&#160; The Axum Programming Guide is a great reference just in case you want to dive deeper into some of these topics.</p>
<p>Before we get started here, let’s first take a look at a simple hello world example to get you familiar with the syntax.&#160; Below is a quick example of getting the command line arguments, and then setting the channel to say we are finished.&#160; Alternatively, we could set the error code </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">using</span><span style="color: #000000"> Microsoft.Axum;

</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">agent</span><span style="color: #000000"> Program : </span><span style="color: #0000FF">channel</span><span style="color: #000000"> Application
{
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> Program()
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Wait for the command line arguments</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> cmdLine </span><span style="color: #000000">=</span><span style="color: #000000"> PrimaryChannel::CommandLine;
        </span><span style="color: #0000FF">var</span><span style="color: #000000"> cmdArgs </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">receive</span><span style="color: #000000">(cmdLine);  

        </span><span style="color: #008000">//</span><span style="color: #008000"> Tell the application we're done</span><span style="color: #008000">
</span><span style="color: #000000">        PrimaryChannel::Done </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> Signal.Value;
    }
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>The first piece you will notice is the lack of the word class, and instead the keyword agent.&#160; The agent concept comes from the actor model of concurrency in which it is an autonomous entity that communicates with others via messages they receives from these other “actors” and can spawn off other “actors” as well.&#160; These agents aren’t like normal classes in which you have fields that other classes can modify, nor have any direct method calls you can make.&#160; </p>
<p>The second piece you’ll notice after the agent declaration is that our Program implements the Microsoft.Axum.Application Channel.&#160; When we implement a channel, we are attached at the implementing end of that channel and we become the server of messages on that channel.&#160; This channel has a public property called PrimaryChannel which gives access to the channel being implemented.&#160; The double-colon operator gives us access to the channel’s port.</p>
<p>Now to actually dive through the agent constructor, we wait for the command line arguments to be passed.&#160; This receive is a blocking call, so we will wait until we receive the data from the CommandLine port, which in this case will be a string array.&#160; We then tell the application we are done by sending a message through the &lt;—operator to the Done port, which is done asynchronously, as opposed to the receive.&#160; Now that we looked at a basic example, let’s move on to a channel based approach.</p>
<h2>The Channels Example</h2>
<p>The first example we’re going to look at is using channels and protocols.&#160; In this example, we will use some of the above constructs with the addition of channel protocols.&#160; First, let’s look at the main code which starts the program:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">using</span><span style="color: #000000"> System;
</span><span style="color: #0000FF">using</span><span style="color: #000000"> System.Concurrency;
</span><span style="color: #0000FF">using</span><span style="color: #000000"> System.Collections.Generic;
</span><span style="color: #0000FF">using</span><span style="color: #000000"> Microsoft.Axum;
</span><span style="color: #0000FF">using</span><span style="color: #000000"> System.Concurrency.Messaging;

</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">agent</span><span style="color: #000000"> Program : </span><span style="color: #0000FF">channel</span><span style="color: #000000"> Application
{
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> Program()
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Wait for our command args</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> cmdArgs </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">receive</span><span style="color: #000000">(PrimaryChannel::CommandLine);

        </span><span style="color: #008000">//</span><span style="color: #008000"> Set the iterations to be some number</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> iters </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800080">3</span><span style="color: #000000">;

        </span><span style="color: #008000">//</span><span style="color: #008000"> Create instance of ping and send msg</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> chan </span><span style="color: #000000">=</span><span style="color: #000000"> Ping.CreateInNewDomain();
        chan::HowMany </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> iters;

        </span><span style="color: #008000">//</span><span style="color: #008000"> Receive how many done</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">receive</span><span style="color: #000000">(chan::Done);

        PrimaryChannel::Done </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> Signal.Value;
    }
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This code first waits for our command arguments, then we set the iterations to 3 for now, but we could set it as high as we wish, maybe higher than 5000 if we care.&#160; Sure, that’s a high number, but our system should be good for it.&#160; We then call Ping.CreateInNewDomain() which instantiates two ends of the PingPongStatus channel, creates an instance of Ping that implements the channel, then returns the using end of the channel.&#160; After this, we send a message on the HowMany port with our number of iterations desired.&#160; Then, we’ll block until we’ve received our message on the Done port to indicate that we are finished.&#160; Finally, we wrap up with setting the overall Done on the PrimaryChannel to indicate our program completion.&#160; Let’s move onto the Ping implementation next.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">channel</span><span style="color: #000000"> PingPongStatus
{
    </span><span style="color: #0000FF">input</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> HowMany;
    </span><span style="color: #0000FF">output</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> Done;

    Start: { HowMany, Done </span><span style="color: #000000">-&gt;</span><span style="color: #000000"> End; }
}

</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">agent</span><span style="color: #000000"> Ping : </span><span style="color: #0000FF">channel</span><span style="color: #000000"> PingPongStatus
{
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> Ping()
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> How many are we supposed to do?</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> iters </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">receive</span><span style="color: #000000">(PrimaryChannel::HowMany);

        </span><span style="color: #008000">//</span><span style="color: #008000"> Create pong and send how many to do</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> chan </span><span style="color: #000000">=</span><span style="color: #000000"> Pong.CreateInNewDomain();
        chan::HowMany </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> iters;

        </span><span style="color: #008000">//</span><span style="color: #008000"> Send pings and receive pongs</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">for</span><span style="color: #000000"> (</span><span style="color: #0000FF">int</span><span style="color: #000000"> i </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800080">0</span><span style="color: #000000">; i </span><span style="color: #000000">&lt;</span><span style="color: #000000"> iters; i</span><span style="color: #000000">++</span><span style="color: #000000">)
        {
            chan::Ping </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> Signal.Value;
            </span><span style="color: #0000FF">receive</span><span style="color: #000000">(chan::Pong);
            Console.WriteLine(</span><span style="color: #800000">"</span><span style="color: #800000">Ping received Pong</span><span style="color: #800000">"</span><span style="color: #000000">);
        }

        </span><span style="color: #008000">//</span><span style="color: #008000"> How many did Pong process?</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">int</span><span style="color: #000000"> pongIters </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">receive</span><span style="color: #000000">(chan::Done);

        PrimaryChannel::Done </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> </span><span style="color: #800080">0</span><span style="color: #000000">;
    }
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>First, we created a PingPongStatus channel to get an input of how many to process, and then we have an output message which says we’re complete.&#160; You’ll notice there’s something more to our channel which begins with Start:.&#160; This is an implementation of a protocol, which allows us to specify the order in which messages are sent to which ports.&#160; All cases start with the Start as we have above, and then we transition to the HowMany port, then from the Done, it signifies the end of our interaction on this channel.</p>
<p>Now to analyze the Ping agent.&#160; Quite simply, we receive the number of iterations message from our Program agent from above.&#160; From there, we call Pong.CreateInNewDomain() which instantiates two ends of the PingPong channel, creates an instance of Pong that implements the channel, then returns the using end of the channel.&#160; We send a message to the HowMany port to specify the number of iterations our ponger should do.&#160; Going through each iteration, we send a message on the Ping port of a Signal, receive the message back on the Pong port.&#160; Finally, we receive the number of iterations that our pong did and then set our Done flag to 0.&#160; Now, let’s move onto our Pong implementation.</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">channel</span><span style="color: #000000"> PingPong
{
    </span><span style="color: #0000FF">input</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> HowMany;
    </span><span style="color: #0000FF">output</span><span style="color: #000000"> </span><span style="color: #0000FF">int</span><span style="color: #000000"> Done;

    </span><span style="color: #0000FF">input</span><span style="color: #000000"> Signal Ping;
    </span><span style="color: #0000FF">output</span><span style="color: #000000"> Signal Pong;
}

</span><span style="color: #0000FF">public</span><span style="color: #000000"> </span><span style="color: #0000FF">agent</span><span style="color: #000000"> Pong : </span><span style="color: #0000FF">channel</span><span style="color: #000000"> PingPong
{
    </span><span style="color: #0000FF">public</span><span style="color: #000000"> Pong()
    {
        </span><span style="color: #008000">//</span><span style="color: #008000"> Get how many we're supposed to do</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">var</span><span style="color: #000000"> iters </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #0000FF">receive</span><span style="color: #000000">(PrimaryChannel::HowMany);

        </span><span style="color: #0000FF">int</span><span style="color: #000000"> i </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800080">0</span><span style="color: #000000">;

        </span><span style="color: #008000">//</span><span style="color: #008000"> Receive our ping and send back our pong</span><span style="color: #008000">
</span><span style="color: #000000">        </span><span style="color: #0000FF">for</span><span style="color: #000000"> (; i </span><span style="color: #000000">&lt;</span><span style="color: #000000"> iters; i</span><span style="color: #000000">++</span><span style="color: #000000">)
        {
            </span><span style="color: #0000FF">receive</span><span style="color: #000000">(PrimaryChannel::Ping);
            Console.WriteLine(</span><span style="color: #800000">"</span><span style="color: #800000">Pong received Ping</span><span style="color: #800000">"</span><span style="color: #000000">);
            PrimaryChannel::Pong </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> Signal.Value;
        }

        PrimaryChannel::Done </span><span style="color: #0000FF">&lt;--</span><span style="color: #000000"> i;
    }
}</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Notice that we have defined our PingPong channel to have ports to indicate how many to do, an output of how many we did, plus an input of a ping and an output of a pong.&#160; Pretty straight forward and self explanatory.&#160; Our Pong agent receives the number of iterations we’re supposed to do.&#160; Then we loop through our iterations, receiving a ping and sending a pong.&#160; After we finish the loop, we send a message on the Done port to indicate the number of iterations done.&#160; </p>
<p>If we stick with our three iterations, the output from our application should look like the following:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterEditableSmartContent">
<pre style="background-color:#FFFFFF;overflow: auto"><span style="color: #000000">Pong received Ping
Ping Received Pong
Pong received Ping
Ping Received Pong
Pong received Ping
Ping Received Pong</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>Pretty straight forward and easy example as we dip our toe into what we can do with Axum.&#160; You can find the complete source code <a href="http://gist.github.com/110275">here</a>.</p>
<h2>Conclusion</h2>
<p>There are other angles I wish to tackle with this example, including using asynchronous methods, ordered interaction points and so on, which I will get into in subsequent posts.&#160; Until then, I hope this brief foray into some of the capabilities of Axum will inspire you to give Axum a look.&#160; <a href="http://msdn.microsoft.com/en-us/devlabs/dd795202.aspx">Download it</a>, use it in anger, and give the team <a href="http://social.msdn.microsoft.com/Forums/en/axum.">feedback on the MSDN forum</a>.&#160; With your help we can help shape the future of an actor based concurrency model on .NET.</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/axum/" title="View all posts in Axum" rel="category tag">Axum</a>, <a href="http://codebetter.com/matthewpodwysocki/category/concurrency/" title="View all posts in Concurrency" rel="category tag">Concurrency</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2009/05/12/axum-introduction-and-ping-pong-example/" title="Permalink to Axum – Introduction and Ping Pong Example" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2009/05/12/axum-introduction-and-ping-pong-example/feed/" title="Comments RSS to Axum – Introduction and Ping Pong Example" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-140 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2009/05/08/axum-hits-ctp/" rel="prev"><span class="meta-nav">&larr;</span> Axum Hits CTP</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2009/05/15/axum-ping-pong-with-dataflow-networks/" rel="next">Axum – Ping Pong with Dataflow Networks <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-343">
					<div id="dsq-comment-header-343" class="dsq-comment-header">
						<cite id="dsq-cite-343">
	http://geekswithblogs.net/malisancube							<span id="dsq-author-user-343">Malisa Ncube</span>
							</cite>
					</div>
					<div id="dsq-comment-body-343" class="dsq-comment-body">
						<div id="dsq-comment-message-343" class="dsq-comment-message"><p>Nice post.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-344">
					<div id="dsq-comment-header-344" class="dsq-comment-header">
						<cite id="dsq-cite-344">
	http://www.twitter.com/talktomikesmith							<span id="dsq-author-user-344">Michael A. Smith</span>
							</cite>
					</div>
					<div id="dsq-comment-body-344" class="dsq-comment-body">
						<div id="dsq-comment-message-344" class="dsq-comment-message"><p>Man, this is sweet. Provided that Axum goes off without a hitch, when&#8217;s the earliest (time-wise) we could expect to see a technology based on it as part of .NET?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-345">
					<div id="dsq-comment-header-345" class="dsq-comment-header">
						<cite id="dsq-cite-345">
	http://codebetter.com/members/Matthew.Podwysocki/default.aspx							<span id="dsq-author-user-345">Matthew.Podwysocki</span>
							</cite>
					</div>
					<div id="dsq-comment-body-345" class="dsq-comment-body">
						<div id="dsq-comment-message-345" class="dsq-comment-message"><p>@Michael,</p>
<p>Not quite sure I can answer that without some sort of wild speculation on my part.  Remember this is an experimental language to explore what works and what doesn&#8217;t in terms of building an actor model concurrency language on .NET, and any final product may look nothing like the current language.  </p>
<p>But, if we let the team know through the forums that we like it and give certain areas that it works and others where it may need improvement, all the better.  I hope to dive further into this subject as time goes on.  I&#8217;d love to see this language evolve as well.</p>
<p>Matt</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-346">
					<div id="dsq-comment-header-346" class="dsq-comment-header">
						<cite id="dsq-cite-346">
	http://www.tavaresstudios.com							<span id="dsq-author-user-346">Chris Tavares</span>
							</cite>
					</div>
					<div id="dsq-comment-body-346" class="dsq-comment-body">
						<div id="dsq-comment-message-346" class="dsq-comment-message"><p>Looks pretty cool. It&#8217;s almost a shame it looks so much like C#, though &#8211; I would have loved to see something a little more distinct just to keep the languages straight in my head.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-347">
					<div id="dsq-comment-header-347" class="dsq-comment-header">
						<cite id="dsq-cite-347">
	http://codebetter.com/members/Matthew.Podwysocki/default.aspx							<span id="dsq-author-user-347">Matthew.Podwysocki</span>
							</cite>
					</div>
					<div id="dsq-comment-body-347" class="dsq-comment-body">
						<div id="dsq-comment-message-347" class="dsq-comment-message"><p>@Chris,</p>
<p>Agreed, and I would rather have more F#-ish syntax for declaring channels, ports and messages.  Of course the less curly braces the better sometimes.  What would you prefer though?  More Erlang-ish syntax?</p>
<p>Matt</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/matthewpodwysocki/2009/05/12/axum-introduction-and-ping-pong-example/ ';
	var disqus_identifier = '140 /blogs/matthew.podwysocki/archive/2009/05/12/axum-introduction-and-ping-pong-example.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'matthewpodwysocki';
	var disqus_title = "Axum – Introduction and Ping Pong Example";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=140');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/matthewpodwysocki/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2009\/05\/12\/axum-introduction-and-ping-pong-example\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.823 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-25 14:58:03 -->
<!-- super cache -->