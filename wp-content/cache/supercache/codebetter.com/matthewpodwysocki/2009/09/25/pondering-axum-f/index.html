<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Pondering Axum + F# | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/matthewpodwysocki/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/matthewpodwysocki/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/matthewpodwysocki/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Matthew Podwysocki' href='http://codebetter.com/matthewpodwysocki/' />
<link rel='start' title='let Matt = CodeBetter + 1' href='http://codebetter.com/matthewpodwysocki/2008/04/24/let-matt-codebetter-1/' />
<link rel='prev' title='Generically Constraining F# – Part I' href='http://codebetter.com/matthewpodwysocki/2009/09/14/constraining-f/' />
<link rel='next' title='Generically Constraining F# – Part II' href='http://codebetter.com/matthewpodwysocki/2009/09/28/generically-constraining-f-part-ii/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/matthewpodwysocki/2009/09/25/pondering-axum-f/' />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=171' />
<link rel="stylesheet" href="http://codebetter.com/matthewpodwysocki/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/matthewpodwysocki/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/matthewpodwysocki/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-171" class="post-171 post type-post status-publish format-standard hentry category-axum category-concurrency category-f category-functional-programming">
					<h1 class="entry-title">Pondering Axum + F#</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2009/09/25/pondering-axum-f/" title="7:42 pm" rel="bookmark"><span class="entry-date">September 25, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/matthewpodwysocki/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>It’s been a while since I’ve posted about <a href="http://msdn.microsoft.com/en-us/devlabs/dd795202.aspx">Axum</a> as I’ve been posting about other asynchronous and parallel programming models.&#160; After two releases of the Axum standalone language and lots of good user feedback, it’s time to ponder what could be with Axum.&#160; Overall, the goals of Axum to provide an agent-based concurrency oriented system is important as we consider the emerging hardware trends.&#160; Many of these ideas would in fact benefit most languages, whether mainstream or not.&#160; With all the success that it has had, there have also been some issues as well, which leads me to wonder, what else could we do here?&#160; Let step through some of those issues today and see where we could go.</p>
<h2>Should It Be Its Own Language?</h2>
<p>One of the highlighted concerns was the need to have yet another language.&#160; Creating and maintaining languages is a large effort, not to be undertaken lightly at any organization.&#160; To base your language on C# while adding additional constructs was a great way to get started and create some buzz and buy-in, but it also brought its own set of problems.&#160; </p>
<p>One problem is that it is an enormous effort to keep on par with the C# compiler and add these constructs on a continuing basis.&#160; The Spec# project, also based upon C# realized that it wasn’t feasible to keep up with the rapid pace of the language and instead went as a language neutral approach.&#160; Not only keeping up with the language, but to enforce many functional programming constructs that Axum embraces such as immutability and purity are harder to enforce given a language which is built upon object-oriented and imperative approaches, an approach which encourage the encapsulation and manipulation of state.&#160; So, instead of creating a separate language, why not fold these constructs into an existing language instead?</p>
<h2>The Case For F#</h2>
<p>Given the impedance mismatch between the C# language and the overall goals of Axum for a safe, isolated, agent-based system that is great for concurrency, why not consider another language such as F#?&#160; Now that F# is a first-class citizen within Visual Studio going forward, there can be a strong case made.&#160; Given some of the features of F#, which we will discuss, could potentially be a happy marriage with Axum.&#160; The F# language and its associated libraries have many of the constructs that are essential to an agent-based messaging system, including immutability (albeit shallow), encouraging side effect free programming, and library functions such as the mailbox processor messaging classes.</p>
<h2>In Praise Of Immutability</h2>
<p>In the world of concurrency we find that shared mutable state is evil.&#160; Often we have to protect certain parts by using low level constructs such as locks, semaphores, mutexes.&#160; Because of this, we find that most people tend to avoid concurrency programming as it tends to be too hard to get just right.&#160; Instead, communication through message passing in languages such as Axum and Erlang, immutability is the standard.&#160; This way, we can freely reference the values without any worry of whether they will change underneath us.&#160; Providing first-class support for immutability goes a long way towards making safe concurrency programming easier for the masses.&#160; With the F# language, we get that approach by default and with rich types such as records, discriminated unions, lists, tuples and more.&#160; </p>
<p>Of particular note, Discriminated Unions are quite useful in messaging systems to define the types of messages your system accepts.&#160; For example, we could model our auction messages quite easily using discriminated unions to define which interactions are legal, such as the following code:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">type</span><span style="color: #000000"> AuctionMessage </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #000000">|</span><span style="color: #000000"> Offer of </span><span style="color: #0000ff">int</span><span style="color: #000000"> </span><span style="color: #000000">*</span><span style="color: #000000"> MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">AuctionReply</span><span style="color: #000000">&gt;</span><span style="color: #000000">
  </span><span style="color: #000000">|</span><span style="color: #000000"> Inquire of MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">AuctionReply</span><span style="color: #000000">&gt;</span><span style="color: #000000">
</span><span style="color: #0000ff">and</span><span style="color: #000000">  AuctionReply </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #000000">|</span><span style="color: #000000"> Status of </span><span style="color: #0000ff">int</span><span style="color: #000000"> </span><span style="color: #000000">*</span><span style="color: #000000"> System.DateTime
  </span><span style="color: #000000">|</span><span style="color: #000000"> BestOffer
  </span><span style="color: #000000">|</span><span style="color: #000000"> BeatenOffer of </span><span style="color: #0000ff">int</span><span style="color: #000000">
  </span><span style="color: #000000">|</span><span style="color: #000000"> AuctionConcluded of
      MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">AuctionReply</span><span style="color: #000000">&gt;</span><span style="color: #000000"> </span><span style="color: #000000">*</span><span style="color: #000000"> MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">AuctionReply</span><span style="color: #000000">&gt;</span><span style="color: #000000">
  </span><span style="color: #000000">|</span><span style="color: #000000"> AuctionFailed
  </span><span style="color: #000000">|</span><span style="color: #000000"> AuctionOver</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>In this case, we have succinctly defined what messages can be processed.&#160; Adding to this, Axum, through the use of data-flow networks and channel protocols could be a nice compliment to determine how these messages are processed.&#160;&#160; Where else could they match up nicely?</p>
<h2>Built For Concurrency</h2>
<p>To talk about a potential marriage between F# and Axum, we need to talk about the language and its libraries and how they support concurrency.&#160; From first class events, to asynchronous workflows, to mailbox processors, F# has a wide array of asynchronous and parallel programming libraries available out of the box.&#160; In particular, the asynchronous workflows and the mailbox processor could match well with the Axum programming model.&#160; Interestingly, <a href="http://blogs.msdn.com/lucabol/">Luca Bolognese</a> has built upon the mailbox processor for his <a href="http://blogs.msdn.com/lucabol/archive/2009/09/18/lagent-an-agent-framework-in-f-part-ix-counting-words.aspx">LAgent framework</a> to show some more interesting scenarios where agent based programming could work.&#160; This includes such things as advanced error handling, hot swapping, implementing MapReduce and so on.</p>
<p>With little effort, we can model such things as the standard ping-pong example using F# mailboxes:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">let</span><span style="color: #000000"> (</span><span style="color: #000000">&lt;--</span><span style="color: #000000">) (m:MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">_</span><span style="color: #000000">&gt;</span><span style="color: #000000">) msg </span><span style="color: #000000">=</span><span style="color: #000000"> m.Post(msg)
</span><span style="color: #0000ff">type</span><span style="color: #000000"> PingMessage </span><span style="color: #000000">=</span><span style="color: #000000"> Ping of MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">PongMessage</span><span style="color: #000000">&gt;</span><span style="color: #000000"> </span><span style="color: #000000">|</span><span style="color: #000000"> Stop
</span><span style="color: #0000ff">and</span><span style="color: #000000">  PongMessage </span><span style="color: #000000">=</span><span style="color: #000000"> Pong

</span><span style="color: #0000ff">let</span><span style="color: #000000"> ping iters (pong : MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">PingMessage</span><span style="color: #000000">&gt;</span><span style="color: #000000">) </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000ff">new</span><span style="color: #000000"> MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">PongMessage</span><span style="color: #000000">&gt;</span><span style="color: #000000">(</span><span style="color: #0000ff">fun</span><span style="color: #000000"> inbox </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000">
    pong </span><span style="color: #000000">&lt;--</span><span style="color: #000000"> Ping inbox
    </span><span style="color: #0000ff">let</span><span style="color: #000000"> </span><span style="color: #0000ff">rec</span><span style="color: #000000"> loop pingsLeft </span><span style="color: #000000">=</span><span style="color: #000000"> async {
      </span><span style="color: #0000ff">let</span><span style="color: #000000">!</span><span style="color: #000000"> msg </span><span style="color: #000000">=</span><span style="color: #000000"> inbox.Receive()
      </span><span style="color: #0000ff">match</span><span style="color: #000000"> msg </span><span style="color: #0000ff">with</span><span style="color: #000000">
      </span><span style="color: #000000">|</span><span style="color: #000000"> Pong </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000">
          </span><span style="color: #0000ff">if</span><span style="color: #000000"> pingsLeft </span><span style="color: #000000">%</span><span style="color: #000000"> </span><span style="color: #800080">1000</span><span style="color: #000000"> </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800080">0</span><span style="color: #000000"> </span><span style="color: #0000ff">then</span><span style="color: #000000">
            printfn </span><span style="color: #800000">&quot;</span><span style="color: #800000">Ping: pong</span><span style="color: #800000">&quot;</span><span style="color: #000000">
          </span><span style="color: #0000ff">if</span><span style="color: #000000"> pingsLeft </span><span style="color: #000000">&gt;</span><span style="color: #000000"> </span><span style="color: #800080">0</span><span style="color: #000000"> </span><span style="color: #0000ff">then</span><span style="color: #000000">
            pong </span><span style="color: #000000">&lt;--</span><span style="color: #000000"> Ping inbox
            </span><span style="color: #0000ff">return</span><span style="color: #000000">!</span><span style="color: #000000"> loop(pingsLeft </span><span style="color: #000000">-</span><span style="color: #000000"> </span><span style="color: #800080">1</span><span style="color: #000000">)
          </span><span style="color: #0000ff">else</span><span style="color: #000000">
            printfn </span><span style="color: #800000">&quot;</span><span style="color: #800000">Ping: stop</span><span style="color: #800000">&quot;</span><span style="color: #000000">
            pong </span><span style="color: #000000">&lt;--</span><span style="color: #000000"> Stop
            </span><span style="color: #0000ff">return</span><span style="color: #000000"> () }
    loop (iters </span><span style="color: #000000">-</span><span style="color: #000000"> </span><span style="color: #800080">1</span><span style="color: #000000">))

</span><span style="color: #0000ff">let</span><span style="color: #000000"> pong () </span><span style="color: #000000">=</span><span style="color: #000000">
  </span><span style="color: #0000ff">new</span><span style="color: #000000"> MailboxProcessor</span><span style="color: #000000">&lt;</span><span style="color: #000000">PingMessage</span><span style="color: #000000">&gt;</span><span style="color: #000000">(</span><span style="color: #0000ff">fun</span><span style="color: #000000"> inbox </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000">
    </span><span style="color: #0000ff">let</span><span style="color: #000000"> </span><span style="color: #0000ff">rec</span><span style="color: #000000"> loop pongCount </span><span style="color: #000000">=</span><span style="color: #000000"> async {
      </span><span style="color: #0000ff">let</span><span style="color: #000000">!</span><span style="color: #000000"> msg </span><span style="color: #000000">=</span><span style="color: #000000"> inbox.Receive()
      </span><span style="color: #0000ff">match</span><span style="color: #000000"> msg </span><span style="color: #0000ff">with</span><span style="color: #000000">
      </span><span style="color: #000000">|</span><span style="color: #000000"> Ping sender </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000">
          </span><span style="color: #0000ff">if</span><span style="color: #000000"> pongCount </span><span style="color: #000000">%</span><span style="color: #000000"> </span><span style="color: #800080">1000</span><span style="color: #000000"> </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800080">0</span><span style="color: #000000"> </span><span style="color: #0000ff">then</span><span style="color: #000000">
            printfn </span><span style="color: #800000">&quot;</span><span style="color: #800000">Pong: ping %d</span><span style="color: #800000">&quot;</span><span style="color: #000000"> pongCount
          sender </span><span style="color: #000000">&lt;--</span><span style="color: #000000"> Pong
          </span><span style="color: #0000ff">return</span><span style="color: #000000">!</span><span style="color: #000000"> loop (pongCount </span><span style="color: #000000">+</span><span style="color: #000000"> </span><span style="color: #800080">1</span><span style="color: #000000">)
      </span><span style="color: #000000">|</span><span style="color: #000000"> Stop </span><span style="color: #0000ff">-&gt;</span><span style="color: #000000"> printfn </span><span style="color: #800000">&quot;</span><span style="color: #800000">Pong: stop</span><span style="color: #800000">&quot;</span><span style="color: #000000">; </span><span style="color: #0000ff">return</span><span style="color: #000000"> () }
    loop </span><span style="color: #800080">0</span><span style="color: #000000">)

</span><span style="color: #0000ff">let</span><span style="color: #000000"> ponger </span><span style="color: #000000">=</span><span style="color: #000000"> pong()
</span><span style="color: #0000ff">let</span><span style="color: #000000"> pinger </span><span style="color: #000000">=</span><span style="color: #000000"> ping </span><span style="color: #800080">100000</span><span style="color: #000000"> ponger
pinger.Start()
ponger.Start()</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>And you’ll notice from all of this, there are no mutable values anywhere nor shared global state and all communication happens through message passing.&#160; We have certain limitations here such as we cannot remote these calls, so all interaction happens inside the single application.&#160; Not only that, but how do we enforce no shared state?</p>
<h2>What Would It Look Like?</h2>
<p>So, now that we looked at some of the reasons why F# and Axum might be a good marriage, what might it actually look like?&#160; That’s a great question!&#160; Some of the concepts from Axum could map perfectly to F# whereas some might need a little more coaxing.&#160; Let’s go back to the basic building blocks of Axum.&#160; They consist of the following:</p>
<ul>
<li>Agents and domains </li>
<li>Channels </li>
<li>Schema </li>
<li>Networks </li>
</ul>
<p>The first three items are concerned mostly with state isolation and the exchange of information between our isolated regions of our application, while the last item deals more with the how messages are passed.&#160; </p>
<p>The domain is the most basic isolation concept where all data is encapsulated and only constructors are exposed outside of the domain definition.&#160; Agents are defined to run within the isolated space of a domain with each agent on a separate thread of control.&#160; These agents are exposed to one another through passing messages back and forth via channels which define ports through which our data flows.&#160; The data that passes between our domains can be defined in a schema, similar in nature of XML Schemas, to define structure and rules of our data.&#160; Now to think about message passing, F# already has asynchronous behavior already built in to the mailbox processor, so we could take advantage here and build on top of it and our networks could guide us as to what order messages are passed.</p>
<p>Let’s look at some possible code examples of what things might look like.&#160; I’ll choose just a couple as they might work nicely out of the box.&#160; Let’s first look at how we might define a port which accepts a given message.&#160; </p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">type</span><span style="color: #000000"> ProductInput </span><span style="color: #000000">=</span><span style="color: #000000"> Multiply of </span><span style="color: #0000ff">int</span><span style="color: #000000"> </span><span style="color: #000000">*</span><span style="color: #000000"> </span><span style="color: #0000ff">int</span><span style="color: #000000"> </span><span style="color: #000000">|</span><span style="color: #000000"> Done
</span><span style="color: #0000ff">type</span><span style="color: #000000"> ProductOutput </span><span style="color: #000000">=</span><span style="color: #000000"> Product of </span><span style="color: #0000ff">int</span><span style="color: #000000"> </span><span style="color: #000000">|</span><span style="color: #000000"> AckDone</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>This way, we could define what our payload type for both incoming and outgoing.&#160; Another area would be to look how schemas might be done.&#160; In our earlier example, we used simple data types such as integers, but what about more complex types?&#160; Using F#, we could think of using records here to simulate the not only the data, but what is and is not required:</p>
<div style="padding-bottom: 0px;margin: 0px;padding-left: 0px;padding-right: 0px;float: none;padding-top: 0px" class="wlWriterSmartContent">
<pre style="background-color: #ffffff;overflow: auto"><span style="color: #0000ff">type</span><span style="color: #000000"> PersonSchema </span><span style="color: #000000">=</span><span style="color: #000000">
  { Name     : </span><span style="color: #0000ff">string</span><span style="color: #000000">
    Employer : </span><span style="color: #0000ff">string</span><span style="color: #000000">
    Age      : </span><span style="color: #0000ff">int</span><span style="color: #000000"> option }

</span><span style="color: #0000ff">let</span><span style="color: #000000"> matt </span><span style="color: #000000">=</span><span style="color: #000000">
  { Name </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800000">&quot;</span><span style="color: #800000">Matthew Podwysocki</span><span style="color: #800000">&quot;</span><span style="color: #000000">
    Employer </span><span style="color: #000000">=</span><span style="color: #000000"> </span><span style="color: #800000">&quot;</span><span style="color: #800000">Microsoft Corporation</span><span style="color: #800000">&quot;</span><span style="color: #000000">
    Age </span><span style="color: #000000">=</span><span style="color: #000000"> None }</span></pre>
<p><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div>
<p>By marking the fields we require as standard fields and those which are optional as option types works out nicely.&#160; Using F#, we’re able to have concise syntax with a language that is already defined and quite flexible.</p>
<h2>Conclusion</h2>
<p>As you can see from this post, a potential marriage between Axum and F# would certainly be a great fit.&#160; Instead of focusing on Axum as a separate language, focusing the effort on top of an existing language which matches many of the design goals can bear a lot of fruit.&#160; I believe Axum is important for the .NET programming stack, giving us more options on how to deal with concurrency and changing hardware architectures.&#160; What do you think?</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/axum/" title="View all posts in Axum" rel="category tag">Axum</a>, <a href="http://codebetter.com/matthewpodwysocki/category/concurrency/" title="View all posts in Concurrency" rel="category tag">Concurrency</a>, <a href="http://codebetter.com/matthewpodwysocki/category/f/" title="View all posts in F#" rel="category tag">F#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/functional-programming/" title="View all posts in Functional Programming" rel="category tag">Functional Programming</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2009/09/25/pondering-axum-f/" title="Permalink to Pondering Axum + F#" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2009/09/25/pondering-axum-f/feed/" title="Comments RSS to Pondering Axum + F#" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-171 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2009/09/14/constraining-f/" rel="prev"><span class="meta-nav">&larr;</span> Generically Constraining F# – Part I</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2009/09/28/generically-constraining-f-part-ii/" rel="next">Generically Constraining F# – Part II <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-392">
					<div id="dsq-comment-header-392" class="dsq-comment-header">
						<cite id="dsq-cite-392">
	http://semasiographic.com							<span id="dsq-author-user-392">Art Scott</span>
							</cite>
					</div>
					<div id="dsq-comment-body-392" class="dsq-comment-body">
						<div id="dsq-comment-message-392" class="dsq-comment-message"><p>Thanks Matthew.<br />
When I first heard of Axum, I thouhgt it was as you describe it should be. I am surprised it is not!</p>
<p>Hopefully, reason will prevail over C#-illiness.<br />
Axum built on C# is a house built on sand, a bane.<br />
Built on a solid FP F# foundation Axum will be a boon.</p>
<p>Keep up our gret work.<br />
Best Regards.<br />
Art</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-393">
					<div id="dsq-comment-header-393" class="dsq-comment-header">
						<cite id="dsq-cite-393">
	http://codebetter.com/members/Matthew.Podwysocki/default.aspx							<span id="dsq-author-user-393">Matthew.Podwysocki</span>
							</cite>
					</div>
					<div id="dsq-comment-body-393" class="dsq-comment-body">
						<div id="dsq-comment-message-393" class="dsq-comment-message"><p>@Art,</p>
<p>Thanks for the comments.  I wouldn&#8217;t go as far as you would in terms of the language choice for Axum.  To be fair, the large majority of .NET developers are C# developers and to target this language did indeed give them a wider audience for trying the language than F# would have.  That said, there are things to be said for F# being the language of choice as it supports many of the features that are required by Axum out of the box.  The others, I&#8217;m not as sure about without some changes being made to the language.</p>
<p>Matt</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-394">
					<div id="dsq-comment-header-394" class="dsq-comment-header">
						<cite id="dsq-cite-394">
	http://Mazmanov							<span id="dsq-author-user-394">Dimitri</span>
							</cite>
					</div>
					<div id="dsq-comment-body-394" class="dsq-comment-body">
						<div id="dsq-comment-message-394" class="dsq-comment-message"><p>Axum + F# &#8211; .NET Framework = Erlang</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-395">
					<div id="dsq-comment-header-395" class="dsq-comment-header">
						<cite id="dsq-cite-395">
	http://codebetter.com/members/Matthew.Podwysocki/default.aspx							<span id="dsq-author-user-395">Matthew.Podwysocki</span>
							</cite>
					</div>
					<div id="dsq-comment-body-395" class="dsq-comment-body">
						<div id="dsq-comment-message-395" class="dsq-comment-message"><p>@Dimitri,</p>
<p>Not quite as F# is a statically typed language, and one of the goals for Axum is safety through channels, ports, and domains.  The interactions are a bit more rigid than Erlang which enforces discipline instead of the more free nature of Erlang and its dynamic typing.</p>
<p>Matt</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-396">
					<div id="dsq-comment-header-396" class="dsq-comment-header">
						<cite id="dsq-cite-396">
								<span id="dsq-author-user-396">Konstantim Triger</span>
							</cite>
					</div>
					<div id="dsq-comment-body-396" class="dsq-comment-body">
						<div id="dsq-comment-message-396" class="dsq-comment-message"><p>There are 2 different concepts, functionality and language binding to this functionality. I think that functionality should be available as a library usable from any .Net language. Then you may consider how some particular language is bound to this library, if needed adding special keywords to the language.</p>
<p>This approach looks very native to the language agnostic nature of .net framework and proved itself very well with LINQ.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-397">
					<div id="dsq-comment-header-397" class="dsq-comment-header">
						<cite id="dsq-cite-397">
	http://codebetter.com/members/Matthew.Podwysocki/default.aspx							<span id="dsq-author-user-397">Matthew.Podwysocki</span>
							</cite>
					</div>
					<div id="dsq-comment-body-397" class="dsq-comment-body">
						<div id="dsq-comment-message-397" class="dsq-comment-message"><p>@Konstantin,</p>
<p>I&#8217;m going to have to disagree with you here.  LINQ, although interesting, already had a lot of those features included and it wasn&#8217;t much of a stretch to include the others (anonymous types, type inference, extension methods, etc).  Instead, languages would have to change their posture quite a bit to become immutable by default.  The reason to focus on F# is that it supports many of the constructs already, but not only that, its syntax is quite lightweight and friendly to defining messages that is otherwise convoluted in languages such as C# and VB.NET.</p>
<p>Matt</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-398">
					<div id="dsq-comment-header-398" class="dsq-comment-header">
						<cite id="dsq-cite-398">
								<span id="dsq-author-user-398">eventhelix</span>
							</cite>
					</div>
					<div id="dsq-comment-body-398" class="dsq-comment-body">
						<div id="dsq-comment-message-398" class="dsq-comment-message"><p>Heres an implementation of axum channels and agents.<br />
type PortName = string<br />
type Channel = string * seq<string><br />
let port : string -> PortName = id<br />
let channel name x : Channel = (name, x)<br />
let extends = ()<br />
type AgentMsg = Receive of string * AsyncReplyChannel<obj> | Post of PortName * obj<br />
type AgentType< 'ConstructerArgs>(name: string, channels: seq<channel>, body: Agent -> &#8216;ConstructerArgs -> Async<unit>) =<br />
    let create(args) =<br />
        let ports =<br />
            channels<br />
            |> Seq.collect snd<br />
            |> Seq.map(fun name -><br />
                let mb =<br />
                    MailboxProcessor<obj>.Start(fun _ -> async{return()})<br />
                (name, mb))<br />
            |> Map.ofSeq</p>
<p>        let rec mbox: Agent =<br />
            MailboxProcessor.Start(fun inbox -><br />
                async {<br />
                    while true do<br />
                        let! msg = inbox.Receive()<br />
                        match msg with<br />
                        |Post(name, msg) -> ports.[name].Post(msg)<br />
                        |Receive(name, reply) -><br />
                            let! msg = ports.[name].Receive()<br />
                            reply.Reply(msg)<br />
                })<br />
        body mbox args |> Async.Start<br />
        mbox<br />
    member self.Name = name<br />
    member self.CreateInNewDomain(args) = create(args)<br />
and Agent = MailboxProcessor<agentmsg><br />
let (?< -) (m: Agent) x y = m.Post <| Post(x,y)<br />
let(?) (m: Agent) x = m.PostAndAsyncReply(fun r -> Receive(x, r))<br />
let agent name () chans body = AgentType(name, chans, body)<br />
// Samples<br />
let Foo =<br />
    channel &#8220;Foo&#8221; [<br />
        port "bar";<br />
        port "baz";<br />
    ]<br />
let FooBar =<br />
    agent &#8220;FooBar&#8221; extends [Foo] (fun self () -> async {<br />
            while true do<br />
                let! msg = self?bar<br />
                printfn &#8220;bar: %O&#8221; msg<br />
                let! msg = self?baz<br />
                printfn &#8220;baz: %O&#8221; msg<br />
        }<br />
    )<br />
let x = FooBar.CreateInNewDomain()<br />
x?bar < - 3<br />
x?baz <- "Hello"<br />
System.Console.ReadLine() |> ignore</agentmsg></obj></unit></channel></obj></string></p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/matthewpodwysocki/2009/09/25/pondering-axum-f/ ';
	var disqus_identifier = '171 /blogs/matthew.podwysocki/archive/2009/09/25/pondering-axum-f.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'matthewpodwysocki';
	var disqus_title = "Pondering Axum + F#";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=171');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/matthewpodwysocki/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2009\/09\/25\/pondering-axum-f\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.824 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-25 15:16:08 -->
<!-- super cache -->