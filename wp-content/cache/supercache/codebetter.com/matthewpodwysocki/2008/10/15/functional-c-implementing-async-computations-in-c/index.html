<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Functional C# &#8211; Implementing Async Computations in C# | Matthew Podwysocki</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/matthewpodwysocki/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/matthewpodwysocki/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/matthewpodwysocki/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/matthewpodwysocki/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Matthew Podwysocki' href='http://codebetter.com/matthewpodwysocki/' />
<link rel='start' title='let Matt = CodeBetter + 1' href='http://codebetter.com/matthewpodwysocki/2008/04/24/let-matt-codebetter-1/' />
<link rel='prev' title='Functional .NET &#8211; LINQ or Language Integrated Monads?' href='http://codebetter.com/matthewpodwysocki/2008/10/13/functional-c-linq-as-a-monad/' />
<link rel='next' title='Functional .NET &#8211; Fighting Friction in the BCL with Directory.GetFiles' href='http://codebetter.com/matthewpodwysocki/2008/10/16/functional-net-fighting-friction-in-the-bcl-with-directory-getfiles/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/matthewpodwysocki/2008/10/15/functional-c-implementing-async-computations-in-c/' />
<link rel='shortlink' href='http://codebetter.com/matthewpodwysocki/?p=70' />
<link rel="stylesheet" href="http://codebetter.com/matthewpodwysocki/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/matthewpodwysocki/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/matthewpodwysocki/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-70" class="post-70 post type-post status-publish format-standard hentry category-c category-concurrency category-f category-functional-programming">
					<h1 class="entry-title">Functional C# &#8211; Implementing Async Computations in C#</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/matthewpodwysocki/author/matthewpodwysocki/" title="View all posts by matthewpodwysocki">matthewpodwysocki</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/matthewpodwysocki/2008/10/15/functional-c-implementing-async-computations-in-c/" title="10:53 pm" rel="bookmark"><span class="entry-date">October 15, 2008</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/matthewpodwysocki/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/matthewpodwysocki/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/matthewpodwysocki/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p><strong>Update: Removed Internal Constructor constraint on AsyncBuilder.</strong></p>
<p>As I covered earlier in my post <a href="http://codebetter.com/blogs/matthew.podwysocki/archive/2008/10/13/functional-c-linq-as-a-monad.aspx">Functional .NET &#8211; LINQ or Language Integrated Monads</a>, I talked about using asynchronous computation expressions (monads) from C# 3.0.&#160; <a href="http://lorgonblog.spaces.live.com/">Brian McNamara</a>, of the F# team, posted back in May about <a href="http://lorgonblog.spaces.live.com/Blog/cns!701679AD17B6D310!208.entry">using them from C</a>#.&#160; But since then, things have changed slightly.&#160; Before, I showed a basic example of how to utilize the F# libraries from C#, but let&#8217;s go deep under the covers to see how this actually works.</p>
<p>&#160;</p>
<h2>Getting Started</h2>
<p>In order to make use of the F# libraries in our C# library, we need to add references to them.&#160; We need the following items:</p>
<ul>
<li>FSharp.Core.dll </li>
<li>FSharp.PowerPack.dll </li>
<li>FSharp.PowerPack.Linq.dll </li>
</ul>
<p>And then I need to open the namespaces in order to take advantage of F#:</p>
<div style="font-family: courier new"><span style="color: blue">using</span> Microsoft.FSharp;     <br /><span style="color: blue">using</span> Microsoft.FSharp.Control;     <br /><span style="color: blue">using</span> Microsoft.FSharp.Core;</div>
<div style="font-family: courier new">&#160;</div>
<h2>Referencing F# Classes</h2>
<p>As part of process of creating the asynchronous monad builders in C#, we need to create an instance of the F# class AsyncBuilder in the Microsoft.FSharp.Control namespace.&#160; We can get a reference to this from the Pervasives class, through the async property.&#160; This is a static reference which is available to all.</p>
<div style="font-family: courier new"><span style="color: blue">static</span>&#160;<span style="color: blue">class</span> AsyncExtensions&#160; <br />{&#160; <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> AsyncBuilder async = Pervasives.async;     <br />&#8230;</div>
<p>&#160;</p>
<p>Now that we have this, we have to realize that F# doesn&#8217;t use the standard .NET delegates for functions.&#160; Let&#8217;s walk through some ways of converting back and forth.</p>
<p>&#160;</p>
<h2>Converting Functions</h2>
<p>As we&#8217;ve noted before, F# does not use the standard Func and Action delegates that are commonly used in C# and VB.NET.&#160; Instead, the functions in F# use the FastFunc class.&#160; This allows for the F# compiler to better optimize the closures, especially due to the fact that these closures are quite commonly used.&#160; Another point of difference is that there is no distinction between Func and Action delegates, and instead, for functions that return no value have the return type of Unit.&#160; This is the optimal way of handling this, due to the fact that Void is not treated as a real type, which you&#8217;ve heard me complain about in the past.</p>
<p>In order to convert from the Func delegate to the FastFunc, we use the FuncConvertExtensions class in the FSharp.PowerPack.Linq.dll assembly.&#160; Then we can create extension methods on our Func delegates to expose the conversion methods.&#160; The conversion methods should look like this.</p>
<div style="font-family: courier new"><span style="color: blue">static</span>&#160;<span style="color: blue">class</span> AsyncExtensions     <br />{     <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> FastFunc&lt;Tuple&lt;A, B&gt;, C&gt; ToTupledFastFunc&lt;A, B, C&gt;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">this</span> Func&lt;A, B, C&gt; f)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> FuncConvertExtensions.ToTupledFastFunc(f);     <br />&#160;&#160;&#160; }     <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> FastFunc&lt;Tuple&lt;A, B, C&gt;, D&gt; ToTupledFastFunc&lt;A, B, C, D&gt;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">this</span> Func&lt;A, B, C, D&gt; f)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> FuncConvertExtensions.ToTupledFastFunc(f);     <br />&#160;&#160;&#160; }&#160; </p>
<p>&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> FastFunc&lt;A, B&gt; ToFastFunc&lt;A, B&gt;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">this</span> Func&lt;A, B&gt; f)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> FuncConvertExtensions.ToFastFunc(f);     <br />&#160;&#160;&#160; }</div>
<div style="font-family: courier new">&#8230;</div>
<div style="font-family: courier new">&#160;</div>
<p>Now that the conversions have been put in place, we can turn our attention to creating the extension methods required for LINQ expressions.&#160; </p>
<p>&#160;</p>
<h2>Adding LINQ Extension Methods</h2>
<p>In order for LINQ to bind and return data, the SelectMany and Select methods must be implemented.&#160; We need to implement these methods to return an Async&lt;T&gt; class for binding and returning purposes.&#160; As part of the implementation, we need to ensure our Func delegates are converted to the proper FastFunc types.</p>
<div style="font-family: courier new"><span style="color: blue">static</span>&#160;<span style="color: blue">class</span> AsyncExtensions     <br />{     <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;B&gt; Select&lt;A, B&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span> Async&lt;A&gt; x, Func&lt;A, B&gt; selector)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> async.Bind(x,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; ToFastFunc&lt;A, Async&lt;B&gt;&gt;((r) =&gt; async.Return(selector(r))));     <br />&#160;&#160;&#160; }     </p>
<p>&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;V&gt; SelectMany&lt;T, U, V&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">this</span> Async&lt;T&gt; p, Func&lt;T, Async&lt;U&gt;&gt; selector, Func&lt;T, U, V&gt; projector)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> async.Bind(p, ToFastFunc&lt;T, Async&lt;V&gt;&gt;(r1 =&gt;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; async.Bind(selector(r1), ToFastFunc&lt;U, Async&lt;V&gt;&gt;(r2 =&gt;     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; async.Return(projector(r1, r2))))));     <br />&#160;&#160;&#160; }</div>
<div style="font-family: courier new">&#8230;</div>
<div style="font-family: courier new">&#160;</div>
<p>Once the LINQ methods are added, we can turn our attention on how we might actually implement the asynchronous behavior with our given classes.&#160; </p>
<p>&#160;</p>
<h2>Adding Extensions Building Primitives</h2>
<p>In order for your classes to use the asynchronous behavior, we need to expose ways of building primitives so that we can enlist those methods that expose the Beginxxx and Endxxx signature which includes the IAsyncResult.&#160; Also, in order to support method calls that do not, we have the ability within the asynchronous computation expressions to unblock via a new thread.</p>
<p>First, we need to define the method which allows us to do non-blocking calls on methods that do not support the Begin/End pattern.&#160; In order for this to happen, we need to call an internal method to the FileExtensions class in the FSharp.PowerPack.dll assembly called UnblockViaNewThread.&#160; Due to the fact that it is a generic method, we have to do special binding using reflection.&#160;&#160;&#160; Once this has been created, we can now enlist functions that follow the Func&lt;Res&gt; signature.</p>
<p>Second, we need to define methods to build primitives to allow for methods that follow the Begin/End pattern using the IAsyncResult and AsyncCallback delegate.&#160; Overloads are necessary due to the fact that methods may have return types or not.&#160; Examples of this pattern are Stream.BeginRead, Stream.BeginWrite and so on.</p>
<p>Lastly, we need the ability to start the asynchronous computation expression.&#160; This must be the first statement in any asynchronous computation expression that we write.&#160; Let&#8217;s look at how the code is implemented.</p>
<div style="font-family: courier new"><span style="color: blue">static</span>&#160;<span style="color: blue">class</span> AsyncExtensions     <br />{     <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;T&gt; UnblockViaNewThread&lt;T&gt;(FastFunc&lt;Unit, T&gt; f)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#0000ff">var</font> type = <span style="color: blue">typeof</span>(FileExtensions);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#0000ff">var</font> methodInfo = type.GetMethod(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;UnblockViaNewThread&quot;</span>, BindingFlags.NonPublic | BindingFlags.Static);     </p>
<p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#0000ff">var</font> genericArguments = <span style="color: blue">new</span>[] { <span style="color: blue">typeof</span>(T) };     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#0000ff">var</font> genericMethodInfo = methodInfo.MakeGenericMethod(genericArguments);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> genericMethodInfo.Invoke(<span style="color: blue">null</span>, <span style="color: blue">new</span>[] { f }) <span style="color: blue">as</span> Async&lt;T&gt;;     <br />&#160;&#160;&#160; }     </p>
<p>&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;Unit&gt; BuildVoidPrimitive(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;AsyncCallback, <span style="color: blue">object</span>, IAsyncResult&gt; begin,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Action&lt;IAsyncResult&gt; end)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> Async.BuildPrimitive(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; begin.ToTupledFastFunc(), FuncConvert.ToFastFunc(end));     <br />&#160;&#160;&#160; }     </p>
<p>&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;R&gt; BuildPrimitive&lt;R&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;AsyncCallback, <span style="color: blue">object</span>, IAsyncResult&gt; begin,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;IAsyncResult, R&gt; end)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> Async.BuildPrimitive(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; begin.ToTupledFastFunc(), end.ToFastFunc());     <br />&#160;&#160;&#160; }     <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;R&gt; BuildPrimitive&lt;Arg, R&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Arg a,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;Arg, AsyncCallback, <span style="color: blue">object</span>, IAsyncResult&gt; begin,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;IAsyncResult, R&gt; end)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> Async.BuildPrimitive(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; a, begin.ToTupledFastFunc(), end.ToFastFunc());     <br />&#160;&#160;&#160; }&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;<span style="color: blue">int</span>&gt; StartWorkflow = async.Return(<span style="color: maroon">0</span>);</div>
<div style="font-family: courier new">&#8230;</div>
<p>&#160; <br />Now that we have the ability to add asynchronous behavior to our classes, let&#8217;s implement some extension methods that encompass the behavior.</p>
<p>&#160;</p>
<h2>Extending Types With The Begin/End Pattern</h2>
<p>For methods that have the standard Begin/End methods can use the BuildPrimitive methods that we defined above.&#160; As our first example, let&#8217;s implement an asynchronous WebRequest.GetResponse.&#160; Normally in our .NET code, we have to implement the Begin/End ourselves.&#160; Instead, we pass the methods to the BuildPrimitive method to bind.</p>
<div style="font-family: courier new"><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">class</span> WebExtensions     <br />{&#160; <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;WebResponse&gt; AsyncGetResponse     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; (<span style="color: blue">this</span> WebRequest request)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> AsyncExtensions.BuildPrimitive&lt;WebResponse&gt;(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; request.BeginGetResponse, request.EndGetResponse);     <br />&#160;&#160;&#160; }     <br />}</div>
<div style="font-family: courier new">&#160;</div>
<p>Any method signature that follows this pattern should be able to partake.&#160; Now what about those methods that do not follow the Begin/End pattern.&#160; What can we do about those?</p>
<p>&#160;</p>
<h2>Extending Types with Non-Blocking Threads</h2>
<p>As I mentioned previously, I want the ability to perform asynchronous operations on those methods that do not follow the Begin/End pattern.&#160; In order to do that, I must use the UnblockViaNewThread method that was defined above.&#160; For example, we could expose the ability to open files asynchronously as either readers or streams.&#160; Let&#8217;s define some methods to open files asynchronously.</p>
<div style="font-family: courier new"><span style="color: blue">public</span>&#160;<span style="color: blue">static</span>&#160;<span style="color: blue">class</span> FileSystem     <br />{     <br />&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;FileStream&gt; AsyncOpen(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">string</span> path, FileMode mode, FileAccess access, FileShare share)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;FileStream&gt; f = () =&gt;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; File.Open(path, mode, access, share);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> AsyncExtensions.UnblockViaNewThread(FuncConvertExtensions.ToFastFunc(f));     <br />&#160;&#160;&#160; }     </p>
<p>&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;FileStream&gt; AsyncOpenRead(<span style="color: blue">string</span> path)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;FileStream&gt; f = () =&gt; File.OpenRead(path);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> AsyncExtensions.UnblockViaNewThread(FuncConvertExtensions.ToFastFunc(f));     <br />&#160;&#160;&#160; }     </p>
<p>&#160;&#160;&#160; <span style="color: blue">public</span>&#160;<span style="color: blue">static</span> Async&lt;StreamReader&gt; AsyncOpenText(<span style="color: blue">string</span> path)     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Func&lt;StreamReader&gt; f = () =&gt; File.OpenText(path);     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span> AsyncExtensions.UnblockViaNewThread(FuncConvertExtensions.ToFastFunc(f));     <br />&#160;&#160;&#160; }     <br />}</div>
<div style="font-family: courier new">&#8230;</div>
<div style="font-family: courier new">&#160;</div>
<p>This pattern would also apply to such things as WebRequest.Create and so on.&#160; Now, let&#8217;s bring it all together. </p>
<p>&#160;</p>
<h2>Bringing It All Together</h2>
<p> Now that we have defined the extension methods and other asynchronous methods, let&#8217;s tie it all back together.&#160; First, let&#8217;s look at a quick example of an asynchronous computation expression that will retrieve the number of hyperlinks from a web page.
<div style="font-family: courier new"><span style="color: blue"></span></div>
<div style="font-family: courier new"><span style="color: blue">#light</span>     </p>
<p><span style="color: blue">open</span> System<span style="color: blue">.</span>IO     <br /><span style="color: blue">open</span> System<span style="color: blue">.</span>Net     <br /><span style="color: blue">open</span> System<span style="color: blue">.</span>Text<span style="color: blue">.</span>RegularExpressions     </p>
<p><span style="color: blue">let</span> get_links html =&#160; <br />&#160; <span style="color: blue">let</span> linkRegex = <span style="color: blue">new</span> Regex<span style="color: blue">(</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;&lt;a\s{1}href=\&quot;&quot;(?&lt;url&gt;.*?)\&quot;&quot;(\s?target=\&quot;&quot;&quot;</span> +     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;(?&lt;target&gt;_(blank|new|parent|self|top))\&quot;&quot;)?&quot;</span> +     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;(\s?class=\&quot;&quot;(?&lt;class&gt;.*?)\&quot;&quot;)?(\s?style=\&quot;&quot;&quot;</span> +     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;(?&lt;style&gt;.*?)\&quot;&quot;)?&gt;(?&lt;title&gt;.*?)&lt;/a&gt;&quot;</span><span style="color: blue">)</span>;     <br />&#160; linkRegex<span style="color: blue">.</span>Matches<span style="color: blue">(</span>html<span style="color: blue">)</span>&#160;<span style="color: blue">|</span>&gt; Seq<span style="color: blue">.</span>cast&lt;Match&gt;     </p>
<p><span style="color: blue">let</span> links_async <span style="color: blue">(</span>requestUriString<span style="color: blue">:</span><span style="color: blue">string</span><span style="color: blue">)</span> =&#160; <br />&#160; async <span style="color: blue">{</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">let</span> request = WebRequest<span style="color: blue">.</span>Create<span style="color: blue">(</span>requestUriString<span style="color: blue">)</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">let</span>! response = request<span style="color: blue">.</span>AsyncGetResponse<span style="color: blue">(</span><span style="color: blue">)</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">let</span> reader = <span style="color: blue">new</span> StreamReader<span style="color: blue">(</span>response<span style="color: blue">.</span>GetResponseStream<span style="color: blue">(</span><span style="color: blue">)</span><span style="color: blue">)</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">let</span>! html = reader<span style="color: blue">.</span>AsyncReadToEnd<span style="color: blue">(</span><span style="color: blue">)</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">let</span> links = get_links html     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <font color="#0000ff">return</font> requestUriString, links <span style="color: blue">|</span>&gt; Seq<span style="color: blue">.</span>length&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">}</span>     </p>
<p><span style="color: blue">let</span> sites = <span style="color: blue">[</span><span style="color: maroon">&quot;http://live.com/&quot;</span>;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;http://www.google.com/&quot;</span>;&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;http://codebetter.com/&quot;</span><span style="color: blue">]</span>     <br /><span style="color: blue">let</span> results = Async<span style="color: blue">.</span>Run<span style="color: blue">(</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Async<span style="color: blue">.</span>Parallel <span style="color: blue">[</span><span style="color: blue">for</span> site <span style="color: blue">in</span> sites <span style="color: blue">-&gt;</span> links_async site<span style="color: blue">]</span><span style="color: blue">)</span>     <br />results <span style="color: blue">|</span>&gt; Seq<span style="color: blue">.</span>iter<span style="color: blue">(</span>     <br />&#160; <span style="color: blue">fun</span> result <span style="color: blue">-&gt;</span> printfn <span style="color: maroon">&quot;Site %s has %d links&quot;</span>&#160;<span style="color: blue">(</span>fst result<span style="color: blue">)</span>&#160;<span style="color: blue">(</span>snd result<span style="color: blue">)</span><span style="color: blue">)</span></div>
<div style="font-family: courier new"><span style="color: blue"></span></div>
<p>What the above code does for me is allows me to count the number of hyperlinks, given a URL, in parallel.&#160; This is a pretty simplistic example, yet works quite well for this demonstration.&#160; Now, using our C# implementation, let&#8217;s take the above code and get it to work in C#.</p>
<div style="font-family: courier new">Func&lt;<span style="color: blue">string</span>, IEnumerable&lt;Match&gt;&gt; get_links = html =&gt;     <br />{     <br />&#160;&#160;&#160; <font color="#0000ff">var</font> linkRegex = <span style="color: blue">new</span> Regex(     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;&lt;a\s{1}href=\&quot;&quot;(?&lt;url&gt;.*?)\&quot;&quot;(\s?target=\&quot;&quot;&quot;</span> +     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;(?&lt;target&gt;_(blank|new|parent|self|top))\&quot;&quot;)?&quot;</span> +     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;(\s?class=\&quot;&quot;(?&lt;class&gt;.*?)\&quot;&quot;)?(\s?style=\&quot;&quot;&quot;</span> +     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">@&quot;(?&lt;style&gt;.*?)\&quot;&quot;)?&gt;(?&lt;title&gt;.*?)&lt;/a&gt;&quot;</span>);     <br />&#160;&#160;&#160; <span style="color: blue">return</span> linkRegex.Matches(html).Cast&lt;Match&gt;();     <br />};     </p>
<p>Func&lt;<span style="color: blue">string</span>, Async&lt;Tuple&lt;<span style="color: blue">string</span>, <span style="color: blue">int</span>&gt;&gt;&gt; links_async = requestUriString =&gt;     <br />&#160;&#160;&#160; <font color="#0000ff">from</font> _ <span style="color: blue">in</span> AsyncExtensions.StartWorkflow     <br />&#160;&#160;&#160; <font color="#0000ff">let</font> request = WebRequest.Create(requestUriString)     <br />&#160;&#160;&#160; <font color="#0000ff">from</font> response <span style="color: blue">in</span> request.AsyncGetResponse()     <br />&#160;&#160;&#160; <font color="#0000ff">let</font> reader = <span style="color: blue">new</span> StreamReader(response.GetResponseStream())     <br />&#160;&#160;&#160; <font color="#0000ff">from</font> html <span style="color: blue">in</span> reader.AsyncReadToEnd()     <br />&#160;&#160;&#160; <font color="#0000ff">let</font> links = get_links(html)     <br />&#160;&#160;&#160; <font color="#0000ff">select</font> <span style="color: blue">new</span> Tuple&lt;<span style="color: blue">string</span>, <span style="color: blue">int</span>&gt;(requestUriString, links.Count());     </p>
<p><font color="#0000ff">var</font> sites = <span style="color: blue">new</span>[]     <br />&#160;&#160;&#160; {     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;http://live.com/&quot;</span>,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;http://www.google.com/&quot;</span>,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: maroon">&quot;http://codebetter.com/&quot;</span>     <br />&#160;&#160;&#160; };     <br /><font color="#0000ff">var</font> results = Async.Run(     <br />&#160;&#160;&#160; Async.Parallel(from site <span style="color: blue">in</span> sites select links_async(site)),&#160; <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Option&lt;<span style="color: blue">int</span>&gt;.None,     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160; Option&lt;<span style="color: blue">bool</span>&gt;.None);     <br /><span style="color: blue">foreach</span> (<font color="#0000ff">var</font> result <span style="color: blue">in</span> results)&#160; <br />&#160;&#160;&#160; Console.WriteLine(<span style="color: maroon">&quot;Site {0} has {1} links&quot;</span>, result.Item1, result.Item2);</div>
<div style="font-family: courier new">&#160;</div>
<p>For each of the above, we get the following result:</p>
<p><a href="http://codebetter.com/blogs/matthew.podwysocki/WindowsLiveWriter/FunctionalCImplementingAsyncComputations_10F46/get_links_2.png"><img style="border-right-width: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px" border="0" alt="get_links" src="http://codebetter.com/blogs/matthew.podwysocki/WindowsLiveWriter/FunctionalCImplementingAsyncComputations_10F46/get_links_thumb.png" width="567" height="283" /></a> </p>
<p>Well, that works exactly according to plan.&#160; But, using this technique, are there any downsides?</p>
<p>&#160;</p>
<h2>Downsides?</h2>
<p>The asynchronous code I wrote above is pretty simple and naive.&#160; Counting links in an HTML page is a pretty simple example with some asynchronous calls.&#160; But, this breaks down easily if it gets more complex than this.&#160; There are constructs that can be done in the asynchronous computation expressions in F# that cannot be done through LINQ.&#160; For example, there are several things that cannot be done through LINQ expressions such as the following:</p>
<ul>
<li>if/then/else </li>
<li>while loops </li>
<li>try/catch/finally </li>
<li>methods that return void </li>
</ul>
<p>These above constructs don&#8217;t have a 1 to 1 mapping with LINQ.&#160; As a result, our code may have to look significantly different than the F# code that we&#8217;d write.&#160; That of course eliminates some of the savings we may have had with our LINQ implementation.&#160; </p>
<div style="font-family: courier new"><span style="color: blue">#light</span>     </p>
<p><span style="color: blue">open</span> Microsoft<span style="color: blue">.</span>FSharp<span style="color: blue">.</span>Control     </p>
<p><span style="color: blue">let</span> agent = MailboxProcessor<span style="color: blue">.</span>Start<span style="color: blue">(</span><span style="color: blue">fun</span> inbox <span style="color: blue">-&gt;</span>     <br />&#160; <span style="color: blue">let</span>&#160;<span style="color: blue">rec</span> loop n =     <br />&#160;&#160;&#160; async <span style="color: blue">{</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">do</span> printfn <span style="color: maroon">&quot;n = %d&quot;</span> n     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">let</span>! message = inbox<span style="color: blue">.</span>Receive<span style="color: blue">(</span><span style="color: blue">)</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">if</span> n % <span style="color: maroon">2</span> = <span style="color: maroon">0</span>&#160;<span style="color: blue">then</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">do</span> printfn <span style="color: maroon">&quot;message %d is an even number&quot;</span> message     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">else</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">do</span> printfn <span style="color: maroon">&quot;message %d is an odd number&quot;</span> message     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">return</span>! loop<span style="color: blue">(</span>n + message<span style="color: blue">)</span>     <br />&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span style="color: blue">}</span>     <br />&#160; loop <span style="color: maroon">0</span><span style="color: blue">)</span></div>
<div style="font-family: courier new"><span style="color: blue"></span></div>
<p>As you see, when combined with such things as the MailboxProcessor, the asynchronous computation expressions become a bit more powerful.&#160; Unfortunately, LINQ doesn&#8217;t support these features of conditionals, using statements and so on.&#160; The alternative being, using the awkward syntax with converting between FastFunc and Func delegates, which negates any savings we may have had.</p>
<p>&#160;</p>
<h2>Wrapping It Up</h2>
<p>As I&#8217;ve shown in the past posts, LINQ expressions could be used to your advantage to do more than just standard query operations.&#160; Instead, if we start to think of them as very powerful monadic constructs, we can then think of better uses for them.&#160; Although the LINQ expressions are limited in what they can achieve through the asynchronous computation expressions, it still gets you quite far.&#160; I hope this exploration gets you to understand languages such as Haskell and how monads are useful.&#160; For further information, you should check out <a href="http://lambda-the-ultimate.org/node/1276">&quot;What is a monad, why should I use it and when it is appropriate&quot;</a> on Lambda the Ultimate.</p>
<p>The code from this post is available, as always from the <a href="http://code.msdn.microsoft.com/FunctionalCSharp">Functional C# Library</a> on MSDN Code Gallery.</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/matthewpodwysocki/category/c/" title="View all posts in C#" rel="category tag">C#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/concurrency/" title="View all posts in Concurrency" rel="category tag">Concurrency</a>, <a href="http://codebetter.com/matthewpodwysocki/category/f/" title="View all posts in F#" rel="category tag">F#</a>, <a href="http://codebetter.com/matthewpodwysocki/category/functional-programming/" title="View all posts in Functional Programming" rel="category tag">Functional Programming</a>. Bookmark the <a href="http://codebetter.com/matthewpodwysocki/2008/10/15/functional-c-implementing-async-computations-in-c/" title="Permalink to Functional C# &#8211; Implementing Async Computations in C#" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/matthewpodwysocki/2008/10/15/functional-c-implementing-async-computations-in-c/feed/" title="Comments RSS to Functional C# &#8211; Implementing Async Computations in C#" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-70 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/matthewpodwysocki/2008/10/13/functional-c-linq-as-a-monad/" rel="prev"><span class="meta-nav">&larr;</span> Functional .NET &#8211; LINQ or Language Integrated Monads?</a></div>
					<div class="nav-next"><a href="http://codebetter.com/matthewpodwysocki/2008/10/16/functional-net-fighting-friction-in-the-bcl-with-directory-getfiles/" rel="next">Functional .NET &#8211; Fighting Friction in the BCL with Directory.GetFiles <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-155">
					<div id="dsq-comment-header-155" class="dsq-comment-header">
						<cite id="dsq-cite-155">
	http://toninio.com							<span id="dsq-author-user-155">Anton Andreev</span>
							</cite>
					</div>
					<div id="dsq-comment-body-155" class="dsq-comment-body">
						<div id="dsq-comment-message-155" class="dsq-comment-message"><p>Hi,</p>
<p>I &#8216;ve just made a Google code project and added some samples that I made to work:<br />
<a href="http://code.google.com/p/fsharpdemos/" rel="nofollow">http://code.google.com/p/fsharpdemos/</a><br />
Everyone is welcome to contribute.</p>
<p>Cheers,<br />
Anton</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/matthewpodwysocki/2008/10/15/functional-c-implementing-async-computations-in-c/ ';
	var disqus_identifier = '70 /blogs/matthew.podwysocki/archive/2008/10/15/functional-c-implementing-async-computations-in-c.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'matthewpodwysocki';
	var disqus_title = "Functional C# &#8211; Implementing Async Computations in C#";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=70');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/matthewpodwysocki/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/matthewpodwysocki\/2008\/10\/15\/functional-c-implementing-async-computations-in-c\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.274 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-25 15:04:11 -->
<!-- super cache -->