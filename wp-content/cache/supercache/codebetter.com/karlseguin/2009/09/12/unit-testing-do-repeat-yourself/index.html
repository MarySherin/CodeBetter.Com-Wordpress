<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Unit Testing &#8211; Do Repeat Yourself | Karl Seguin</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/karlseguin/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/karlseguin/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/karlseguin/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/karlseguin/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/karlseguin/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Karl Seguin' href='http://codebetter.com/karlseguin/' />
<link rel='start' title='Expecting More From Development Companies' href='http://codebetter.com/karlseguin/2006/03/24/expecting-more-from-development-companies/' />
<link rel='prev' title='Canvas gets a Spark' href='http://codebetter.com/karlseguin/2009/09/01/canvas-gets-a-spark/' />
<link rel='next' title='Time for a New Computer' href='http://codebetter.com/karlseguin/2009/10/18/time-for-a-new-computer/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/' />
<link rel='shortlink' href='http://codebetter.com/karlseguin/?p=184' />
<link rel="stylesheet" href="http://codebetter.com/karlseguin/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/karlseguin/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-184" class="post-184 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">Unit Testing &#8211; Do Repeat Yourself</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/karlseguin/author/karlseguin/" title="View all posts by karlseguin">karlseguin</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/" title="8:34 pm" rel="bookmark"><span class="entry-date">September 12, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/karlseguin/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/karlseguin/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/karlseguin/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>Writing effective unit tests is as much about the test itself as it is about the code under test. All the experience in the world isn&#8217;t going to help you write clean and meaningful tests against highly coupled code. Conversely, complex and messy unit tests don&#8217;t add any value even if the code under test is perfectly designed. Ultimately, the secret is practice &#8211; the more tests you write, the better you are at it, and the cleaner your code becomes as a consequence.</p>
<p>One thing that I&#8217;ve noticed though is that one of the fundamental practices for maintainable code can actually be counter-productive when applied to unit tests: <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> (Don&#8217;t Repeat Yourself). Outside of unit tests, DRY simply makes sense &#8211; it reduces the amount of code you have, generally increased readability, and makes maintenance considerably easier. As a developer you have a ton of choices to ensure code isn&#8217;t repeated &#8211; from your typical OO paradigms (i.e. inheritance) to a slew of refactoring options, and even some language-specific features like extension methods .</p>
<p>However, when applied irresponsibly to unit tests, DRY can very likely make your tests brittle &#8211; brittle tests are what lead to developers complaining of &#8220;spending more time maintaining and fixing our tests than anything else.&#8221; Let&#8217;s look at a modified example from the <a href="/blogs/karlseguin/archive/2009/09/01/canvas-gets-a-spark.aspx">CodeBetter.Canvas</a> project. Our <code>UserBinder</code> class is responsible for binding both the new users and existing users, it looks something like:</p>
<pre>public override User BindNew()
{
    var user = BindBase(new User());
    user.Credentials.Password = _encryptor.Encrypt(Get("Credentials.Password"));
    return user;
}

public override User BindExisting(User user)
{
    BindBase(user)
    var password = Get("Credentials.Password");
    if (!string.IsNullOrEmpty(password))
    {
        user.Credentials.Password = _encryptor.Encrypt(password);
    }
}

private User BindBase(User user)
{
    user.Name = Get("Name");
    user.Credentials.Email = Get("Credentials.Email");
    return user;
}</pre>
<p>In order to avoid some repetition, the <code>BindBase</code> method is used to bind all the properties shared when binding new users and existing ones &#8211; a simple but effective <a href="http://www.refactoring.com/catalog/extractMethod.html">Extract Method</a> was used. So, let&#8217;s write the unit tests for the <code>BindNew</code> Method:</p>
<pre>public class BindNewUserTests : BaseFixture
{
    [Fact]
    public void BindsBaseProperties()
    {
        var encryptor = Dynamic&lt;IEncryptor&gt;();
        var parameters = new NameValueCollection{ {"Name", "Giru"}, {"Credentials.Email", "giru@playa.cool"},  {"Credentials.Password", ""}, };
        var binder = new UserBinder(encryptor);
        SetField(binder, "_parameters", parameters); //ack that's ugly!!

        encryptor.Stub(e =&gt; e.Encrypt(null)).IgnoreParameters().Return(null);
        encryptor.Replay();        

        var user = binder.BindNew();
        Assert.Equal("Giru", user.Name);
        Assert.Equal("giru@playa.cool", user.Credentials.Email);
    }
    [Fact]
    public void BindsEncryptedPassword()
    {
        var encryptor = Dynamic&lt;IEncryptor&gt;();
        var parameters = new NameValueCollection{ {"Name", "Giru"}, {"Credentials.Email", "giru@playa.cool"},  {"Credentials.Password", "plain text"}, };
        var binder = new UserBinder(encryptor);
        SetField(binder, "_parameters", parameters); //ack that's ugly!!

        encryptor.Expect(e =&gt; e.Encrypt("plain text")).Return("encrypted");
        encryptor.Replay();        

        var user = binder.BindNew();
        Assert.Equal("encrypted", user.Credentials.Password);
        encryptor.VerifyAllExpectations();
    }
}</pre>
<p>So there&#8217;s a bit of ugliness, but overall those are two decent tests. Now what about tests for the <code>BindExisting</code> method? We know we need to handle the special password handling (if it&#8217;s blank, that means it wasn&#8217;t changed, so we don&#8217;t overwrite it):</p>
<pre>public class BindExistingUserTests : BaseFixture
{
    [Fact]
    public void LeavesPasswordAsIsIfNotSet()
    {
        var original = new User{Password = "the originator" };
        var parameters = new NameValueCollection{ {"Name", "Giru"}, {"Credentials.Email", "giru@playa.cool"},  {"Credentials.Password", string.Empty}, };
        var binder = new UserBinder(null);
        SetField(binder, "_parameters", parameters); //ack that's ugly!!

         binder.BindExisting(original);
         Assert.Equal("the originator", original.Credentials.Password);
    }
    [Fact]
    public void EncryptsTheNewPassword()
    {
        var encryptor = Dynamic&lt;IEncryptor&gt;();
        var original = new User{Password = "the originator" };
        var parameters = new NameValueCollection{ {"Name", "Giru"}, {"Credentials.Email", "giru@playa.cool"},  {"Credentials.Password", "new password"}, };
        var binder = new UserBinder(encryptor);
        SetField(binder, "_parameters", parameters); //ack that's ugly!!

        encryptor.Expect(e =&gt; e.Encrypt("new passwordt")).Return("newly encrypted");
        encryptor.Replay();        

         binder.BindExisting(original);
        Assert.Equal("newly encrypted", original.Credentials.Password);
        encryptor.VerifyAllExpectations();
    }
}
</pre>
<p>So far so good, but what about a test to verify that Name and Email are also properly bound? Your first instinct may be to skip it, since you know, from the tests against <code>BindNew</code> that everything works as expected. You may also consider mocking the <code>BindBase</code> call. Neither of these are good choices. Fundamentally, your test should be written in a way that&#8217;s independent of the implementation (in large part because the implementation could change, resulting in a broken test). This means that you should effectively repeat your test:</p>
<pre>    [Fact]
    public void BindsBaseProperties()
    {
        var original = new User();
        var parameters = new NameValueCollection{ {"Name", "Giru"}, {"Credentials.Email", "giru@playa.cool"},  {"Credentials.Password", ""}, };
        var binder = new UserBinder(null);
        SetField(binder, "_parameters", parameters); //ack that's ugly!!

        binder.BindExisting(original);
        Assert.Equal("Giru", original.Name);
        Assert.Equal("giru@playa.cool", original.Credentials.Email);
    }</pre>
<p>The benefit is that if the implementation of <code>BindExisting</code> changes, our test will catch it. On the flip side, if <code>BindBase</code> changes, two tests will break. You can mitigate against this by extracting some of the logic, for example:</p>
<pre>    [Fact]
    public void BindsBaseProperties()
    {
        var original = new User();
        var parameters = new NameValueCollection{ {"Name", "Giru"}, {"Credentials.Email", "giru@playa.cool"},  {"Credentials.Password", ""}, };
        var binder = new UserBinder(null);
        SetField(binder, "_parameters", parameters); //ack that's ugly!!

        binder.BindExisting(original);
        AssertBase(original, "Giru", "giru@playa.cool");
    }

    private static void AssertBase(User user, string name, string email)
    {
        Assert.Equal(name, user.Name);
        Assert.Equal(email, user.Credentials.Email);
    }</pre>
<p>But that won&#8217;t always be practical, and greatly decreases your tests readability.</p>
<p>There&#8217;s two points to all of this. First and most importantly, your unit tests shouldn&#8217;t know or be written in a way that relies on a specific internal implementation &#8211; else you <b>will</b> spend more time fixing your tests than anything else. This is the same reason why you shouldn&#8217;t test private methods &#8211; because tests against public methods should adequately cover them.  Secondly the goals of unit testing is different enough from system code that common principles should often be reconsidered. If your test is brittle or hard to read, find an alternative!</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/karlseguin/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/" title="Permalink to Unit Testing &#8211; Do Repeat Yourself" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/feed/" title="Comments RSS to Unit Testing &#8211; Do Repeat Yourself" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-184 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/karlseguin/2009/09/01/canvas-gets-a-spark/" rel="prev"><span class="meta-nav">&larr;</span> Canvas gets a Spark</a></div>
					<div class="nav-next"><a href="http://codebetter.com/karlseguin/2009/10/18/time-for-a-new-computer/" rel="next">Time for a New Computer <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

							<div id="comments">


			<h3 id="comments-title">9 Responses to <em>Unit Testing &#8211; Do Repeat Yourself</em> </h3>


			<ol class="commentlist">
						<li class="comment even thread-even depth-1" id="li-comment-2044">
		<div id="comment-2044">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://jamespeckham.com' rel='external nofollow' class='url'>James Peckham</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2044">September 29, 2009 at 3:25 am</a></div>

		<div class="comment-body"><p>Ho-hum&#8230;</p>
<p>set some state<br />
run some logic<br />
assert state</p>
<p>remove duplicated state setup -> (FixtureSetup or SetUp in NUnit)<br />
remove duplicated asserts -> (extract to method)</p>
<p>To me most of your problem in that code was that it was very procedural. If you remove redundant code in an extensible/object oriented manner it wouldn&#8217;t be so brittle.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2043">
		<div id="comment-2043">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://scottcreynolds.com' rel='external nofollow' class='url'>scott</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2043">September 24, 2009 at 5:23 pm</a></div>

		<div class="comment-body"><p>I like to think of tests as being &#8220;damp&#8221;. Not totally DRY, but DRY enough.</p>
<p>Context/Spec helps a lot with this. Organizing around shared context keeps duplication within the context at a minimum, but you may have some duplication between contexts, and&#8230;I&#8217;m ok with that.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2042">
		<div id="comment-2042">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/members/karl/default.aspx' rel='external nofollow' class='url'>karl</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2042">September 15, 2009 at 5:31 pm</a></div>

		<div class="comment-body"><p>@Bill<br />
I&#8217;m hardly always right. I blog as much to learn and engage in a conversation as I do to help and teach.  </p>
<p>I think my point wasn&#8217;t properly illustrated by my example. Ultimately, unit tests should be decoupled from internal implementations, which will often lead to tests that test the same thing. This is a good thing.</p>
<p>However, you can use techniques within tests themselves to reduce code duplication. That&#8217;s fine.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2041">
		<div id="comment-2041">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.truewill.net/myblog/index.php' rel='external nofollow' class='url'>Bill Sorensen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2041">September 15, 2009 at 5:16 pm</a></div>

		<div class="comment-body"><p>I have to think twice about disagreeing with both Glenn Block and Karl, but I think there&#8217;s room for compromise here. Duplication that makes tests harder to maintain can be refactored out. Using helper methods, custom assertions, and/or base classes in tests can be beneficial. In all cases readability is an important consideration.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2040">
		<div id="comment-2040">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Jeremy Hadden</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2040">September 14, 2009 at 3:11 pm</a></div>

		<div class="comment-body"><p>I think that &#8211; as always &#8211; these things should be decided on a case-by-case basis.</p>
<p>In the example above your application of DRY is basedon replacing 4 lines of repeated code with 2 lines. You could certainly argue that the readability trade-off doesn&#8217;t stack up in this case. However, what if it&#8217;s 10 lines of repeated code &#8211; or more, if they are repeated over many more tests. Then the trade-off may swing the other way.</p>
<p>And what if further base fields are added? Without the refactor, adding a new base field means adding a test for that field in each unit test &#8211; thereby increasing the risk that you miss one out.</p>
<p>And finally, I think that brittleness is less about how many tests break as a result of a single change and more about how hard it is to fix them. A good example is setting up state in order to run a test. Good DRY refactoring for test set-up means that if an operation suddenly requires an extra piece of data to complete you don&#8217;t find yourself manually editing 20 broken tests to fix.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2039">
		<div id="comment-2039">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Ivars</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2039">September 14, 2009 at 11:27 am</a></div>

		<div class="comment-body"><p>Well, as with any software development technique &#8211; it depends. For example, recently I wrote bunch of tests (well, integration tests, not unit tests), where was common steps in so-called &#8220;arrange&#8221; part of tests. I did extract them in methods, because in my opinion it&#8217;s better to have test like</p>
<p>public void SomeTest()<br />
{<br />
  string userName = &#8220;user&#8221;;<br />
  string password = &#8220;pass&#8221;;<br />
  Login();<br />
 // Do test specific part<br />
 // Do assert<br />
}</p>
<p>than duplicating login logic in each test. Also such approach allows to avoid  multiple asserts per test which is kind of &#8220;Bad Thing(tm)&#8221; (I mean multiple asserts, not avoiding them).</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2038">
		<div id="comment-2038">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Gustav</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2038">September 13, 2009 at 7:31 am</a></div>

		<div class="comment-body"><p>You could extract the user binding logic into its own class. That way you would only need to test it once:</p>
<p>public override User BindNew()<br />
{<br />
   var user = new User();<br />
   return userBinder.Bind(user);<br />
}</p>
<p>public override User BindExisting(User user)<br />
{<br />
   return userBinder.Bind(user)<br />
}  </p>
<p>private UserBinderHelper userBinder = &#8230; </p>
<p>//&#8212;&#8212;</p>
<p>public class UserBinderHelper<br />
{<br />
   public void Bind(User user)<br />
   {<br />
      user.Name = Get(&#8220;Name&#8221;);<br />
      user.Credentials.Email = Get(&#8220;Credentials.Email&#8221;);<br />
      var password = Get(&#8220;Credentials.Password&#8221;)<br />
      if (!string.IsNullOrEmpty(password))<br />
      {<br />
         user.Credentials.Password = _encryptor.Encrypt(password);<br />
      }<br />
}<br />
}</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2037">
		<div id="comment-2037">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Piotr</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2037">September 12, 2009 at 11:31 pm</a></div>

		<div class="comment-body"><p>I agree: I tend to apply DRY far less aggressively in test code than in production code.  Also, a lot of duplication in test code may be a signal that you test too much functionality per test: instead of extracting methods, you may be better off splitting your tests into smaller ones.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2036">
		<div id="comment-2036">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://www.codebetter.com/blogs/glenn.block' rel='external nofollow' class='url'>Glenn Block</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/karlseguin/2009/09/12/unit-testing-do-repeat-yourself/#comment-2036">September 12, 2009 at 9:20 pm</a></div>

		<div class="comment-body"><p>My experience exacty. Applying DRY to unit-testing code makes the tests much harder to follow. Yes there&#8217;s duplication but in this case it&#8217;s one good use of cut &#038; paste <img src='http://codebetter.com/karlseguin/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' /> </p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
			</ol>



								
</div><!-- #comments -->

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.241 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-26 19:55:38 -->
<!-- super cache -->