<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Exploring resources, a resource programming model, and code-based configuration. | Glenn Block</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/glennblock/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/glennblock/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Glenn Block' href='http://codebetter.com/glennblock/' />
<link rel='start' title='IoC.AddComponent&lt;IBloggingStrategy, CodeBetterBloggingStrategy&gt;();' href='http://codebetter.com/glennblock/2008/01/03/ioc-addcomponent-lt-ibloggingstrategy-codebetterbloggingstrategy-gt/' />
<link rel='prev' title='WCF Web APIs, HTTP your way' href='http://codebetter.com/glennblock/2010/11/01/wcf-web-apis-http-your-way/' />
<link rel='next' title='Are you using WCF within your organization?' href='http://codebetter.com/glennblock/2010/11/16/are-you-using-wcf-within-your-organization/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/glennblock/2010/11/15/exploring-resources-a-resource-programming-model-and-code-based-configuration/' />
<link rel='shortlink' href='http://codebetter.com/glennblock/?p=138' />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/mytechnobabble/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-138" class="post-138 post type-post status-publish format-standard hentry category-http category-oredev category-rest category-wcf">
					<h1 class="entry-title">Exploring resources, a resource programming model, and code-based configuration.</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/glennblock/author/glennblock/" title="View all posts by Glenn Block">Glenn Block</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/glennblock/2010/11/15/exploring-resources-a-resource-programming-model-and-code-based-configuration/" title="2:03 pm" rel="bookmark"><span class="entry-date">November 15, 2010</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/glennblock/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/glennblock/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p><a href='http://archive.codebetter.com/cfs-file.ashx/__key/CommunityServer.Components.PostAttachments/00.01.30.70.85/ResourceProgrammingModel.zip'>ResourceProgrammingModel.zip</a>
<p><strong>Disclaimer: Early prototype</strong></p>
<p>At <a href="http://www.oredev.org/2010/sessions/embracing-http-in-the-net-platform--have-it-your-way">Oredev</a> 2010 in Sweden (which btw is an AMAZING conference), I demonstrated a prototype of a convention-based resource programming model for our new HTTP apis. In this post I&rsquo;m going to discuss a bit of background (not exhaustive) resources. Next we&rsquo;ll delve into an initial cut at a resource programming model. It supports more than just resources, it also supports code-based configuration and adds support for IoC containers, something we&rsquo;ve heard many folks ask for. I&rsquo;ll focus mainly on the resource part, but touch on some of those capabilities as well.</p>
<p>First a bit of context around resources and HTTP.</p>
<h1>Resources</h1>
<p><em><strong>Resources</strong></em> are at the heart of HTTP. A resource is an entity that is exposed over and accessible through HTTP. Entity in this case could literally be anything, a file, a web page, an image, a video, etc. Each resource is addressable through a <strong><em>URI</em></strong> or Uniform Resource Identifier. Resources are accessed through a standard set of <strong><em>HTTP methods</em></strong> including &ldquo;GET&rdquo;, &ldquo;POST&rdquo;, &ldquo;PUT&rdquo; and &ldquo;DELETE&rdquo; which can be used for reading or updating the resource. </p>
<p>There are 2 common categories of resources. An <strong><em>item resource</em></strong> refers to an individual resource like a Contact resource. A <em><strong>collection resource</strong></em> refers to a collection of child resources such as a Contacts resource. To add a contact to a contact management system exposed over HTTP for example you can POST a contact to the Contacts resource. To retrieve an individual resource however you would perform a GET on the contact resource.</p>
<h2>Representations and Media Types</h2>
<p>Resources have one or more <strong><em>representations</em></strong> which a client can access. The representation is <strong>not </strong>the resource rather it is a snapshot of the resource which is presented in a specific format. That format is identified through what is known as a&nbsp; <strong>media type </strong>which is stored in the Content-Type header of a request or response. Examples of standard media types are application/xml, application/json, application/atom+xml, application/pdf and image/png. Some of these are markup based and some of them are not. </p>
<p>For example at PDC I demonstrated a resource that returns an image (image/png) representation of a contact. The resource is actually the contact which is stored in a database, while the image is just one representation that gets returned to the client. </p>
<p>New media types are continually created (minted) to meet specific needs. If a media type is to be consumed publically, it is standard for it to be registered in the <a href="http://www.iana.org/assignments/media-types/">IANA</a> registry where potential clients can access it&rsquo;s specifications. </p>
<p>The important takeaway here is that resources representations are not fixed. New representations can be added without affecting existing clients at all. This provides great flexibility in the maintainability of resources. It allows the resource to evolve over time.</p>
<h2>Negotiating representations</h2>
<p>HTTP provides several mechanisms for allowing the server to select the appropriate representation for a specific request. For example with transparent content negotiation (conneg) the client sends a list of Accept headers specifying media types they can handle along with qualifiers indicating which one they prefer. Alternatively a resource may also expose it&rsquo;s specific representations as sub-resources which can be accessed through a specific uri. For example &ldquo;http://contoso/contact/1.xml&rdquo; and &ldquo;http://consoto/contact/1.json&rdquo; would both be sub-resources of &ldquo;http://contoso/contact/1&rdquo;.</p>
<h1>The need for a resource programming model</h1>
<p>Looking at the overview of resources above, we can see that there are several key characteristics that define a resource.</p>
<ul>
<li>It is addressable through a URI </li>
<li>It is accessible through one or more HTTP methods </li>
<li>It has one or more representations. </li>
<li>It can be collection based or item based. </li>
</ul>
<p>Today WCF has no real notion of an HTTP resources. In WCF HTTP, resources emerge as the result of annotating services and methods with various attributes such as WebGet, WebInvoke, etc. The model requires the developer to be very very explicit about how to do the mapping. The reason for this is because the existing functionality is designed to allow one to take a traditional service such as one that is exposed over SOAP, and expose it over raw HTTP.</p>
<p>What if you only care about HTTP ? In that case, you might want something more natural. You might want a model that is more implicit than explicit. With such a model, you could tell WCF, &ldquo;I am building a resource&rdquo; and it can make a whole bunch of assumptions based on the conventions / constraints set by HTTP. It can for example assume things like some of your methods map to HTTP methods or it can apply special rules depending on if you are a collection or an item resource. It can also potentially assume that resources relate to other resources and even provide special behavior based on those relationships. </p>
<h1>The resource model</h1>
<p>To understand the benefits the model brings, let&rsquo;s first take a look at the ContactResource we ship today.</p>
<pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    [ServiceContract]
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> ContactResource
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">private</span> <span style="color: #0000ff">readonly</span> IContactRepository repository;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> ContactResource(IContactRepository repository)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository = repository;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> ContactResource() : <span style="color: #0000ff">this</span>(<span style="color: #0000ff">new</span> ContactRepository())
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        [WebGet(UriTemplate = "<span style="color: #8b0000">{id}</span>")]
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> Contact Get(<span style="color: #0000ff">string</span> id, HttpResponseMessage response)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">

            var contact = <span style="color: #0000ff">this</span>.repository.Get(<span style="color: #0000ff">int</span>.Parse(id, 

                CultureInfo.InvariantCulture));

</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">if</span> (contact == <span style="color: #0000ff">null</span>)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">                response.StatusCode = HttpStatusCode.NotFound;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">                response.Content = HttpContent.Create("<span style="color: #8b0000">Contact not found</span>");
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> contact;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        [WebInvoke(UriTemplate = "<span style="color: #8b0000">{id}</span>", Method = "<span style="color: #8b0000">PUT</span>")]
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">

        <span style="color: #0000ff">public</span> Contact Put(<span style="color: #0000ff">string</span> id, Contact contact, 

            HttpResponseMessage response)

</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.Get(id, response);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository.Update(contact);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> contact;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        [WebInvoke(UriTemplate = "<span style="color: #8b0000">{id}</span>", Method = "<span style="color: #8b0000">DELETE</span>")]
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> Contact Delete(<span style="color: #0000ff">string</span> id)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            var intId = <span style="color: #0000ff">int</span>.Parse(id, CultureInfo.InvariantCulture);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            dynamic deleted = <span style="color: #0000ff">this</span>.repository.Get(intId);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository.Delete(intId);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> deleted;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">}</pre>
</pre>
<p>A few things to note about the resource above.</p>
<ul>
<li>The resource is annotated with [SeviceContract] to tell WCF it is a service. </li>
<li>Each operation is annotated with [WebGet]/[WebInvoke] and explicitly specifies the HTTP method </li>
<li>Each operation specifies a UriTemplate with an id parameter as the resource in this case is an item resource </li>
<li>The resource uses a default ctor to inject a dependency. (Not something specific to resources, it also applies to general WCF services) </li>
</ul>
<p>Here&rsquo;s how the same resource looks with the resource model.</p>
<pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> ContactResource
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">private</span> <span style="color: #0000ff">readonly</span> IContactRepository repository;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> ContactResource(IContactRepository repository)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository = repository;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> Contact Get(<span style="color: #0000ff">string</span> id, HttpResponseMessage response)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            var contact = <span style="color: #0000ff">this</span>.repository.Get(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">                <span style="color: #0000ff">int</span>.Parse(id, CultureInfo.InvariantCulture));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">if</span> (contact == <span style="color: #0000ff">null</span>)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">                response.StatusCode = HttpStatusCode.NotFound;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">                response.Content = HttpContent.Create("<span style="color: #8b0000">Contact not found</span>");
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> contact;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">

        <span style="color: #0000ff">public</span> Contact Put(<span style="color: #0000ff">string</span> id, Contact contact, 

            HttpResponseMessage response)

</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.Get(id, response);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository.Update(contact);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> contact;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> Contact Delete(<span style="color: #0000ff">string</span> id)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            var intId = <span style="color: #0000ff">int</span>.Parse(id, CultureInfo.InvariantCulture);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            dynamic deleted = <span style="color: #0000ff">this</span>.repository.Get(intId);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository.Delete(intId);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> deleted;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    }
</pre>
</pre>
<p>What is different?</p>
<ul>
<li>There are no attributes to say this is a resource, we know it&rsquo;s a resource. </li>
<li>Methods are not annotated to indicated the HTTP method, instead the method is mapped conventionally by name. </li>
<li>The URI template is conventionally constructed. </li>
<li>The resource is injected with an IContactRepository which it receives through an IoC. </li>
</ul>
<p>I mentioned above that resources have one or more representations, yet there are none specified above. The idea here is to keep the resource decoupled from it&rsquo;s representations. Those are specified elsewhere through the configuration class.</p>
<p>Taking a look at the collection resource, it looks similar.</p>
<pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> ContactsResource
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">private</span> <span style="color: #0000ff">readonly</span> IContactRepository repository;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> ContactsResource(IContactRepository repository)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository = repository;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> List&lt;Contact&gt; Get()
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> <span style="color: #0000ff">this</span>.repository.GetAll();
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> Contact Post(Contact contact, HttpResponseMessage response)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.repository.Post(contact);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            response.StatusCode = HttpStatusCode.Created;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> contact;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    }</pre>
</pre>
<p>Notice the main difference is that it&rsquo;s methods don&rsquo;t access the id. This makes sense as it is a collection.</p>
<h2>Configuration</h2>
<p>In order to configure the host with the prototype resource programming model, you create a class which derives from ResourceConfiguration. This class is passed to the service host to configure it. The prototype includes an AddResourceRoute extension method for passing this in through routes. More on this in a bit. This class is used for more than just resources, it is a general way to configure parts of WCF programatically rather than through a config file. I&rsquo;ll cover more on the uses later.</p>
<p>Let&rsquo;s first take a look at the configuration class that the ContactManager uses. </p>
<pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> ContactManagerConfiguration : ResourceConfiguration
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">private</span> IUnityContainer container;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> ContactManagerConfiguration(IUnityContainer container)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">this</span>.container = container;
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> RegisterRequestProcessorsForOperation(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            HttpOperationDescription operation,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            IList&lt;Processor&gt; processors,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            MediaTypeProcessorMode mode)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            processors.Add(<span style="color: #0000ff">new</span> JsonProcessor(operation, mode));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            processors.Add(<span style="color: #0000ff">new</span> FormUrlEncodedProcessor(operation, mode));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> RegisterResponseProcessorsForOperation(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            HttpOperationDescription operation,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            IList&lt;Processor&gt; processors,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            MediaTypeProcessorMode mode)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            processors.Add(<span style="color: #0000ff">new</span> JsonProcessor(operation, mode));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            processors.Add(<span style="color: #0000ff">new</span> PngProcessor(operation, mode));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">object</span> GetInstance(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            System.Type serviceType,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            InstanceContext instanceContext,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            Message message)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">return</span> container.Resolve(serviceType);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        <span style="color: #0000ff">public</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> ReleaseInstance(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            InstanceContext instanceContext,
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">object</span> service)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            container.Teardown(service);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
</pre>
<p>Key things to note:</p>
<ul>
<li>The configuration class derives from ResourceConfiguration. This turns on the conventions we discussed earlier. </li>
<li>RegisterRequestProcessorsForOperation / RegisterResponseProcessorsForOperation are where representations are configured. In this case you can see that the request supports Json and FormUrlEncoded while the response supports Json and Png. Media type formatting is just one of the many things that you can do with processors. More on that in another post. </li>
<li>An IoC container is specified for constructing the resource. In this case, the configuration class accepts a unity container passed in during construction. The GetInstance and ReleaseInstance methods are then overridden and hand off to the IoC for constructing/releasing. This is a very simplistic usage with a single global container, however through the instance context, you can create and store per-request level containers. I am not going to delve into the how of that now. <img src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/glenn/block/wlEmoticon-smile_7A1DBD7F.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1920566612&amp;Signature=2pM3SWg%2bEobqSUS86JzQKyELmHI%3d" alt="Smile" class="wlEmoticon wlEmoticon-smile" style="border-bottom-style: none;border-right-style: none;border-top-style: none;border-left-style: none" /> </li>
</ul>
<p>The code that actually configures the host in the global.asax is below:</p>
<pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    <span style="color: #0000ff">protected</span> <span style="color: #0000ff">void</span> Application_Start(<span style="color: #0000ff">object</span> sender, EventArgs e)
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    {
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        IUnityContainer container = <span style="color: #0000ff">new</span> UnityContainer();
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        container.RegisterType(<span style="color: #0000ff">typeof</span>(ContactResource));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        container.RegisterType(<span style="color: #0000ff">typeof</span>(ContactsResource));
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        container.RegisterType(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">typeof</span>(IContactRepository),
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">typeof</span>(ContactRepository),
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            <span style="color: #0000ff">new</span> ContainerControlledLifetimeManager());
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px"></pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        var configuration = <span style="color: #0000ff">new</span> ContactManagerConfiguration(container);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        RouteTable.Routes.AddResourceRoute&lt;ContactResource&gt;(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            "<span style="color: #8b0000">contact</span>", configuration);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">        RouteTable.Routes.AddResourceRoute&lt;ContactsResource&gt;(
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">            "<span style="color: #8b0000">contacts</span>", configuration);
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">    }
</pre>
<pre style="background-color: #ffffff;margin: 0em;width: 100%;font-family: consolas,'Courier New',courier,monospace;font-size: 12px">

&nbsp;
</pre>
</pre>
<p>First I am creating a Unity container and configuring the types. Then the configuration class is constructed passing the container. Finally AddResourceRoute is called passing in the resources, base uri and the configuration class.</p>
<h2>Uri templates and hosting on IIS / self-host?</h2>
<p>For those of you that are familiar with our WCF HTTP model you might be wondering how the URI template is constructed. Currently it is constructed by default based on a bunch of assumptions, however they can be overridden.</p>
<ul>
<li>By default the resource is assumed to be registered through a ServiceRoute that supplies it&rsquo;s uri. Thus the UriTemplate does not contain the name of the resource i.e. contact, contacts, etc. </li>
<li>If the class name does not end with &ldquo;s&rdquo; then the resource is assumed to be an item resource. In this case the UriTemplate is set to {id} based on the assumption that the last uri segment will be an id pointing to the resource i.e. contact/1. </li>
</ul>
<p>This is definitely simplistic, however the model supports specifying it yourself for example pulling from a configuration file or through an FI. The configuration class contains a protected method called GetUriTemplate. If you override it, you can take the URIs into your own hands. In the current prototype you need to do this if you want to self-host or host on IIS. I wouldn&rsquo;t&rsquo; expect that to be the long term solution&hellip;</p>
<h2>Code-based configuration</h2>
<p>As I mentioned above, the configuration class above is addressing more than just resources and representations. It also provides richer ways to configure WCF through code. This sample doesn&rsquo;t illustrate that, but if you look there are two protected methods ApplyConfiguration and ConfigureOperation. </p>
<ul>
<li>ApplyConfiguration gives you the opportunity to configure things on the host that normally would be configured through web.config. It is called once when the host is created. </li>
<li>ConfigureOperation is called for each operation. It gives you the opportunity to programmatically in a centrally managed way rather than annotating each operation. </li>
</ul>
<h1>It&rsquo;s a prototype <img src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/glenn/block/wlEmoticon-smile_7A1DBD7F.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1920566612&amp;Signature=2pM3SWg%2bEobqSUS86JzQKyELmHI%3d" alt="Smile" class="wlEmoticon wlEmoticon-smile" style="border-bottom-style: none;border-right-style: none;border-top-style: none;border-left-style: none" /></h1>
<p>I&rsquo;ve said prototype over and over throughout this blog. The reason I did that is to set proper expectations as it&rsquo;s very likely some of your scenarios are not supported. I am putting this out there to get feedback on if this is a direction you think we should pursue.</p>
<p>Code is attached. We look forward to your feedback (good or bad),</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/glennblock/category/http/" title="View all posts in HTTP" rel="category tag">HTTP</a>, <a href="http://codebetter.com/glennblock/category/oredev/" title="View all posts in Oredev" rel="category tag">Oredev</a>, <a href="http://codebetter.com/glennblock/category/rest/" title="View all posts in REST" rel="category tag">REST</a>, <a href="http://codebetter.com/glennblock/category/wcf/" title="View all posts in WCF" rel="category tag">WCF</a>. Bookmark the <a href="http://codebetter.com/glennblock/2010/11/15/exploring-resources-a-resource-programming-model-and-code-based-configuration/" title="Permalink to Exploring resources, a resource programming model, and code-based configuration." rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/glennblock/2010/11/15/exploring-resources-a-resource-programming-model-and-code-based-configuration/feed/" title="Comments RSS to Exploring resources, a resource programming model, and code-based configuration." rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-138 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/glennblock/2010/11/01/wcf-web-apis-http-your-way/" rel="prev"><span class="meta-nav">&larr;</span> WCF Web APIs, HTTP your way</a></div>
					<div class="nav-next"><a href="http://codebetter.com/glennblock/2010/11/16/are-you-using-wcf-within-your-organization/" rel="next">Are you using WCF within your organization? <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-623">
					<div id="dsq-comment-header-623" class="dsq-comment-header">
						<cite id="dsq-cite-623">
	http://www.2geeks1rant.com							<span id="dsq-author-user-623">rafek</span>
							</cite>
					</div>
					<div id="dsq-comment-body-623" class="dsq-comment-body">
						<div id="dsq-comment-message-623" class="dsq-comment-message"><p>You&#8217;re right.. Øredev was amazing, indeed! Actually I kinda regret going to Deep Dive into HTML5 session instead of yours. <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley' /> </p>
</div>
					</div>
				</li>
					<li id="dsq-comment-729">
					<div id="dsq-comment-header-729" class="dsq-comment-header">
						<cite id="dsq-cite-729">
								<span id="dsq-author-user-729">Anonymous</span>
							</cite>
					</div>
					<div id="dsq-comment-body-729" class="dsq-comment-body">
						<div id="dsq-comment-message-729" class="dsq-comment-message"><p>It might just be me? but where is the code attached?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-730">
					<div id="dsq-comment-header-730" class="dsq-comment-header">
						<cite id="dsq-cite-730">
								<span id="dsq-author-user-730">Jason</span>
							</cite>
					</div>
					<div id="dsq-comment-body-730" class="dsq-comment-body">
						<div id="dsq-comment-message-730" class="dsq-comment-message"><p>Yes as nicolai mentioned, can&#8217;t seem to find attached code link..</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-731">
					<div id="dsq-comment-header-731" class="dsq-comment-header">
						<cite id="dsq-cite-731">
	http://blogs.msdn.com/gblock							<span id="dsq-author-user-731">Glenn Block</span>
							</cite>
					</div>
					<div id="dsq-comment-body-731" class="dsq-comment-body">
						<div id="dsq-comment-message-731" class="dsq-comment-message"><p>It is now <img src='http://cdn1.codebetter.com/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />  The site was recently migrated to WordPress and there was an issue with attachments.</p>
<p>Just i case you didn&#8217;t see it in my web apis roundup post the resource model binaries are also available as a nuget pack, WcfResource.</p>
<p>Have fun!</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-742">
					<div id="dsq-comment-header-742" class="dsq-comment-header">
						<cite id="dsq-cite-742">
								<span id="dsq-author-user-742">Anonymous</span>
							</cite>
					</div>
					<div id="dsq-comment-body-742" class="dsq-comment-body">
						<div id="dsq-comment-message-742" class="dsq-comment-message"><p>Ok so I&#8217;ve had a play with this for a couple of days now and on the whole I&#8217;m really positive about the direction you guys are taking with this. Now as you mentioned, its a prototype, but I do have a few concerns with the current implementation.</p>
<p>First of all, nested resources?  its quite common to have things like &#8220;http://www.foo.com/{username}/contact/{contactid}&#8221; I dont really think theres an elegant way to solve that with the current prototype. Maybe something like its done in mvc with MapRoute</p>
<p>Second: UriTemplates, I know I can override GetUriTemplate on the ResourceConfiguration, but if you have multiple/nested resources this is going to get complicated real fast. Maybe having a simple UriTemplate attribute would do the trick?</p>
<p>Third: Async, to be honest I&#8217;ve not really looked into this much, since theres seems to be couple of different ways to do this now, but if I have domain model underneath exposing async methods (begin/end) the current model does not really seem to lend itself well to this (but I might just be missing something obvious here)</p>
<p>Anyways, good work so far, I&#8217;m really looking forward to seeing where you take it from here.</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/glennblock/2010/11/15/exploring-resources-a-resource-programming-model-and-code-based-configuration/ ';
	var disqus_identifier = '138 /blogs/glenn.block/archive/2010/11/15/exploring-resources-a-resource-programming-model-and-code-based-configuration.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'mytechnobabble';
	var disqus_title = "Exploring resources, a resource programming model, and code-based configuration.";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=138');
		});
					};
	var facebookXdReceiverPath = 'http://cdn1.codebetter.com/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/glennblock\/2010\/11\/15\/exploring-resources-a-resource-programming-model-and-code-based-configuration\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.276 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 12:39:37 -->
<!-- super cache -->