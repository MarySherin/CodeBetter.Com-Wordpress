<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Yet another simplification of Prism’s EventAggregator syntax part II–mocking extension methods | Glenn Block</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/glennblock/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/glennblock/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/glennblock/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/glennblock/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/glennblock/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Glenn Block' href='http://codebetter.com/glennblock/' />
<link rel='start' title='IoC.AddComponent&lt;IBloggingStrategy, CodeBetterBloggingStrategy&gt;();' href='http://codebetter.com/glennblock/2008/01/03/ioc-addcomponent-lt-ibloggingstrategy-codebetterbloggingstrategy-gt/' />
<link rel='prev' title='Yea another simplification of Prism’s EventAggregator syntax' href='http://codebetter.com/glennblock/2010/10/11/yea-another-simplification-of-prism-s-eventaggregator-syntax/' />
<link rel='next' title='Taking HTTP support in WCF to the next level' href='http://codebetter.com/glennblock/2010/10/26/taking-http-support-in-wcf-to-the-next-level/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/glennblock/2010/10/11/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods/' />
<link rel='shortlink' href='http://codebetter.com/glennblock/?p=135' />
<link rel="stylesheet" href="http://codebetter.com/glennblock/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/mytechnobabble/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/glennblock/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-135" class="post-135 post type-post status-publish format-standard hentry category-eventaggregator category-prism">
					<h1 class="entry-title">Yet another simplification of Prism’s EventAggregator syntax part II–mocking extension methods</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/glennblock/author/glennblock/" title="View all posts by Glenn Block">Glenn Block</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/glennblock/2010/10/11/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods/" title="5:14 am" rel="bookmark"><span class="entry-date">October 11, 2010</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/glennblock/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/glennblock/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/glennblock/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>After my last <a href="http://codebetter.com/blogs/glenn.block/archive/2010/10/10/yea-another-simplification-of-prism-s-eventaggregator-syntax.aspx">post</a>, I had quite a healthy discussion with <a href="http://lostincolonisation.wordpress.com">Alex Hung</a> (<a href="http://twitter.com/alexhung">@alexhung</a>) on you guessed it, testability and mocking. Alex’s observation was although my extension methods were easy to use, they were difficult to test. He had gone and implemented a similar user experience but through using a custom wrapper which added Publish and Subscribe methods but called to EA under the covers. His wrapper implements an interface that is easy to mock.</p>
<p>The question then was how can you mock the new extension methods? Before getting into the how lets first answer the question of why?</p>
<p>Here are unit tests that should illustrate what I want to do.</p>
<pre>
<pre>[TestFixture]
</pre>
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> When_SelectOrder_is_invoked {
</pre>
<pre>  [Test]
</pre>
<pre>  <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> then_controller_publishes_OrderSelected()
</pre>
<pre>  {
</pre>
<pre>    <span style="color: #008000">//mock out the event aggregator;  </span>
</pre>
<pre>    var mock = <span style="color: #0000ff">new</span> Mock&lt;IEventAggregator&gt;()
</pre>
<pre>    var controller = <span style="color: #0000ff">new</span> OrderController(mock.Object);
</pre>
<pre>    var order=<span style="color: #0000ff">new</span> Order();
</pre>
<pre>    controller.SelectOrder(order);
</pre>
<pre>    mock.Verify(ea=&gt;ea.Publish(order));
</pre>
<pre>  }
</pre>
<pre>}
</pre>
<pre></pre>
<pre>[TestFixture]
</pre>
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> When_OrderViewModel_is_created {
</pre>
<pre>  [Test]
</pre>
<pre>  <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> then_subscribes_to_OrderSelected() {
</pre>
<pre>    <span style="color: #008000">//mock out the event aggregator;  </span>
</pre>
<pre>    var mock = <span style="color: #0000ff">new</span> Mock&lt;IEventAggregator&gt;()
</pre>
<pre>    var vm = <span style="color: #0000ff">new</span> OrderViewModel(mock.Object);
</pre>
<pre>    mock.Verify(ea=&gt;ea.Subscribe(vm.OnOrderSelected));
</pre>
<pre>  }
</pre>
<pre>}</pre>
</pre>
<p>Looks simple enough right? I am creating a mock EventAggregator, passing it in and then verifying that the Publish and Subscribe methods are called. Both Alex and I originally though that would work. <img style="border-bottom-style: none;border-right-style: none;border-top-style: none;border-left-style: none" class="wlEmoticon wlEmoticon-winkingsmile" alt="Winking smile" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/glenn/block/wlEmoticon-winkingsmile_5AB3B8FA.png?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1920566611&amp;Signature=c4oXz5YewUmAWz2aNvZ0ubuO4pE%3d" /> Though Alex was a bit skeptical.</p>
<p>However the reality is that it cannot work. The reason is because I am creating a mock of IEventAggregator but the methods I want to mock are not on the event aggregator itself, they are extension methods! Yet another proof that what looks like it will work in the blackboard of your mind, often doesn’t hold up any water in the real world.</p>
<p>There is hope though. Extension methods CAN be mocked, but it takes a bit of refactoring. Daniel Cazzulino (<a href="http://twitter.com/kzu">@kzu</a>) has a great post on this <a href="http://www.clariusconsulting.net/blogs/kzu/archive/2009/02/19/Makingextensionmethodsamenabletomocking.aspx">here</a>. The approach I came up with is based on his. For my extension methods here are the steps I went through in that refactoring.</p>
<ol>
<li>Created an IEventAggregatorExtensionsProvider interface. This interface has all the methods from my EventAggregatorExtensions class however, the methods are all non-static (obviously) and I removed this from the first param. Other than that the signatures are the same. </li>
<li>Created EventAggregatorExtensionsProvider which implements IEventAggregatorExtensionsProvider. I ripped the implementation of each method out of EventAggregatorExtenions and then moved it into this provider. </li>
<li>Added a private static variable _Provider of type IEventAggregatorExtensionsProvider to EventAggregatorExtensions. The variable initializes itself to a new instance of EventAggregatorExtensionsProvider. </li>
<li>Changed all public methods in EventAggregatorExtensions to delegate directly to the _provider instance. </li>
<li>Added a static SetProvider method which accepts an IEventAggregatorExtensionsProvider which it then overrides _provider with. </li>
</ol>
<p>Here’s what the resulting code now looks like (which has grown a bit from my first Codepaste): <a title="http://codepaste.net/woqq1d" href="http://codepaste.net/woqq1d">http://codepaste.net/woqq1d</a></p>
<p>With these changes I can now pass in a mock of IEventAggregatorExtensionsProvider to do exactly what I want. Now my unit tests read like this:</p>
<pre>
<pre>[TestFixture]
</pre>
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> When_SelectOrder_is_invoked {
</pre>
<pre>  [Test]
</pre>
<pre>  <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> then_controller_publishes_OrderSelected()
</pre>
<pre>  {
</pre>
<pre>    <span style="color: #008000">//mock out the provider</span>
</pre>
<pre>    var mock = <span style="color: #0000ff">new</span> Mock&lt;IEventAggregatorExtensionsProvider&gt;();
</pre>
<pre>    var ea = <span style="color: #0000ff">new</span> EventAggregator();
</pre>
<pre>    EventAggregatorExtensions.SetProvider(mock.Object);
</pre>
<pre>    var controller = <span style="color: #0000ff">new</span> OrderController(ea);
</pre>
<pre>    var order = <span style="color: #0000ff">new</span> Order();
</pre>
<pre>    controller.SelectOrder(order);
</pre>
<pre>    mock.Verify(p=&gt;p.Publish(ea, order));
</pre>
<pre>}
</pre>
<pre></pre>
<pre>[TestFixture]
</pre>
<pre><span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> When_OrderViewModel_is_created {
</pre>
<pre>  [Test]
</pre>
<pre>  <span style="color: #0000ff">public</span> <span style="color: #0000ff">void</span> then_subscribes_to_OrderSelected()
</pre>
<pre>  {
</pre>
<pre>    <span style="color: #008000">//mock out the provider</span>
</pre>
<pre>    var mock = <span style="color: #0000ff">new</span> Mock&lt;IEventAggregatorExtensionsProvider&gt;();
</pre>
<pre>    var ea = <span style="color: #0000ff">new</span> EventAggregator();
</pre>
<pre>    EventAggregatorExtensions.SetProvider(mock.Object);
</pre>
<pre>    var vm = <span style="color: #0000ff">new</span> OrderViewModel(ea);
</pre>
<pre>    mock.Verify(p=&gt;p.Subscribe(ea, vm.OnOrderSelected));
</pre>
<pre>
</pre>
<pre>  }
</pre>
<pre>}</pre>
</pre>
<p>The main difference is that I am now creating a mock of the extensions provider rather than the event aggregator itself. That means that my mock is the thing that will get invoked by the classes under test.</p>
<p>Actually the EA instance I create in the unit tests is just a dummy and could even be null as <a href="http://bradwilson.typepad.com/blog/2008/01/c-30-extension.html">extensions methods can be invoked on null instances</a>. That’s because my classes under test are only accessing the extension methods. However I passed it in because it is entirely conceivable one might want to access the actual instance methods.</p>
<p>To be fair there is more ceremony here than the approach that Alex was suggesting as you have to mock the provider and pass in an event aggregator. However the difference I think is marginal, and it works nicely and is completely testable.</p>
<p>What do you think?</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/glennblock/category/eventaggregator/" title="View all posts in EventAggregator" rel="category tag">EventAggregator</a>, <a href="http://codebetter.com/glennblock/category/prism/" title="View all posts in prism" rel="category tag">prism</a>. Bookmark the <a href="http://codebetter.com/glennblock/2010/10/11/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods/" title="Permalink to Yet another simplification of Prism’s EventAggregator syntax part II–mocking extension methods" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/glennblock/2010/10/11/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods/feed/" title="Comments RSS to Yet another simplification of Prism’s EventAggregator syntax part II–mocking extension methods" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-135 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/glennblock/2010/10/11/yea-another-simplification-of-prism-s-eventaggregator-syntax/" rel="prev"><span class="meta-nav">&larr;</span> Yea another simplification of Prism’s EventAggregator syntax</a></div>
					<div class="nav-next"><a href="http://codebetter.com/glennblock/2010/10/26/taking-http-support-in-wcf-to-the-next-level/" rel="next">Taking HTTP support in WCF to the next level <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-593">
					<div id="dsq-comment-header-593" class="dsq-comment-header">
						<cite id="dsq-cite-593">
								<span id="dsq-author-user-593">JeroenH</span>
							</cite>
					</div>
					<div id="dsq-comment-body-593" class="dsq-comment-body">
						<div id="dsq-comment-message-593" class="dsq-comment-message"><p>I really don&#8217;t see the point&#8230; This approach makes the code more complicated and doubles the size.</p>
<p>I prefer your original code. It can be tested much simpler tested with a dummy event and the actual event aggregator.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-594">
					<div id="dsq-comment-header-594" class="dsq-comment-header">
						<cite id="dsq-cite-594">
	http://codebetter.com/members/gblock/default.aspx							<span id="dsq-author-user-594">Glenn Block</span>
							</cite>
					</div>
					<div id="dsq-comment-body-594" class="dsq-comment-body">
						<div id="dsq-comment-message-594" class="dsq-comment-message"><p>@JeroenH The observation that there is more code is fair, though the additional code is&nbsp;really a set of delegation calls and one additional public method.</p>
<p>I am not sure your thought on using the real EA actually will work I started mentally down that path but here is the issue. Prism&#8217;s EA creates the event instance the first time you call GetEvent&lt;&gt; (i.e. it calls new). That means that in order to have the mock event, you also need a mock/fake event aggregator which returns the mock event that you are trying to test against. </p>
<p>That sounded messy(ier) in my head. But I may have to give it a try and use it for a third post. &lt;g&gt;</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-595">
					<div id="dsq-comment-header-595" class="dsq-comment-header">
						<cite id="dsq-cite-595">
								<span id="dsq-author-user-595">Mark Green</span>
							</cite>
					</div>
					<div id="dsq-comment-body-595" class="dsq-comment-body">
						<div id="dsq-comment-message-595" class="dsq-comment-message"><p>I&#8217;m with Jeroen. All that&#8217;s happened is that you&#8217;ve moved the complexity from the GetEvent call to the ViewModel, the extension methods and the controller, while gaining no additional functionality and no additional testability as compared to the original GetEvent syntax.</p>
<p>GetEvent isn&#8217;t great but it&#8217;s not so complex that it needs an over-engineered &#8220;simplification&#8221;.</p>
<p>Nice work on the testing of extension methods, though. I&#8217;ll take that from this post.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-596">
					<div id="dsq-comment-header-596" class="dsq-comment-header">
						<cite id="dsq-cite-596">
								<span id="dsq-author-user-596">Dave Stevens</span>
							</cite>
					</div>
					<div id="dsq-comment-body-596" class="dsq-comment-body">
						<div id="dsq-comment-message-596" class="dsq-comment-message"><p>Is it just me or does the need to mock an extension method raise huge red flags?  I think of extension methods as simply static utility classes with some syntactic sugar to allow for inferred typing.  As such, I would argue that extension methods must be purely functional and execute deterministically based solely on their input.</p>
<p>I&#8217;m a huge proponent of mocking and TDD, but I feel that if you&#8217;re attempting to mock an extension method than you&#8217;re doing something wrong.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-597">
					<div id="dsq-comment-header-597" class="dsq-comment-header">
						<cite id="dsq-cite-597">
	http://richarddingwall.name							<span id="dsq-author-user-597">Richard Dingwall</span>
							</cite>
					</div>
					<div id="dsq-comment-body-597" class="dsq-comment-body">
						<div id="dsq-comment-message-597" class="dsq-comment-message"><p>Appreciate what you&#8217;re trying to do Glenn, but why don&#8217;t you just fix the IEventAggregator directly?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-598">
					<div id="dsq-comment-header-598" class="dsq-comment-header">
						<cite id="dsq-cite-598">
	http://codebetter.com/members/gblock/default.aspx							<span id="dsq-author-user-598">Glenn Block</span>
							</cite>
					</div>
					<div id="dsq-comment-body-598" class="dsq-comment-body">
						<div id="dsq-comment-message-598" class="dsq-comment-message"><p>Dave these methods are performing syntactic sugar as they simply delegate to the instance they they extend and call existing methods. If you check the CodePaste there is almost zero logic in the extensions.</p>
<p>You don&#8217;t &#8220;need&#8217; to mock the extensions, but it makes it easier to test in this case because otherwise you need to mock 2 classes instead of one. ie you would need a mock event aggregator and a mock event. Wheras in this case I just mock the provider.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-599">
					<div id="dsq-comment-header-599" class="dsq-comment-header">
						<cite id="dsq-cite-599">
	http://codebetter.com/members/gblock/default.aspx							<span id="dsq-author-user-599">Glenn Block</span>
							</cite>
					</div>
					<div id="dsq-comment-body-599" class="dsq-comment-body">
						<div id="dsq-comment-message-599" class="dsq-comment-message"><p>Richard</p>
<p>I am doing this as a consumer of the existing EA. Now you could do what Alex did and create an EA wrapper with it&#8217;s own interface and then register that in the container. Arugably that would make testing simpler. In this case I was trying to use the existing EA without introducing a new wrapper.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-600">
					<div id="dsq-comment-header-600" class="dsq-comment-header">
						<cite id="dsq-cite-600">
								<span id="dsq-author-user-600">Dave Stevens</span>
							</cite>
					</div>
					<div id="dsq-comment-body-600" class="dsq-comment-body">
						<div id="dsq-comment-message-600" class="dsq-comment-message"><p>I know very little of EA and am simply commenting on the use of extension methods (and by extension, static methods) which depend on outside code and/or contain state.  This is a common mistake and something I am forced to live with on a daily basis because my company&#8217;s internally developed uber-library makes similar use of side effecting, state-full static methods.  These methods, similar to the problem you created for yourself, make life extremely difficult when attempting to do TDD.</p>
<p>I think I&#8217;d completely agree with Richard, but when that&#8217;s not possible,  Alex&#8217;s approach that you describe sounds very similar to what I would do.</p>
<p>A little googling just now and I found this: <a href="http://www.chadmyers.com/blog/archive/2007/11/19/a-public-call-for-c-extension-method-best-practices.aspx" rel="nofollow">http://www.chadmyers.com/blog/archive/2007/11/19/a-public-call-for-c-extension-method-best-practices.aspx</a>.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-601">
					<div id="dsq-comment-header-601" class="dsq-comment-header">
						<cite id="dsq-cite-601">
	http://codebetter.com/members/gblock/default.aspx							<span id="dsq-author-user-601">Glenn Block</span>
							</cite>
					</div>
					<div id="dsq-comment-body-601" class="dsq-comment-body">
						<div id="dsq-comment-message-601" class="dsq-comment-message"><p>Dave</p>
<p>What do you mean by the extension methods depend on state? These don&#8217;t depend on any state within the extension method. They are not stateful.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-602">
					<div id="dsq-comment-header-602" class="dsq-comment-header">
						<cite id="dsq-cite-602">
								<span id="dsq-author-user-602">Dave Stevens</span>
							</cite>
					</div>
					<div id="dsq-comment-body-602" class="dsq-comment-body">
						<div id="dsq-comment-message-602" class="dsq-comment-message"><p>I concede that &#8220;stateful&#8221; does not really apply to this code as nothing is modified.  It does depend on the state of the field containing the IEventAggregatorExtensionsProvider though.  I&#8217;m personally not a fan of using extension methods unless they are self contained and deterministic (based purely on input) utility functions which have no side effects.</p>
<p>You have successfully allowed code which uses these extension methods to be tested.  I do very much like the pattern you&#8217;ve described here for when it is absolutely necessary.  If it helps you be more productive then it probably helps other people be more productive as well too and this is all that matters.</p>
<p>On an unrelated note, I just started playing around with Reactive Extensions and I can definitely see these working together.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-603">
					<div id="dsq-comment-header-603" class="dsq-comment-header">
						<cite id="dsq-cite-603">
	http://codebetter.com/members/gblock/default.aspx							<span id="dsq-author-user-603">Glenn Block</span>
							</cite>
					</div>
					<div id="dsq-comment-body-603" class="dsq-comment-body">
						<div id="dsq-comment-message-603" class="dsq-comment-message"><p>Dave</p>
<p>Thanks. I think your points are completely valid. This is not optimal and I don&#8217;t mean to imply that it is. I think it does provide a workable solution. Actually my reason for pushing on it was to see how and what could be achieved. </p>
<p>As I started down the mockability path, I realized there was value in just sharing the approach I went through to make it more testable so that others could benefit.</p>
<p>Yes RX is awesome. A bunch of folks have done posts on using RX with EA, or even as an EA.</p>
<p>Regards</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/glennblock/2010/10/11/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods/ ';
	var disqus_identifier = '135 /blogs/glenn.block/archive/2010/10/10/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'mytechnobabble';
	var disqus_title = "Yet another simplification of Prism’s EventAggregator syntax part II–mocking extension methods";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=135');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/glennblock/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/glennblock\/2010\/10\/11\/yet-another-simplification-of-prism-s-eventaggregator-syntax-part-ii-mocking-extension-methods\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.498 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-26 19:47:18 -->
<!-- super cache -->