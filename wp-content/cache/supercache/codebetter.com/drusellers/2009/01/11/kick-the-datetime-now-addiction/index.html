<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Kick the DateTime.Now addiction | Dru Sellers</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/drusellers/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/drusellers/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/drusellers/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/drusellers/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/drusellers/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Dru Sellers' href='http://codebetter.com/drusellers/' />
<link rel='start' title='Planning the Upcoming Year' href='http://codebetter.com/drusellers/2009/01/10/planning-the-upcoming-year/' />
<link rel='prev' title='Shared Random Idea: Batch Tables' href='http://codebetter.com/drusellers/2009/01/11/shared-random-idea-batch-tables/' />
<link rel='next' title='Tackling Complexity' href='http://codebetter.com/drusellers/2009/01/11/tackling-complexity/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/drusellers/2009/01/11/kick-the-datetime-now-addiction/' />
<link rel='shortlink' href='http://codebetter.com/drusellers/?p=8' />
<link rel="stylesheet" href="http://codebetter.com/drusellers/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><link rel="stylesheet" href="http://disqus.com/stylesheets/drusellers/disqus.css?v=2.0" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/drusellers/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-8" class="post-8 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">Kick the DateTime.Now addiction</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/drusellers/author/drusellers/" title="View all posts by Dru Sellers">Dru Sellers</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/drusellers/2009/01/11/kick-the-datetime-now-addiction/" title="4:22 pm" rel="bookmark"><span class="entry-date">January 11, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/drusellers/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/drusellers/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/drusellers/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>How many times do we naively rely on DateTime.Now for business dates. Yikes, I just reviewed a system that I wrote a while back and I have chained myself to this concept in a very painful way. Now, I am not responsible for this system any longer but I wanted to try and think of a solution to this problem so that I don&#8217;t do it again.</p>
<p>Captain Obvious says: &#8220;So with time we seem to have two major units that we care about &#8216;Date&#8217; and &#8216;Time&#8217;.&#8221;</p>
<p>Dates are all about a calendar so lets have an ICalendar and times are all about clocks so lets have an IClock too. Now we can have some concrete SystemCalender and SystemClock that basically just wrap the DateTime.Now type functions. The more interesting behavior for your business would be / could be wrapped in a concrete implementation called, wait for it, Business Calendar and BusinessClock.</p>
<pre>
public interface IClock
{
	DateTime Now {get;}
}

public interface ICalendar
{
	DateTime Today {get;}
}
</pre>
<p>Some things that I like about this. I like that this can be database backed, or by a filesystem, or a configuration file. It really becomes less of a concern if I need to change something. If I care more about calendar than clocks I can always use the system clock but then use the business calendar. Really at this point its all about making the choice an explicit choice. Its another one of these small things that can make your system much easier to rerun should a run fail, or just more tolerant of changes in time or what holidays you recognize, etc.</p>
<pre>
public class SystemClock : IClock
{
	public DateTime Now { get { return DateTime.Now; } }
}

public class SystemCalendar : ICalendar
{
	public DateTime Today { get{ return DateTime.Today; } }
}
</pre>
<p>not to abuse extension methods (oh what the hell why not, its fun)</p>
<pre>
public static class CalendarExtensions
{
	public static bool IsHoliday(this ICalendar calendar)
	{
		return _holidayRepository.Find(calendar.Today).IsNotNull();
	}
}
</pre>
<p>Ok, the code above is way contrived and totally made up but I like how the base calendars don&#8217;t have to have every function you may want and can instead focus on the problem of representing dates and times the correct way and that you can bolt on stuff for your app later. Of course you can get yourself into trouble this way as well but sharp tools are nice!</p>
<p>As always leave improvements in the comments!</p>
<p>-d</p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/drusellers/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/drusellers/2009/01/11/kick-the-datetime-now-addiction/" title="Permalink to Kick the DateTime.Now addiction" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/drusellers/2009/01/11/kick-the-datetime-now-addiction/feed/" title="Comments RSS to Kick the DateTime.Now addiction" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-8 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/drusellers/2009/01/11/shared-random-idea-batch-tables/" rel="prev"><span class="meta-nav">&larr;</span> Shared Random Idea: Batch Tables</a></div>
					<div class="nav-next"><a href="http://codebetter.com/drusellers/2009/01/11/tackling-complexity/" rel="next">Tackling Complexity <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

				
<div id="disqus_thread">
					<div id="dsq-content">
			<ul id="dsq-comments">
					<li id="dsq-comment-15">
					<div id="dsq-comment-header-15" class="dsq-comment-header">
						<cite id="dsq-cite-15">
	http://blog.kamstrup-linnet.dk							<span id="dsq-author-user-15">Jesper Kamstrup Linnet</span>
							</cite>
					</div>
					<div id="dsq-comment-body-15" class="dsq-comment-body">
						<div id="dsq-comment-message-15" class="dsq-comment-message"><p>I once worked on a project where a lot of the business logic was very dependent on dates. Using an interface like the ICalendar was a great help, especially when writing unit tests exercising the date related logic.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-16">
					<div id="dsq-comment-header-16" class="dsq-comment-header">
						<cite id="dsq-cite-16">
	http://damieng.com							<span id="dsq-author-user-16">Damien Guard</span>
							</cite>
					</div>
					<div id="dsq-comment-body-16" class="dsq-comment-body">
						<div id="dsq-comment-message-16" class="dsq-comment-message"><p>This makes dealing with time zones more difficult.</p>
<p>[)amien</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-17">
					<div id="dsq-comment-header-17" class="dsq-comment-header">
						<cite id="dsq-cite-17">
	http://blog.jendrusz.pl							<span id="dsq-author-user-17">Roman Jendrusz</span>
							</cite>
					</div>
					<div id="dsq-comment-body-17" class="dsq-comment-body">
						<div id="dsq-comment-message-17" class="dsq-comment-message"><p>As Jesper said it is a really great way for writing  a more testable code. I think that many projects have some fancy helper methods for dealing with time and dates.  As you said these metods can be provided by this interfaces or extension methods.</p>
<p>What is your prefered way to gain access to objects that implements these interfaces? Are you using some service locator?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-18">
					<div id="dsq-comment-header-18" class="dsq-comment-header">
						<cite id="dsq-cite-18">
								<span id="dsq-author-user-18">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-18" class="dsq-comment-body">
						<div id="dsq-comment-message-18" class="dsq-comment-message"><p>@Damien, it&#8217;s not immediately obvious to me why this makes using time zones more difficult than calling DateTime.Now directly? Can you expand and suggest any improvements you would make?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-19">
					<div id="dsq-comment-header-19" class="dsq-comment-header">
						<cite id="dsq-cite-19">
	http://weblogs.asp.bet/avnerk							<span id="dsq-author-user-19">Avner Kashtan</span>
							</cite>
					</div>
					<div id="dsq-comment-body-19" class="dsq-comment-body">
						<div id="dsq-comment-message-19" class="dsq-comment-message"><p>Your implementation is pretty simple and straightforward, but I&#8217;m just missing one thing &#8211; what&#8217;s so horrible about using DateTime.Now? I can understand scenarios where the current server&#8217;s system clock isn&#8217;t the standardized time you want to rely on, but what is the rationale for marking DateTime.Now as a total no-no?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-20">
					<div id="dsq-comment-header-20" class="dsq-comment-header">
						<cite id="dsq-cite-20">
	http://panteravb.com							<span id="dsq-author-user-20">Chris</span>
							</cite>
					</div>
					<div id="dsq-comment-body-20" class="dsq-comment-body">
						<div id="dsq-comment-message-20" class="dsq-comment-message"><p>It would be easier to see why you would want to clutter a codebase with these interfaces if you could provide real examples of  the problem with DateTime.Now, followed by examples of how hiding behind the an interface is helpful and more testable.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-21">
					<div id="dsq-comment-header-21" class="dsq-comment-header">
						<cite id="dsq-cite-21">
								<span id="dsq-author-user-21">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-21" class="dsq-comment-body">
						<div id="dsq-comment-message-21" class="dsq-comment-message"><p>@Chris, it could aid in testing as now you can create a mock IClock or ICalendar to return a deterministic date for testing purposes</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-22">
					<div id="dsq-comment-header-22" class="dsq-comment-header">
						<cite id="dsq-cite-22">
	http://igorbrejc.net							<span id="dsq-author-user-22">Igor Brejc</span>
							</cite>
					</div>
					<div id="dsq-comment-body-22" class="dsq-comment-body">
						<div id="dsq-comment-message-22" class="dsq-comment-message"><p>I agree with abstracting Date/Time, but I think your interfaces should return DateTimeOffset instead of DateTime.</p>
<p>see <a href="http://www.danrigsby.com/blog/index.php/2008/08/23/datetime-vs-datetimeoffset-in-net/" rel="nofollow">http://www.danrigsby.com/blog/index.php/2008/08/23/datetime-vs-datetimeoffset-in-net/</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-23">
					<div id="dsq-comment-header-23" class="dsq-comment-header">
						<cite id="dsq-cite-23">
	http://panteravb.com							<span id="dsq-author-user-23">Chris</span>
							</cite>
					</div>
					<div id="dsq-comment-body-23" class="dsq-comment-body">
						<div id="dsq-comment-message-23" class="dsq-comment-message"><p>@Paul, </p>
<p>isn&#8217;t this deterministic:</p>
<p>new DateTime(2008, 12, 25)</p>
<p>??</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-24">
					<div id="dsq-comment-header-24" class="dsq-comment-header">
						<cite id="dsq-cite-24">
								<span id="dsq-author-user-24">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-24" class="dsq-comment-body">
						<div id="dsq-comment-message-24" class="dsq-comment-message"><p>@Chris, yes but it isn&#8217;t DateTime.Now. If the method under test uses DateTime.Now as part of it&#8217;s internal logic, then how are you going to control that when you come to test it. You&#8217;re not going to change the source code of your method are you?</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-25">
					<div id="dsq-comment-header-25" class="dsq-comment-header">
						<cite id="dsq-cite-25">
	http://panteravb.com							<span id="dsq-author-user-25">Chris</span>
							</cite>
					</div>
					<div id="dsq-comment-body-25" class="dsq-comment-body">
						<div id="dsq-comment-message-25" class="dsq-comment-message"><p>Right, so back to my first comment, i just need an example so I can wrap my head around this.  </p>
<p>To date(no pun intended), this would solve exactly zero problems I&#8217;ve had, so rather than a theoretical example, I&#8217;m curious of an original problem that this solves.  And not one that was made up this morning to help support this post, just one from a real project.  Actually, the one that inspired Dru&#8217;s post would be perfect.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-26">
					<div id="dsq-comment-header-26" class="dsq-comment-header">
						<cite id="dsq-cite-26">
	http://jimmybogard.lostechies.com							<span id="dsq-author-user-26">Jimmy Bogard</span>
							</cite>
					</div>
					<div id="dsq-comment-body-26" class="dsq-comment-body">
						<div id="dsq-comment-message-26" class="dsq-comment-message"><p>We used to use the IClock quite a bit in our projects BUT&#8230;.it got quite annoying having the IClock dependency littered everywhere.</p>
<p>We&#8217;re now leaning towards the Ayende &#8482; way of things:</p>
<p><a href="http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/11/09/systemtime-versus-isystemclock-dependencies-revisited.aspx" rel="nofollow">http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/11/09/systemtime-versus-isystemclock-dependencies-revisited.aspx</a></p>
<p>Yeah, I&#8217;ll be That Guy who links to his own blog.  What _is_ nice about wrapping the dependencies in an interface is the extension methods.</p>
<p>However, extension methods around primitives are often a sign that you have a case of primitive obsession.  Why not separate creation (SystemTime.Now or whatever) and behavior?  You could have a pretty rich SystemTime or SystemCalendar if you put all the behavior pertaining to those items actually in that class.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-27">
					<div id="dsq-comment-header-27" class="dsq-comment-header">
						<cite id="dsq-cite-27">
								<span id="dsq-author-user-27">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-27" class="dsq-comment-body">
						<div id="dsq-comment-message-27" class="dsq-comment-message"><p>@Chris</p>
<p>Here is a real life example from a project Ayende was having problems testing.</p>
<p><a href="http://ayende.com/Blog/archive/2008/07/07/Dealing-with-time-in-tests.aspx" rel="nofollow">http://ayende.com/Blog/archive/2008/07/07/Dealing-with-time-in-tests.aspx</a></p>
</div>
					</div>
				</li>
					<li id="dsq-comment-28">
					<div id="dsq-comment-header-28" class="dsq-comment-header">
						<cite id="dsq-cite-28">
	http://panteravb.com							<span id="dsq-author-user-28">Chris</span>
							</cite>
					</div>
					<div id="dsq-comment-body-28" class="dsq-comment-body">
						<div id="dsq-comment-message-28" class="dsq-comment-message"><p>@Paul,</p>
<p>I just can&#8217;t buy into the whole abstracting DateTime.Now.</p>
<p>There are two ends of the spectrum of testing.  The ones who just flat out don&#8217;t do it at all, and the ones who spend WAY too much time overthinking things like how to test DateTime.Now.  </p>
<p>Ayende&#8217;s post actually indicates that there wasn&#8217;t a problem with his non-test code, just his test code, so time was spent(wasted) trying to make his test work, while all that time his non-test code was working fine.</p>
<p>IClock, IDateTime, and ISystemTime, et al, can all very easily be replaced with another interface: ILikeToWasteMyClientsMoney</p>
<p>I&#8217;m wearing my flame retardant tshirt today <img src='http://codebetter.com/drusellers/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' /> </p>
</div>
					</div>
				</li>
					<li id="dsq-comment-29">
					<div id="dsq-comment-header-29" class="dsq-comment-header">
						<cite id="dsq-cite-29">
	http://jimmybogard.lostechies.com							<span id="dsq-author-user-29">Jimmy Bogard</span>
							</cite>
					</div>
					<div id="dsq-comment-body-29" class="dsq-comment-body">
						<div id="dsq-comment-message-29" class="dsq-comment-message"><p>@Chris</p>
<p>His non-test code was working fine?  How did he prove that?  Gut feeling? Manual testing when we feel like it?</p>
<p>Tests/specifications are the only repeatable, reliable way to know if we built the software right.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-30">
					<div id="dsq-comment-header-30" class="dsq-comment-header">
						<cite id="dsq-cite-30">
								<span id="dsq-author-user-30">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-30" class="dsq-comment-body">
						<div id="dsq-comment-message-30" class="dsq-comment-message"><p>@Chris,</p>
<p>Ha <img src='http://codebetter.com/drusellers/wp-includes/images/smilies/icon_smile.gif' alt=':-)' class='wp-smiley' />  It&#8217;s ok you can hang it back up for another day.<br />
I know what you are saying in that his production code was working but the question is how would you know that other than by checking it manually or via an automated test.<br />
I&#8217;ve no vested interest in trying to persuade you. I&#8217;m by no means an expert (or zealot) in tdd. I&#8217;ve just been using more and more over the last few years. I think tdd is a very personal experience and it&#8217;s only when you&#8217;ve experienced some real value from an extra level of decoupling than you may normally have chose on a few of your projects that it becomes easier to buy into more and more of these kind of pre-emptive decisions.<br />
And please don&#8217;t take any of that as implying that you don&#8217;t get tdd or anything, pragmatism rules the day and if you say you don&#8217;t need it this particular abstraction for your projects then I believe you. Who better to make that decision.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-31">
					<div id="dsq-comment-header-31" class="dsq-comment-header">
						<cite id="dsq-cite-31">
	http://panteravb.com							<span id="dsq-author-user-31">Chris</span>
							</cite>
					</div>
					<div id="dsq-comment-body-31" class="dsq-comment-body">
						<div id="dsq-comment-message-31" class="dsq-comment-message"><p>@Jimmy,</p>
<p>I would 100 percent agree with the your last statement so long as it was prefaced with one word,  &#8220;[Useful] Tests/specifications are the only repeatable, reliable way to know if we built the software right.&#8221;</p>
<p>Hacking up an interface to test whether DateTime.Now works is no different than testing getters and setters, waste of time.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-32">
					<div id="dsq-comment-header-32" class="dsq-comment-header">
						<cite id="dsq-cite-32">
								<span id="dsq-author-user-32">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-32" class="dsq-comment-body">
						<div id="dsq-comment-message-32" class="dsq-comment-message"><p>@Chris,</p>
<p>Also I don&#8217;t think anyone is suggesting that the interface is to help test if DateTime.Now works. It is useful for helping to test if your user code responds appropriately when it has to use the current time as part of its logic, in a deterministic way.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-33">
					<div id="dsq-comment-header-33" class="dsq-comment-header">
						<cite id="dsq-cite-33">
	http://panteravb.com							<span id="dsq-author-user-33">Chris</span>
							</cite>
					</div>
					<div id="dsq-comment-body-33" class="dsq-comment-body">
						<div id="dsq-comment-message-33" class="dsq-comment-message"><p>@Paul,</p>
<p>I was kinda generalizing(slash mocking) with the DateTime.Now remarks.  </p>
<p>It&#8217;s hard to not see wrapping DateTime.Now behind an interface as overkill.  I&#8217;m a huge TDD fan, this particular thing though, I just don&#8217;t get it.  I&#8217;m sure next week(month) I&#8217;ll hit my first time sensitive coding issue and the only way of testing it is with an ISomethingToDoWithDateAndTime interface.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-34">
					<div id="dsq-comment-header-34" class="dsq-comment-header">
						<cite id="dsq-cite-34">
								<span id="dsq-author-user-34">Paul</span>
							</cite>
					</div>
					<div id="dsq-comment-body-34" class="dsq-comment-body">
						<div id="dsq-comment-message-34" class="dsq-comment-message"><p>@Chris,<br />
If I had this conversation at work, I&#8217;m sure 90%+ of the guys I deal with would say all the things you&#8217;ve said. It&#8217;s very hard for it not to sound like overkill until it&#8217;s caused you some pain. For the record I don&#8217;t implement this solution in every project I do, but I know it&#8217;s there in the toolbox should I need it.<br />
The thing is because it&#8217;s such a trivial thing to implement you can see why people might just use it from the off if they think they might need it. The YAGNI discussion is for another day though.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-35">
					<div id="dsq-comment-header-35" class="dsq-comment-header">
						<cite id="dsq-cite-35">
	http://www.centrifugalbumblepuppy.com/							<span id="dsq-author-user-35">Andrew</span>
							</cite>
					</div>
					<div id="dsq-comment-body-35" class="dsq-comment-body">
						<div id="dsq-comment-message-35" class="dsq-comment-message"><p>I have implemented the abstracted clock for a new project and it is proving very useful. We use the Static Gateway Pattern from this website, although Ayende&#8217;s way also looks like a neat alternative.</p>
<p>Our code regularly has to deal with time zones and handling them right is very important for the business but far from straightforward. Having the code properly unit tested around edge cases is a life saver, and certainly helped to speed up the development.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-36">
					<div id="dsq-comment-header-36" class="dsq-comment-header">
						<cite id="dsq-cite-36">
	http://jimmybogard.lostechies.com							<span id="dsq-author-user-36">Jimmy Bogard</span>
							</cite>
					</div>
					<div id="dsq-comment-body-36" class="dsq-comment-body">
						<div id="dsq-comment-message-36" class="dsq-comment-message"><p>@Chris</p>
<p>We&#8217;re not testing DateTime.Now, but rather, code that _uses_ DateTime.Now.  Any time we have code that looks at DateTime.Now for decisions, it will be a brittle test UNLESS we&#8217;re able to specify that indirect input for that test.</p>
<p>All it really takes to shift to this kind of abstraction is one test/build failure because of an environmental concern.  When we had tests fail because of what time zone our build server was on, we moved to an abstraction.  Going forward, our tests were easier to discern when both the observed &#8220;today&#8221; date as well as calculated dates were specified.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-37">
					<div id="dsq-comment-header-37" class="dsq-comment-header">
						<cite id="dsq-cite-37">
								<span id="dsq-author-user-37">drusellers</span>
							</cite>
					</div>
					<div id="dsq-comment-body-37" class="dsq-comment-body">
						<div id="dsq-comment-message-37" class="dsq-comment-message"><p>@Roman: As a big IoC guy I would probably request either the calendar or the clock via constructor injection.</p>
<p>@Avner: see below. I wouldn&#8217;t say that DateTime.Now is a total no-no, but rather you should make an active and aware decision to use it, and not just let it be the default.</p>
<p>@Chris: point taken.</p>
<p>@Igor: See DateTimeOffset, even better</p>
<p>@Jimmy: Ohhh, that&#8217;s nice too.</p>
<p>Where I work we run processes 24 hours a day, sometimes things have to run after midnight for stuff that has technically happened the day before. Before this abstraction we had to, HAD TO, make sure we had the processes complete before midnight. If we didn&#8217;t, it would screw up the calculation of someone&#8217;s loan (if memory serves we basically dropped a day&#8217;s interest). We could always solve it with workarounds but it was painful and messy. Time is an important aspect in our domain as well, which is another reason why the abstraction has come up.</p>
<p>Wow! You guys rock and I can&#8217;t wait for more. Thanks for all the comments, I hope my response has cleared some of this up.</p>
<p>-d</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-38">
					<div id="dsq-comment-header-38" class="dsq-comment-header">
						<cite id="dsq-cite-38">
								<span id="dsq-author-user-38">Andrew</span>
							</cite>
					</div>
					<div id="dsq-comment-body-38" class="dsq-comment-body">
						<div id="dsq-comment-message-38" class="dsq-comment-message"><p>>>Where I work we run processes 24 hours a day, sometimes things have to run after midnight for stuff that has technically happened the day before. Before this abstraction we had to, HAD TO, make sure we had the processes complete before midnight. If we didn&#8217;t, it would screw up the calculation of someone&#8217;s loan (if memory serves we basically dropped a day&#8217;s interest). </p>
<p>There&#8217;s your problem, it was just bad design.  In this situation you never should have been using DateTime.Now in the first place.  You always should have been passing in the date (or dates if necessary).</p>
<p>I&#8217;m with Chris on this one, you&#8217;ve overcomplicated a system which (more the likely) could have been solved with one or two DateTime parameters.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-39">
					<div id="dsq-comment-header-39" class="dsq-comment-header">
						<cite id="dsq-cite-39">
	http://ferventcoder.com							<span id="dsq-author-user-39">Robz</span>
							</cite>
					</div>
					<div id="dsq-comment-body-39" class="dsq-comment-body">
						<div id="dsq-comment-message-39" class="dsq-comment-message"><p>@Andrew: In Dru&#8217;s defense, he didn&#8217;t write the system that does this crazy stuff.  </p>
<p>We are keeping our fingers crossed that that system can be rewritten. It&#8217;s a very bad egg.</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-40">
					<div id="dsq-comment-header-40" class="dsq-comment-header">
						<cite id="dsq-cite-40">
								<span id="dsq-author-user-40">Andrew</span>
							</cite>
					</div>
					<div id="dsq-comment-body-40" class="dsq-comment-body">
						<div id="dsq-comment-message-40" class="dsq-comment-message"><p>@Robz</p>
<p>I probably should have worded it a bit differently.  I have quite  a bit of experience working in the banking industry, and there is some truly fugly code out there based around the fact that most banks do nightly processing.  Unfortuately for them, banking is now pretty much 24/7 (Credit Card processors generally have downtime over the weekends though), so I&#8217;ve dealt with all the same pains in the past.</p>
<p>Granted, I know next to nothing about the system in question otther than that processing can extend past midnight (a very common issue in the finance industry), I just can&#8217;t see how messing around with DateTime.Now can solve the problem since the code that drives the Date Time should never have been there in the first place.</p>
<p>There should be a basic thought process that takes effect when tackling a problem: 1) Why does something need to be done? 2) What do we need to do? and 3) How do we do it?  The problem is, a lot of developers think in reverse.  We come up with nifty, cool solutions to problems that don&#8217;t really need fixing.  We&#8217;re worried about &#8220;the How&#8221; when we should be worried about &#8220;the What&#8221;.   In this case, something as simple as DateTime.Now is now being turned into two interfaces, two classes and some extension methods.  Backing up a step further, someone needs to ask &#8220;Why&#8221; this problem needs to be fixed, and the answer is &#8220;because sometimes processing goes past midnight and DateTime.Now is no longer &#8216;correct&#8217;&#8221;.  So basically, we have &#8220;bad&#8221; data, so instead of overcomplicating the bad data to insure you get the right data, wouldn&#8217;t it be easier for everyone to pass in the correct data in the first place (from a database, from a file, from a user control where they chose a Date, etc/)?  </p>
<p>DateTime.Now is great for timestamping a Forum Post, setting the value of a &#8220;Last Updated&#8221;, etc. but it shouldn&#8217;t be used to drive business logic if there is a possiblity that it might prevent it from working. </p>
<p>Also, if this is indeed just a temporary fix becase the project is so bad, why not JFHCI with a fix, throw a &#8220;HACK&#8221; comment above it and move on since that logic has a very, very good chance of being ripped out of that particular method anyways?</p>
<p>Just playing Devil&#8217;s advocate more than anything, I have a few years of banking experience and I&#8217;m just shocked at how horrible the code is especially when it comes to their ETLs/Nightly Processing.  Makes me want to hide money under my mattress. <img src='http://codebetter.com/drusellers/wp-includes/images/smilies/icon_wink.gif' alt=';)' class='wp-smiley' /> </p>
</div>
					</div>
				</li>
					<li id="dsq-comment-41">
					<div id="dsq-comment-header-41" class="dsq-comment-header">
						<cite id="dsq-cite-41">
								<span id="dsq-author-user-41">Karsten</span>
							</cite>
					</div>
					<div id="dsq-comment-body-41" class="dsq-comment-body">
						<div id="dsq-comment-message-41" class="dsq-comment-message"><p>What do you think about TypeMock?<br />
I guess you will say that&#8217;s a bad idea. But why?<br />
It&#8217;s a honest question. I&#8217;m very new to unit testing and still thinking about starting with TDD. But to me Typemock would seem as a good solution for this problem??</p>
</div>
					</div>
				</li>
					<li id="dsq-comment-42">
					<div id="dsq-comment-header-42" class="dsq-comment-header">
						<cite id="dsq-cite-42">
								<span id="dsq-author-user-42">Discofunk</span>
							</cite>
					</div>
					<div id="dsq-comment-body-42" class="dsq-comment-body">
						<div id="dsq-comment-message-42" class="dsq-comment-message"><p>In a recent project we littered our code with DateTime.Now which caused a lot of headaches in the end.  We found it became important to make the distinction between a day and a time.  A clock object with the ability to freeze time, warp-into-the-future and blast-into-the-past is also helpful for unit testing timed events.</p>
</div>
					</div>
				</li>
				</ul>
		</div>
	</div>

<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

<script type="text/javascript">
/* <![CDATA[ */
	var disqus_url = 'http://codebetter.com/drusellers/2009/01/11/kick-the-datetime-now-addiction/ ';
	var disqus_identifier = '8 /blogs/dru.sellers/archive/2009/01/11/kick-the-datetime-now-addiction.aspx';
	var disqus_container_id = 'disqus_thread';
	var disqus_domain = 'disqus.com';
	var disqus_shortname = 'drusellers';
	var disqus_title = "Kick the DateTime.Now addiction";
		var disqus_config = function () {
	    var config = this; // Access to the config object

	    /* 
	       All currently supported events:
	        * preData — fires just before we request for initial data
	        * preInit - fires after we get initial data but before we load any dependencies
	        * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
	        * afterRender - fires when template is rendered but before we show it
	        * onReady - everything is done
	     */

		config.callbacks.preData.push(function() {
			// clear out the container (its filled for SEO/legacy purposes)
			document.getElementById(disqus_container_id).innerHTML = '';
		});
				config.callbacks.onReady.push(function() {
			// sync comments in the background so we don't block the page
			DISQUS.request.get('?cf_action=sync_comments&post_id=8');
		});
					};
	var facebookXdReceiverPath = 'http://codebetter.com/drusellers/wp-content/plugins/disqus-comment-system/xd_receiver.htm';
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
	var DsqLocal = {
		'trackbacks': [
		],
		'trackback_url': "http:\/\/codebetter.com\/drusellers\/2009\/01\/11\/kick-the-datetime-now-addiction\/trackback\/"	};
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
	var dsq = document.createElement('script'); dsq.type = 'text/javascript';
	dsq.async = true;
	dsq.src = 'http://' + disqus_shortname + '.' + disqus_domain + '/embed.js?pname=wordpress&pver=2.61';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.254 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-27 09:49:44 -->
<!-- super cache -->