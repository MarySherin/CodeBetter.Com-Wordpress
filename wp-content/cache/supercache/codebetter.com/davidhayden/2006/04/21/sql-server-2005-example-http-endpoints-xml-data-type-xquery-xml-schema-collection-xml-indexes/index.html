<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>SQL Server 2005 Example: Http Endpoints, XML Data Type, XQuery, XML Schema Collection, XML Indexes | David Hayden</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/davidhayden/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/davidhayden/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/davidhayden/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/davidhayden/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/davidhayden/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='David Hayden' href='http://codebetter.com/davidhayden/' />
<link rel='start' title='Object Identity vs. Object Equality &#8211; Overriding System.Object.Equals(Object obj)' href='http://codebetter.com/davidhayden/2005/02/22/object-identity-vs-object-equality-overriding-system-object-equalsobject-obj/' />
<link rel='prev' title='Sarasota Florida .NET Developers: SQL Server 2005 and Enterprise Library 2.0' href='http://codebetter.com/davidhayden/2006/04/14/sarasota-florida-net-developers-sql-server-2005-and-enterprise-library-2-0/' />
<link rel='next' title='ReSharper 2.0 Beta Available for Download' href='http://codebetter.com/davidhayden/2006/04/21/resharper-2-0-beta-available-for-download/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/' />
<link rel='shortlink' href='http://codebetter.com/davidhayden/?p=110' />
<meta name="_awb_version" content="2.0.3" /><link rel="stylesheet" href="http://codebetter.com/davidhayden/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.6" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/davidhayden/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-110" class="post-110 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">SQL Server 2005 Example: Http Endpoints, XML Data Type, XQuery, XML Schema Collection, XML Indexes</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/davidhayden/author/davidhayden/" title="View all posts by davidhayden">davidhayden</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/" title="4:03 pm" rel="bookmark"><span class="entry-date">April 21, 2006</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/davidhayden/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/davidhayden/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/davidhayden/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p><P>This is an example <A href="http://davidhayden.com/blog/dave/archive/2006/04/18/2918.aspx">I presented at the last Sarasota .NET Developer Meeting</A> during my SQL Server 2005 Presentation. It provides a glimpse at two new features in <A href="http://davidhayden.com/blog/dave/category/14.aspx?Show=All">SQL Server 2005</A>: <A href="http://davidhayden.com/blog/dave/archive/2006/03/30/2896.aspx">Http Endpoints</A> and the <A href="http://davidhayden.com/blog/dave/archive/2006/04/11/2909.aspx">XML Data Type</A>. It also shows a little XQuery, XML Indexes&nbsp;as well as consuming and using XML Web Services in Visual Studio 2005.</P><br />
<P>&nbsp;</P><br />
<P><STRONG>Book Collection Library</STRONG></P><br />
<P>The idea here is that I have a vast collection of technical books and often I would like the ability to do a quick query on these books based on a keyword and retrieve a list of titles with their page numbers that talk about the keyword.</P><br />
<P>For example, I would like to be able to type in &#8220;ADO.NET&#8221; and have a list of books that talk about ADO.NET be displayed with their page numbers as such:</P><br />
<P>&nbsp;</P><br />
<P align="center"><IMG src="/photos/david.hayden/images/143183/original.aspx"></P><br />
<P>&nbsp;</P><br />
<P><STRONG>Architecture</STRONG></P><br />
<P>The architecture of my trivial application looks as follows:</P><br />
<P>&nbsp;</P><br />
<P align="center"><IMG src="/photos/david.hayden/images/143184/original.aspx"></P><br />
<P>&nbsp;</P><br />
<P>I have created an Http Endpoint in SQL Server 2005, called <STRONG>Library_Books</STRONG>. There is a method defined in this Endpoint, called <STRONG>FindBooksByKeyword</STRONG>, that accepts a keyword as a parameter and maps to a stored procedure in the <STRONG>Library</STRONG> Database, called <STRONG>dbo.FindBooksByKeyword</STRONG>. This stored procedure does a select on the <STRONG>Books</STRONG> Table in the database, finding all titles and page numbers that have the keyword and return the rowsets.</P><br />
<P>Here is a picture that gives you a overview of the players in the database:</P><br />
<P>&nbsp;</P><br />
<P align="center"><IMG src="/photos/david.hayden/images/143185/original.aspx"></P><br />
<P>&nbsp;</P><br />
<P>&nbsp;</P><br />
<P>Here is the Http Endpoint:</P><br />
<P>&nbsp;</P><br />
<P align="center"><IMG src="/photos/david.hayden/images/143186/original.aspx"></P><br />
<P>&nbsp;</P><br />
<P><STRONG>Books Table</STRONG></P><br />
<P>The Books Table contains 3 fields</P><br />
<UL><br />
<LI>ISBN &#8211; serves as PK</LI><br />
<LI>Title</LI><br />
<LI>BookIndex &#8211; XML Data Type containing the book&#8217;s index</LI></UL><br />
<P>The BookIndex is a simple XML Document. Here is an example of inserting a book in the table that shows you the layout of the XML and the look of the content:</P><br />
<P>&nbsp;</P><PRE><SPAN>Insert into dbo.Books<br />
(ISBN,Title,BookIndex)<br />
VALUES<br />
(</SPAN><SPAN>&#8216;</SPAN><SPAN>1-59059-589-3</SPAN><SPAN>&#8216;</SPAN><SPAN>,</SPAN><SPAN>&#8216;</SPAN><SPAN>Visual C# 2005 Recipes</SPAN><SPAN>&#8216;</SPAN><SPAN>,<br />
CAST(</SPAN><SPAN>&#8216;<br />
</SPAN><SPAN>&lt;</SPAN><SPAN>index</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>15</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>AppDomain</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>319</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>DataTable</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>328</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>DataSet</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>149</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>Encrypt</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>167</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>File IO</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>27</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>GAC</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>keyword page</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>55</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN>Generics</SPAN><SPAN>&lt;/</SPAN><SPAN>keyword</SPAN><SPAN>&gt;</SPAN><SPAN><br />
</SPAN><SPAN>&lt;/</SPAN><SPAN>index</SPAN><SPAN>&gt;</SPAN><SPAN>&#8216;</SPAN><SPAN> as XML))</SPAN></PRE><br />
<P>&nbsp;</P><br />
<P><STRONG>XML Schema Collection</STRONG></P><br />
<P>One of the beauties of SQL Server 2005 is that we can now add schemas to the database and associate them to a XML Data Type, providing validation, Typed XML, and better performance when doing XQuery.</P><br />
<P>I let <A HREF="/blogs/david.hayden/archive/2006/04/11/142686.aspx">VS 2005 create the schema for me based on test data</A> and then inserted the schema into the database, calling it BookIndex:</P><br />
<P>&nbsp;</P><PRE><SPAN>CREATE XML SCHEMA COLLECTION BookIndex<br />
AS<br />
N</SPAN><SPAN>&#8216;</SPAN><SPAN>&lt;xs:schema attributeFormDefault=&#8221;unqualified&#8221;</SPAN><SPAN><br />
</SPAN><SPAN>    elementFormDefault</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>qualified</SPAN><SPAN>&#8220;</SPAN><SPAN><br />
    xmlns:xs</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>http://www.w3.org/2001/XMLSchema</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;</SPAN><SPAN>xs:element name</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>index</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN><br />
        </SPAN><SPAN>&lt;</SPAN><SPAN>xs:complexType</SPAN><SPAN>&gt;</SPAN><SPAN><br />
            </SPAN><SPAN>&lt;</SPAN><SPAN>xs:sequence</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                </SPAN><SPAN>&lt;</SPAN><SPAN>xs:element maxOccurs</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>unbounded</SPAN><SPAN>&#8220;</SPAN><SPAN> name</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>keyword</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                    </SPAN><SPAN>&lt;</SPAN><SPAN>xs:complexType</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                        </SPAN><SPAN>&lt;</SPAN><SPAN>xs:simpleContent</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                            </SPAN><SPAN>&lt;</SPAN><SPAN>xs:extension </SPAN><SPAN>base</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>xs:string</SPAN><SPAN>&#8220;</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                                </SPAN><SPAN>&lt;</SPAN><SPAN>xs:attribute name</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>page</SPAN><SPAN>&#8220;</SPAN><SPAN> type</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>xs:int</SPAN><SPAN>&#8220;</SPAN><SPAN> use</SPAN><SPAN>=</SPAN><SPAN>&#8220;</SPAN><SPAN>required</SPAN><SPAN>&#8220;</SPAN><SPAN> </SPAN><SPAN>/&gt;</SPAN><SPAN><br />
                            </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:extension</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                        </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:simpleContent</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                    </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:complexType</SPAN><SPAN>&gt;</SPAN><SPAN><br />
                </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:element</SPAN><SPAN>&gt;</SPAN><SPAN><br />
            </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:sequence</SPAN><SPAN>&gt;</SPAN><SPAN><br />
        </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:complexType</SPAN><SPAN>&gt;</SPAN><SPAN><br />
    </SPAN><SPAN>&lt;/</SPAN><SPAN>xs:element</SPAN><SPAN>&gt;</SPAN><SPAN><br />
</SPAN><SPAN>&lt;/</SPAN><SPAN>xs:schema</SPAN><SPAN>&gt;</SPAN><SPAN>&#8216;</SPAN></PRE><br />
<P>&nbsp;</P><br />
<P><STRONG>XML Indexes</STRONG></P><br />
<P>Because I planned on querying the XML data using XQuery, I decided to&nbsp;create a Primary XML Index on the table at a minimum. I could have also created up to 3 secondary XML Indexes as well.</P><br />
<P>&nbsp;</P><PRE><SPAN>CREATE PRIMARY XML INDEX idx_XML_Primary_Books_BookIndex<br />
ON dbo.Books(BookIndex)</SPAN></PRE><br />
<P>&nbsp;</P><br />
<P>As you can see from the overall image of the database, the BookIndex Column in the Books Table is tied to the schema.</P><br />
<P>&nbsp;</P><br />
<P><STRONG>The FindBooksByKeyword Stored Procedure</STRONG></P><br />
<P>Shown below is a <STRONG>FindBooksByKeyword</STRONG> Stored Procedure that uses XQuery to dive into the BookIndex XML Data Type to look for keywords and return page numbers and titles. My XQuery skills are weak, so the stored procedure shown below&nbsp;may have been written easier or better. However, it does work and shows the integration of XQuery into the stored procedure. I would love to hear from any XML Gurus if they know of a better or more proper way to query the data.</P><br />
<P>&nbsp;</P><PRE><SPAN>CREATE PROCEDURE dbo.FindBooksByKeyword<br />
    @Keyword varchar(</SPAN><SPAN>25</SPAN><SPAN>)<br />
AS<br />
BEGIN<br />
    SET NOCOUNT ON;</p>
<p>    SELECT Title, BookIndex.value(</SPAN><SPAN>&#8216;</SPAN><SPAN>(/index/keyword[.=sql:variable("@Keyword")]/@page)[1]</SPAN><SPAN>&#8216;<BR>                                       </SPAN><SPAN>,</SPAN><SPAN>&#8216;</SPAN><SPAN>varchar(25)</SPAN><SPAN>&#8216;</SPAN><SPAN>) </SPAN><SPAN>as</SPAN><SPAN> Page<br />
    FROM Books<br />
    WHERE BookIndex.exist(</SPAN><SPAN>&#8216;</SPAN><SPAN>/index/keyword[.=sql:variable("@Keyword")]</SPAN><SPAN>&#8216;</SPAN><SPAN>) </SPAN><SPAN>=</SPAN><SPAN> </SPAN><SPAN>1</SPAN><SPAN></p>
<p>END<br />
GO</SPAN></PRE><br />
<P>&nbsp;</P><br />
<P><STRONG>Creating the Http Endpoint</STRONG></P><br />
<P>We now need an Http Endpoint that exposes our stored procedure as an XML Web Service. I created it as such:</P><br />
<P>&nbsp;</P><PRE><SPAN>CREATE ENDPOINT Library_Books<br />
    STATE </SPAN><SPAN>=</SPAN><SPAN> Started<br />
AS HTTP<br />
    (<br />
        PATH </SPAN><SPAN>=</SPAN><SPAN> </SPAN><SPAN>&#8216;</SPAN><SPAN>/Library/Books</SPAN><SPAN>&#8216;</SPAN><SPAN>,<br />
        AUTHENTICATION </SPAN><SPAN>=</SPAN><SPAN> (INTEGRATED),<br />
        PORTS </SPAN><SPAN>=</SPAN><SPAN> (CLEAR),<br />
        SITE </SPAN><SPAN>=</SPAN><SPAN> </SPAN><SPAN>&#8216;</SPAN><SPAN>*</SPAN><SPAN>&#8216;</SPAN><SPAN><br />
    )<br />
FOR SOAP<br />
    (<br />
        WEBMETHOD </SPAN><SPAN>&#8216;</SPAN><SPAN>FindBooksByKeyword</SPAN><SPAN>&#8216;</SPAN><SPAN><br />
            (NAME </SPAN><SPAN>=</SPAN><SPAN> </SPAN><SPAN>&#8216;</SPAN><SPAN>Library.dbo.FindBooksByKeyword</SPAN><SPAN>&#8216;</SPAN><SPAN>,<br />
             FORMAT </SPAN><SPAN>=</SPAN><SPAN> ROWSETS_ONLY),<br />
        WSDL </SPAN><SPAN>=</SPAN><SPAN> DEFAULT,<br />
        DATABASE </SPAN><SPAN>=</SPAN><SPAN> </SPAN><SPAN>&#8216;</SPAN><SPAN>Library</SPAN><SPAN>&#8216;</SPAN><SPAN>,<br />
        NAMESPACE </SPAN><SPAN>=</SPAN><SPAN> DEFAULT<br />
    )</SPAN></PRE><br />
<P>&nbsp;</P><br />
<P>The WSDL for this Http Endpoint would be:</P><br />
<P>&nbsp;</P><br />
<P><STRONG>http://localhost/library/books?wsdl</STRONG></P><br />
<P>&nbsp;</P><br />
<P>which can now be consumed&nbsp;in a windows form application.</P><br />
<P>&nbsp;</P><br />
<P><STRONG>Calling the Http Endpoint</STRONG></P><br />
<P>The code for the winform application is pretty simple:</P><br />
<P>&nbsp;</P><PRE><SPAN>//</SPAN><SPAN> Instantiate Service</SPAN><SPAN><br />
</SPAN><SPAN>Library.Library_Books libraryService </SPAN><SPAN>=</SPAN><SPAN><br />
    </SPAN><SPAN>new</SPAN><SPAN> Library.Library_Books();</p>
<p></SPAN><SPAN>//</SPAN><SPAN> Set Default Credentials</SPAN><SPAN><br />
</SPAN><SPAN>libraryService.Credentials </SPAN><SPAN>=</SPAN><SPAN><br />
    CredentialCache.DefaultCredentials;</p>
<p></SPAN><SPAN>//</SPAN><SPAN> Call FindByKeywords</SPAN><SPAN><br />
</SPAN><SPAN>DataSet ds </SPAN><SPAN>=</SPAN><SPAN><br />
    libraryService.FindBooksByKeyword(keyword);</p>
<p></SPAN><SPAN>//</SPAN><SPAN> Bind</SPAN><SPAN><br />
</SPAN><SPAN>Books.DataSource </SPAN><SPAN>=</SPAN><SPAN><br />
    ds.Tables[</SPAN><SPAN>0</SPAN><SPAN>].DefaultView;</SPAN></PRE><br />
<P>&nbsp;</P><br />
<P><STRONG>Conclusion</STRONG></P><br />
<P>Some of the features in SQL Server 2005 are pretty cool. You may or may not want to use them depending on the size of the application, etc., but it is cool to know that they exist and how they work. Hopefully this will help others interested in these new features.</P><br />
<P>&nbsp;</P><br />
<P><STRONG>Resources:</STRONG></P><br />
<UL><br />
<LI><A href="http://davidhayden.com/blog/dave/archive/2006/04/18/2917.aspx">SQLCLR &#8211; Create CLR User-Defined Function ( UDF ) &#8211; Check Constraint on EmailAddress Column Using RegEx</A></LI><br />
<LI><A href="http://davidhayden.com/blog/dave/archive/2006/04/15/2916.aspx">Web Services and SQL Server 2005 &#8211; sqlbatch &#8211; HTTP Endpoint &#8211; BATCHES = ENABLED</A></LI><br />
<LI><A href="http://davidhayden.com/blog/dave/archive/2006/03/30/2896.aspx">Native XML Web Services in SQL Server 2005 &#8211; Creating HTTP Endpoints &#8211; Native HTTP</A></LI><br />
<LI><A href="http://davidhayden.com/blog/dave/archive/2006/03/31/2897.aspx">SQL Server 2005 XML Web Services &#8211; Create HTTP Endpoint Using SMO</A></LI><br />
<LI><A href="http://davidhayden.com/blog/dave/archive/2006/04/11/2909.aspx">XML Data Type in SQL Server 2005 &#8211; Part I</A></LI><br />
<LI><A href="http://davidhayden.com/blog/dave/category/51.aspx">SQL Server Management Objects</A></LI></UL><br />
<P>&nbsp;</P></p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/davidhayden/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/" title="Permalink to SQL Server 2005 Example: Http Endpoints, XML Data Type, XQuery, XML Schema Collection, XML Indexes" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/feed/" title="Comments RSS to SQL Server 2005 Example: Http Endpoints, XML Data Type, XQuery, XML Schema Collection, XML Indexes" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-110 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/davidhayden/2006/04/14/sarasota-florida-net-developers-sql-server-2005-and-enterprise-library-2-0/" rel="prev"><span class="meta-nav">&larr;</span> Sarasota Florida .NET Developers: SQL Server 2005 and Enterprise Library 2.0</a></div>
					<div class="nav-next"><a href="http://codebetter.com/davidhayden/2006/04/21/resharper-2-0-beta-available-for-download/" rel="next">ReSharper 2.0 Beta Available for Download <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

							<div id="comments">


			<h3 id="comments-title">6 Responses to <em>SQL Server 2005 Example: Http Endpoints, XML Data Type, XQuery, XML Schema Collection, XML Indexes</em> </h3>


			<ol class="commentlist">
						<li class="comment even thread-even depth-1" id="li-comment-240">
		<div id="comment-240">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://davidhayden.com/blog/dave/' rel='external nofollow' class='url'>dhayden</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#comment-240">April 22, 2006 at 8:55 pm</a></div>

		<div class="comment-body"><p>Thanks, John.</p>
<p>The new XML features in SQL Server 2005 are awesome. Just another reason why I need to improve upon my XML skills <img src='http://codebetter.com/davidhayden/wp-includes/images/smilies/icon_smile.gif' alt=':)' class='wp-smiley' />  So much to learn, so little time&#8230;</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-239">
		<div id="comment-239">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://davidhayden.com/blog/dave/' rel='external nofollow' class='url'>dhayden</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#comment-239">April 22, 2006 at 8:52 pm</a></div>

		<div class="comment-body"><p>Eber,</p>
<p>Great point. You definitely have to be careful about large tables when it comes to anything.</p>
<p>I haven&#8217;t looked into XML Indexes in depth. The basic idea is that when you create a primary XML index it shreds the XML into a table behind the scenes. This increases query performance, because without the primary XML index, SQL Server shreds the XML during run-time for each query.</p>
<p>If one is doing a lot of XQuery and performance is critical, IMHO the primary XML index seems like a necessary evil. Index management is definitely a performance factor when adding, modifying, and deleting nodes happens often.</p>
<p>The need and value of a primary XML index is probably based on the size of the tables and the relative frequency of querying compared to data manipulation in the XML Data Type columns. If one is doing mostly querying and very little modifications, my humble opinion is that an index is a good thing. If the situation is just the opposite, an index can possibly be more trouble than it is worth.</p>
<p>Here are a couple of links about XML Indexes and performance:</p>
<p><a href="http://msdn.microsoft.com/xml/default.aspx?pull=/library/en-us/dnsql90/html/sqloptxml.asp" rel="nofollow">http://msdn.microsoft.com/xml/default.aspx?pull=/library/en-us/dnsql90/html/sqloptxml.asp</a></p>
<p><a href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=86062&#038;SiteID=1" rel="nofollow">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=86062&#038;SiteID=1</a></p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-238">
		<div id="comment-238">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://davidhayden.com/blog/dave/' rel='external nofollow' class='url'>dhayden</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#comment-238">April 22, 2006 at 8:21 pm</a></div>

		<div class="comment-body"><p>DaRage,</p>
<p>A select statement in your stored procedure will return a DataSet. If you added the FOR XML onto the stored procedure it would return an XmlElement. Return values are of type Int32. An error would return as of type SqlMessage. etc&#8230;</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-237">
		<div id="comment-237">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://ebersys.blogspot.com/' rel='external nofollow' class='url'>Eber Irigoyen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#comment-237">April 22, 2006 at 3:39 pm</a></div>

		<div class="comment-body"><p>&#8220;I decided to create a Primary XML Index&#8221;<br />
primary like in unique and clustered?</p>
<p>if that is the case, for any decent size table this wouldn&#8217;t be a good idea, would it?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-236">
		<div id="comment-236">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">DaRage</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#comment-236">April 22, 2006 at 1:21 pm</a></div>

		<div class="comment-body"><p>So any sql result set will be returned in a dataset? what if i want to return it in something else?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-235">
		<div id="comment-235">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/blogs/john.papa' rel='external nofollow' class='url'>johnpapa</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#comment-235">April 21, 2006 at 4:43 pm</a></div>

		<div class="comment-body"><p>Nice post David. The XML features in SQL Server 2005 are vastly improved. I especially love the XQuery abilities.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
			</ol>



								<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/davidhayden/2006/04/21/sql-server-2005-example-http-endpoints-xml-data-type-xquery-xml-schema-collection-xml-indexes/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://codebetter.com/davidhayden/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name</label> <span class="required">*</span><input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">Email</label> <span class="required">*</span><input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">Website</label><input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">Comment</label><textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='110' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a0e24a66cd" /></p>					</form>
							</div><!-- #respond -->
						
</div><!-- #comments -->

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='/wp-content/plugins/syntaxhighlighter//third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 167.745 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-18 15:27:37 -->
<!-- super cache -->