<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Always Valid | Greg Young</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/gregyoung/xmlrpc.php" />
	                <link rel="stylesheet" href="http://codebetter.com/gregyoung/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://codebetter.com/gregyoung/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/gregyoung/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://codebetter.com/gregyoung/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Greg Young' href='http://codebetter.com/gregyoung/' />
<link rel='start' title='Howdy and Viewing Unmanaged Code in VS.NET' href='http://codebetter.com/gregyoung/2006/06/09/howdy-and-viewing-unmanaged-code-in-vs-net/' />
<link rel='prev' title='Alt.Net Vancouver Edition' href='http://codebetter.com/gregyoung/2009/05/20/alt-net-vancouver-edition/' />
<link rel='next' title='The Anemic Domain Model Pattern' href='http://codebetter.com/gregyoung/2009/07/15/the-anemic-domain-model-pattern/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel='canonical' href='http://codebetter.com/gregyoung/2009/05/22/always-valid/' />
<link rel='shortlink' href='http://codebetter.com/gregyoung/?p=124' />
<link rel="stylesheet" href="http://codebetter.com/gregyoung/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://codebetter.com/gregyoung/wp-content/uploads/spacker-cache/a8046d2f1fc1c08af413701218a11c1d.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content" class="container_12">
			<div id="main" class="grid_8">


				<div id="post-124" class="post-124 post type-post status-publish format-standard hentry category-uncategorized">
					<h1 class="entry-title">Always Valid</h1>

					<div class="entry-meta">
						<span class="meta-prep meta-prep-author">Posted by </span>
						<span class="author vcard"><a class="url fn n" href="http://codebetter.com/gregyoung/author/gregyoung/" title="View all posts by gregyoung">gregyoung</a></span>
						<span class="meta-sep"> on  </span>
						<a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/" title="1:08 pm" rel="bookmark"><span class="entry-date">May 22, 2009</span></a>
											</div><!-- .entry-meta -->

					<div class="entry-content">
						<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/gregyoung/feed/rss/"  rel="nofollow"><img src="http://codebetter.com/gregyoung/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/gregyoung/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div><p>Jeff Palermo recently wrote up a blog post about <a href="http://jeffreypalermo.com/blog/the-fallacy-of-the-always-valid-entity/">“The fallacy of the always valid entity”</a>. This post is a more thought out commentary to the ideas therein and could be better suited with a name of “The fallacy of the fallacy of the always valid entity”. </p>
<p>Jeff appears to be arguing with something that he for lack of better terminology just does not understand. He gives an example and then asks the question of:</p>
<li>“The fact that name is required needs to be context-bound.&#160; When is it invalid?”</li>
<p>This is referring to one type of validation that occurs within a domain. This is a validation to perform an operation. Generally speaking this type of validation is not performed by the object itself but is represented as observations of that object by another object. Jeff is right in that trying to make these things always valid makes no sense.</p>
<p>Of course no one in the “always valid object” camp has ever made such a statement. This brings us to the crutch of the argument … What do we want to keep valid?</p>
<p>&#160;</p>
<p><a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/gregyoung/clydsdale_5F00_7E46E7D7.jpg"><img style="border-right: 0px;border-top: 0px;border-left: 0px;border-bottom: 0px" height="194" alt="clydsdale" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/gregyoung/clydsdale_thumb_0178CFC0.jpg?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1920566612&amp;Signature=Dye2oErEdAumGoj6h51VCmnIfk4%3d" width="244" border="0" /></a> ==?&#160; <a href="http://codebetter.com/cfs-file.ashx/__key/CommunityServer.Blogs.Components.WeblogFiles/gregyoung/mohawkpony_5F00_60F1900D.jpg"><img style="border-right: 0px;border-top: 0px;border-left: 0px;border-bottom: 0px" height="244" alt="mohawk pony" src="http://s3.amazonaws.com:80/CodeBetter/CommunityServer.Blogs.Components.WeblogFiles/gregyoung/mohawkpony_thumb_144D536A.jpg?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1920566612&amp;Signature=W8FoptVFnYFy3n4sDunpPG49DZE%3d" width="184" border="0" /></a> </p>
<p>Not surprisingly some great people have dealt with these problems in the past.We can look at by going into philosophy (yeah boring I know) for a moment. Let’s say there are two horses a big Clydesdale and my friend’s daughter’s pony “samantha”. We have all seen the Budweiser commercials so we can imagine what the Clydesdale looks like but “samantha” is quite different. She is short, kind of thin, white with a black nose, and has her hoofs painted most of the time (likely due to her proximity to my friend’s daughter).</p>
<p>If we were to look at these two things we know that they are both horses. But they are still quite different, why is that? <a href="http://en.wikipedia.org/wiki/Theory_of_Forms">Plato put forth the concept of ideals</a>, that there is somewhere an ideal horse which represents all of the recognizable traits of a horse. All horses can be descended from the one ideal horse, the ideal horse represents all of their common traits.</p>
<p>So you must be thinking how does this relate back to the original topic of objects always being valid? We have introduced a second type of validation!</p>
<p>Suppose we had a unicorn with no horn? Would it still be a unicorn? What about a cyclops with two eyes? These things are <strong>invariants </strong>of the objects (they belong on the concept of the ideal). If we were to have an object that did not meet these invariants it would in fact cease being the concept that we knew it as.</p>
<p>We run across these types of things regularly in our domains! Let’s imagine we are building grain silos … could we have a grain silo without a capacity? If we were writing poker software could we have a poker table without any seats? For a product application does it make sense to allow a sale line item without a product?</p>
<p>It can be quite useful for us to model our domains using invariants. The main reason for this is that it helps with DRY. Quite often we will see that nearly all or all operations require a certain thing to be true, as such the checks are run in many places. As an example a customer must have a name to place an order, they also must have a name to move, or to open a credit account. We could always be diligent to check that the customer has a name in various contexts or we can build into the customer object the invariant that the name will always be non-null. Invariants help us to narrow our thinking when we rationalize about our domain.</p>
<p>TDD will quickly lead you to the need for invariants. Consider when I have a BattleService that takes a parameter of a Cyclops … Without using invariants the first test I should be writing is should_throw_not_a_cyclops_exception_when_cyclops_has_two_eyes() … As soon as I find myself writing this test I should be seeing the language and realizing that I am being silly. In case that does not work I should at the least see that if I moved such a thing to be an invariant of my object that I could be saving myself code/tests elsewhere.</p>
<p>Now to bring this back to Jeffrey’s original misunderstanding of the always valid viewpoint, it is not that an object must always be valid for everything, there are lots of context based validations… Always valid means that you are not breaking your invariants. </p>
											</div><!-- .entry-content -->


					<div class="entry-utility">
					This entry was posted in <a href="http://codebetter.com/gregyoung/category/uncategorized/" title="View all posts in Uncategorized" rel="category tag">Uncategorized</a>. Bookmark the <a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/" title="Permalink to Always Valid" rel="bookmark">permalink</a>. Follow any comments here with the <a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/feed/" title="Comments RSS to Always Valid" rel="alternate" type="application/rss+xml">RSS feed for this post</a>.
					</div><!-- .entry-utility -->
				</div><!-- #post-124 -->

				<div id="nav-below" class="navigation">
					<div class="nav-previous"><a href="http://codebetter.com/gregyoung/2009/05/20/alt-net-vancouver-edition/" rel="prev"><span class="meta-nav">&larr;</span> Alt.Net Vancouver Edition</a></div>
					<div class="nav-next"><a href="http://codebetter.com/gregyoung/2009/07/15/the-anemic-domain-model-pattern/" rel="next">The Anemic Domain Model Pattern <span class="meta-nav">&rarr;</span></a></div>
				</div><!-- #nav-below -->

							<div id="comments">


			<h3 id="comments-title">16 Responses to <em>Always Valid</em> </h3>


			<ol class="commentlist">
						<li class="comment even thread-even depth-1" id="li-comment-2723">
		<div id="comment-2723">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Harry</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2723">September 6, 2009 at 11:00 pm</a></div>

		<div class="comment-body"><p>If I remember correctly, in DDD, invariances should be reinforced at the aggregate level, mostly by aggregate root. I think Jeffery&#8217;s point is that object level &#8216;always valid&#8217; is irrelevent especially when aggregate is internally handling the internal stuff (loading, creating, &#8230; etc). And the invariance and the aggregate boundary is the context Jeffery was talking about.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2722">
		<div id="comment-2722">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Tom</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2722">July 9, 2009 at 11:42 am</a></div>

		<div class="comment-body"><p>Hi,</p>
<p>Would be great to see some code of this, just a simple customer edit example.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2721">
		<div id="comment-2721">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Tom</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2721">July 8, 2009 at 3:48 pm</a></div>

		<div class="comment-body"><p>Good post as always.</p>
<p>I would like to see a code example of this if possible. I sometimes find it hard to picture how the code would be. Could you do it for a simple example of a say a customer which has contact addresses and when editing a customer he/she must have details (title, name etc) and at least one contact address?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2720">
		<div id="comment-2720">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://jlzdfrui.com/' rel='external nofollow' class='url'>Qolabisk</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2720">July 1, 2009 at 7:33 am</a></div>

		<div class="comment-body"><p>aPtDeK comment5 ,</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2719">
		<div id="comment-2719">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Illugi</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2719">May 27, 2009 at 6:35 pm</a></div>

		<div class="comment-body"><p>An interesting paper to read while thinking about these matters <a href="http://www.swen.uwaterloo.ca/~drayside/PAPERS/rayside_oopsla00.pdf" rel="nofollow">http://www.swen.uwaterloo.ca/~drayside/PAPERS/rayside_oopsla00.pdf</a></p>
<p>I do not think Greg should provide any code examples, invariants should not be viewed as something that easily can be understood by simple patterns or code examples. It&#8217;s far to fundamental and important for your domain and the deeper understaning of your design.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2718">
		<div id="comment-2718">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://meandmycode.com' rel='external nofollow' class='url'>Stephen</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2718">May 27, 2009 at 11:24 am</a></div>

		<div class="comment-body"><p>Gutted, I wrote a sizable reply but I don&#8217;t remember doing the &#8216;captcha&#8217; (looks to much like a banner to me, isn&#8217;t immediately obvious, ah well).</p>
<p>Basically I was saying that in terms of validation, entities already validate quite a lot by just being .net types, for example- we know an entity has these properties, and we also enforce how those properties look (int, DateTime, string &#8211; etc)..</p>
<p>It seems to me there are some universally correct validations for an entity, where any usual scenario would want these validations.. if not then you would probably want entities to be a property bag which seems scary.. it seems sensible that an entity should validate itself to these universal concerns (with compile time errors where possible, ie type correctness).</p>
<p>But that any additional concerns are concerns of a specific operation, and they should validate that a given entity satisfies their requirements.. my example was that if you passed a &#8216;Comment&#8217; to presentation logic, it may only care that you have a Name, Body and a post date.. but passing a comment to the persistence layer would have different concerns.. that the comments date is now in the future (for example).</p>
<p>However you manage to generalize these validations is up to you..</p>
<p>Variants are good for things that the type system can enforce, thus getting compile time validation.. but most validation I think happens at runtime, but I think tools like code contracts could massively help push runtime concerns to compile time.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2717">
		<div id="comment-2717">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://espacodj.com' rel='external nofollow' class='url'>Gustavo</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2717">May 26, 2009 at 12:26 pm</a></div>

		<div class="comment-body"><p>I agree with Nate, most of us wanna see some piece of code, specially about CQS!</p>
<p>Please Greg, make us happy!</p>
<p>Sory bad english</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2716">
		<div id="comment-2716">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/members/Greg/default.aspx' rel='external nofollow' class='url'>Greg</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2716">May 23, 2009 at 3:57 pm</a></div>

		<div class="comment-body"><p>Nate,</p>
<p>What sort of code would you be looking for here? I specifically stayed away from implementation as there is more than one way to implement an invariant depending on the style of your domain.</p>
<p>I can put up a new post with an example implementation if you want but it will have many things that seem different about it (i.e. its not just a property bucket)</p>
<p>Greg</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2715">
		<div id="comment-2715">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Nate</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2715">May 23, 2009 at 12:40 pm</a></div>

		<div class="comment-body"><p>Greg, I enjoy your writing.  I agree with you a lot.  But I&#8217;m going to stop paying attention to you until I see some source code.  Jeffrey releases plenty of it.  Where&#8217;s yours?</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2714">
		<div id="comment-2714">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://blogs.msdn.com/alexj' rel='external nofollow' class='url'>Alex James</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2714">May 23, 2009 at 1:36 am</a></div>

		<div class="comment-body"><p>The idea that there are contexts for validation is something I have struggled with before:</p>
<p><a href="http://blogs.msdn.com/alexj/archive/2009/01/07/nullable-false-but-when-exactly.aspx" rel="nofollow">http://blogs.msdn.com/alexj/archive/2009/01/07/nullable-false-but-when-exactly.aspx</a></p>
<p>Looking forward to chatting about this.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2713">
		<div id="comment-2713">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Eldon Ferran de Pol</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2713">May 22, 2009 at 11:43 pm</a></div>

		<div class="comment-body"><p>Hi Greg,</p>
<p>Excellent article and I totally agree. I find the distinction you make between different types of validation particularly useful. There is a clear difference between an object that is not in a fit state for some purpose and one that breaks incontrovertible laws about what it means to be of that type.</p>
<p>Do you have any good 3.0 patterns around invariants? For immutable types I tend to have guards in the constructor. Where I have state modifying methods I sometimes factor to a private method. Still all a bit clunky though.</p>
<p>Gillian,</p>
<p>Jeff&#8217;s argument that always valid is bad with entities is exactly the problem: there is nowhere it is more important in the context of invariants. To extend Greg&#8217;s example. A Cyclops with two eyes is not in need of questioning to find out whether it can wear glasses. It is simply not a Cyclops, by definition and, at a code level, by invariant.</p>
<p>DDD, an aspect of which Jeff puports to be demonstrating in his post, and all OO modelling is based on the  pretty simple premise that the better software reflects the real world the more chance it has of meeting requirements for that world. Why would anyone prepared to put in the time and effort to apply DDD ever allow a Cylops with two eyes to exist? It is never valid. In any context. That is what  we mean by invariant. It always holds true within the given domain.</p>
<p>Jeff&#8217;s example is the direct equivalent of the two-eyed Cyclops. I think this is the point he hasn&#8217;t grasped. The fallacy he talks of is not a fallacy at all. It is a subtlety he has completely missed in what &#8220;always valid&#8221; means to the people who actually use it</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2712">
		<div id="comment-2712">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/members/Greg/default.aspx' rel='external nofollow' class='url'>Greg</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2712">May 22, 2009 at 8:28 pm</a></div>

		<div class="comment-body"><p>@kyle re invariant.</p>
<p>They are things about our objects that are included *in the definition* of the object. For instance that a unicorn has a horn (I don&#8217;t check to make sure it has a horn, I assume it). His example is domain dependent, in some domains the fact that an order has a customer may very well be an invariant.</p>
<p>the point of this post is really more to explain the error in Jeff&#8217;s post. We must ALWAYS insure that our invariants are true &#8230; We also have validation that is context specific and can be broken (i.e. an entity is valid for an operation) but for invariants they are *always* true.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2711">
		<div id="comment-2711">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn"><a href='http://codebetter.com/members/kylebaley/default.aspx' rel='external nofollow' class='url'>Kyle Baley</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2711">May 22, 2009 at 8:17 pm</a></div>

		<div class="comment-body"><p>Greg,</p>
<p>Trying to get a sense of what you mean by invariants. They are things that, when satisfied, mean the object simply can&#8217;t exist, yesno? I.e. you don&#8217;t *need* to write the test checking to see if a cyclops has two eyes because that case is not physically possible?</p>
<p>And the type of validation from Jeff&#8217;s example, where you need a customer&#8217;s name in order to fill an order, is a different type of validation? That is, the customer&#8217;s name isn&#8217;t an invariant.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2710">
		<div id="comment-2710">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Gilligan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2710">May 22, 2009 at 4:11 pm</a></div>

		<div class="comment-body"><p>I always thought people bottled up &#8220;Always valid&#8221; in too specific a context. Jeff is only arguing &#8220;always valid&#8221; is bad with entity invariants. We have more objects in the domain model than entities. We have value objects, services, components (transient state-based objects), Repositories, Messages, etc. All of these have &#8220;invariants&#8221;. A BudweiserCommercial service would have an &#8220;invariant&#8221; that it can only register Clydesdale horses, for example.</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment even thread-even depth-1" id="li-comment-2709">
		<div id="comment-2709">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Blair Davidson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2709">May 22, 2009 at 3:21 pm</a></div>

		<div class="comment-body"><p>Hi Greg,</p>
<p>I do strongly agree with you.</p>
<p>Just commenting on the following quote.</p>
<p>&#8220;This is referring to one type of validation that occurs within a domain. This is a validation to perform an operation. Generally speaking this type of validation is not performed by the object itself but is represented as observations of that object by another object. Jeff is right in that trying to make these things always valid makes no sense.&#8221;</p>
<p>If we have object that can be valid in different states we can use the state pattern to do the validation in each different state. I still think we should validate an object in the constructor and as we perform operation like change address on an entity to stop an object from moving into an invalid state. </p>
<p>I have used the old isvalid approach before and you end up seeing checks everywhere for this in the service layer methods. I have found it to be annoying checking it everyone and it hurts when you forget to check it as it breaks code in other places that you have assumptions of things being in a certain state.</p>
<p>I would really love to get other peoples ideas and techniques and maybe share some code on the above.</p>
<p>Blair Davidson</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
		<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-2708">
		<div id="comment-2708">
		<div class="comment-author vcard">
			<img alt='' src='http://0.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=40' class='avatar avatar-40 photo avatar-default' height='40' width='40' />			<cite class="fn">Blair Davidson</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://codebetter.com/gregyoung/2009/05/22/always-valid/#comment-2708">May 22, 2009 at 3:19 pm</a></div>

		<div class="comment-body"><p>Hi Greg,</p>
<p>I do strongly agree with you.</p>
<p>Just commenting on the following quote.</p>
<p>&#8220;This is referring to one type of validation that occurs within a domain. This is a validation to perform an operation. Generally speaking this type of validation is not performed by the object itself but is represented as observations of that object by another object. Jeff is right in that trying to make these things always valid makes no sense.&#8221;</p>
<p>If we have object that can be valid in different states we can use the state pattern to do the validation in each different state. I still think we should validate an object in the constructor and as we perform operation like change address on an entity to stop an object from moving into an invalid state. </p>
<p>I have used the old isvalid approach before and you end up seeing checks everywhere for this in the service layer methods. I have found it to be annoying checking it everyone and it hurts when you forget to check it as it breaks code in other places that you have assumptions of things being in a certain state.</p>
<p>I would really love to get other peoples ideas and techniques and maybe share some code on the above.</p>
<p>Blair Davidson</p>
</div>

		<div class="reply">
					</div>
	</div>

	</li>
			</ol>



								<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/gregyoung/2009/05/22/always-valid/#respond" style="display:none;">Cancel reply</a></small></h3>
									<p class="must-log-in">You must be <a href="http://codebetter.com/gregyoung/wp-login.php?redirect_to=http%3A%2F%2Fcodebetter.com%2Fgregyoung%2F2009%2F05%2F22%2Falways-valid%2F">logged in</a> to post a comment.</p>												</div><!-- #respond -->
						
</div><!-- #comments -->

		</div><!-- #main -->
			<div id="sidebar" class="grid_4">

		<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3>One of these days I will add something to my user profile! For now, I shall remain mysterious.
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
									</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #container -->
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.251 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-26 19:59:42 -->
<!-- super cache -->