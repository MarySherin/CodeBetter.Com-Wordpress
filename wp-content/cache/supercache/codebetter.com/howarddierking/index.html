<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
	<meta charset="UTF-8" />
    <title>Howard Dierking | CodeBetter.Com &#8211; Stuff you need to Code Better!</title>
	<link rel="profile" href="http://gmpg.org/xfn/11" />
	
	<link href="http://feeds.feedburner.com/CodeBetter" title="CodeBetter.Com &raquo; Feed" type="application/rss+xml" rel="alternate">
	
		<link rel="pingback" href="http://codebetter.com/howarddierking/xmlrpc.php" />
	                <link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/ea73517eb74a545f51c376487c94dc9f.css" type="text/css" media="all" /><!-- Is Cache! -->
                <script type='text/javascript' src='http://cdn1.codebetter.com/wp-includes/js/l10n.js?ver=20101110'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://codebetter.com/howarddierking/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://cdn1.codebetter.com/wp-includes/wlwmanifest.xml" /> 
<link rel='index' title='Howard Dierking' href='http://codebetter.com/howarddierking/' />
<meta name="generator" content="WordPress 3.1-beta1-16732" />
<link rel="stylesheet" href="http://cdn1.codebetter.com/wp-content/plugins/digg-digg/include/../css/diggdigg-style.css?ver=4.5.0.7" type="text/css" media="screen" /><meta id="syntaxhighlighteranchor" name="syntaxhighlighter-version" content="3.1.1" />
                <script type="text/javascript" src="http://cdn1.codebetter.com/wp-content/uploads/spacker-cache/3e52f3b292da95601a0d3fbd9775ac0e.js">/*Is Cache!*/</script>
                	<style type="text/css">body { padding-top:0px !important; } html { margin-top: 0px !important; }</style>

</head>

<body>

			
		<div class="container_12 ui-tabs ui-widget ui-widget-content ui-corner-all" id="tabs">			
			<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
				<li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="#ui-tabs-1">CodeBetter.Com</a></li>
				<li class="ui-state-default ui-corner-top"><a href="http://devlicio.us">Devlicio.Us</a></li>				
				<div id="top-search">
				<form action="http://codebetter.com/globalsearch/" id="cse-search-box">
  <div>
   <fieldset id="search">
		<input type="hidden" name="cx" value="005178204031477491434:2bg5jtwgsfe" />
		<input type="hidden" name="cof" value="FORID:9" />
		<input type="hidden" name="ie" value="UTF-8" />
		<input type="text"  class="text-input" id="s" name="q" size="31" />
		<input type="image" src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/search-img.png" class="form-button" id="searchsubmit" value="GO" name="">				   	
	</fieldset>
  </div>
</form>
<script type="text/javascript" src="http://www.google.com/cse/brand?form=cse-search-box&lang=en&sitesearch=true"></script>
				</div>				
			</ul><div id="ui-tabs-1" class="ui-tabs-panel ui-widget-content ui-corner-bottom"></div><div id="ui-tabs-2" class="ui-tabs-panel ui-widget-content ui-corner-bottom ui-tabs-hide"></div>
		</div>
			
		<div id="main" class="container_12">
		
			<div id="logo" class="grid_3"><a href="/" title="CodeBetter.Com - Stuff you need to Code Better!"><image src="http://cdn1.codebetter.com/wp-content/themes/codebetter/images/codebetter_logo.png" height="48" width="223"></image></a></div>
			<div id="ad_leaderboard" class="grid_9">			</div>
			
			<div id="globalNav" class="grid_12">
				<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=EFEFEF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
				</ul>
								
			</div><!-- end div#globalNav.container_12 -->				
	
		<div id="content">
			<div id="main" class="grid_8">
			<div id="greet_block"><noscript><div class="greet_block wpgb_cornered"><div class="greet_text"><div class="greet_image"><a href="http://codebetter.com/howarddierking/feed/rss/"  rel="nofollow"><img src="http://cdn1.codebetter.com/wp-content/plugins/wp-greet-box/images/rss_icon.png" alt="WP Greet Box icon"/></a></div>Hello there! If you are new here, you might want to <a href="http://codebetter.com/howarddierking/feed/rss/" rel="nofollow"><strong>subscribe to the RSS feed</strong></a> for updates on this topic.<div style="clear:both"></div><div class="greet_block_powered_by">Powered by <a href="http://omninoggin.com/projects/wordpress-plugins/wp-greet-box-wordpress-plugin/" title="WP Greet Box WordPress Plugin" style="text-decoration:none;">WP Greet Box</a> <a href="http://omninoggin.com/" title="WordPress Plugin" style="text-decoration:none;">WordPress Plugin</a></div><div style="clear:both"></div></div></div></noscript></div>			
	<div id="nav-above" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-above -->


				
			<div id="post-72" class="post-72 post type-post status-publish format-standard hentry category-msdn-magazine category-pivot">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/" title="Permalink to Collection Hosting Using Windows Azure" rel="bookmark">Collection Hosting Using Windows Azure</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/" title="1:00 am" rel="bookmark"><span class="entry-date">January 28, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>As I’ve mentioned in a couple earlier posts, Pivot is driven using Deep Zoom image pyramids.  This means that for a collection of trade card images, multiple additional image combinations are generated for different zoom levels.  The net result here is a LOT of generated images.  For example, in the case of the MSDN Magazine Pivot collection, there are roughly 2400 article trade cards.  Generating the deep zoom collection from this set of input images yields roughly 100,000 images with a total collection size of just under 500 MB.</p>
<p>As you can see, there are a ton of images generated, and a reasonable number of bytes that need to be stored, cached, etc.  For the MSDN Magazine collection, hosting the collection in our data center architecture wasn’t really a viable option for several reasons – the most notable one being that there’s not a really great story for managing large collections of images that change on a frequency or schedule that is different than the monthly platform release schedule.  Fortunately, Azure blob storage provides a really simple solution for dealing with this problem, as well as a few others.  Here’s how I setup Azure hosting for the MSDN Magazine Pivot collection.</p>
<h1>CDN Caching</h1>
<p>One of the nice things about hosting the collection in Azure blob storage is that enabling CDN edge caching as simple as one button click (see the upper left corner in the image below).  For more information about CDN, check out <a href="http://en.wikipedia.org/wiki/Content_delivery_network">http://en.wikipedia.org/wiki/Content_delivery_network</a></p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/azure-portal-storage.png"><img style="margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;padding-top: 0px;border-width: 0px" src="http://codebetter.com/howarddierking/files/2011/01/azure-portal-storage_thumb.png" border="0" alt="azure-portal-storage" width="355" height="250" /></a></p>
<h1>Silverlight Client Access Policy</h1>
<p>I knew pretty early on that I wanted to host my cxml and Deep Zoom image pyramids in Azure blob storage.  However, my initial plan was to store the Silverlight xap file on our own Web platform and simply pull in the data.  As all of you Silverlight aficionados already know, while this is totally doable, you need to ensure that you have a <a href="http://msdn.microsoft.com/en-us/library/cc645032.aspx">client access policy XML file</a> at the URL root of whatever resource you’re trying to access.  For Azure blob storage, you’ll want to put this file in a special <a href="http://msdn.microsoft.com/en-us/library/ee395424.aspx">$root container</a>.  Doing this will apply the policies you declare to all containers in that blob storage account.</p>
<p>Like I said, my original plan was to host the collection in Azure and xap containing the Pivot viewer on our servers.  However, as I progressed in developing the solution, I realized something different.  There were no restrictions preventing me from hosting the xap itself in blob storage along with the collection data, and that by doing this, I would get 2 additional benefits:</p>
<ol>
<li>I no longer had a need for a clientaccesspolicy.xml file, since the xap and the data were now in the same domain.</li>
<li>By simplifying things with #1, I could now make the entire magazine Pivot experience available to anybody that wanted to embed it in his or her own site – for example, check out <a href="http://mtaulty.com/CommunityServer/blogs/mike_taultys_blog/archive/2010/08/19/pivotviewer-collections-and-the-silverlight-control.aspx">this point on Mike Taulty’s blog</a>.  Because everything needed for the Pivot experience is now sitting up in blob storage, the only code needed for anybody who wants to include the experience in his/her site is just the Silverlight object creation code.</li>
</ol>
<pre class="brush: xml; title: ;" title="">
&lt;object data=&quot;data:application/x-silverlight-2,&quot; height=&quot;100%&quot; type=&quot;application/x-silverlight-2&quot; width=&quot;100%&quot;&gt;
   &lt;param name=&quot;source&quot; value=&quot;http://az7446.vo.msecnd.net/msdn-magazine/Magazines.PivotViewer.xap&quot;&gt;
   &lt;param name=&quot;onError&quot; value=&quot;onSilverlightError&quot;&gt;
   &lt;param name=&quot;background&quot; value=&quot;white&quot;&gt;
   &lt;param name=&quot;minRuntimeVersion&quot; value=&quot;4.0.50401.0&quot;&gt;
   &lt;param name=&quot;autoUpgrade&quot; value=&quot;true&quot;&gt;
   &lt;param name=&quot;enableHtmlAccess&quot; value=&quot;true&quot;&gt;
   &lt;param name=&quot;initParams&quot; value=&quot;collection=http://az7446.vo.msecnd.net/msdn-magazine/msdnmagazine.cxml, defaultViewState=%24facet0%24=Issue%20Date&amp;amp;%24view%24=2&quot;&gt;
   &lt;a href=&quot;http://go.microsoft.com/fwlink/?LinkID=149156&amp;amp;v=4.0.50401.0&quot; style=&quot;text-decoration:none;&quot; &gt;
      &lt;img alt=&quot;Get Microsoft Silverlight&quot; src=&quot;http://go.microsoft.com/fwlink/?LinkId=161376&quot; style=&quot;border-style:none&quot;&gt;
   &lt;/a&gt;
&lt;/object&gt;
</pre>
<h1>Uploading</h1>
<p>As I’m sure you can imagine, uploading 100,000 files to Azure can take a bit of time – and fortunately, from a brief bit of looking around, it seems as though there are more commercial tools to enable a performant upload experience.  At the time that I was working on the magazine collection, there was unfortunately not a ton of tools that could do what I needed – and so I wrote my own tool.  The requirements (and the resulting program) are pretty simple: recursively process a directory and all its contained files and upload all the files.  Additionally, because I’ve got a rockin’ machine with plenty of processor cores to go around, I made sure to take advantage of some of the opportunities for parallelism provided by the <a href="http://blogs.msdn.com/b/pfxteam/">parallel extensions</a> in .NET 4.  I was completely new to the Azure client libs but was fortunate enough to <a href="http://blog.smarx.com/posts/pivot-odata-and-windows-azure-visual-netflix-browsing">get help from Steve Marx</a> (the guy on the Azure team who did the Netflix collection) – so many thanks to Steve!</p>
<p>At any rate, the code to do the upload looks like this:</p>
<pre class="brush: csharp; title: ;" title="">
private static void Main(string[] args) {
    if (args.Length &lt; 3) {
        Console.WriteLine(&quot;Pivot.BlobStorageUpload.exe CollectionPath AccountName AccountKey&quot;);
        return;
    }

    var pivotCollectionFldr = args[0];
    var accountName = args[1];
    var key = args[2];

    const string magazineContainer = &quot;msdn-magazine&quot;;

    var storageAccount = CloudStorageAccount.Parse(string.Format(&quot;DefaultEndpointsProtocol=http;AccountName={0};AccountKey={1}&quot;,accountName, key));
    var client = storageAccount.CreateCloudBlobClient();

    var container = client.GetContainerReference(magazineContainer);

    UploadDirectoryRecursive(pivotCollectionFldr, container);

    Console.WriteLine(&quot;\nFinished!  Press any key to continue...&quot;);
    Console.ReadLine();
}

private static void UploadDirectoryRecursive(string pivotCollectionFolder, CloudBlobContainer container) {
    string cxmlPath = null;

    // use 16 threads to upload
    Parallel.ForEach(EnumerateDirectoryRecursive(pivotCollectionFolder),
                        new ParallelOptions {MaxDegreeOfParallelism = 16},
                        filePath =&gt; {
                            if (Path.GetExtension(filePath) == &quot;.cxml&quot;)    // save #####.cxml for last
                                cxmlPath = filePath;
                            else {
                                var blobAddressUri = Path.GetFullPath(filePath).Substring(pivotCollectionFolder.Length + 1);
                                var blob = container.GetBlobReference(blobAddressUri);
                                UploadFile(filePath, blob);   // upload each file, using the relative path as a blob name
                            }
                        });

    // finish up with the cxml itself
    if (cxmlPath != null)
        UploadFile(cxmlPath, container.GetBlobReference(Path.GetFullPath(cxmlPath).Substring(pivotCollectionFolder.Length + 1)));
}

private static IEnumerable&lt;string&gt; EnumerateDirectoryRecursive(string root) {
    foreach (var file in Directory.GetFiles(root))
        yield return file;
    foreach (var subdir in Directory.GetDirectories(root))
        foreach (var file in EnumerateDirectoryRecursive(subdir))
            yield return file;
}

private static void UploadFile(string filePath, CloudBlob blob) {
    var extension = Path.GetExtension(filePath).ToLower();
    blob.Properties.CacheControl = extension == &quot;.cxml&quot; ? &quot;max-age=1800&quot; : &quot;max-age=7200&quot;;

    switch (extension) {
        case &quot;.xml&quot;:
        case &quot;.cxml&quot;:
        case &quot;.dzi&quot;:
        case &quot;.dzc&quot;:
            blob.Properties.ContentType = &quot;application/xml&quot;;
            break;
        case &quot;.jpg&quot;:
            blob.Properties.ContentType = &quot;image/jpeg&quot;;
            break;
        case &quot;.ico&quot;:
            blob.Properties.ContentType = &quot;image/x-icon&quot;;
            break;
    }
    blob.UploadFile(filePath);
    Console.Write(&quot;*&quot;);
}
</pre>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/msdn-magazine/" title="View all posts in MSDN Magazine" rel="category">MSDN Magazine</a>, <a href="http://codebetter.com/howarddierking/category/pivot/" title="View all posts in Pivot" rel="category">Pivot</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2011/01/28/collection-hosting-using-windows-azure-2/#respond" title="Comment on Collection Hosting Using Windows Azure"><span class="dsq-postid" rel="72 http://codebetter.com/howarddierking/?p=72">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-72 -->

		
						
			<div id="post-85" class="post-85 post type-post status-publish format-standard hentry category-msdn-magazine category-pivot">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/" title="Permalink to Creating the MSDN Magazine Pivot Client" rel="bookmark">Creating the MSDN Magazine Pivot Client</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/" title="11:34 pm" rel="bookmark"><span class="entry-date">January 27, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>When non-developers approach Pivot, they tend to be dismayed by 2 primary things:</p>
<ul>
<li>it’s not something that you can just plug into your data source and have it work
<li>it’s not some discrete thing that you can just slap onto a Web page and have it work</li>
</ul>
<p>We’ve talked about the data aspects of building the MSDN Magazine collection in <a href="http://codebetter.com/howarddierking/2010/10/28/generating-the-collection-data/">previous</a> <a href="http://codebetter.com/howarddierking/2010/09/20/data-and-design-the-chicken-and-egg-problem/">posts</a>.&nbsp; What I want to review in this post is the actual client work required to make the show the collection.&nbsp; There are actually 2 parts to the client work: the Silverlight project which extends the Silverlight Pivot viewer control, and the JavaScript which creates the Silverlight object and listens to events on it.</p>
<h1>Creating the Silverlight XAP</h1>
<p>When you download the <a href="http://www.silverlight.net/learn/pivotviewer/">Pivot SDK</a>, you’ll get the Pivot viewer control – just a standard Silverlight control.&nbsp; Most of the work, then is just packaging that control into a xap file by wrapping it into a Silverlight project and putting it on the mainpage.xaml file (or whatever you’ve declared as your applications RootVisual object).&nbsp; From there, you basically just write code to control the behavior of the control (e.g. what cxml to load, how to handle errors, catching events).&nbsp; As you can see, there’s really not all that much to it:</p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/pivot-viewer-sl-solution.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="pivot-viewer-sl-solution" src="http://codebetter.com/howarddierking/files/2011/01/pivot-viewer-sl-solution_thumb.png" width="274" height="190"></a></p>
<p>That said, there are a couple interesting extensions that I did to enable some capabilities on the control.&nbsp; Specifically, I derived my own control from PivotViewer so that I could hook a protected method and execute conditional logic for the action buttons on a trade card.&nbsp; I also made the Silverlight object scriptable and added a bunch of events so that could better instrument the Pivot experience with our BI system.</p>
<h2>Inheriting from PivotViewer</h2>
<p>As you may have noticed in the MSDN Magazine collection, a trade card can have up to 2 possible action buttons: one button to go read the article and another one to go and get associated sample code.&nbsp; </p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/action-buttons.png"><img style="border-right-width: 0px;margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;border-top-width: 0px;border-bottom-width: 0px;border-left-width: 0px;padding-top: 0px" border="0" alt="action-buttons" src="http://codebetter.com/howarddierking/files/2011/01/action-buttons_thumb.png" width="413" height="115"></a></p>
<p>However, not every article has sample code, and as such, I need to be able to execute some conditional logic to determine whether or not to display the action button.&nbsp; You would hope/expect that the PivotViewer control would expose a method or event which you could hook per collection item that would enable you to specify the custom actions for that item – and you would be right – kind of.&nbsp; The PivotViewer does expose this in the form of a method override.&nbsp; The problem is that it’s a protected method.&nbsp; As a result, I created a custom class deriving from PivotViewer so that I could override the appropriate method and basically expose that method’s functionality to consumers of my custom PivotViewer.</p>
<p><pre class="brush: csharp; title: ;" title="">public class CustomPivotViewer : System.Windows.Pivot.PivotViewer
{
    public Func&lt;string, List&lt;CustomAction&gt;&gt; GetCustomActionsForItemCallback { get; set; }

    protected override List&lt;CustomAction&gt; GetCustomActionsForItem(string itemId) {
        List&lt;CustomAction&gt; customActions = null;

        if (GetCustomActionsForItemCallback != null)
            customActions = GetCustomActionsForItemCallback(itemId);

        return customActions;
    }
}
</pre>
<p>Back in my MainPage.xaml.cs code behind file, then (where I manipulate the instance of my custom PivotViewer object), I then have the following:</p>
<p><pre class="brush: csharp; title: ;" title="">private List&lt;CustomAction&gt; GetCustomActionsForItem(string itemId) {
    var customActions = new List&lt;CustomAction&gt;();

    var item = MagazinePivotViewer.GetItem(itemId);
    if (item.Facets[FACET_KEY_HAS_CODE].First() == FACET_VALUE_HAS_CODE)
        customActions.Add(_getCodeAction);

    if (!string.IsNullOrEmpty(item.Href))
        customActions.Add(_readArticleAction);

    return customActions;
}
</pre>
<p>As the PivotViewer control brings each item’s trade card into focus, it calls the GetCustomActionsForItem method, which my custom class overrides and then delegates to my code behind class using a callback.&nbsp; In my code behind class, that callback function runs the necessary conditional logic and returns a list containing the appropriate actions.&nbsp; The action instances themselves are&nbsp; created during xap initialization and are held in static fields for improving performance.</p>
<h2>Making it Scriptable</h2>
<p>The other major way that I’ve extended the default Pivot viewer functionality is to make my xap scriptable to my HTML page, and forward events coming from the viewer control out to the page.&nbsp; I did this for the MSDN Magazine collection specifically so that I could wire the control up to our business intelligence service (we use Omniture).&nbsp; In case you’ve never had to deal with one of these systems (Omniture, WebTrends, etc.), they don’t just sit on the back end and parse the Web server’s log files.&nbsp; Rather, they rely on an additional HTTP call from the client to the service’s servers.&nbsp; This level of indirection enables the site owners to provide additional detail which can then be used to slice and dice blunt stats such as page views when performing analysis.&nbsp; For the Pivot viewer, I wanted to feed into the analytics system was not just how many people were using the Pivot experience, but *how* they were using it (e.g. are there specific facet categories that are used more than others, do people drill-through or re-pivot using the info pane, etc.).&nbsp; This insight can then be used to drive things like the order in which I show facet categories (or whether I can get rid of categories) and what features I add going forward.</p>
<p>Making the Silverlight object scriptable was pretty straightforward.&nbsp; The first thing to do is register my xap’s mainpage object as a scriptable object using a static method on the HtmlPage class:</p>
<p><pre class="brush: csharp; title: ;" title="">
HtmlPage.RegisterScriptableObject(&quot;PivotViewer&quot;, this);
</pre>
<p>Next, it was just a matter of creating all of the events that I wanted to expose as scriptable.&nbsp; The only requirement that goes beyond the normal pattern for exposing events in .NET is to ensure that the event declaration is decorated with the <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptablememberattribute(v=vs.95).aspx">ScriptableMemberAttribute</a>:</p>
<p><pre class="brush: csharp; title: ;" title="">
[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ArticleButtonClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ArticleLinkClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; CodeButtonClicked;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; FiltersChanged;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; SortChanged;

[ScriptableMember]
public event EventHandler&lt;PivotViewerStateEventArgs&gt; ViewChanged;

protected virtual void OnArticleButtonClicked(string articleUrl) {
    if (ArticleButtonClicked != null)
        ArticleButtonClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl });
}

protected virtual void OnArticleLinkClicked(string articleUrl) {
    if (ArticleLinkClicked != null)
        ArticleLinkClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl });
}

protected virtual void OnCodeButtonClicked(string articleUrl, string codeUrl) {
    if (CodeButtonClicked != null)
        CodeButtonClicked(this, new PivotViewerStateEventArgs { ArticleHref = articleUrl, CodeHref = codeUrl });
}

protected virtual void OnFiltersChanged(string filterString) {
    if (FiltersChanged != null)
        FiltersChanged(this, new PivotViewerStateEventArgs { FilterCategories = filterString });
}

protected virtual void OnSortChanged(string sortFacet) {
    if (SortChanged != null)
        SortChanged(this, new PivotViewerStateEventArgs { SortFacet = sortFacet });
}

protected virtual void OnViewChanged(string view) {
    if (ViewChanged != null)
        ViewChanged(this, new PivotViewerStateEventArgs { View = view });
}
</pre>
<p>Because the events pass a custom EventArguments type, we need to also ensure that this custom type is decorated with <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptabletypeattribute(v=vs.95).aspx">ScriptableTypeAttribute</a> and its members are decorated with <a href="http://msdn.microsoft.com/en-us/library/system.windows.browser.scriptablememberattribute(v=vs.95).aspx">ScriptableMemberAttribute</a>:</p>
<p><pre class="brush: csharp; title: ;" title="">
[ScriptableType]
public class PivotViewerStateEventArgs : EventArgs
{
    [ScriptableMember]
    public string ArticleHref { get; set; }

    [ScriptableMember]
    public string CodeHref { get; set; }

    [ScriptableMember]
    public string FilterCategories { get; set; }

    [ScriptableMember]
    public string SortFacet { get; set; }

    [ScriptableMember]
    public string State { get; set; }

    [ScriptableMember]
    public string View { get; set; }
}
</pre>
<p>Firing the event is consistent with everything you already know from .NET programming – nothing more to see here.</p>
<h1>Consuming the Silverlight</h1>
<p>Because the xap completely encapsulates the Pivot viewer control, the configuration of all inputs is performed by default in the code behind the mainpage.xaml file.&nbsp; In my case, I wanted to have some of these configuration options available through the creation script or markup.&nbsp; To enable this, I enabled several different inputs (including the location of the cxml and the default view state) to be passed in through the Silverlight object’s <a href="http://msdn.microsoft.com/en-us/library/system.windows.startupeventargs.initparams(v=vs.95).aspx">InitParams</a> collection.&nbsp; This is a comma separated list that the application host automatically parses and makes available as a dictionary – through the Application.Current.Host.InitParams object.&nbsp; If you’re creating the Silverlight object using the object tag, you can specify all the configuration options using a param element.&nbsp; In my case, I wrapped the client functionality in a Javascript object, and am therefore creating it using the following:</p>
<p><pre class="brush: jscript; title: ;" title="">
PivotViewer.prototype.renderIn = function (container) {
    var self = this;
    Silverlight.createObject(
                this.xapPath,
                container[0],
                &quot;magazinePivotViewer_SL&quot;,
                {
                    type: &quot;application/x-silverlight-2&quot;,
                    width: &quot;100%&quot;,
                    height: &quot;100%&quot;,
                    background: &quot;white&quot;,
                    version: &quot;4.0.50401.0&quot;,
                    enableHtmlAccess: 'true',
                    autoUpgrade: 'true'
                },
                {
                    onError: this.onSilverlightError,
                    onLoad: function (sender, e) {
                        self.onLoad(sender, e);
                    }
                },
                &quot;collection=&quot; + this.collectionPath + &quot;,defaultViewState=&quot; + this.defaultViewState,
                this);
}
</pre>
<p>If you take a look at the third line from the bottom, you can see where the init parameters is built up from some fields (which were set during the object initializer). Another function of the initializer is that it allows you to pass in JavaScript functions to handle the various state change events that I previously exposed in my mainpage.xaml code behind.</p>
<p><pre class="brush: jscript; title: ;" title="">
var PivotViewer = function (xapPath,
        collectionPath,
        defaultViewState,
        onArticleLinkClicked,
        onArticleButtonClicked,
        onCodeButtonClicked,
        onSortChanged,
        onViewChanged,
        onFiltersChanged) {
    this.xapPath = xapPath;
    this.collectionPath = collectionPath;
    this.defaultViewState = defaultViewState;

    this.onArticleLinkClicked = onArticleLinkClicked;
    this.onArticleButtonClicked = onArticleButtonClicked;
    this.onCodeButtonClicked = onCodeButtonClicked;
    this.onSortChanged = onSortChanged;
    this.onViewChanged = onViewChanged;
    this.onFiltersChanged = onFiltersChanged;

};
</pre>
<p>In order to wire these client side functions up to the scriptable events in my Silverlight code, I&#8217;m hooking the load event in the Silverlight initialization code, and then setting the input JavaScript functions to the Silverlight event members.</p>
<p><pre class="brush: jscript; title: ;" title="">
PivotViewer.prototype.onLoad = function (sender, e) {
  sender.Content.PivotViewer.ArticleLinkClicked = this.onArticleLinkClicked;
  sender.Content.PivotViewer.ArticleButtonClicked = this.onArticleButtonClicked;
  sender.Content.PivotViewer.CodeButtonClicked = this.onCodeButtonClicked;
  sender.Content.PivotViewer.FiltersChanged = this.onFiltersChanged;
  sender.Content.PivotViewer.ViewChanged = this.onViewChanged;
  sender.Content.PivotViewer.SortChanged = this.onSortChanged;
}
</pre>
<p>This then gives me the ability to react in my HTML page to the state change events that are happening in the Pivot viewer Silverlight control. For example, in order to create a state change &#8220;console&#8221;, I would initialize my Pivot collection using the following JQuery:</p>
<p><pre class="brush: jscript; title: ;" title="">
$(document).ready(function () {
    var sl = new PivotViewer(&quot;ClientBin/Magazines.PivotViewer.xap&quot;,
        &quot;http://az7446.vo.msecnd.net/msdn-magazine/msdnmagazine.cxml&quot;,
        &quot;%24facet0%24=Issue%20Date&amp;%24view%24=2&quot;,
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;articleLinkClicked: &quot; + e.ArticleHref + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;articleButtonClicked: &quot; + e.ArticleHref + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;codeButtonClicked: [article - &quot; + e.ArticleHref + &quot;] [code - &quot; + e.CodeHref + &quot;]&quot; + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;sortChanged: &quot; + e.SortFacet + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;onViewChanged: &quot; + e.View + &quot;&lt;br/&gt;&quot;); },
        function (sender, e) { $(&quot;div#console&quot;).append(&quot;OnFiltersChanged: &quot; + e.FilterCategories + &quot;&lt;br/&gt;&quot;); })
            .renderIn($('div#silverlightControlHost'));
});
</pre>
<p>As I've mentioned before, my plan is to make all of the source code available to you through bitbucket (I need to do a little refactoring to get rid of some hard coded authentication strings and then I'll post the location). However, I hope this gives you a good idea of what was involved in creating the Pivot UX parts of the <a href="http://msdn.microsoft.com/magazine">MSDN Magazine pivot collection</a>.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/msdn-magazine/" title="View all posts in MSDN Magazine" rel="category">MSDN Magazine</a>, <a href="http://codebetter.com/howarddierking/category/pivot/" title="View all posts in Pivot" rel="category">Pivot</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2011/01/27/creating-the-msdn-magazine-pivot-client/#respond" title="Comment on Creating the MSDN Magazine Pivot Client"><span class="dsq-postid" rel="85 http://codebetter.com/howarddierking/?p=85">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-85 -->

		
						
			<div id="post-61" class="post-61 post type-post status-publish format-standard hentry category-msdn-magazine category-pivot">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2011/01/03/automating-pivot-trade-card-creation/" title="Permalink to Automating Pivot Trade Card Creation" rel="bookmark">Automating Pivot Trade Card Creation</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2011/01/03/automating-pivot-trade-card-creation/" title="11:58 pm" rel="bookmark"><span class="entry-date">January 3, 2011</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>UPDATE: since I can&#8217;t figure out how to attach the template file discussed here, I&#8217;ve uploaded it to my bitbucket samples repository &#8211; <a href="https://bitbucket.org/howarddierking/samples/src/17c4913453f3/MSDN%20Magazine%20Pivot/MSDNMagazineCollectionTemplate2.htm">you can see the code here</a>.</p>
<p>Sorry for the delay in this part in my series documenting how I created the MSDN Magazine Pivot collection.  Between the holidays and a bunch of other stuff that’s been happening at work (more on that later), I let this slip through the cracks.  Anyways, my gut feel is that for those of you who are interested in creating data-driven Pivot collections, this is likely the installment that you’ll be most interested in.</p>
<p>In Pivot, the trade card is the name given to a single visual unit of data.  For example, in the MSDN Magazine collection, a single article is represented by a single trade card as shown below.</p>
<p><a href="http://codebetter.com/howarddierking/files/2011/01/single-trade-card.png"><img style="margin: 0px 0px 24px;padding-left: 0px;padding-right: 0px;padding-top: 0px;border-width: 0px" src="http://codebetter.com/howarddierking/files/2011/01/single-trade-card_thumb.png" border="0" alt="single-trade-card" width="244" height="244" /></a></p>
<p>Everything you see here with the one exception being the 2 action buttons in the upper right hand corner is part of the trade card.  There’s additional metadata that drives the filter and info panes, but that stuff is defined in your cxml which we covered in the <a href="http://codebetter.com/howarddierking/2010/10/28/generating-the-collection-data/">previous post</a>.  The 2 action buttons are going to be defined in your Silverlight xap – we’ll cover that in a future post.</p>
<p>So when you take a look at all of the different elements on the trade card, you should see that these are simply the data elements that you’ve defined in your cxml (or they are visual elements whose display is conditional on those data elements – the example here being the code icon in the upper right).  The would make this a simple data binding problem, right?  Well, perhaps in some future version, but for now, that’s not quite how things work.</p>
<p>Pivot viewer leverages <a href="http://www.microsoft.com/silverlight/deep-zoom/">Deep Zoom</a> image compositions to do its magic.  This means that all of those various data elements and imagery spread across the trade card are actually a single bitmap which is fed into the Deep Zoom composer to produce a whole bunch of additional bitmaps for different zoom levels.</p>
<p>When Pivot was first available for experimentation, you basically had a couple choices for creating collections.  There was an Excel based tool which was capable of generating both cxml and Deep Zoom collections from your data.  However, the tool did not give you the ability to do anything sophisticated with the trade card image (rather, there was a single column for ‘image’).  For data-driven collections such as the MSDN Magazine collection, the alternative was to figure out how to create the image you wanted for your trade card and then feed the set of trade cards into the Deep Zoom composer software to generate all of the different images for all of the different zoom levels.</p>
<p>For a while, the solution du jour for creating the trade card images was to use a technology like Windows Forms or WPF (where you had a data binding infrastructure), iterating through the source data, binding the data to the form, and then <a href="http://www.grumpydev.com/2009/01/03/taking-wpf-screenshots/">saving a snapshot of the form as the trade card image</a>.  That set could then be fed into the Deep Zoom composer and the outputted composition (dzc file) could be handed to the Pivot Viewer control (along with the cxml) which could then display the collection.</p>
<p>Fortunately, not too long after the Pivot viewer was made available, the Pivot team released a command line utility called pauthor.exe.  This tool allowed you to (among other things) feed in a cxml file and an HTML template file.  It would then follow the same basic steps I outlined above:</p>
<ol>
<li>Bind a cxml item to the HTML template</li>
<li>Take a snapshot of the bound template</li>
<li>Call the Deep Zoom composition API for the set of all captured snapshots</li>
</ol>
<p>This was a hugely helpful tool for a couple of reasons.  Firstly, it was less code that I had to maintain and evolve.  Secondly, pauthor had built-in multi-threading and parallelization, which made it run a great deal faster than performing these steps manually.  And while I could have evolved my custom image generator to have the same great capabilities, I’ll fall back to the first point and say that this was code I didn’t have to write.</p>
<p>So, if you recall the SSIS package that I was using to stitch everything together, you’ll see that the last control flow task is to shell out to pauthor using the following command:</p>
<p>pauthor.exe /source cxml &#8220;Working/msdnmagazine.cxml&#8221; /target deepzoom &#8220;Output/msdnmagazine.cxml&#8221; /html-template &#8220;MSDNMagazineCollectionTemplate2.htm&#8221;</p>
<p>The Template</p>
<p>So you’ve seen how the cxml gets generated, you’ve seen how it is used to create the Deep Zoom image compositions – the only thing you haven’t seen is the template that is used to create the individual trade cards, so here it is.</p>
<pre class="brush: xml; title: ;" title="">
&lt;!-- size: 1200, 1200 --&gt;
&lt;html&gt;
&lt;head&gt;
   &lt;meta content=&quot;text/html; charset=utf-8&quot; http-equiv=&quot;Content-Type&quot; /&gt;
   &lt;script type=&quot;text/javascript&quot;&gt;
      var popGroup = &quot;{Popularity}&quot;.toLowerCase();

      switch (popGroup) {
         case &quot;viewed often&quot;:
            popGroup = &quot;top&quot;;
            break;
         case &quot;viewed occasionally&quot;:
            popGroup = &quot;middle&quot;;
            break;
         default:
            popGroup = &quot;bottom&quot;;
      }

      function GetNthPosition(str, c, occurrence) {
         var lastoccurrence = 0;
         for (var i = 0; i &lt; occurrence; i++) {
            var t = str.indexOf(c, lastoccurrence + 1);
            if (t == lastoccurrence)
               return lastoccurrence;
            else if (t == -1)
               return -1;
            lastoccurrence = t;
         }
         return lastoccurrence;
      }
   &lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
   &lt;div id=&quot;tradeCard&quot;&gt;
      &lt;div id=&quot;top&quot;&gt;
         &lt;div id=&quot;codeIndicator&quot;&gt;
            &lt;script type=&quot;text/javascript&quot;&gt;
                    var hasCode = &quot;{Has Code}&quot;;

                    if (hasCode == &quot;Has Code&quot;) {
                        if (popGroup == &quot;bottom&quot;)
                            document.write('&lt;img alt=&quot;&quot; src=&quot;Images/hasCode_black.png&quot; /&gt;');
                        else
                            document.write('&lt;img alt=&quot;&quot; src=&quot;Images/hasCode_white.png&quot; /&gt;');
                    }
                &lt;/script&gt;
             &lt;/div&gt;
             &lt;div id=&quot;headline&quot;&gt;
                 &lt;span id=&quot;subhead&quot;&gt;{Subhead}&lt;/span&gt;: &lt;br /&gt;
                 &lt;span id=&quot;title&quot;&gt;
                     &lt;script type=&quot;text/javascript&quot;&gt;
                        var titleStr = &quot;{Title}&quot;;
                        if (titleStr == &quot;(no data)&quot;)
                            document.write(&quot;&quot;);
                        else
                            document.write(titleStr);
                    &lt;/script&gt;
                 &lt;/span&gt;
             &lt;/div&gt;
             &lt;div id=&quot;authors&quot;&gt;{Authors}&lt;/div&gt;
         &lt;/div&gt;
         &lt;div id=&quot;bottom&quot;&gt;
             &lt;div id=&quot;description&quot;&gt;
                 &lt;script type=&quot;text/javascript&quot;&gt;
                    var desc = &quot;{description}&quot;;

                    if (desc) {
                        var fifthSpacePos = GetNthPosition(desc, ' ', 5);

                        document.write('&lt;span id=&quot;lead&quot;&gt;' + desc.substring(0, fifthSpacePos) + ' &lt;/span&gt;');

                        var detailStr = desc.substring(fifthSpacePos + 1, desc.length);
                        if (detailStr.length &gt; 400) {
                            detailStr = detailStr.substring(0, detailStr.indexOf(&quot; &quot;, 400)) + &quot;...&quot;;
                        }

                        document.write('&lt;span id=&quot;detail&quot;&gt;' + detailStr + '&lt;/span&gt;');
                    }

                &lt;/script&gt;
             &lt;/div&gt;
             &lt;div id=&quot;popularity&quot;&gt;
                 &lt;div id=&quot;popularityGroup&quot;&gt;{Popularity}&lt;/div&gt;
                 &lt;div id=&quot;pageViewsSnapshotDates&quot;&gt;{Page Views} Page Views in November&lt;/div&gt;
             &lt;/div&gt;
             &lt;div id=&quot;issue&quot;&gt;&lt;span class=&quot;verticalRule&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span&gt;{Issue}&lt;/span&gt;&lt;/div&gt;
             &lt;div id=&quot;topics&quot;&gt;
                 &lt;script type=&quot;text/javascript&quot;&gt;
                    var allTopicsStr = &quot;{Topic:join: | }&quot;;

                    if (allTopicsStr.indexOf(&quot;Topic:join:&quot;, 0) &gt; -1 || &quot;{Issue}&quot;.length &gt; 20)
                        document.write(&quot;&quot;);
                    else {
                        var secondPipePos = GetNthPosition(allTopicsStr, &quot; | &quot;, 2);
                        if (secondPipePos &gt; -1)
                            allTopicsStr = allTopicsStr.substring(0, secondPipePos);

                        if (allTopicsStr.length &gt; 33) //second pass to ensure still not too long
                            allTopicsStr = allTopicsStr.substring(0, allTopicsStr.lastIndexOf(&quot; | &quot;));

                        document.write(allTopicsStr);
                    }
                &lt;/script&gt;
             &lt;/div&gt;
         &lt;/div&gt;
     &lt;/div&gt;
      &lt;script type=&quot;text/javascript&quot;&gt;
        document.getElementById(&quot;tradeCard&quot;).className = popGroup;
    &lt;/script&gt;
 &lt;/body&gt;
 &lt;/html&gt;
</pre>
<p>A couple quick notes on this code – and some stuff to be aware of should you go down this path as well.</p>
<ul>
<li>Make sure you include that size comment at the top of the file – this is needed by pauthor.exe so that it knows the appropriate region of which to take a snapshot post data binding.</li>
<li>As you&#8217;ve probably already noticed, the data binding syntax is simply the name of the facet enclosed in curly braces.</li>
<li>I’ve commented out the CSS that defines all the layout and background images – I’ve done this only for space.  I’ll attach the HTML template file to this post for a more thorough view.</li>
<li>While unobtrusive JavaScript is the right way to build Web pages, it’s not always the right way to build pauthor templates.  This is because as pauthor iterates, it only allows for a certain amount of time for the data binding operation.  If the operation goes past this time quantum, the item is skipped by pauthor.  Initially, my template did all of its work in an unobtrusive manner – and the result was a bunch of blank squares in the generated collection.  As such, you can see that I’m doing a bunch of inline logic and document.write code.</li>
<li>Testing is a bit of a pain, but it’s doable (and should be done).  Download the whole template file to see some of the test code that I have in there.</li>
</ul>
<p>I hope this gives you a good sense of how the trade cards were created for the MSDN Magazine Pivot collection.  I’ll follow up with the Silverlight bits and then the Azure bits.  Hopefully, I’ll let less time go by this time.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/msdn-magazine/" title="View all posts in MSDN Magazine" rel="category">MSDN Magazine</a>, <a href="http://codebetter.com/howarddierking/category/pivot/" title="View all posts in Pivot" rel="category">Pivot</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2011/01/03/automating-pivot-trade-card-creation/#respond" title="Comment on Automating Pivot Trade Card Creation"><span class="dsq-postid" rel="61 http://codebetter.com/howarddierking/?p=61">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-61 -->

		
						
			<div id="post-56" class="post-56 post type-post status-publish format-standard hentry category-uncategorized">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2010/12/18/umbraco-source-code-migrated-to-mercurial/" title="Permalink to Umbraco Source Code Migrated to Mercurial" rel="bookmark">Umbraco Source Code Migrated to Mercurial</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2010/12/18/umbraco-source-code-migrated-to-mercurial/" title="3:43 pm" rel="bookmark"><span class="entry-date">December 18, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>It looks as though the good folks at Umbraco have successfully migrated the bulk of their codebase from SVN to Mercurial on <a href="http://umbraco.codeplex.com/">CodePlex</a>.&nbsp; I say “bulk of” because I don’t yet see the v5.0 branch – though based on a <a href="http://umbraco.org/follow-us/blog-archive/2010/12/8/heads-up-umbraco-sourcecode-at-codeplex-to-switch-to-mercurial">recent post by Alex Norcliffe</a>, I expect to see it soon enough.</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/uncategorized/" title="View all posts in Uncategorized" rel="category">Uncategorized</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2010/12/18/umbraco-source-code-migrated-to-mercurial/#respond" title="Comment on Umbraco Source Code Migrated to Mercurial"><span class="dsq-postid" rel="56 http://codebetter.com/howarddierking/2010/12/18/umbraco-source-code-migrated-to-mercurial/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-56 -->

		
						
			<div id="post-55" class="post-55 post type-post status-publish format-standard hentry category-architecture category-international category-web">
			<h2 class="entry-title"><a href="http://codebetter.com/howarddierking/2010/12/18/thoughts-on-ip-reverse-lookup/" title="Permalink to Thoughts On IP Reverse Lookup?" rel="bookmark">Thoughts On IP Reverse Lookup?</a></h2>

			<div class="entry-meta">
				<span class="meta-prep meta-prep-author">Posted on </span><a href="http://codebetter.com/howarddierking/2010/12/18/thoughts-on-ip-reverse-lookup/" title="6:30 am" rel="bookmark"><span class="entry-date">December 18, 2010</span></a> <span class="meta-sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codebetter.com/howarddierking" title="View all posts by Howard Dierking">Howard Dierking</a></span>			</div><!-- .entry-meta -->

				<div class="entry-content">
				<p>I was having a discussion today about URLs and associated behaviors with a colleague who works with many of our international subsidiaries.&nbsp; In the course of the conversation, we came to the topic of IP reverse lookup and it’s pros/cons for geo-detection and content routing.&nbsp; In the past, we’ve used this technique as a last ditch effort to try and route a user to the most relevant possible version of a site or page (by last ditch, I mean to say that there’s no info provided by the URL, by user preferences, or by browser headers).&nbsp; However, my colleague had some general concerns about using it at all – a couple reasons were:</p>
<ul>
<li>Geo-detection systems based on IP addresses tend to have problems with accuracy as the result of things like proxy servers</li>
<li>We’re making a decision based on information about you that you are not able to control (unlike something like your browser language or any other HTTP header)</li>
</ul>
<p>We talked through several different scenarios, including user scenarios like that of a business traveler who may want to see content in his language but see local events for the region in which he is traveling.&nbsp; We also talked through several of the different geo-political scenarios where users in a country may speak the same language as users in another country, but should never be automatically directed to the site of that other country for legal reasons.&nbsp; </p>
<p>In the end, the question came down to whether or not we should use any form of implicit user context to make any kind of default content routing decision (e.g. browser lang or geo-detection).&nbsp; Making the choice explicit would certainly disambiguate the Web site’s behavior for users, though it would also add a step for first time visitors.</p>
<p>What are your thoughts/experiences in this area?&nbsp; Any good pointers to articles/reference that helped?</p>
							</div><!-- .entry-content -->
	
			<div class="entry-utility">
				<span class="cat-links"><span class="entry-utility-prep entry-utility-prep-cat-links">Posted in <a href="http://codebetter.com/howarddierking/category/architecture/" title="View all posts in architecture" rel="category">architecture</a>, <a href="http://codebetter.com/howarddierking/category/international/" title="View all posts in International" rel="category">International</a>, <a href="http://codebetter.com/howarddierking/category/web/" title="View all posts in Web" rel="category">Web</a></span></span>
				<span class="meta-sep"> | </span>
												<span class="comments-link"><a href="http://codebetter.com/howarddierking/2010/12/18/thoughts-on-ip-reverse-lookup/#respond" title="Comment on Thoughts On IP Reverse Lookup?"><span class="dsq-postid" rel="55 http://codebetter.com/howarddierking/2010/12/18/thoughts-on-ip-reverse-lookup/">View Comments</span></a></span>
							</div><!-- #entry-utility -->
		</div><!-- #post-55 -->

		
			
	<div id="nav-below" class="navigation">
		<div class="nav-next"><a href="?page=1" > Next Page &raquo;</a></div>
		
	</div><!-- #nav-below -->
			</div><!-- #main -->
			<div id="sidebar" class="grid_4">
						<div id="primary" class="widget-area">
			<ul class="xoxo">
				<div class="ad-container">
					<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-new-features?utm_source=cb&utm_medium=button&utm_term=4328&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="125" height="125" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/ANTSPP5_125x125_M1.gif"></a>
					<embed width="125" height="125" flashvars="clickTARGET=_blank&amp;clickTAG=http%3A%2F%2Fd1.openx.org%2Fck.php%3Foaparams%3D2__bannerid%3D62753__zoneid%3D29419__cb%3Da0471ce5e8__r_id%3Dd42118811971f057012db20aa261c5c1__r_ts%3Dldef6x__oadest%3Dhttp%253A%252F%252Fwww.jetbrains.com%252Fresharper%252F%253Frs4cb125" allowscriptaccess="always" quality="high" name="Advertisement" id="Advertisement" style="" src="http://s3.amazonaws.com/CodeBetter/Creative/tc_125x125_simple2.swf" type="application/x-shockwave-flash">
				</div>
			
				<li id="user_bio-2" class="widget-container widget_user_bio"><h3 class="widget-title"></h3><div class="ub-grav" style="margin:5px 5px 0px 5px;float: none;"><img alt='' src='http://0.gravatar.com/avatar/859e318f8403226ff4b912edf77fba2a?s=96&amp;d=http%3A%2F%2F0.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D96&amp;r=G' class='avatar avatar-96 photo' height='96' width='96' /></div>I like technology...a lot...
</li><li id="tag_cloud-3" class="widget-container widget_tag_cloud"><h3 class="widget-title">Categories</h3><div class="tagcloud"><a href='http://codebetter.com/howarddierking/category/ado-net-data-services/' class='tag-link-4922' title='5 topics' style='font-size: 19.2pt;'>ADO.NET Data Services</a>
<a href='http://codebetter.com/howarddierking/category/alt-net/' class='tag-link-1362' title='1 topic' style='font-size: 8pt;'>ALT.NET</a>
<a href='http://codebetter.com/howarddierking/category/architecture/' class='tag-link-2588' title='4 topics' style='font-size: 17.3333333333pt;'>architecture</a>
<a href='http://codebetter.com/howarddierking/category/auto-tagging/' class='tag-link-4908' title='1 topic' style='font-size: 8pt;'>auto tagging</a>
<a href='http://codebetter.com/howarddierking/category/bdd/' class='tag-link-2123' title='4 topics' style='font-size: 17.3333333333pt;'>BDD</a>
<a href='http://codebetter.com/howarddierking/category/ddd/' class='tag-link-1717' title='1 topic' style='font-size: 8pt;'>DDD</a>
<a href='http://codebetter.com/howarddierking/category/fluent-nhibernate/' class='tag-link-4911' title='1 topic' style='font-size: 8pt;'>Fluent NHibernate</a>
<a href='http://codebetter.com/howarddierking/category/hardware/' class='tag-link-4927' title='1 topic' style='font-size: 8pt;'>hardware</a>
<a href='http://codebetter.com/howarddierking/category/home-network/' class='tag-link-4909' title='1 topic' style='font-size: 8pt;'>Home Network</a>
<a href='http://codebetter.com/howarddierking/category/international/' class='tag-link-9201' title='1 topic' style='font-size: 8pt;'>International</a>
<a href='http://codebetter.com/howarddierking/category/ioc/' class='tag-link-1361' title='1 topic' style='font-size: 8pt;'>IoC</a>
<a href='http://codebetter.com/howarddierking/category/msdn-magazine/' class='tag-link-4919' title='7 topics' style='font-size: 22pt;'>MSDN Magazine</a>
<a href='http://codebetter.com/howarddierking/category/mspec/' class='tag-link-2130' title='2 topics' style='font-size: 12.2pt;'>MSpec</a>
<a href='http://codebetter.com/howarddierking/category/my-setup/' class='tag-link-4926' title='1 topic' style='font-size: 8pt;'>my setup</a>
<a href='http://codebetter.com/howarddierking/category/nhibernate/' class='tag-link-2527' title='1 topic' style='font-size: 8pt;'>NHibernate</a>
<a href='http://codebetter.com/howarddierking/category/performance/' class='tag-link-4925' title='2 topics' style='font-size: 12.2pt;'>performance</a>
<a href='http://codebetter.com/howarddierking/category/pivot/' class='tag-link-4931' title='6 topics' style='font-size: 20.8333333333pt;'>Pivot</a>
<a href='http://codebetter.com/howarddierking/category/r/' class='tag-link-4916' title='3 topics' style='font-size: 15pt;'>R#</a>
<a href='http://codebetter.com/howarddierking/category/refactoring/' class='tag-link-4737' title='1 topic' style='font-size: 8pt;'>Refactoring</a>
<a href='http://codebetter.com/howarddierking/category/ssis/' class='tag-link-4921' title='5 topics' style='font-size: 19.2pt;'>SSIS</a>
<a href='http://codebetter.com/howarddierking/category/tortoisesvn/' class='tag-link-4923' title='1 topic' style='font-size: 8pt;'>TortoiseSVN</a>
<a href='http://codebetter.com/howarddierking/category/uncategorized/' class='tag-link-1044' title='5 topics' style='font-size: 19.2pt;'>Uncategorized</a>
<a href='http://codebetter.com/howarddierking/category/virtualization/' class='tag-link-4918' title='1 topic' style='font-size: 8pt;'>virtualization</a>
<a href='http://codebetter.com/howarddierking/category/wcf/' class='tag-link-4928' title='1 topic' style='font-size: 8pt;'>WCF</a>
<a href='http://codebetter.com/howarddierking/category/web/' class='tag-link-5485' title='1 topic' style='font-size: 8pt;'>Web</a>
<a href='http://codebetter.com/howarddierking/category/windows-7/' class='tag-link-4917' title='1 topic' style='font-size: 8pt;'>Windows 7</a>
<a href='http://codebetter.com/howarddierking/category/windsor/' class='tag-link-4930' title='1 topic' style='font-size: 8pt;'>Windsor</a></div>
</li>		
						
			</ul>
			
		</div><!-- #primary .widget-area -->
		
		<div id="secondary" class="widget-area">
				<script type="text/javascript" src="http://engine.theloungenet.com/z/15/adzerk1_2_5"></script>
				<div id="adzerk1"></div>
				
				<ul class="xoxo">		
					<li id="archives-2" class="widget-container widget_archive"><h3 class="widget-title">Archives</h3>		<ul>
			<li><a href='http://codebetter.com/howarddierking/2011/01/' title='January 2011'>January 2011</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/12/' title='December 2010'>December 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/10/' title='October 2010'>October 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/09/' title='September 2010'>September 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2010/01/' title='January 2010'>January 2010</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/12/' title='December 2009'>December 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/11/' title='November 2009'>November 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/10/' title='October 2009'>October 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/09/' title='September 2009'>September 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/08/' title='August 2009'>August 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/07/' title='July 2009'>July 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/05/' title='May 2009'>May 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/04/' title='April 2009'>April 2009</a></li>
	<li><a href='http://codebetter.com/howarddierking/2009/03/' title='March 2009'>March 2009</a></li>
		</ul>
</li>				</ul>	
				
				<a target="_blank" href="http://www.red-gate.com/products/dotnet-development/ants-performance-profiler/entrypage/version-6-csharp?utm_source=cb&utm_medium=rectangle&utm_term=4327&utm_content=app6release&utm_campaign=antsperformanceprofiler"><img width="300" height="250" border="0" title="" alt="" src="http://s3.amazonaws.com/CodeBetter/Creative/APP6_Launch_C%23_Jun10_300x250_M1.gif?AWSAccessKeyId=0KMA35HT86EVXB99Z302&amp;Expires=1458095516&amp;Signature=BIBDilUaLnZe1uKfVKyyTBxr%2BvE%3D"></a>
				
		</div><!-- #secondary .widget-area -->			</div><!--sidebar-->
		</div><!-- #content -->
	
</div><!-- end div tabs see header.php -->
	
	<div id="footer">
		<div class="container_12">
		<div id="footer-widget-area">
				<div class="grid_4">					
					<ul>
					<li><a href="http://codebetter.com" title="home">Home</a></li>
					<li class="page_item page-item-2"><a href="http://codebetter.com/about/" title="About">About</a></li>
<li class="page_item page-item-8"><a href="http://codebetter.com/codebetter-ci/" title="CodeBetter CI">CodeBetter CI</a></li>
<li class="page_item page-item-6"><a href="http://codebetter.com/community/" title="Community">Community</a></li>
<li class="page_item page-item-10"><a href="http://codebetter.com/editors/" title="Editors">Editors</a></li>
<li class="page_item page-item-41"><a href="http://codebetter.com/globalsearch/" title="Search Results">Search Results</a></li>
					<li><a href="http://feeds.feedburner.com/CodeBetter" rel="alternate" type="application/rss+xml"><img src="http://www.feedburner.com/fb/images/pub/feed-icon16x16.png" alt="" style="vertical-align:middle;border:0"/></a><a href="http://feeds.feedburner.com/CodeBetter"><img src="http://feeds.feedburner.com/~fc/CodeBetter?bg=FFFFFF&amp;fg=2E9BD2&amp;anim=1" height="26" width="88" style="vertical-align:middle;border:0"/></a></li>
					</ul>
				</div><!-- #second .widget-area -->
				<div class="grid_4">
					
					<h3>Friends of CodeBetter.Com</h3>
<ul>

<li><a href="/blogs/products/pages/64386.aspx">Red-Gate Tools For SQL and .NET</a></li>
<li><a href="/blogs/products/pages/64615.aspx">Telerik</a></li>
<li><a href="/blogs/products/pages/142174.aspx">JetBrains - ReSharper</a></li>
<li><a href="/blogs/products/pages/Beyond-Compare.aspx">Beyond Compare</a></li>
<li><a href="/blogs/products/pages/.NET-Memory-Profiler.aspx">.NET Memory Profiler</a></li>
<li><a href="http://www.ndepend.com/">NDepend</a></li>
<li><a href="http://www.sapphiresteel.com/">Ruby In Steel</a></li>
<li><a href="http://www.slickedit.com/">SlickEdit</a></li>
<li><a href="http://www.gurock.com/products/smartinspect/">SmartInspect .NET Logging</a></li>
<li>NGEDIT: <a href="http://www.viemu.com/">ViEmu</a> and <a href="http://www.codekana.com/">Codekana</a> </li>
<li><a href="http://www.devexpress.com/" target="_blank">DevExpress</a></li>
<li><a href="http://nhprof.com" target="_blank">NHibernate Profiler</a></li>
<li><a href="http://unfuddle.com" target="_blank">Unfuddle</a></li>
<li><a href="http://www.balsamiq.com/products/mockups" target="_blank">Balsamiq Mockups</a></li>
<li><a href="http://scrumy.com" target="_blank">Scrumy</a> &lt;-- NEW Friend!</li>

	</ul>				
				</div><!-- #third .widget-area -->
				<div class="grid_4">
					CodeBetter.Com &copy; '11<br />
						Stuff you need to Code Better!<br />
				Proudly powered by <span id="generator-link"><a href="http://wordpress.org/" title="Semantic Personal Publishing Platform" rel="generator">WordPress</a></span>.					
				</div><!-- #fourth .widget-area -->
			</div><!-- #footer-widget-area -->		
		
			</div><!-- end div.container_12 -->

	</div><!-- end div#footer -->
		
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-531207-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shCore.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushCSharp.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushRuby.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushJScript.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/scripts/shBrushXml.js?ver=3.0.83b'></script>
<script type='text/javascript' src='http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/third-party-brushes/shBrushFSharp.js?ver=3.0.83b'></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://cdn1.codebetter.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['tab-size'] = 2;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['wrap-lines'] = false; 
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.all();
</script>
 
</body>
</html>
<!-- Dynamic page generated in 0.299 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2011-01-31 12:56:42 -->
<!-- super cache -->